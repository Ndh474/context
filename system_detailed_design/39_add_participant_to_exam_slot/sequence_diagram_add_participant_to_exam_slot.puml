@startuml add_participant_to_exam_slot
!theme plain
hide footbox

actor "Data Operator" as Admin

participant "«user interaction»\n:ExamSlotParticipantsPage" as UI
participant "«control»\n:ExamSlotController" as Controller
participant "«service»\n:ExamSlotService" as Service
participant "«database wrapper»\n:ExamSlotParticipantRepository" as Repository
participant "«entity»\n:ExamSlotParticipant" as Entity

' --- MAIN FLOW ---
Admin -> UI: Click "Add Participant"
activate UI

UI -> UI: Open add dialog

Admin -> UI: Select Student & Submit
UI -> Controller: POST /api/v1/exam-slots/{slotId}/participants
activate Controller

Controller -> Service: addParticipant(slotId, request)
activate Service

' Validation (Internal)
Service -> Service: validateSlotAndStudent(slotId, studentId)

alt Validation failed
    Service -->> Controller: <<throw>> ValidationException
    Controller -->> UI: 400 Bad Request
    UI -->> Admin: Show error message
end

' --- CREATE ENTITY ---
Service -> Entity: new ExamSlotParticipant(slot, student)
activate Entity
Entity -->> Service: participant
deactivate Entity

' --- SAVE ---
Service -> Repository: save(participant)
activate Repository
Repository -->> Service: savedParticipant
deactivate Repository

' Auto-create exam attendance (internal)
Service -> Service: ensureExamAttendanceExists(slot, student)

Service -->> Controller: ExamSlotParticipantDTO
deactivate Service

Controller -->> UI: 201 Created
deactivate Controller

UI -->> Admin: Show success message\nRefresh list
deactivate UI

@enduml
