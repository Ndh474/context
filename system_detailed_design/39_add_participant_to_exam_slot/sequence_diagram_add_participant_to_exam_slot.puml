@startuml add_participant_to_exam_slot
!theme plain
hide footbox

actor Admin
participant ":ExamSlotController" as Controller
participant ":ExamSlotService" as Service
participant ":ExamSlotParticipantRepository" as Repository
participant "Database" as DB

' --- MAIN FLOW ---
Admin -> Controller: POST /api/v1/exam-slots/{slotId}/participants
activate Controller

Controller -> Service: addParticipant(slotId, request)
activate Service

' Validation logic (internal: slot/student/subject/enrollment validation, duplicate check)

alt Validation failed
    Service -->> Controller: <<throw>> ValidationException
    Controller --> Admin: 400 Bad Request / 404 Not Found / 409 Conflict
end

Service -> Repository: save(participant)
activate Repository

Repository -> DB: Insert or Update Participant
activate DB
DB --> Repository: Saved Participant
deactivate DB

Repository --> Service: ExamSlotParticipant
deactivate Repository

' Auto-create exam attendance (internal)

Service -> Repository: findByIdWithDetails(participantId)
activate Repository

Repository -> DB: Query Participant with Details
activate DB
DB --> Repository: ExamSlotParticipantDTO
deactivate DB

Repository --> Service: ExamSlotParticipantDTO
deactivate Repository

Service --> Controller: ExamSlotParticipantDTO
deactivate Service

Controller --> Admin: 201 Created
deactivate Controller

@enduml
