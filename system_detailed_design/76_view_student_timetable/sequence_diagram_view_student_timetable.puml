@startuml view_student_timetable
!theme plain
hide footbox

actor "Student" as Student

participant "«user interaction»\n:StudentDashboardPage" as UI
participant "«control»\n:DashboardController" as Controller
participant "«service»\n:StudentDashboardService" as Service
participant "«database wrapper»\n:SemesterRepository" as SemesterRepo
participant "«database wrapper»\n:SlotRepository" as SlotRepo
participant "«database wrapper»\n:EnrollmentRepository" as EnrollmentRepo

' === MAIN FLOW ===
Student -> UI: Navigate to Dashboard\nor select semester
activate UI

UI -> Controller: GET /api/v1/dashboard/student?semesterId={id}
activate Controller

Controller -> Service: getDashboardData(studentUserId, semesterId)
activate Service

' === VALIDATION ===
Service -> Service: validateStudentExists(studentUserId)

alt Student not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller -->> UI: 404 Not Found
    UI -->> Student: Show error message
end

' === GET CURRENT SEMESTER (if not specified) ===
opt semesterId is null
    Service -> SemesterRepo: findCurrentSemesters()
    activate SemesterRepo
    SemesterRepo -->> Service: List<Semester>
    deactivate SemesterRepo
end

' === GET ALL SEMESTERS FOR DROPDOWN ===
Service -> SemesterRepo: findAll()
activate SemesterRepo
SemesterRepo -->> Service: List<Semester>
deactivate SemesterRepo

' === GET NEXT DAY SLOTS ===
Service -> SlotRepo: findNextDaySlotsByStudentId(studentUserId, semesterId, currentTime)
activate SlotRepo
SlotRepo -->> Service: List<StudentSlotDTO>
deactivate SlotRepo

' === GET UPCOMING LEARNING SLOTS ===
Service -> SlotRepo: findUpcomingLearningSlotsBySemester(studentUserId, semesterId, currentTime)
activate SlotRepo
SlotRepo -->> Service: List<StudentSlotDTO>
deactivate SlotRepo

' === GET UPCOMING EXAM SLOTS ===
Service -> SlotRepo: findUpcomingExamSlotsBySemester(studentUserId, semesterId, currentTime)
activate SlotRepo
SlotRepo -->> Service: List<StudentSlotDTO>
deactivate SlotRepo

' === GET ENROLLED SUBJECTS ===
Service -> EnrollmentRepo: findCurrentSemesterSubjectsByStudentId(studentUserId, semesterId)
activate EnrollmentRepo
EnrollmentRepo -->> Service: List<StudentSubjectDTO>
deactivate EnrollmentRepo

Service -->> Controller: StudentDashboardResponse
deactivate Service

Controller -->> UI: 200 OK
deactivate Controller

UI -->> Student: Display dashboard\n(timetable, upcoming slots, subjects)
deactivate UI

@enduml
