@startuml View List Subject - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class SubjectController {
  - subjectService : SubjectService
  + search(request : SubjectSearchRequest) : PagingResponse<SubjectDTO>
}

class SubjectService {
  - subjectRepository : SubjectRepository
  + search(request : SubjectSearchRequest) : List<SubjectDTO>
  + count(request : SubjectSearchRequest) : Long
}

interface SubjectRepository <<interface>> {
  + findById(id : Short) : Optional<Subject>
  + save(subject : Subject) : Subject
}

interface CustomSubjectRepository <<interface>> {
  + search(request : SubjectSearchRequest) : List<SubjectDTO>
  + count(request : SubjectSearchRequest) : Long
}

class SubjectRepositoryImpl {
  - em : EntityManager
  + search(request : SubjectSearchRequest) : List<SubjectDTO>
  + count(request : SubjectSearchRequest) : Long
  - buildWhereClause(parameters : Map<String, Object>, request : SubjectSearchRequest) : String
  - buildOrderBy(sortBy : String, sort : String) : String
  - tupleToSubjectDTO(tuple : Tuple) : SubjectDTO
}

class Subject {
  - id : Short
  - name : String
  - code : String
  - majors : Set<Major>
  - academicClasses : Set<AcademicClass>
}

class Major {
  - id : Short
  - name : String
  - code : String
  - subjects : Set<Subject>
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class SubjectSearchRequest {
  - majorId : Short
}

class PagedRequest {
  - page : Integer
  - pageSize : Integer
  - sort : String
  - sortBy : String
  - search : String
  - isActive : Boolean
  + getPage() : Integer
  + getPageSize() : Integer
  + getSearch() : String
  + getSort() : String
  + getSortBy() : String
  + getActive() : Boolean
}

class SubjectDTO {
  - id : Short
  - name : String
  - code : String
  - majors : List<MajorDTO>
  - totalClass : Integer
  - totalActiveClass : Integer
}

class MajorDTO {
  - id : Short
  - name : String
  - code : String
  - totalSubject : Integer
}

class BaseDTO {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class PagingResponse<T> {
  - status : int
  - message : String
  - code : String
  - data : PageableResponse
  + of(items : List<T>, total : Long, request : PagedRequest) : PagingResponse<T>
}

class PageableResponse {
  - items : List<T>
  - totalPages : int
  - currentPage : int
  - pageSize : int
  - totalItems : long
}

SubjectController --> SubjectService
SubjectService --> SubjectRepository
SubjectRepositoryImpl --> EntityManager

SubjectController ..> SubjectSearchRequest : <<use>>
SubjectController ..> PagingResponse : <<use>>
SubjectService ..> SubjectSearchRequest : <<use>>
SubjectService ..> SubjectDTO : <<use>>
SubjectRepository ..> Subject : <<use>>
CustomSubjectRepository ..> SubjectSearchRequest : <<use>>
CustomSubjectRepository ..> SubjectDTO : <<use>>

CustomSubjectRepository <|.. SubjectRepositoryImpl

BaseEntity <|-- Subject
BaseEntity <|-- Major
PagedRequest <|-- SubjectSearchRequest
BaseDTO <|-- SubjectDTO
BaseDTO <|-- MajorDTO

PagingResponse +-- PageableResponse

Subject *-- Major

@enduml
