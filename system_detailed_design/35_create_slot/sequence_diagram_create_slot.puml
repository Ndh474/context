@startuml create_slot
!theme plain
hide footbox

actor "Data Operator" as DataOperator

participant "«user interaction»\n:SlotFormDialog" as UI
participant "«control»\n:SlotController" as Controller
participant "«service»\n:SlotService" as Service
participant "«database wrapper»\n:SlotRepository" as Repository
participant "«entity»\n:Slot" as Entity

' === MAIN FLOW ===
DataOperator -> UI: Click "Create Slot"
activate UI

UI -> UI: Open form dialog

DataOperator -> UI: Input slot data\n(time, class/semester, room, staff)

DataOperator -> UI: Submit form
UI -> Controller: POST /api/v1/slots
activate Controller

Controller -> Service: create(request)
activate Service

' === VALIDATIONS ===
alt End time <= Start time
    Service -->> Controller: <<throw>> BadRequestException
    Controller -->> UI: 400 Bad Request
end

Service -> Repository: existsByRoomAndTimeRange(roomId, ...)
activate Repository
Repository -->> Service: Boolean
deactivate Repository

alt Room conflict
    Service -->> Controller: <<throw>> BadRequestException
    Controller -->> UI: 400 Bad Request
end

Service -> Repository: existsByStaffAndTimeRange(staffId, ...)
activate Repository
Repository -->> Service: Boolean
deactivate Repository

alt Staff conflict
    Service -->> Controller: <<throw>> BadRequestException
    Controller -->> UI: 400 Bad Request
end

' === LOOKUP REFERENCES (Internal) ===
Service -> Service: validateAndGetReferences(semesterId, classId, roomId, staffId)
' (Omitted interactions with other repositories for simplicity)

' === CREATE ENTITY ===
Service -> Entity: new Slot(data)
activate Entity
Entity -->> Service: slot
deactivate Entity

' === SAVE ===
Service -> Repository: save(slot)
activate Repository
Repository -->> Service: savedSlot
deactivate Repository

' === ATTENDANCE GENERATION ===
Service -> Service: createInitialAttendanceRecords(savedSlot)
' (Internal method call details omitted)

Service -->> Controller: SlotDTO
deactivate Service

Controller -->> UI: 201 Created
deactivate Controller

UI -->> DataOperator: Show success message\nClose dialog & refresh list
deactivate UI

@enduml
