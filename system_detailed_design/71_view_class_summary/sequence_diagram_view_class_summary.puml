@startuml view_class_summary
!theme plain
hide footbox

actor "Lecturer" as Lecturer

participant "«user interaction»\n:ClassSummaryPage" as UI
participant "«control»\n:ClassController" as Controller
participant "«service»\n:ClassSummaryService" as Service
participant "«database wrapper»\n:ClassRepository" as ClassRepo
participant "«database wrapper»\n:SlotRepository" as SlotRepo
participant "«database wrapper»\n:EnrollmentRepository" as EnrollmentRepo

' === MAIN FLOW ===
Lecturer -> UI: Select semester & class
activate UI

UI -> Controller: GET /api/v1/classes/{classId}/summary?semester={semesterId}
activate Controller

Controller -> Service: getClassSummary(classId, semesterId)
activate Service

' === AUTHORIZATION ===
Service -> Service: validateLecturerAuthorization(classId, semesterId)
note right: Check authentication,\nclass existence,\nsemester match,\nstaff assignment

' === GET CLASS INFO ===
Service -> ClassRepo: findById(classId)
activate ClassRepo
ClassRepo -->> Service: Optional<AcademicClass>
deactivate ClassRepo

alt Class not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller -->> UI: 404 Not Found
    UI -->> Lecturer: Show error message
end

' === GET ENROLLMENT SUMMARY ===
Service -> EnrollmentRepo: countByClassIdAndEnrolled(classId, true)
activate EnrollmentRepo
EnrollmentRepo -->> Service: Long
deactivate EnrollmentRepo

' === GET SLOTS FOR MATRIX ===
Service -> SlotRepo: findByClassId(classId)
activate SlotRepo
SlotRepo -->> Service: List<Slot>
deactivate SlotRepo

Service -->> Controller: ClassSummaryDTO
deactivate Service

Controller -->> UI: 200 OK
deactivate Controller

UI -->> Lecturer: Display class summary\nwith attendance matrix
deactivate UI

@enduml
