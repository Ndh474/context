@startuml view_class_summary
!theme plain
hide footbox

actor Lecturer
participant ":ClassController" as Controller
participant ":ClassSummaryService" as Service
participant ":ClassRepository" as ClassRepo
participant ":SlotRepository" as SlotRepo
participant ":EnrollmentRepository" as EnrollmentRepo
participant "Database" as DB

' --- MAIN FLOW ---
Lecturer -> Controller: GET /api/v1/classes/{classId}/summary?semester={semesterId}
activate Controller

Controller -> Service: getClassSummary(classId, semesterId)
activate Service

' --- VALIDATE AUTHORIZATION ---
Service -> ClassRepo: findById(classId)
activate ClassRepo

ClassRepo -> DB: Query Class by ID
activate DB
DB --> ClassRepo: Class Record / Null
deactivate DB

ClassRepo --> Service: Optional<AcademicClass>
deactivate ClassRepo

alt Class not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller --> Lecturer: 404 Not Found
end

' Authorization logic (internal: check class in semester, check staff assignment)

alt Not authorized
    Service -->> Controller: <<throw>> OperationNotAllowedException
    Controller --> Lecturer: 403 Forbidden
end

' Get enrollment summary (internal)

Service -> EnrollmentRepo: countByClassIdAndEnrolled(classId, true)
activate EnrollmentRepo

EnrollmentRepo -> DB: Count Enrolled Students
activate DB
DB --> EnrollmentRepo: Count
deactivate DB

EnrollmentRepo --> Service: Long
deactivate EnrollmentRepo

' Get slot list and attendance statistics (internal)

Service -> SlotRepo: findByClassIdAndSemesterId(classId, semesterId)
activate SlotRepo

SlotRepo -> DB: Query Slots
activate DB
DB --> SlotRepo: Slot List
deactivate DB

SlotRepo --> Service: List<Slot>
deactivate SlotRepo

Service --> Controller: ClassSummaryDTO
deactivate Service

Controller --> Lecturer: 200 OK
deactivate Controller

@enduml
