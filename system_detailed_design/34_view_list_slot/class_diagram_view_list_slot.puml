@startuml View List Slot - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class SlotController {
  - slotService : SlotService
  + findAll(request : SlotSearchRequest) : PagingResponse<SlotDTO>
  + findById(id : Integer) : Response<SlotDTO>
}

class SlotService {
  - slotRepository : SlotRepository
  - slotMapper : SlotMapper
  + findAll(request : SlotSearchRequest) : List<SlotDTO>
  + count(request : SlotSearchRequest) : Long
  + findById(id : Integer) : SlotDTO
}

interface SlotRepository <<interface>> {
  + findById(id : Integer) : Optional<Slot>
  + save(slot : Slot) : Slot
}

interface CustomSlotRepository <<interface>> {
  + search(request : SlotSearchRequest) : List<SlotDTO>
  + count(request : SlotSearchRequest) : Long
  + getAttendanceStats(slotId : Integer) : AttendanceStatsDTO
}

class SlotRepositoryImpl {
  - em : EntityManager
  + search(request : SlotSearchRequest) : List<SlotDTO>
  + count(request : SlotSearchRequest) : Long
  + getAttendanceStats(slotId : Integer) : AttendanceStatsDTO
  - buildWhereClause(parameters : Map<String, Object>, request : SlotSearchRequest) : String
}

class Slot {
  - id : Integer
  - title : String
  - description : String
  - startTime : LocalDateTime
  - endTime : LocalDateTime
  - slotCategory : SlotCategory
  - sessionStatus : SessionStatus
  - scanCount : Integer
  - lastSessionStoppedAt : Instant
  - examSessionStatus : SessionStatus
  - examScanCount : Integer
  - lastExamSessionStoppedAt : Instant
  - academicClass : AcademicClass
  - semester : Semester
  - room : Room
  - staff : User
  - attendanceRecords : Set<AttendanceRecord>
  - examAttendances : Set<ExamAttendance>
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class SlotSearchRequest {
  - slotCategory : List<SlotCategory>
  - classId : Short
  - subjectId : Short
  - staffUserId : Integer
  - studentUserId : Integer
  - roomId : Short
  - semesterId : Short
  - startTimeFrom : LocalDate
  - startTimeTo : LocalDate
}

class PagedRequest {
  - page : Integer
  - pageSize : Integer
  - sort : String
  - sortBy : String
  - search : String
  - isActive : Boolean
  + getPage() : Integer
  + getPageSize() : Integer
  + getSearch() : String
  + getSort() : String
  + getSortBy() : String
  + getActive() : Boolean
}

class SlotDTO {
  - id : Integer
  - title : String
  - description : String
  - startTime : LocalDateTime
  - endTime : LocalDateTime
  - slotCategory : SlotCategory
  - room : RoomDTO
  - staffUser : UserDTO
  - classObj : ClassDTO
  - examSubjects : List<SubjectDTO>
  - semester : SemesterDTO
  - totalStudent : Integer
  - totalPresentStudent : Integer
  - totalAbsentStudent : Integer
  - totalNotYetStudent : Integer
  - sessionStatus : SessionStatus
  - scanCount : Integer
  - lastSessionStoppedAt : Instant
  - examSessionStatus : SessionStatus
  - examScanCount : Integer
  - lastExamSessionStoppedAt : Instant
  - studentAttendanceStatus : AttendanceStatus
}

class BaseDTO {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class PagingResponse<T> {
  - status : int
  - message : String
  - code : String
  - data : PageableResponse
  + of(items : List<T>, total : Long, request : PagedRequest) : PagingResponse<T>
}

class PageableResponse {
  - items : List<T>
  - totalPages : int
  - currentPage : int
  - pageSize : int
  - totalItems : long
}

class AttendanceStatsDTO {
  - total : Integer
  - present : Integer
  - absent : Integer
  - notYet : Integer
}

class RoomDTO {
  - id : Short
  - name : String
  - location : String
}

class UserDTO {
  - id : Integer
  - username : String
  - fullName : String
}

class ClassDTO {
  - id : Short
  - code : String
  - subject : SubjectDTO
  - semester : SemesterDTO
}

class SubjectDTO {
  - id : Short
  - name : String
  - code : String
}

class SemesterDTO {
  - id : Short
  - name : String
  - code : String
}

SlotController --> SlotService
SlotService --> SlotRepository
SlotRepositoryImpl --> EntityManager

SlotController ..> SlotSearchRequest : <<use>>
SlotController ..> PagingResponse : <<use>>
SlotService ..> SlotSearchRequest : <<use>>
SlotService ..> SlotDTO : <<use>>
SlotService ..> AttendanceStatsDTO : <<use>>
SlotRepository ..> Slot : <<use>>
CustomSlotRepository ..> SlotSearchRequest : <<use>>
CustomSlotRepository ..> SlotDTO : <<use>>
CustomSlotRepository ..> AttendanceStatsDTO : <<use>>

SlotDTO ..> RoomDTO : <<use>>
SlotDTO ..> UserDTO : <<use>>
SlotDTO ..> ClassDTO : <<use>>
SlotDTO ..> SubjectDTO : <<use>>
SlotDTO ..> SemesterDTO : <<use>>
ClassDTO ..> SubjectDTO : <<use>>
ClassDTO ..> SemesterDTO : <<use>>

CustomSlotRepository <|.. SlotRepositoryImpl
SlotRepository <|-- CustomSlotRepository

BaseEntity <|-- Slot
PagedRequest <|-- SlotSearchRequest
BaseDTO <|-- SlotDTO
BaseDTO <|-- RoomDTO
BaseDTO <|-- UserDTO
BaseDTO <|-- ClassDTO

PagingResponse +-- PageableResponse

@enduml
