@startuml view_teaching_schedule_lecturer
!theme plain
hide footbox

actor Lecturer
participant ":DashboardController" as Controller
participant ":LecturerDashboardService" as Service
participant ":SemesterRepository" as SemesterRepo
participant ":SlotRepository" as SlotRepo
participant ":ClassRepository" as ClassRepo
participant "Database" as DB

' --- MAIN FLOW ---
Lecturer -> Controller: GET /api/v1/dashboard/lecturer?semesterId={id}
activate Controller

Controller -> Service: getDashboardData(lecturerId, semesterId)
activate Service

' --- GET SEMESTERS WITH TEACHING DATA ---
Service -> SemesterRepo: findSemestersWithSlotsByLecturerId(lecturerId)
activate SemesterRepo

SemesterRepo -> DB: Query Semesters from Class-based Slots
activate DB
DB --> SemesterRepo: Class Semester List
deactivate DB

SemesterRepo --> Service: List<Semester>
deactivate SemesterRepo

Service -> SemesterRepo: findIndependentSemestersWithSlotsByLecturerId(lecturerId)
activate SemesterRepo

SemesterRepo -> DB: Query Semesters from Independent Slots
activate DB
DB --> SemesterRepo: Independent Semester List
deactivate DB

SemesterRepo --> Service: List<Semester>
deactivate SemesterRepo

' --- GET CURRENT SEMESTER ---
Service -> SemesterRepo: findCurrentSemesters()
activate SemesterRepo

SemesterRepo -> DB: Query Current Semesters by Date Range
activate DB
DB --> SemesterRepo: Current Semester List
deactivate DB

SemesterRepo --> Service: List<Semester>
deactivate SemesterRepo

' Calculate lecturer statistics (internal: all semesters or specific semester)

Service -> SlotRepo: calculateLecturerStats(lecturerId, semesterId)
activate SlotRepo

SlotRepo -> DB: Query Teaching Statistics
activate DB
DB --> SlotRepo: Stats Data
deactivate DB

SlotRepo --> Service: DashboardStatsDTO
deactivate SlotRepo

' Get next day slots with attendance stats (internal: loop for each slot)

Service -> SlotRepo: findUpcomingSlotsForNextDay(lecturerId, semesterId, start, end)
activate SlotRepo

SlotRepo -> DB: Query Next Day Slots
activate DB
DB --> SlotRepo: Upcoming Slot List
deactivate DB

SlotRepo --> Service: List<TodaySlotDTO>
deactivate SlotRepo

' Get classes with stats and upcoming slots (internal: loop for each class)

Service -> ClassRepo: findClassesWithStatsByLecturerAndSemester(lecturerId, semesterId)
activate ClassRepo

ClassRepo -> DB: Query Classes with Stats
activate DB
DB --> ClassRepo: Class List with Stats
deactivate DB

ClassRepo --> Service: List<MyClassDTO>
deactivate ClassRepo

Service --> Controller: LecturerDashboardResponse
deactivate Service

Controller --> Lecturer: 200 OK
deactivate Controller

@enduml
