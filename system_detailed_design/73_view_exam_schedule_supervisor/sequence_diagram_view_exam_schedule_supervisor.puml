@startuml view_exam_schedule_supervisor
!theme plain
hide footbox

actor Supervisor
participant ":DashboardController" as Controller
participant ":SupervisorDashboardService" as Service
participant ":SemesterRepository" as SemesterRepo
participant ":SlotRepository" as SlotRepo
participant "Database" as DB

' --- MAIN FLOW ---
Supervisor -> Controller: GET /api/v1/dashboard/supervisor?semesterId={id}
activate Controller

Controller -> Service: getDashboardData(supervisorId, semesterId)
activate Service

' --- GET AVAILABLE SEMESTERS ---
Service -> SemesterRepo: findSemestersWithSupervisionData(supervisorId)
activate SemesterRepo

SemesterRepo -> DB: Query Semesters with Exam Slots by Supervisor
activate DB
DB --> SemesterRepo: Semester List
deactivate DB

SemesterRepo --> Service: List<Semester>
deactivate SemesterRepo

' --- GET CURRENT SEMESTER ---
Service -> SemesterRepo: findCurrentSemesters()
activate SemesterRepo

SemesterRepo -> DB: Query Current Semesters by Date Range
activate DB
DB --> SemesterRepo: Current Semester List
deactivate DB

SemesterRepo --> Service: List<Semester>
deactivate SemesterRepo

' Calculate supervisor statistics (internal: all semesters or specific semester)

Service -> SlotRepo: calculateSupervisorStats(supervisorId, semesterId)
activate SlotRepo

SlotRepo -> DB: Query Exam Slot Statistics
activate DB
DB --> SlotRepo: Stats Data
deactivate DB

SlotRepo --> Service: SupervisorStatsDTO
deactivate SlotRepo

' Get recent supervision activity with attendance stats (internal: loop for each slot)

Service -> SlotRepo: findRecentSupervisionActivity(supervisorId, semesterId, start, end)
activate SlotRepo

SlotRepo -> DB: Query Recent Exam Slots
activate DB
DB --> SlotRepo: Recent Activity List
deactivate DB

SlotRepo --> Service: List<RecentActivitySlotDTO>
deactivate SlotRepo

' Get upcoming exam slots with attendance stats (internal: loop for each slot)

Service -> SlotRepo: findUpcomingExamSlots(supervisorId, semesterId, now, maxResults)
activate SlotRepo

SlotRepo -> DB: Query Upcoming Exam Slots
activate DB
DB --> SlotRepo: Upcoming Exam List
deactivate DB

SlotRepo --> Service: List<TodaySlotDTO>
deactivate SlotRepo

Service --> Controller: SupervisorDashboardResponse
deactivate Service

Controller --> Supervisor: 200 OK
deactivate Controller

@enduml
