@startuml create_staff
!theme plain
hide footbox

actor "Data Operator" as Admin

participant "«user interaction»\n:CreateStaffDialog" as UI
participant "«control»\n:StaffProfileController" as Controller
participant "«service»\n:StaffProfileService" as Service
participant "«database wrapper»\n:UserRepository" as UserRepo
participant "«database wrapper»\n:StaffProfileRepository" as ProfileRepo
participant "«entity»\n:User" as UserEntity
participant "«entity»\n:StaffProfile" as ProfileEntity

' --- MAIN FLOW ---
Admin -> UI: Click "Create Staff"
activate UI

UI -> UI: Open create dialog

Admin -> UI: Fill form (username, email, staff code...)
Admin -> UI: Submit form

UI -> Controller: POST /api/v1/staff-profiles
activate Controller

Controller -> Service: create(request)
activate Service

' Validation (Internal)
Service -> Service: validateUniqueness(username, email, staffCode)

alt Validation failed
    Service -->> Controller: <<throw>> ValidationException
    Controller -->> UI: 400 Bad Request / 409 Conflict
    UI -->> Admin: Show error
end

' --- CREATE USER ---
Service -> UserEntity: new User(username, email, ...)
activate UserEntity
UserEntity -->> Service: user
deactivate UserEntity

Service -> UserRepo: save(user)
activate UserRepo
UserRepo -->> Service: savedUser
deactivate UserRepo

' --- CREATE PROFILE ---
Service -> ProfileEntity: new StaffProfile(user, staffCode, ...)
activate ProfileEntity
ProfileEntity -->> Service: profile
deactivate ProfileEntity

Service -> ProfileRepo: save(profile)
activate ProfileRepo
ProfileRepo -->> Service: savedProfile
deactivate ProfileRepo

Service -->> Controller: StaffProfileDTO
deactivate Service

Controller -->> UI: 201 Created
deactivate Controller

UI -->> Admin: Show success message
deactivate UI

@enduml
