@startuml Import CSV Exam Slot Participants - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class ExamSlotImportController {
  - examSlotImportService : ExamSlotImportService
  + importExamSlotParticipants(file : MultipartFile, mode : String) : Response<ImportResultDTO>
}

class ExamSlotImportService {
  - csvParserService : CsvParserService
  - slotRepository : SlotRepository
  - examSlotParticipantRepository : ExamSlotParticipantRepository
  + importParticipantsFromCsv(file : MultipartFile, modeStr : String) : ImportResultDTO
  # processOneExamSlotParticipantRow(row : ExamSlotParticipantCsvRow, mode : ImportMode) : void
}

class CsvParserService {
  + parseExamSlotParticipantCsv(file : MultipartFile) : List<ExamSlotParticipantCsvRow>
}

interface SlotRepository <<interface>> {
  + findBySemesterCodeAndStartTimeAndRoomName(...) : Slot
}

interface ExamSlotParticipantRepository <<interface>> {
  + findByExamSlotSubjectIdAndStudentUserId(...) : Optional<ExamSlotParticipant>
  + save(entity : ExamSlotParticipant) : ExamSlotParticipant
}

class ExamSlotParticipant {
  - id : Long
  - examSlotSubject : ExamSlotSubject
  - studentUser : User
  - isEnrolled : Boolean
}

class ExamSlotParticipantCsvRow {
  - rowNumber : int
  - semesterCode : String
  - startTime : String
  - roomName : String
  - subjectCode : String
  - rollNumber : String
}

class ImportResultDTO {
  - successCount : int
  - failureCount : int
  - errors : List<ImportErrorDTO>
}

class ImportErrorDTO {
  - rowNumber : int
  - errorCode : String
  - message : String
}

class Response<T> {
  - status : int
  - message : String
  - data : T
}

class ImportMode <<enumeration>> {
  ADD_ONLY
  ADD_AND_UPDATE
}

ExamSlotImportController --> ExamSlotImportService
ExamSlotImportService --> CsvParserService
ExamSlotImportService --> SlotRepository
ExamSlotImportService --> ExamSlotParticipantRepository

ExamSlotImportController ..> Response : <<use>>
ExamSlotImportController ..> ImportResultDTO : <<use>>
ExamSlotImportService ..> ImportResultDTO : <<use>>
ExamSlotImportService ..> ExamSlotParticipantCsvRow : <<use>>
ExamSlotImportService ..> ImportMode : <<use>>
ExamSlotImportService ..> ExamSlotParticipant : <<use>>
CsvParserService ..> ExamSlotParticipantCsvRow : <<use>>
ExamSlotParticipantRepository ..> ExamSlotParticipant : <<use>>

ImportResultDTO *-- ImportErrorDTO

@enduml
