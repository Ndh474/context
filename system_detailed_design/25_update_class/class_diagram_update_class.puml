@startuml Update Class - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class ClassController {
  - classService : ClassService
  + update(id : Short, request : ClassUpdateRequest) : Response<ClassDTO>
}

class ClassService {
  - classRepository : ClassRepository
  - subjectRepository : SubjectRepository
  - semesterRepository : SemesterRepository
  - classMapper : ClassMapper
  - semesterMapper : SemesterMapper
  + update(id : Short, request : ClassUpdateRequest) : ClassDTO
}

interface ClassRepository <<interface>> {
  + findById(id : Short) : Optional<AcademicClass>
  + existsByCodeAndSubjectIdAndSemesterIdAndIdNot(code : String, subjectId : Short, semesterId : Short, id : Short) : boolean
  + countActiveSlotsByClassId(classId : Short) : long
  + countEnrolledStudentsByClassId(classId : Short) : long
  + save(entity : AcademicClass) : AcademicClass
}

interface SubjectRepository <<interface>> {
  + findById(id : Short) : Optional<Subject>
}

interface SemesterRepository <<interface>> {
  + findById(id : Short) : Optional<Semester>
}

interface ClassMapper <<interface>> {
  + toDTO(entity : AcademicClass) : ClassDTO
  + updateClassFromRequest(request : ClassUpdateRequest, academicClass : AcademicClass) : void
}

interface SemesterMapper <<interface>> {
  + toDTO(entity : Semester) : SemesterDTO
}

class AcademicClass {
  - id : Short
  - code : String
  - subject : Subject
  - semester : Semester
  - enrollments : Set<Enrollment>
  - slots : Set<Slot>
}

class Subject {
  - id : Short
  - name : String
  - code : String
}

class Semester {
  - id : Short
  - name : String
  - code : String
  - startDate : LocalDate
  - endDate : LocalDate
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class ClassUpdateRequest {
  - code : String
  - subjectId : Short
  - semesterId : Short
}

class BaseRequest {
  - isActive : Boolean
}

class ClassDTO {
  - id : Short
  - code : String
  - semester : SemesterDTO
  - subject : SubjectDTO
  - totalStudent : Integer
  - totalEnrolledStudent : Integer
  - totalSlot : Integer
  - totalActiveSlot : Integer
}

class SemesterDTO {
  - id : Short
  - name : String
  - code : String
  - startDate : LocalDate
  - endDate : LocalDate
}

class SubjectDTO {
  - id : Short
  - name : String
  - code : String
}

class BaseDTO {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class Response<T> {
  - status : int
  - message : String
  - code : String
  - data : T
}

ClassController --> ClassService
ClassService --> ClassRepository
ClassService --> SubjectRepository
ClassService --> SemesterRepository
ClassService --> ClassMapper
ClassService --> SemesterMapper

ClassController ..> Response : <<use>>
ClassController ..> ClassDTO : <<use>>
ClassController ..> ClassUpdateRequest : <<use>>
ClassService ..> AcademicClass : <<use>>
ClassService ..> Subject : <<use>>
ClassService ..> Semester : <<use>>
ClassService ..> ClassDTO : <<use>>
ClassService ..> SemesterDTO : <<use>>
ClassService ..> SubjectDTO : <<use>>
ClassService ..> ClassUpdateRequest : <<use>>
ClassRepository ..> AcademicClass : <<use>>
SubjectRepository ..> Subject : <<use>>
SemesterRepository ..> Semester : <<use>>
ClassMapper ..> AcademicClass : <<use>>
ClassMapper ..> ClassDTO : <<use>>
ClassMapper ..> ClassUpdateRequest : <<use>>
SemesterMapper ..> Semester : <<use>>
SemesterMapper ..> SemesterDTO : <<use>>

AcademicClass --|> BaseEntity
AcademicClass --> Subject
AcademicClass --> Semester
Subject --|> BaseEntity
Semester --|> BaseEntity
ClassUpdateRequest --|> BaseRequest
ClassDTO --|> BaseDTO

@enduml
