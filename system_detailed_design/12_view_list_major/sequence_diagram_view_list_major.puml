@startuml View List Major
!theme plain
hide footbox

actor Client
participant ":MajorController" as Controller
participant ":MajorService" as Service
participant ":MajorRepository" as Repository
participant ":Database" as DB

Client -> Controller: GET /api/v1/majors?page=1&pageSize=10&search=Computer&isActive=true
activate Controller

Controller -> Service: search(request)
activate Service

Service -> Repository: search(request)
activate Repository

Repository -> DB: SELECT m.id, m.name, m.code, m.is_active,\n    m.created_at, m.updated_at, COUNT(ms.subject_id) as total_subject\nFROM majors m\nLEFT JOIN major_subject ms ON m.id = ms.major_id\nWHERE (LOWER(m.name) LIKE ? OR LOWER(m.code) LIKE ?)\n  AND m.is_active = ?\nGROUP BY m.id, m.name, m.code, m.is_active, m.created_at, m.updated_at\nORDER BY m.id ASC\nLIMIT ? OFFSET ?
activate DB
DB --> Repository: resultList
deactivate DB

Repository --> Service: majors:List<MajorDTO>
deactivate Repository

Service --> Controller: majors:List<MajorDTO>
deactivate Service

Controller -> Service: count(request)
activate Service

Service -> Repository: count(request)
activate Repository

Repository -> DB: SELECT COUNT(m.id) FROM majors m\nWHERE (LOWER(m.name) LIKE ? OR LOWER(m.code) LIKE ?)\n  AND m.is_active = ?
activate DB
DB --> Repository: total
deactivate DB

Repository --> Service: total:Long
deactivate Repository

Service --> Controller: total:Long
deactivate Service

Controller -> Controller: PagingResponse.of(majors, total, request)

Controller --> Client: HTTP 200 OK\n{status: 200,\ndata: {\n  items: [MajorDTO...],\n  currentPage: 1,\n  pageSize: 10,\n  totalItems: 25,\n  totalPages: 3\n}}
deactivate Controller

@enduml
