@startuml create_student
!theme plain
hide footbox

actor "Data Operator" as Admin

participant "«user interaction»\n:CreateStudentDialog" as UI
participant "«control»\n:StudentProfileController" as Controller
participant "«service»\n:StudentProfileService" as Service
participant "«database wrapper»\n:UserRepository" as UserRepo
participant "«database wrapper»\n:StudentProfileRepository" as ProfileRepo
participant "«entity»\n:User" as UserEntity
participant "«entity»\n:StudentProfile" as ProfileEntity

' --- MAIN FLOW ---
Admin -> UI: Fill form & Submit
activate UI

UI -> Controller: POST /api/v1/student-profiles
activate Controller

Controller -> Service: create(request)
activate Service

' Validation (Internal)
Service -> Service: validateUniqueness(username, email, rollNumber)

alt Validation failed
    Service -->> Controller: <<throw>> ResourceExistsException
    Controller -->> UI: 409 Conflict
    UI -->> Admin: Show error
end

' --- CREATE USER ---
Service -> UserEntity: new User(username, email, ...)
activate UserEntity
UserEntity -->> Service: user
deactivate UserEntity

Service -> UserRepo: save(user)
activate UserRepo
UserRepo -->> Service: savedUser
deactivate UserRepo

' --- CREATE PROFILE ---
Service -> ProfileEntity: new StudentProfile(user, major, ...)
activate ProfileEntity
ProfileEntity -->> Service: profile
deactivate ProfileEntity

Service -> ProfileRepo: save(profile)
activate ProfileRepo
ProfileRepo -->> Service: savedProfile
deactivate ProfileRepo

Service -->> Controller: StudentProfileDTO
deactivate Service

Controller -->> UI: 201 Created
deactivate Controller

UI -->> Admin: Show success message
deactivate UI

@enduml
