@startuml View Major Details
!theme plain
hide footbox

actor Client
participant ":MajorController" as Controller
participant ":MajorService" as Service
participant ":MajorRepository" as Repository
participant ":Database" as DB

Client -> Controller: GET /api/v1/majors/1
activate Controller

Controller -> Service: findById(id)
activate Service

Service -> Repository: findMajorDTOById(id)
activate Repository

Repository -> DB: SELECT m.id, m.name, m.code, m.is_active,\n    m.created_at, m.updated_at, COUNT(ms.subject_id) as total_subject\nFROM majors m\nLEFT JOIN major_subject ms ON m.id = ms.major_id\nWHERE m.id = ?\nGROUP BY m.id, m.name, m.code, m.is_active, m.created_at, m.updated_at
activate DB
DB --> Repository: majorRecord
deactivate DB

Repository --> Service: majorOpt:Optional<MajorDTO>
deactivate Repository

alt majorOpt.isEmpty()
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller --> Client: HTTP 404\n{status: 404,\nmessage: "Major not found: 1",\ncode: "MAJOR_NOT_FOUND"}
end

Service --> Controller: MajorDTO
deactivate Service

Controller --> Client: HTTP 200 OK\n{status: 200,\ndata: {\n  id: 1,\n  name: "Computer Science",\n  code: "CS",\n  totalSubject: 10,\n  isActive: true,\n  createdAt: "2024-11-17T10:30:00Z",\n  updatedAt: "2024-11-17T15:00:00Z"\n}}
deactivate Controller

@enduml
