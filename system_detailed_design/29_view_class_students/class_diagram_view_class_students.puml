@startuml View Class Students - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class ClassController {
  - classService : ClassService
  - enrollmentService : EnrollmentService
  + getRosterByClassId(id : Short, request : EnrollmentSearchRequest) : PagingResponse<StudentProfileDTO>
}

class ClassService {
  - classRepository : ClassRepository
  + getClassDetailsForRoster(classId : Short) : ClassDTO
}

class EnrollmentService {
  - enrollmentRepository : EnrollmentRepository
  - classRepository : ClassRepository
  + findByClassId(classId : Short, request : EnrollmentSearchRequest) : List<StudentProfileDTO>
  + countByClassId(classId : Short, request : EnrollmentSearchRequest) : Long
  + countEnrolledByClassId(classId : Short) : Long
  + countWithdrawnByClassId(classId : Short) : Long
}

interface ClassRepository <<interface>> {
  + existsById(id : Short) : boolean
  + findById(id : Short) : Optional<AcademicClass>
}

interface EnrollmentRepository <<interface>> {
  + findById(id : EnrollmentId) : Optional<Enrollment>
  + save(entity : Enrollment) : Enrollment
}

interface CustomEnrollmentRepository <<interface>> {
  + findByClassId(classId : Short, request : EnrollmentSearchRequest) : List<StudentProfileDTO>
  + countByClassId(classId : Short, request : EnrollmentSearchRequest) : Long
  + countEnrolledByClassId(classId : Short) : Long
  + countWithdrawnByClassId(classId : Short) : Long
}

class EnrollmentRepositoryImpl {
  - em : EntityManager
  + findByClassId(classId : Short, request : EnrollmentSearchRequest) : List<StudentProfileDTO>
  + countByClassId(classId : Short, request : EnrollmentSearchRequest) : Long
  + countEnrolledByClassId(classId : Short) : Long
  + countWithdrawnByClassId(classId : Short) : Long
  - buildRosterWhereClause(parameters : Map<String, Object>, classId : Short, isEnrolled : Boolean, search : String) : String
  - buildRosterOrderBy(sortBy : String, sort : String) : String
}

class Enrollment {
  - id : EnrollmentId
  - academicClass : AcademicClass
  - student : User
  - isEnrolled : Boolean
}

class AcademicClass {
  - id : Short
  - code : String
  - subject : Subject
  - semester : Semester
}

class User {
  - id : Integer
  - fullName : String
  - email : String
}

class StudentProfile {
  - user : User
  - rollNumber : String
  - major : Major
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class EnrollmentSearchRequest {
  - classId : Short
  - studentUserId : Integer
  - semesterId : Short
  - isEnrolled : Boolean
}

class PagedRequest {
  - page : Integer
  - pageSize : Integer
  - sort : String
  - sortBy : String
  - search : String
  - isActive : Boolean
}

class StudentProfileDTO {
  - id : Integer
  - fullName : String
  - rollNumber : String
  - email : String
  - majorName : String
  - majorCode : String
  - isEnrolled : Boolean
}

class ClassDTO {
  - id : Short
  - code : String
  - subject : SubjectDTO
  - semester : SemesterDTO
}

class ClassRosterDTO {
  - academicClass : ClassDTO
  - totalEnrolled : Long
  - totalWithdrawn : Long
  + ClassRosterDTO(request : PagedRequest, classDTO : ClassDTO, items : List<StudentProfileDTO>, total : Long, totalEnrolled : Long, totalWithdrawn : Long)
}

class PagingResponse<T> {
  - status : int
  - message : String
  - code : String
  - data : PageableResponse
  + of(items : List<T>, total : Long, request : PagedRequest) : PagingResponse<T>
}

class PageableResponse {
  - items : List<T>
  - totalPages : int
  - currentPage : int
  - pageSize : int
  - totalItems : long
}

ClassController --> ClassService
ClassController --> EnrollmentService
ClassService --> ClassRepository
EnrollmentService --> EnrollmentRepository
EnrollmentService --> ClassRepository
EnrollmentRepositoryImpl --> EntityManager

ClassController ..> EnrollmentSearchRequest : <<use>>
ClassController ..> ClassRosterDTO : <<use>>
ClassController ..> StudentProfileDTO : <<use>>
ClassService ..> ClassDTO : <<use>>
EnrollmentService ..> EnrollmentSearchRequest : <<use>>
EnrollmentService ..> StudentProfileDTO : <<use>>
EnrollmentRepository ..> Enrollment : <<use>>
CustomEnrollmentRepository ..> EnrollmentSearchRequest : <<use>>
CustomEnrollmentRepository ..> StudentProfileDTO : <<use>>

CustomEnrollmentRepository <|.. EnrollmentRepositoryImpl

BaseEntity <|-- Enrollment
BaseEntity <|-- AcademicClass
Enrollment --> AcademicClass
Enrollment --> User
StudentProfile --> User
PagedRequest <|-- EnrollmentSearchRequest
PagingResponse <|-- ClassRosterDTO

PagingResponse +-- PageableResponse

@enduml
