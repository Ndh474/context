@startuml view_class_students
!theme plain
hide footbox

actor Admin
participant ":ClassController" as Controller
participant ":ClassService" as ClassService
participant ":EnrollmentService" as EnrollmentService
participant ":EnrollmentRepository" as Repository
participant "Database" as DB

' --- MAIN FLOW ---
Admin -> Controller: GET /api/v1/classes/{id}/enrollments
activate Controller

' --- GET CLASS DETAILS ---
Controller -> ClassService: getClassDetailsForRoster(id)
activate ClassService

' Class validation (internal)

alt Class not found
    ClassService -->> Controller: <<throw>> ResourceNotFoundException
    Controller --> Admin: 404 Not Found
end

ClassService --> Controller: Class Details
deactivate ClassService

' --- GET STUDENTS LIST ---
Controller -> EnrollmentService: findByClassId(id, request)
activate EnrollmentService

' Class validation (internal)

alt Class not found
    EnrollmentService -->> Controller: <<throw>> ResourceNotFoundException
    Controller --> Admin: 404 Not Found
end

EnrollmentService -> Repository: findByClassId(id, request)
activate Repository

Repository -> DB: Query Students with Enrollment Status
activate DB
DB --> Repository: Student List
deactivate DB

Repository --> EnrollmentService: List<StudentProfile>
deactivate Repository

EnrollmentService --> Controller: List<StudentProfile>
deactivate EnrollmentService

' Count queries (internal: total, enrolled, withdrawn)

Controller -> EnrollmentService: countByClassId(id, request)
activate EnrollmentService

EnrollmentService -> Repository: countByClassId(id, request)
activate Repository

Repository -> DB: Count Total Students
activate DB
DB --> Repository: Total Count
deactivate DB

Repository --> EnrollmentService: Long
deactivate Repository

EnrollmentService --> Controller: Long
deactivate EnrollmentService

' Build roster response (internal)

Controller --> Admin: 200 OK
deactivate Controller

@enduml
