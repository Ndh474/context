@startuml Import CSV Subject - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class SubjectController {
  - subjectService : SubjectService
  + importSubjects(file : MultipartFile, mode : String) : Response<ImportResultDTO>
}

class SubjectService {
  - subjectRepository : SubjectRepository
  - majorRepository : MajorRepository
  - csvParserService : CsvParserService
  + importFromCsv(file : MultipartFile, modeStr : String) : ImportResultDTO
  # processOneSubjectRow(row : SubjectCsvRow, mode : ImportMode) : void
}

class CsvParserService {
  + parseSubjectCsv(file : MultipartFile) : List<SubjectCsvRow>
}

interface SubjectRepository <<interface>> {
  + findByCode(code : String) : Subject
  + existsByCode(code : String) : boolean
  + existsByName(name : String) : boolean
  + existsByNameAndIdNot(name : String, id : Short) : boolean
  + save(entity : Subject) : Subject
}

interface MajorRepository <<interface>> {
  + findByCode(code : String) : Major
}

class Subject {
  - id : Short
  - name : String
  - code : String
  - majors : Set<Major>
  - academicClasses : Set<AcademicClass>
}

class Major {
  - id : Short
  - name : String
  - code : String
  - subjects : Set<Subject>
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class SubjectCsvRow {
  - rowNumber : int
  - code : String
  - name : String
  - majorCodes : String
  - isActive : Boolean
  + isValid() : boolean
  + getMajorCodeList() : List<String>
  + getUniqueKey() : String
}

class ImportResultDTO {
  - successCount : int
  - failureCount : int
  - errors : List<ImportErrorDTO>
}

class ImportErrorDTO {
  - rowNumber : int
  - errorCode : String
  - message : String
}

class Response<T> {
  - status : int
  - message : String
  - code : String
  - data : T
}

class ImportMode <<enumeration>> {
  ADD_ONLY
  ADD_AND_UPDATE
  + fromString(mode : String) : ImportMode
}

SubjectController --> SubjectService
SubjectService --> SubjectRepository
SubjectService --> MajorRepository
SubjectService --> CsvParserService

SubjectController ..> Response : <<use>>
SubjectController ..> ImportResultDTO : <<use>>
SubjectService ..> ImportResultDTO : <<use>>
SubjectService ..> SubjectCsvRow : <<use>>
SubjectService ..> ImportMode : <<use>>
SubjectService ..> Subject : <<use>>
SubjectService ..> Major : <<use>>
CsvParserService ..> SubjectCsvRow : <<use>>
SubjectRepository ..> Subject : <<use>>
MajorRepository ..> Major : <<use>>

ImportResultDTO *-- ImportErrorDTO

Subject --|> BaseEntity
Major --|> BaseEntity

Subject *-- Major

@enduml
