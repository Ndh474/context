@startuml Update Subject - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class SubjectController {
  - subjectService : SubjectService
  + update(id : Short, request : SubjectUpdateRequest) : Response<SubjectDTO>
}

class SubjectService {
  - subjectRepository : SubjectRepository
  - subjectMapper : SubjectMapper
  - majorRepository : MajorRepository
  - majorMapper : MajorMapper
  + update(id : Short, request : SubjectUpdateRequest) : SubjectDTO
}

interface SubjectRepository <<interface>> {
  + findById(id : Short) : Optional<Subject>
  + existsByCode(code : String) : boolean
  + existsByName(name : String) : boolean
  + countActiveClassesBySubjectId(subjectId : Short) : long
  + countAllClassesBySubjectId(subjectId : Short) : long
  + save(entity : Subject) : Subject
}

interface SubjectMapper <<interface>> {
  + toDTO(entity : Subject) : SubjectDTO
  + updateSubjectFromRequest(request : SubjectUpdateRequest, subject : Subject) : void
}

interface MajorRepository <<interface>> {
  + findByIdIn(ids : Collection<Short>) : List<Major>
}

interface MajorMapper <<interface>> {
  + toDTO(entity : Major) : MajorDTO
}

class Subject {
  - id : Short
  - name : String
  - code : String
  - majors : Set<Major>
  - academicClasses : Set<AcademicClass>
}

class Major {
  - id : Short
  - name : String
  - code : String
  - subjects : Set<Subject>
  - studentProfiles : Set<StudentProfile>
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class SubjectUpdateRequest {
  - name : String
  - code : String
  - majorIds : List<Short>
}

class BaseRequest {
  - isActive : Boolean
}

class SubjectDTO {
  - id : Short
  - name : String
  - code : String
  - majors : List<MajorDTO>
  - totalClass : Integer
  - totalActiveClass : Integer
}

class MajorDTO {
  - id : Short
  - name : String
  - code : String
  - totalSubject : Integer
}

class BaseDTO {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class Response<T> {
  - status : int
  - message : String
  - code : String
  - data : T
}

SubjectController --> SubjectService
SubjectService --> SubjectRepository
SubjectService --> SubjectMapper
SubjectService --> MajorRepository
SubjectService --> MajorMapper

SubjectController ..> Response : <<use>>
SubjectController ..> SubjectDTO : <<use>>
SubjectController ..> SubjectUpdateRequest : <<use>>
SubjectService ..> Subject : <<use>>
SubjectService ..> SubjectDTO : <<use>>
SubjectService ..> SubjectUpdateRequest : <<use>>
SubjectService ..> Major : <<use>>
SubjectService ..> MajorDTO : <<use>>
SubjectRepository ..> Subject : <<use>>
SubjectMapper ..> Subject : <<use>>
SubjectMapper ..> SubjectDTO : <<use>>
SubjectMapper ..> SubjectUpdateRequest : <<use>>
MajorRepository ..> Major : <<use>>
MajorMapper ..> Major : <<use>>
MajorMapper ..> MajorDTO : <<use>>

Subject --|> BaseEntity
Major --|> BaseEntity
SubjectUpdateRequest --|> BaseRequest
SubjectDTO --|> BaseDTO
MajorDTO --|> BaseDTO

Subject *-- Major

@enduml
