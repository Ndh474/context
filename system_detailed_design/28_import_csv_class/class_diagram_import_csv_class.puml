@startuml Import CSV Class - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class ClassController {
  - classService : ClassService
  + importClasses(file : MultipartFile, mode : String) : Response<ImportResultDTO>
}

class ClassService {
  - classRepository : ClassRepository
  - subjectRepository : SubjectRepository
  - semesterRepository : SemesterRepository
  - csvParserService : CsvParserService
  + importFromCsv(file : MultipartFile, modeStr : String) : ImportResultDTO
  # processOneClassRow(row : ClassCsvRow, mode : ImportMode) : void
  - extractErrorCode(e : Exception) : String
}

class CsvParserService {
  + parseClassCsv(file : MultipartFile) : List<ClassCsvRow>
}

interface ClassRepository <<interface>> {
  + findByCodeAndSubjectIdAndSemesterId(code : String, subjectId : Short, semesterId : Short) : AcademicClass
  + save(entity : AcademicClass) : AcademicClass
}

interface SubjectRepository <<interface>> {
  + findByCode(code : String) : Subject
}

interface SemesterRepository <<interface>> {
  + findByCode(code : String) : Semester
}

class AcademicClass {
  - id : Short
  - code : String
  - subject : Subject
  - semester : Semester
  - enrollments : Set<Enrollment>
  - slots : Set<Slot>
}

class Subject {
  - id : Short
  - name : String
  - code : String
}

class Semester {
  - id : Short
  - name : String
  - code : String
  - startDate : LocalDate
  - endDate : LocalDate
}

class BaseEntity {
  - isActive : Boolean
  - createdAt : Instant
  - updatedAt : Instant
}

class ClassCsvRow {
  - rowNumber : int
  - code : String
  - subjectCode : String
  - semesterCode : String
  - isActive : Boolean
  + isValid() : boolean
  + getValidationError() : String
  + getUniqueKey() : String
}

class ImportResultDTO {
  - successCount : int
  - failureCount : int
  - errors : List<ImportErrorDTO>
}

class ImportErrorDTO {
  - rowNumber : int
  - errorCode : String
  - message : String
}

class Response<T> {
  - status : int
  - message : String
  - code : String
  - data : T
}

class ImportMode <<enumeration>> {
  ADD_ONLY
  ADD_AND_UPDATE
  + fromString(mode : String) : ImportMode
}

ClassController --> ClassService
ClassService --> ClassRepository
ClassService --> SubjectRepository
ClassService --> SemesterRepository
ClassService --> CsvParserService

ClassController ..> Response : <<use>>
ClassController ..> ImportResultDTO : <<use>>
ClassService ..> ImportResultDTO : <<use>>
ClassService ..> ClassCsvRow : <<use>>
ClassService ..> ImportMode : <<use>>
ClassService ..> AcademicClass : <<use>>
ClassService ..> Subject : <<use>>
ClassService ..> Semester : <<use>>
CsvParserService ..> ClassCsvRow : <<use>>
ClassRepository ..> AcademicClass : <<use>>
SubjectRepository ..> Subject : <<use>>
SemesterRepository ..> Semester : <<use>>

ImportResultDTO *-- ImportErrorDTO

AcademicClass --|> BaseEntity
AcademicClass --> Subject
AcademicClass --> Semester
Subject --|> BaseEntity
Semester --|> BaseEntity

@enduml
