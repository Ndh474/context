@startuml view_attendance_history
!theme plain
hide footbox

actor "Student" as Student

participant "«user interaction»\n:StudentAttendanceHistoryPage" as UI
participant "«control»\n:StudentProfileController" as Controller
participant "«service»\n:AttendanceHistoryService" as Service
participant "«database wrapper»\n:AttendanceHistoryRepository" as Repository

' === MAIN FLOW ===
Student -> UI: Select semester & subject
activate UI

UI -> Controller: GET /api/v1/student-profiles/{id}/attendance-history
activate Controller

Controller -> Service: getAttendanceHistory(studentId, request)
activate Service

' === VALIDATION ===
Service -> Service: validateStudentExists(studentId)

alt Student not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller -->> UI: 404 Not Found
    UI -->> Student: Show error message
end

' === GET ATTENDANCE RECORDS ===
Service -> Repository: searchByStudentId(studentId, request)
activate Repository
Repository -->> Service: List<AttendanceHistoryDTO>
deactivate Repository

' === GET SUMMARY ===
Service -> Repository: getAttendanceSummary(studentId, request)
activate Repository
Repository -->> Service: AttendanceSummaryDTO
deactivate Repository

Service -->> Controller: AttendanceHistoryWithSummaryDTO
deactivate Service

' === COUNT TOTAL ===
Controller -> Service: countAttendanceHistory(studentId, request)
activate Service

Service -> Repository: countByStudentId(studentId, request)
activate Repository
Repository -->> Service: Long
deactivate Repository

Service -->> Controller: Long
deactivate Service

' === GET DETAILED SUMMARY ===
Controller -> Service: getDetailedSummary(studentId, request)
activate Service

Service -> Repository: getDetailedSummary(studentId, request)
activate Repository
Repository -->> Service: AttendanceSummaryDetailsDTO
deactivate Repository

Service -->> Controller: AttendanceSummaryDetailsDTO
deactivate Service

Controller -->> UI: 200 OK
deactivate Controller

UI -->> Student: Display attendance matrix\nwith summary statistics
deactivate UI

@enduml
