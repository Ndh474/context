@startuml sign_in_with_google
!theme plain
hide circle
skinparam classAttributeIconSize 0

' --- CẤU HÌNH "ORTHO" (BẮT BUỘC) ---
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60

' --- CONTROLLER ---
class AuthenticationController {
  + googleLogin(request) : Response
}

' --- SERVICE ---
class AuthenticationService {
  + googleLogin(request) : TokenResponse
  + validateUserActive(user) : void
  + buildTokenResponse(user) : TokenResponse
}

' --- REPOSITORY ---
interface UserRepository <<interface>> {
  + findByEmail(email : String) : Optional<User>
}

' --- ENTITIES ---
class User {
  - id : Integer
  - username : String
  - email : String
  - fullName : String
  - passwordHash : String
  - isActive : Boolean
  - roles : Set<Role>
}

class Role {
  - id : Short
  - name : String
  - permissions : Set<Permission>
}

class Permission {
  - id : Short
  - name : String
}

' --- DEPENDENCY INJECTION (Association) ---
AuthenticationController -down-> AuthenticationService
AuthenticationService -down-> UserRepository

' --- REPOSITORY USAGE (Dependency) ---
UserRepository .down.> User

' --- ENTITY RELATIONSHIPS (Aggregation) ---
User o-right- Role
Role o-right- Permission

@enduml
