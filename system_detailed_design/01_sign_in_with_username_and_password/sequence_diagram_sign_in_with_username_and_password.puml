@startuml sign_in_with_username_and_password
!theme plain
hide footbox

actor User

participant "«user interaction»\n:LoginPage" as UI
participant "«control»\n:AuthenticationController" as Controller
participant "«service»\n:AuthenticationService" as Service
participant "«database wrapper»\n:UserRepository" as Repository

' === MAIN FLOW ===
User -> UI: Enter username & password
activate UI

User -> UI: Click "Sign In"
UI -> Controller: POST /api/v1/auth/login
activate Controller

Controller -> Service: login(request)
activate Service

' === USER LOOKUP ===
Service -> Repository: findByUsername(username)
activate Repository
Repository -->> Service: Optional<User>
deactivate Repository

alt User not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller -->> UI: 404 Not Found
    UI -->> User: Show error message
end

alt User is inactive
    Service -->> Controller: <<throw>> AccessDeniedException
    Controller -->> UI: 403 Forbidden
    UI -->> User: Show error message
end

' === PASSWORD VALIDATION ===
alt Invalid password
    Service -->> Controller: <<throw>> BadCredentialsException
    Controller -->> UI: 401 Unauthorized
    UI -->> User: Show error message
end

' === TOKEN GENERATION (internal) ===

Service -->> Controller: TokenResponse
deactivate Service

Controller -->> UI: 200 OK (TokenResponse)
deactivate Controller

UI -->> User: Redirect to Dashboard
deactivate UI

@enduml
