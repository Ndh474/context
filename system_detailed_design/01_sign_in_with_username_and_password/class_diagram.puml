@startuml Sign In with Username and Password - Class Diagram
!theme plain
skinparam classAttributeIconSize 0
hide circle
skinparam circledCharacterRadius 0

class AuthenticationController {
  - authenticationService : AuthenticationService
  + login(request : LoginRequest) : ResponseEntity<TokenResponse>
}

class AuthenticationService {
  - userRepository : UserRepository
  - passwordEncoder : PasswordEncoder
  - tokenProvider : TokenProviderUtil
  + login(request : LoginRequest) : TokenResponse
  - buildTokenResponse(user : User) : TokenResponse
  - validateUserActive(user : User) : void
}

interface UserRepository <<interface>> {
  + findByUsername(username : String) : Optional<User>
}

interface PasswordEncoder <<interface>> {
  + matches(rawPassword : String, encodedPassword : String) : boolean
}

class TokenProviderUtil {
  + createAccessToken(user : User, permissions : Set<Permission>) : String
  + createRefreshToken(userId : Integer) : String
}

class LoginRequest {
  - username : String
  - password : String
}

class TokenResponse {
  - accessToken : String
  - refreshToken : String
  - tokenType : String
  - fullName : String
  - username : String
  - roles : Set<String>
  - userId : Integer
}

class User {
  - id : Integer
  - username : String
  - passwordHash : String
  - isActive : Boolean
  - roles : Set<Role>
}

class Role {
  - id : Short
  - name : String
  - permissions : Set<Permission>
}

class Permission {
  - id : Short
  - name : String
}

AuthenticationController --> AuthenticationService
AuthenticationService --> UserRepository
AuthenticationService --> PasswordEncoder
AuthenticationService --> TokenProviderUtil

AuthenticationController ..> LoginRequest : <<use>>
AuthenticationController ..> TokenResponse : <<use>>
AuthenticationService ..> LoginRequest : <<use>>
AuthenticationService ..> TokenResponse : <<use>>
AuthenticationService ..> User : <<use>>
TokenProviderUtil ..> User : <<use>>
TokenProviderUtil ..> Permission : <<use>>

UserRepository ..> User : <<use>>

User *-- Role
Role *-- Permission

@enduml
