@startuml forgot_password
!theme plain
hide circle
skinparam classAttributeIconSize 0

' --- CẤU HÌNH "ORTHO" (BẮT BUỘC) ---
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60

' --- CONTROLLER ---
class AuthenticationController {
  + forgotPassword(request) : Response
  + resetPassword(request) : Response
}

' --- SERVICE ---
class AuthenticationService {
  + forgotPassword(request) : String
  + resetPassword(request) : String
  + validateUserActive(user) : void
}

' --- REPOSITORIES ---
interface UserRepository <<interface>> {
  + findByEmail(email : String) : Optional<User>
  + save(user : User) : User
}

interface PasswordResetTokenRepository <<interface>> {
  + updateToken(email, token, createdAt, expiresAt) : int
  + findByTokenHash(tokenHash : String) : Optional<PasswordResetToken>
  + save(token : PasswordResetToken) : PasswordResetToken
  + delete(token : PasswordResetToken) : void
}

' --- ENTITIES ---
class User {
  - id : Integer
  - username : String
  - email : String
  - fullName : String
  - passwordHash : String
  - isActive : Boolean
  - roles : Set<Role>
}

class PasswordResetToken {
  - id : Integer
  - email : String
  - tokenHash : String
  - createdAt : Instant
  - expiresAt : Instant
}

class Role {
  - id : Short
  - name : String
  - permissions : Set<Permission>
}

class Permission {
  - id : Short
  - name : String
}

' --- DEPENDENCY INJECTION (Association) ---
AuthenticationController -down-> AuthenticationService
AuthenticationService -down-> UserRepository
AuthenticationService -down-> PasswordResetTokenRepository

' --- REPOSITORY USAGE (Dependency) ---
UserRepository .down.> User
PasswordResetTokenRepository .down.> PasswordResetToken

' --- ENTITY RELATIONSHIPS (Aggregation) ---
User o-right- Role
Role o-right- Permission

@enduml
