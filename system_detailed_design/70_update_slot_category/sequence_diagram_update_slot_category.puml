@startuml update_slot_category
!theme plain
hide footbox

actor Lecturer
participant ":SlotController" as Controller
participant ":SlotService" as Service
participant ":SlotRepository" as SlotRepo
participant ":ExamAttendanceRepository" as ExamRepo
participant "Database" as DB

' --- MAIN FLOW ---
Lecturer -> Controller: PUT /api/v1/slots/{id}/category
activate Controller

Controller -> Service: updateSlotCategory(id, request, currentUserId)
activate Service

' --- FIND EXISTING ---
Service -> SlotRepo: findById(id)
activate SlotRepo

SlotRepo -> DB: Query Slot by ID
activate DB
DB --> SlotRepo: Slot Record / Null
deactivate DB

SlotRepo --> Service: Optional<Slot>
deactivate SlotRepo

alt Slot not found
    Service -->> Controller: <<throw>> ResourceNotFoundException
    Controller --> Lecturer: 404 Not Found
end

' Validation logic (internal: authorization, category transition validation, exam data check with conditional delete)

alt Validation failed
    Service -->> Controller: <<throw>> ValidationException
    Controller --> Lecturer: 400 Bad Request / 403 Forbidden
end

Service -> SlotRepo: save(slot)
activate SlotRepo

SlotRepo -> DB: Update Slot Category
activate DB
DB --> SlotRepo: Updated Slot
deactivate DB

SlotRepo --> Service: Slot
deactivate SlotRepo

Service --> Controller: SlotDTO
deactivate Service

Controller --> Lecturer: 200 OK
deactivate Controller

@enduml
