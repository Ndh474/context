{
  "metadata": {
    "codebase": "frontend-web",
    "category": "lib_api",
    "generated_at": "2025-11-24T20:05:17.464618",
    "total_files": 3,
    "total_lines": 207,
    "total_bytes": 6841
  },
  "files": [
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\lib\\adapters\\staff-profile-adapter.ts",
      "relative_path": "lib/adapters/staff-profile-adapter.ts",
      "filename": "staff-profile-adapter.ts",
      "size_bytes": 946,
      "lines": 35,
      "last_modified": "2025-11-01T15:38:43.372613",
      "encoding": "utf-8",
      "language": "typescript",
      "content": "/**\n * Adapter functions to convert between API types and UI types\n * for Staff Profiles\n */\n\nimport { StaffProfile } from \"@/types\";\nimport { StaffUserRow } from \"@/components/admin/users-roles/staff-columns\";\n\n/**\n * Convert StaffProfile (API type) to StaffUserRow (UI type)\n *\n * Mappings:\n * - userId → id\n * - roles array directly mapped to UI\n */\nexport function staffProfileToRow(profile: StaffProfile): StaffUserRow {\n  return {\n    id: profile.userId,\n    username: profile.username,\n    staffCode: profile.staffCode,\n    fullName: profile.fullName,\n    email: profile.email,\n    isActive: profile.isActive,\n    roles: profile.roles,\n    createdAt: profile.createdAt,\n    updatedAt: profile.updatedAt,\n  };\n}\n\n/**\n * Convert array of StaffProfile to array of StaffUserRow\n */\nexport function staffProfilesToRows(profiles: StaffProfile[]): StaffUserRow[] {\n  return profiles.map(staffProfileToRow);\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\lib\\adapters\\student-profile-adapter.ts",
      "relative_path": "lib/adapters/student-profile-adapter.ts",
      "filename": "student-profile-adapter.ts",
      "size_bytes": 1269,
      "lines": 41,
      "last_modified": "2025-11-20T12:31:20.050754",
      "encoding": "utf-8",
      "language": "typescript",
      "content": "/**\n * Adapter functions to convert between API types and UI types\n * for Student Profiles\n */\n\nimport { StudentProfile } from \"@/types\";\nimport { StudentUserRow } from \"@/components/admin/users-roles/student-columns\";\n\n/**\n * Convert StudentProfile (API type) to StudentUserRow (UI type)\n *\n * Mappings:\n * - userId → id\n * - username → username (login identification)\n * - major.code → major (display code)\n * - major.id → majorId (for API operations)\n * - Use updatedAt as lastActiveAt fallback\n */\nexport function studentProfileToRow(profile: StudentProfile): StudentUserRow {\n  return {\n    id: profile.userId,\n    rollNumber: profile.rollNumber,\n    username: profile.username ?? 'N/A', // Map username, fallback to N/A if missing\n    fullName: profile.fullName,\n    email: profile.email,\n    major: profile.major.code,\n    majorId: profile.major.id,\n    isActive: profile.isActive,\n    createdAt: profile.createdAt,\n    lastActiveAt: profile.updatedAt, // Using updatedAt as proxy for last activity\n  };\n}\n\n/**\n * Convert array of StudentProfile to array of StudentUserRow\n */\nexport function studentProfilesToRows(\n  profiles: StudentProfile[]\n): StudentUserRow[] {\n  return profiles.map(studentProfileToRow);\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\lib\\api-axios.ts",
      "relative_path": "lib/api-axios.ts",
      "filename": "api-axios.ts",
      "size_bytes": 4626,
      "lines": 131,
      "last_modified": "2025-11-21T01:39:53.467561",
      "encoding": "utf-8",
      "language": "typescript",
      "content": "import axios, { AxiosError } from \"axios\";\nimport { getAuthToken, clearAuthSession } from \"./auth\";\nimport { API_ENDPOINTS } from \"./constants\";\n\nconst api = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  // Serialize params to handle arrays properly\n  // For slotCategories: repeat param multiple times (e.g., slotCategory=LECTURE&slotCategory=LECTURE_WITH_PT)\n  // For other arrays: comma-separated values (e.g., roleId=1,2,3)\n  paramsSerializer: {\n    serialize: (params) => {\n      const searchParams = new URLSearchParams();\n\n      Object.entries(params).forEach(([key, value]) => {\n        if (value === undefined || value === null) {\n          return;\n        }\n\n        if (Array.isArray(value)) {\n          if (value.length > 0) {\n            // Special handling for slotCategories: repeat param for each value\n            if (key === \"slotCategories\") {\n              value.forEach((item) => {\n                searchParams.append(\"slotCategory\", String(item));\n              });\n            } else {\n              // Default: comma-separated values for other arrays\n              searchParams.append(key, value.join(\",\"));\n            }\n          }\n        } else {\n          searchParams.append(key, String(value));\n        }\n      });\n\n      return searchParams.toString();\n    },\n  },\n});\n\napi.interceptors.request.use(\n  (config) => {\n    const token = getAuthToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n/**\n * Smart Response Interceptor\n *\n * Backend always wraps responses with: { status: number, data?: any, message?: string }\n * This interceptor automatically unwraps the 'data' field to simplify hook logic.\n *\n * Before: hooks need to parse response\n * After:  hooks only need to parse response\n *\n * Examples:\n * - GET /semesters → { status: 200, data: { items: [...] } } → returns { items: [...] }\n * - GET /semesters/1 → { status: 200, data: { id: 1, name: \"...\" } } → returns { id: 1, name: \"...\" }\n * - DELETE /semesters/1 → { status: 200, message: \"...\" } → returns { status: 200, message: \"...\" }\n */\napi.interceptors.response.use(\n  (response) => {\n    const backendResponse = response.data;\n\n    // If backend wrapped with { status, data, message? }, unwrap the 'data' field\n    if (\n      backendResponse &&\n      typeof backendResponse === \"object\" &&\n      \"data\" in backendResponse\n    ) {\n      return backendResponse.data;\n    }\n\n    // For DELETE endpoints or responses without 'data' field, return as-is\n    return backendResponse;\n  },\n  (error: AxiosError) => {\n    const status = error.response?.status;\n    const requestUrl = error.config?.url ?? \"\";\n    const requestMethod = error.config?.method?.toUpperCase() ?? \"GET\";\n    const isLoginRequest = requestUrl.includes(API_ENDPOINTS.auth.login);\n    const isUpdatePasswordRequest = requestUrl.includes(\"/update-password\");\n\n    // Don't auto-logout on 401 from login or change password endpoints\n    // For change password, the error should be shown to the user without logout\n    if (status === 401 && !isLoginRequest && !isUpdatePasswordRequest) {\n      clearAuthSession();\n\n      if (\n        typeof window !== \"undefined\" &&\n        window.location.pathname !== \"/login\"\n      ) {\n        window.location.href = \"/login\";\n      }\n    }\n\n    // Preserve the original backend error structure for hooks to access\n    // Backend structure: { status: number, message?: string, code?: string, data?: any }\n    const backendError = error.response?.data;\n\n    // Attach backend error to the axios error for easier access in hooks\n    if (backendError && typeof backendError === \"object\") {\n      (error as any).backendError = backendError;\n    }\n\n    // 403 Forbidden Error Handling Strategy:\n    // Mark if this is a critical action (POST/PUT/PATCH/DELETE) that should show dialog\n    // vs non-critical action (GET) that should only show toast\n    //\n    // Usage in components:\n    // - Check error.isCriticalAction to decide between toast vs dialog\n    // - Critical actions: Show ApiErrorDialog for better visibility\n    // - Non-critical: Show toast notification only\n    if (status === 403) {\n      const criticalMethods = [\"POST\", \"PUT\", \"PATCH\", \"DELETE\"];\n      (error as any).isCriticalAction = criticalMethods.includes(requestMethod);\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport default api;\n"
    }
  ]
}