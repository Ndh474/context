{
  "metadata": {
    "codebase": "frontend-web",
    "category": "component_admin",
    "generated_at": "2025-11-24T20:05:17.451579",
    "total_files": 70,
    "total_lines": 17576,
    "total_bytes": 617476
  },
  "files": [
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\cameras\\camera-columns.tsx",
      "relative_path": "components/admin/cameras/camera-columns.tsx",
      "filename": "camera-columns.tsx",
      "size_bytes": 4338,
      "lines": 161,
      "last_modified": "2025-11-11T10:48:14.516953",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Pencil } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Camera } from \"@/types\";\n\n// Header components\nfunction NameHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_name')}</div>;\n}\n\nfunction RtspUrlHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_rtsp_url')}</div>;\n}\n\nfunction RoomHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_room')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nfunction ActionCell({ \n  camera, \n  onEdit \n}: { \n  camera: Camera; \n  onEdit: (camera: Camera) => void;\n}) {\n  const t = useTranslations('camera');\n  \n  return (\n    <div className=\"flex justify-center\">\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => onEdit(camera)}\n              className=\"h-8\"\n            >\n              <Pencil className=\"h-4 w-4 mr-2\" />\n              {t('edit_menu')}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>{t('menu_label', { name: camera.name })}</p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    </div>\n  );\n}\n\nexport const createCameraColumns = (\n  onEdit: (camera: Camera) => void,\n  onRoomClick: (roomName: string) => void\n): ColumnDef<Camera>[] => [\n  {\n    accessorKey: \"name\",\n    header: NameHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"name\")}</div>\n    ),\n  },\n  {\n    accessorKey: \"rtspUrl\",\n    header: RtspUrlHeader,\n    cell: ({ row }) => (\n      <div className=\"text-muted-foreground font-mono text-xs max-w-[300px] truncate text-center mx-auto\">\n        {row.getValue(\"rtspUrl\")}\n      </div>\n    ),\n  },\n  {\n    id: \"room\",\n    header: RoomHeader,\n    cell: ({ row }) => {\n      const room = row.original.room;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80 min-w-[120px] justify-center\"\n                  onClick={() => onRoomClick(room.name)}\n                >\n                  <span className=\"truncate\">{room.name}</span>\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <div className=\"space-y-1\">\n                  <p className=\"font-medium\">{room.name}</p>\n                  {room.location && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      {room.location}\n                    </p>\n                  )}\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return <StatusCell isActive={isActive} />;\n    },\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        camera={row.original}\n        onEdit={onEdit}\n      />\n    ),\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\cameras\\camera-form-dialog.tsx",
      "relative_path": "components/admin/cameras/camera-form-dialog.tsx",
      "filename": "camera-form-dialog.tsx",
      "size_bytes": 17000,
      "lines": 451,
      "last_modified": "2025-11-21T20:17:51.313200",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Check, ChevronsUpDown } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { cn } from \"@/lib/utils\";\nimport { Camera, Room } from \"@/types\";\n\ninterface CameraFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  camera?: Camera;\n  isLoadingCamera?: boolean;\n  onSubmit: (data: CameraFormData) => Promise<void>;\n  onDelete?: (camera: Camera) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n  availableRooms: Room[];\n}\n\nexport interface CameraFormData {\n  name: string;\n  rtspUrl: string;\n  roomId: number;\n  isActive?: boolean;\n}\n\nexport function CameraFormDialog({\n  open,\n  onOpenChange,\n  camera,\n  isLoadingCamera = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n  availableRooms,\n}: CameraFormDialogProps) {\n  const isEditMode = !!camera;\n  const [roomOpen, setRoomOpen] = useState(false);\n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n\n  // Create schema with translated messages\n  const baseCameraFormSchema = useMemo(() => z.object({\n    name: z\n      .string()\n      .min(1, tValidation('name_required'))\n      .max(150, tValidation('name_max_length'))\n      .regex(\n        /^[A-Za-z0-9\\-]+( [A-Za-z0-9\\-]+)*$/,\n        tValidation('name_format')\n      ),\n    rtspUrl: z\n      .string()\n      .min(1, tValidation('rtsp_url_required'))\n      .max(512, \"RTSP URL must be at most 512 characters\")\n      .regex(/^rtsp:\\/\\/.+/, tValidation('rtsp_url_format')),\n    roomId: z.number().min(1, tValidation('room_required')),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  type CameraFormValues = z.infer<typeof baseCameraFormSchema>;\n\n  const form = useForm<CameraFormValues>({\n    resolver: zodResolver(baseCameraFormSchema),\n    defaultValues: {\n      name: camera?.name || \"\",\n      rtspUrl: camera?.rtspUrl || \"\",\n      roomId: camera?.room.id || 0,\n      isActive: camera?.isActive ?? true,\n    },\n  });\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        name: camera?.name || \"\",\n        rtspUrl: camera?.rtspUrl || \"\",\n        roomId: camera?.room.id || 0,\n        isActive: camera?.isActive ?? true,\n      });\n    }\n  }, [camera, open, form]);\n\n  // Filter only active rooms, but include current room if inactive in edit mode\n  const roomOptions = useMemo(() => {\n    const activeRooms = availableRooms.filter(r => r.isActive);\n    if (isEditMode && camera?.room && !camera.room.isActive) {\n      const currentExists = activeRooms.some(r => r.id === camera.room.id);\n      if (!currentExists) {\n        return [camera.room, ...activeRooms];\n      }\n    }\n    return activeRooms;\n  }, [availableRooms, isEditMode, camera]);\n\n  const handleSubmit = async (values: CameraFormValues) => {\n    form.clearErrors();\n    try {\n      await onSubmit({\n        name: values.name,\n        rtspUrl: values.rtspUrl,\n        roomId: values.roomId,\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Map specific error codes to form fields\n      switch (errorCode) {\n        case ERROR_CODES.CAMERA_NAME_EXISTS:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('name_exists'),\n          });\n          break;\n        case ERROR_CODES.RTSP_URL_EXISTS:\n          form.setError(\"rtspUrl\", {\n            type: \"manual\",\n            message: apiMessage,\n          });\n          break;\n        case ERROR_CODES.CAMERA_NAME_REQUIRED:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tValidation('name_required'),\n          });\n          break;\n        case ERROR_CODES.CAMERA_RTSP_URL_REQUIRED:\n          form.setError(\"rtspUrl\", {\n            type: \"manual\",\n            message: apiMessage || tValidation('rtsp_url_required'),\n          });\n          break;\n        case ERROR_CODES.CAMERA_ROOM_ID_REQUIRED:\n        case ERROR_CODES.ROOM_NOT_FOUND:\n          form.setError(\"roomId\", {\n            type: \"manual\",\n            message: apiMessage || tValidation('room_required'),\n          });\n          break;\n        default:\n          // Fallback: parse error message\n          if (apiMessage.toLowerCase().includes(\"name\")) {\n            form.setError(\"name\", { type: \"manual\", message: apiMessage });\n          } else if (apiMessage.toLowerCase().includes(\"rtsp\")) {\n            form.setError(\"rtspUrl\", { type: \"manual\", message: apiMessage });\n          } else if (apiMessage.toLowerCase().includes(\"room\")) {\n            form.setError(\"roomId\", { type: \"manual\", message: apiMessage });\n          }\n          break;\n      }\n    }\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen && !isSubmitting && !isDeleting) {\n      form.reset();\n      onOpenChange(newOpen);\n    }\n  };\n\n  const handleDelete = () => {\n    if (camera && onDelete) {\n      onDelete(camera);\n    }\n  };\n\n  const selectedRoom = roomOptions.find(\n    (r) => r.id === form.watch(\"roomId\")\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] flex flex-col gap-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full\"\n          >\n            <DialogHeader>\n              <DialogTitle>\n                {isEditMode ? tForm('title_edit') : tForm('title_create')}\n              </DialogTitle>\n              <DialogDescription>\n                {isEditMode\n                  ? tForm('description_edit')\n                  : tForm('description_create')}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"grid gap-4 py-4 px-1 overflow-y-auto flex-1\">\n              {/* Loading State */}\n              {isLoadingCamera && isEditMode && (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  {tForm('loading')}\n                </div>\n              )}\n\n              {/* Form Fields - Hidden while loading in edit mode */}\n              {(!isLoadingCamera || !isEditMode) && (\n                <>\n                  {/* Name Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_camera_name')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_camera_name')}\n                            {...field}\n                            disabled={isSubmitting || isDeleting}\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* RTSP URL Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"rtspUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_rtsp_url')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_rtsp_url')}\n                            {...field}\n                            disabled={isSubmitting || isDeleting}\n                            className=\"font-mono text-sm\"\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Room Field (Combobox) */}\n                  <FormField\n                    control={form.control}\n                    name=\"roomId\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-col\">\n                        <FormLabel>\n                          {tForm('label_room')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <Popover open={roomOpen} onOpenChange={setRoomOpen}>\n                          <PopoverTrigger asChild>\n                            <FormControl>\n                              <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                className={cn(\n                                  \"justify-between h-auto min-h-[40px] py-2\",\n                                  !field.value && \"text-muted-foreground\"\n                                )}\n                                disabled={isSubmitting || isDeleting}\n                              >\n                                {selectedRoom ? (\n                                  <div className=\"flex flex-col items-start gap-0.5\">\n                                    <span>{selectedRoom.name}</span>\n                                    {selectedRoom.location && (\n                                      <span className=\"text-xs text-muted-foreground\">\n                                        {selectedRoom.location}\n                                      </span>\n                                    )}\n                                  </div>\n                                ) : (\n                                  tForm('placeholder_room')\n                                )}\n                                <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                              </Button>\n                            </FormControl>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-[400px] p-0\">\n                            <Command>\n                              <CommandInput placeholder={tForm('placeholder_room')} />\n                              <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                                <CommandEmpty>{tValidation('room_required')}</CommandEmpty>\n                                <CommandGroup>\n                                  {roomOptions.map((room) => (\n                                    <CommandItem\n                                      key={room.id}\n                                      value={`${room.name}-${room.location || \"\"}`}\n                                      onSelect={() => {\n                                        field.onChange(room.id);\n                                        setRoomOpen(false);\n                                      }}\n                                    >\n                                      <Check\n                                        className={cn(\n                                          \"mr-2 h-4 w-4\",\n                                          room.id === field.value\n                                            ? \"opacity-100\"\n                                            : \"opacity-0\"\n                                        )}\n                                      />\n                                      <div className=\"flex flex-col\">\n                                        <span>{room.name}</span>\n                                        {room.location && (\n                                          <span className=\"text-xs text-muted-foreground\">\n                                            {room.location}\n                                          </span>\n                                        )}\n                                      </div>\n                                      {!room.isActive && (\n                                        <span className=\"ml-auto text-xs text-muted-foreground\">\n                                          (Inactive)\n                                        </span>\n                                      )}\n                                    </CommandItem>\n                                  ))}\n                                </CommandGroup>\n                              </CommandList>\n                            </Command>\n                          </PopoverContent>\n                        </Popover>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Active Status (Edit mode only) */}\n                  {isEditMode && (\n                    <FormField\n                      control={form.control}\n                      name=\"isActive\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                          <div className=\"space-y-0.5 flex-1\">\n                            <FormLabel className=\"text-base\">\n                              {tForm('label_active')}\n                            </FormLabel>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {field.value\n                                ? tForm('description_active')\n                                : tForm('description_inactive')}\n                            </div>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              disabled={isSubmitting || isDeleting}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  )}\n                </>\n              )}\n            </div>\n\n            {/* Button Layout */}\n            <div className=\"flex flex-row justify-between items-center pt-4\">\n              {isEditMode && onDelete && camera && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={handleDelete}\n                  disabled={isDeleting || isSubmitting}\n                  className=\"min-w-[100px]\"\n                >\n                  {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                </Button>\n              )}\n\n              <div className=\"flex gap-2 ml-auto\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleOpenChange(false)}\n                  disabled={isSubmitting || isDeleting}\n                  className=\"min-w-[80px]\"\n                >\n                  {tForm('button_cancel')}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={isSubmitting || isDeleting || isLoadingCamera}\n                  className=\"min-w-[100px]\"\n                >\n                  {isSubmitting\n                    ? tForm('button_saving')\n                    : isEditMode\n                    ? tForm('button_update')\n                    : tForm('button_create')}\n                </Button>\n              </div>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\cameras\\camera-pagination.tsx",
      "relative_path": "components/admin/cameras/camera-pagination.tsx",
      "filename": "camera-pagination.tsx",
      "size_bytes": 3012,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.287640",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface CameraPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function CameraPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: CameraPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\cameras\\camera-table.tsx",
      "relative_path": "components/admin/cameras/camera-table.tsx",
      "filename": "camera-table.tsx",
      "size_bytes": 4607,
      "lines": 153,
      "last_modified": "2025-11-01T15:38:43.288640",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Camera } from \"@/types\";\nimport { CameraPagination } from \"./camera-pagination\";\n\ninterface CameraTableProps {\n  columns: ColumnDef<Camera>[];\n  data: Camera[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function CameraTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: CameraTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[900px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    No cameras found.\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            <>\n              Showing {(currentPage - 1) * pageSize + 1} -{\" \"}\n              {Math.min(currentPage * pageSize, totalItems)} of {totalItems}{\" \"}\n              items\n            </>\n          ) : (\n            \"No items\"\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <CameraPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\cameras\\delete-camera-dialog.tsx",
      "relative_path": "components/admin/cameras/delete-camera-dialog.tsx",
      "filename": "delete-camera-dialog.tsx",
      "size_bytes": 1965,
      "lines": 67,
      "last_modified": "2025-11-11T10:48:14.517960",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from 'next-intl';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Camera } from \"@/types\";\n\ninterface DeleteCameraDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  camera: Camera | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteCameraDialog({\n  open,\n  onOpenChange,\n  camera,\n  onConfirm,\n  isDeleting = false,\n}: DeleteCameraDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!camera) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {t('camera_name', { name: camera.name })}\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>{t('button_cancel')}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\add-student-dialog.tsx",
      "relative_path": "components/admin/classes/add-student-dialog.tsx",
      "filename": "add-student-dialog.tsx",
      "size_bytes": 7267,
      "lines": 218,
      "last_modified": "2025-11-24T16:46:20.107109",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Search } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useGetStudentProfiles } from \"@/hooks/api/useStudentProfiles\";\nimport { useGetClassEnrollments } from \"@/hooks/api/useEnrollments\";\nimport { StudentProfileListItem } from \"@/types\";\n\ninterface AddStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onAddStudent: (studentUserId: number) => void;\n  isAdding: boolean;\n  enrolledStudentIds?: number[]; // Deprecated: now fetched internally\n  classCode: string;\n  classData?: {\n    id: number;\n    code: string;\n    subject?: {\n      id: number;\n      name: string;\n      code: string;\n      majors?: Array<{\n        id: number;\n        name: string;\n        code: string;\n      }>;\n    };\n  };\n}\n\nexport function AddStudentDialog({\n  open,\n  onOpenChange,\n  onAddStudent,\n  isAdding,\n  classCode,\n  classData,\n}: AddStudentDialogProps) {\n  const t = useTranslations(\"admin.classes.students\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [debouncedSearch, setDebouncedSearch] = useState(\"\");\n\n  // Debounce search query\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedSearch(searchQuery);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [searchQuery]);\n\n  // Extract major IDs from class's subject for filtering\n  const subjectMajorIds = useMemo(() => {\n    if (!classData?.subject?.majors) return undefined;\n    return classData.subject.majors.map((m) => m.id);\n  }, [classData]);\n\n  // Fetch ALL enrolled students for this class (with large pageSize to get all)\n  // Only fetch when dialog is open and we have classData\n  const { data: enrollmentsData, isLoading: isLoadingEnrollments } = useGetClassEnrollments(\n    classData?.id ?? 0,\n    {\n      page: 1,\n      pageSize: 1000, // Large enough to get all enrolled students\n      isEnrolled: true, // Only currently enrolled (not withdrawn)\n    },\n    { enabled: open && !!classData?.id }\n  );\n\n  // Extract all enrolled student IDs\n  const allEnrolledStudentIds = useMemo(() => {\n    return enrollmentsData?.items.map((e) => e.studentUserId) || [];\n  }, [enrollmentsData]);\n\n  // Fetch student profiles filtered by subject's majors\n  const { data: studentsData, isLoading: isLoadingStudents } = useGetStudentProfiles({\n    search: debouncedSearch,\n    isActive: true,\n    majorIds: subjectMajorIds,\n    page: 1,\n    pageSize: 50,\n  });\n\n  const isLoading = isLoadingStudents || isLoadingEnrollments;\n\n  // Filter out already enrolled students\n  const availableStudents =\n    studentsData?.items.filter(\n      (student) => !allEnrolledStudentIds.includes(student.userId)\n    ) || [];\n\n  const handleAddStudent = (studentUserId: number) => {\n    onAddStudent(studentUserId);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>{t(\"dialog.add.title\", { classCode })}</DialogTitle>\n          <DialogDescription>\n            {t(\"dialog.add.description\")}\n            {subjectMajorIds && subjectMajorIds.length > 0 && (\n              <> {t(\"dialog.add.note_eligible\")}</>\n            )} {t(\"dialog.add.note_excluded\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Search Input */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder={t(\"dialog.add.search_placeholder\")}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9\"\n            />\n          </div>\n\n          {/* Student List */}\n          <ScrollArea className=\"h-[400px] rounded-md border p-4\">\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(5)].map((_, i) => (\n                  <div\n                    key={i}\n                    className=\"flex items-center justify-between p-3 border rounded-lg\"\n                  >\n                    <div className=\"space-y-2 flex-1\">\n                      <Skeleton className=\"h-4 w-[200px]\" />\n                      <Skeleton className=\"h-3 w-[150px]\" />\n                    </div>\n                    <Skeleton className=\"h-9 w-[80px]\" />\n                  </div>\n                ))}\n              </div>\n            ) : availableStudents.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                <p className=\"text-muted-foreground\">{t(\"dialog.add.no_results\")}</p>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {debouncedSearch\n                    ? t(\"dialog.add.adjust_search\")\n                    : t(\"dialog.add.start_typing\")}\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {availableStudents.map((student) => (\n                  <StudentListItem\n                    key={student.userId}\n                    student={student}\n                    onAdd={handleAddStudent}\n                    isAdding={isAdding}\n                  />\n                ))}\n              </div>\n            )}\n          </ScrollArea>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\ninterface StudentListItemProps {\n  student: StudentProfileListItem;\n  onAdd: (studentUserId: number) => void;\n  isAdding: boolean;\n}\n\nfunction StudentListItem({ student, onAdd, isAdding }: StudentListItemProps) {\n  const t = useTranslations(\"admin.classes.students\");\n  return (\n    <div className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-accent transition-colors\">\n      <div className=\"flex-1 space-y-1\">\n        <div className=\"flex items-center gap-2\">\n          <code className=\"text-sm bg-muted px-2 py-0.5 rounded\">\n            {student.rollNumber}\n          </code>\n          <span className=\"font-medium\">{student.fullName}</span>\n        </div>\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <span>{student.email}</span>\n          {student.major && (\n            <>\n              <span>â€¢</span>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {student.major.code}\n              </Badge>\n            </>\n          )}\n        </div>\n      </div>\n      <Button\n        size=\"sm\"\n        onClick={() => onAdd(student.userId)}\n        disabled={isAdding}\n      >\n        {t(\"dialog.add.button_add\")}\n      </Button>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\class-columns.tsx",
      "relative_path": "components/admin/classes/class-columns.tsx",
      "filename": "class-columns.tsx",
      "size_bytes": 6715,
      "lines": 240,
      "last_modified": "2025-11-21T19:17:03.186285",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Pencil, MoreHorizontal, Users, Calendar } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Class } from \"@/types\";\n\n// Header components\nfunction CodeHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_code')}</div>;\n}\n\nfunction SemesterHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_semester')}</div>;\n}\n\nfunction SubjectHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_subject')}</div>;\n}\n\nfunction StudentsHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_students')}</div>;\n}\n\nfunction SlotsHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_slots')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction ActionCell({ \n  classItem, \n  onEdit, \n  onViewSlots, \n  onViewStudents \n}: { \n  classItem: Class; \n  onEdit: (classItem: Class) => void;\n  onViewSlots?: (classItem: Class) => void;\n  onViewStudents?: (classItem: Class) => void;\n}) {\n  const t = useTranslations('class');\n  \n  return (\n    <div className=\"flex justify-center\">\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\">\n          <DropdownMenuLabel>{t('menu_label', { code: classItem.code })}</DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem onClick={() => onEdit(classItem)}>\n            <Pencil className=\"mr-2 h-4 w-4\" />\n            {t('edit_menu')}\n          </DropdownMenuItem>\n          <DropdownMenuItem\n            onClick={() => {\n              if (onViewStudents) {\n                onViewStudents(classItem);\n              }\n            }}\n          >\n            <Users className=\"mr-2 h-4 w-4\" />\n            {t('view_enrollments_menu')}\n          </DropdownMenuItem>\n          <DropdownMenuItem\n            onClick={() => {\n              if (onViewSlots) {\n                onViewSlots(classItem);\n              }\n            }}\n          >\n            <Calendar className=\"mr-2 h-4 w-4\" />\n            {t('view_slots_menu')}\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nexport const createClassColumns = (\n  onEdit: (classItem: Class) => void,\n  onSemesterClick: (semesterCode: string) => void,\n  onSubjectClick: (subjectCode: string) => void,\n  onViewSlots?: (classItem: Class) => void,\n  onViewStudents?: (classItem: Class) => void\n): ColumnDef<Class>[] => [\n  {\n    accessorKey: \"code\",\n    header: CodeHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"code\")}</div>\n    ),\n  },\n  {\n    id: \"semester\",\n    header: SemesterHeader,\n    cell: ({ row }) => {\n      const semester = row.original.semester;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80\"\n                  onClick={() => onSemesterClick(semester.code)}\n                >\n                  {semester.code}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <p>{semester.name}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"subject\",\n    header: SubjectHeader,\n    cell: ({ row }) => {\n      const subject = row.original.subject;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80\"\n                  onClick={() => onSubjectClick(subject.code)}\n                >\n                  {subject.code}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <p>{subject.name}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"students\",\n    header: StudentsHeader,\n    cell: ({ row }) => {\n      const totalEnrolled = row.original.totalEnrolledStudent;\n      return (\n        <div className=\"text-center\">\n          <span className=\"font-medium\">{totalEnrolled}</span>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"slots\",\n    header: SlotsHeader,\n    cell: ({ row }) => {\n      const activeSlots = row.original.totalActiveSlot;\n      return (\n        <div className=\"text-center\">\n          <span className=\"font-medium\">{activeSlots}</span>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return <StatusCell isActive={isActive} />;\n    },\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        classItem={row.original}\n        onEdit={onEdit}\n        onViewSlots={onViewSlots}\n        onViewStudents={onViewStudents}\n      />\n    ),\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\class-form-dialog.tsx",
      "relative_path": "components/admin/classes/class-form-dialog.tsx",
      "filename": "class-form-dialog.tsx",
      "size_bytes": 19234,
      "lines": 493,
      "last_modified": "2025-11-21T20:16:08.830716",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { toast } from \"sonner\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\nimport { Class, Semester, Subject } from \"@/types\";\nimport { useGetSemesters } from \"@/hooks/api/useSemesters\";\nimport { useGetSubjects } from \"@/hooks/api/useSubjects\";\nimport { FILTER_PAGE_SIZE } from \"@/lib/constants\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Check, ChevronsUpDown } from \"lucide-react\";\n\ninterface ClassFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  classItem?: Class;\n  isLoadingClass?: boolean;\n  onSubmit: (data: ClassFormData) => Promise<void>;\n  onDelete?: (classItem: Class) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n  availableSemesters: Semester[];\n  availableSubjects: Subject[];\n}\n\nexport interface ClassFormData {\n  code: string;\n  semesterId: number;\n  subjectId: number;\n  isActive?: boolean;\n}\n\nexport function ClassFormDialog({\n  open,\n  onOpenChange,\n  classItem,\n  isLoadingClass = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n  availableSemesters,\n  availableSubjects,\n}: ClassFormDialogProps) {\n  const isEditMode = !!classItem;\n  const [semesterOpen, setSemesterOpen] = useState(false);\n  const [subjectOpen, setSubjectOpen] = useState(false);\n  const [semesterQuery, setSemesterQuery] = useState(\"\");\n  const [subjectQuery, setSubjectQuery] = useState(\"\");\n  \n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n\n  // Create schema with translated messages\n  const baseClassFormSchema = useMemo(() => z.object({\n    code: z\n      .string()\n      .min(1, tValidation('code_required'))\n      .max(20, tValidation('code_max_length'))\n      .regex(\n        /^[A-Z0-9]+$/,\n        tValidation('code_uppercase_format')\n      ),\n    semesterId: z.number().min(1, tValidation('semester_required')),\n    subjectId: z.number().min(1, tValidation('subject_required')),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  type ClassFormValues = z.infer<typeof baseClassFormSchema>;\n\n  const form = useForm<ClassFormValues>({\n    resolver: zodResolver(baseClassFormSchema),\n    defaultValues: {\n      code: classItem?.code || \"\",\n      semesterId: classItem?.semester.id || 0,\n      subjectId: classItem?.subject.id || 0,\n      isActive: classItem?.isActive ?? true,\n    },\n  });\n\n  // Remote search for semesters and subjects (only active items)\n  const { data: remoteSemesters } = useGetSemesters({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    search: semesterQuery || undefined,\n    isActive: true,\n  });\n  const { data: remoteSubjects } = useGetSubjects({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"code\",\n    search: subjectQuery || undefined,\n    isActive: true,\n  });\n\n  // Merge current inactive item in EDIT mode\n  const semesterOptions = useMemo(() => {\n    const activeItems = remoteSemesters?.items || availableSemesters;\n    if (isEditMode && classItem?.semester && !classItem.semester.isActive) {\n      const currentExists = activeItems.some(s => s.id === classItem.semester.id);\n      if (!currentExists) {\n        return [classItem.semester, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteSemesters?.items, availableSemesters, isEditMode, classItem]);\n\n  const subjectOptions = useMemo(() => {\n    const activeItems = remoteSubjects?.items || availableSubjects;\n    if (isEditMode && classItem?.subject && !classItem.subject.isActive) {\n      const currentExists = activeItems.some(s => s.id === classItem.subject.id);\n      if (!currentExists) {\n        return [classItem.subject, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteSubjects?.items, availableSubjects, isEditMode, classItem]);\n\n  useEffect(() => {\n    if (!semesterOpen) setSemesterQuery(\"\");\n  }, [semesterOpen]);\n  \n  useEffect(() => {\n    if (!subjectOpen) setSubjectQuery(\"\");\n  }, [subjectOpen]);\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        code: classItem?.code || \"\",\n        semesterId: classItem?.semester.id || 0,\n        subjectId: classItem?.subject.id || 0,\n        isActive: classItem?.isActive ?? true,\n      });\n    }\n  }, [classItem, open, form]);\n\n  const handleSubmit = async (values: ClassFormValues) => {\n    form.clearErrors();\n    try {\n      // Convert code to uppercase before submitting\n      await onSubmit({\n        code: values.code.toUpperCase(),\n        semesterId: values.semesterId,\n        subjectId: values.subjectId,\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Map specific error codes to form fields\n      if (errorCode === ERROR_CODES.CLASS_EXISTS) {\n        form.setError(\"code\", {\n          type: \"manual\",\n          message: apiMessage || tApiError('code_exists'),\n        });\n      } else if (errorCode === ERROR_CODES.CLASS_CODE_REQUIRED) {\n        form.setError(\"code\", {\n          type: \"manual\",\n          message: apiMessage || tValidation('code_required'),\n        });\n      } else if (errorCode === ERROR_CODES.CLASS_SEMESTER_ID_REQUIRED) {\n        form.setError(\"semesterId\", {\n          type: \"manual\",\n          message: apiMessage || tValidation('semester_required'),\n        });\n      } else if (errorCode === ERROR_CODES.CLASS_SUBJECT_ID_REQUIRED) {\n        form.setError(\"subjectId\", {\n          type: \"manual\",\n          message: apiMessage || tValidation('subject_required'),\n        });\n      } else if (errorCode === ERROR_CODES.INACTIVE_REFERENCE_NOT_ALLOWED) {\n        toast.error(apiMessage);\n      } else if (errorCode === ERROR_CODES.CLASS_HAS_ACTIVE_DEPENDENCIES) {\n        form.setError(\"isActive\", {\n          type: \"manual\",\n          message: apiMessage || tApiError('cannot_deactivate'),\n        });\n      }\n    }\n  };\n\n  const selectedSemester = semesterOptions.find(\n    (s) => s.id === form.watch(\"semesterId\")\n  );\n  const selectedSubject = subjectOptions.find(\n    (s) => s.id === form.watch(\"subjectId\")\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>\n            {isEditMode ? tForm('title_edit') : tForm('title_create')}\n          </DialogTitle>\n          <DialogDescription>\n            {isEditMode\n              ? tForm('description_edit')\n              : tForm('description_create')}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"space-y-4\"\n          >\n            {/* Loading State */}\n            {isLoadingClass && isEditMode && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                {tForm('loading')}\n              </div>\n            )}\n\n            {/* Form Fields - Hidden while loading in edit mode */}\n            {(!isLoadingClass || !isEditMode) && (\n              <>\n                {/* Code Field */}\n                <FormField\n                  control={form.control}\n                  name=\"code\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>\n                        {tForm('label_class_code')}{\" \"}\n                        <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder={tForm('placeholder_class_code')}\n                          onChange={(e) =>\n                            field.onChange(e.target.value.toUpperCase())\n                          }\n                          disabled={isSubmitting || isDeleting}\n                          autoComplete=\"off\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Semester Field */}\n                <FormField\n                  control={form.control}\n                  name=\"semesterId\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {tForm('label_semester')}{\" \"}\n                        <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover open={semesterOpen} onOpenChange={setSemesterOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              className={cn(\n                                \"justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              disabled={isSubmitting || isDeleting}\n                            >\n                              {selectedSemester\n                                ? `${selectedSemester.code} - ${selectedSemester.name}`\n                                : tForm('placeholder_semester')}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[400px] p-0\">\n                          <Command>\n                            <CommandInput\n                              placeholder={tForm('search_semester')}\n                              value={semesterQuery}\n                              onValueChange={setSemesterQuery}\n                            />\n                            <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                              <CommandEmpty>{tForm('no_semester_found')}</CommandEmpty>\n                              <CommandGroup>\n                                {semesterOptions.map((semester) => (\n                                  <CommandItem\n                                    key={semester.id}\n                                    value={`${semester.code}-${semester.name}`}\n                                    onSelect={() => {\n                                      field.onChange(semester.id);\n                                      setSemesterOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        semester.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    {semester.code} - {semester.name}\n                                    {!semester.isActive && (\n                                      <span className=\"ml-2 text-xs text-muted-foreground\">\n                                        (Inactive)\n                                      </span>\n                                    )}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Subject Field */}\n                <FormField\n                  control={form.control}\n                  name=\"subjectId\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {tForm('label_subject')}{\" \"}\n                        <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover open={subjectOpen} onOpenChange={setSubjectOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              className={cn(\n                                \"justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              disabled={isSubmitting || isDeleting}\n                            >\n                              {selectedSubject\n                                ? `${selectedSubject.code} - ${selectedSubject.name}`\n                                : tForm('placeholder_subject')}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[400px] p-0\">\n                          <Command>\n                            <CommandInput\n                              placeholder={tForm('search_subject')}\n                              value={subjectQuery}\n                              onValueChange={setSubjectQuery}\n                            />\n                            <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                              <CommandEmpty>{tForm('no_subject_found')}</CommandEmpty>\n                              <CommandGroup>\n                                {subjectOptions.map((subject) => (\n                                  <CommandItem\n                                    key={subject.id}\n                                    value={`${subject.code}-${subject.name}`}\n                                    onSelect={() => {\n                                      field.onChange(subject.id);\n                                      setSubjectOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        subject.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    {subject.code} - {subject.name}\n                                    {!subject.isActive && (\n                                      <span className=\"ml-2 text-xs text-muted-foreground\">\n                                        (Inactive)\n                                      </span>\n                                    )}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Active Status Switch (Edit Mode Only) */}\n                {isEditMode && (\n                  <FormField\n                    control={form.control}\n                    name=\"isActive\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                        <div className=\"space-y-0.5 flex-1\">\n                          <FormLabel className=\"text-base\">\n                            {tForm('label_active')}\n                          </FormLabel>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {field.value\n                              ? tForm('description_active')\n                              : tForm('description_inactive')}\n                          </div>\n                        </div>\n                        <FormControl>\n                          <Switch\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            disabled={isSubmitting || isDeleting}\n                          />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                )}\n              </>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-2 pt-2\">\n              {isEditMode && onDelete && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => onDelete(classItem)}\n                  disabled={isSubmitting || isDeleting}\n                  className=\"flex-1\"\n                >\n                  {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                </Button>\n              )}\n              <Button\n                type=\"submit\"\n                disabled={isSubmitting || isDeleting || isLoadingClass}\n                className=\"flex-1\"\n              >\n                {isSubmitting\n                  ? tForm('button_saving')\n                  : isEditMode\n                  ? tForm('button_update')\n                  : tForm('button_create')}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\class-pagination.tsx",
      "relative_path": "components/admin/classes/class-pagination.tsx",
      "filename": "class-pagination.tsx",
      "size_bytes": 3009,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.290148",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface ClassPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function ClassPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: ClassPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\class-students-table.tsx",
      "relative_path": "components/admin/classes/class-students-table.tsx",
      "filename": "class-students-table.tsx",
      "size_bytes": 9373,
      "lines": 226,
      "last_modified": "2025-11-24T16:45:26.315104",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Pencil, UserX, UserPlus, MoreHorizontal, Trash2 } from \"lucide-react\";\nimport { ClassEnrollment } from \"@/types\";\n\ninterface ClassStudentsTableProps {\n  data: ClassEnrollment[];\n  currentPage: number;\n  pageSize: number;\n  onEdit: (enrollment: ClassEnrollment) => void;\n  onWithdraw: (enrollment: ClassEnrollment) => void;\n  onReEnroll: (enrollment: ClassEnrollment) => void;\n  onDelete?: (enrollment: ClassEnrollment) => void;\n  isWithdrawing?: boolean;\n  isReEnrolling?: boolean;\n  canModifyEnrollments?: boolean;  // NEW: check semester date range\n  canDelete?: boolean;  // Can delete only if class hasn't started\n  fixedRowCount?: number;\n}\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString(\"en-US\", {\n    year: \"numeric\",\n    month: \"short\",\n    day: \"numeric\",\n  });\n};\n\nexport function ClassStudentsTable({\n  data,\n  currentPage,\n  pageSize,\n  onEdit,\n  onWithdraw,\n  onReEnroll,\n  onDelete,\n  isWithdrawing = false,\n  isReEnrolling = false,\n  canModifyEnrollments = true,  // NEW: check semester date range\n  canDelete = false,  // Can delete only if class hasn't started\n  fixedRowCount = 10,\n}: ClassStudentsTableProps) {\n  const t = useTranslations(\"admin.classes.students\");\n  const columnCount = 8;\n\n  return (\n    <div className=\"rounded-md border bg-background overflow-x-auto\">\n      <Table className=\"min-w-[1000px]\">\n        <TableHeader>\n          <TableRow>\n            <TableHead className=\"text-center w-[60px] whitespace-nowrap\">\n              {t(\"table.header.stt\")}\n            </TableHead>\n            <TableHead className=\"text-center w-[110px] whitespace-nowrap\">\n              {t(\"table.header.roll_number\")}\n            </TableHead>\n            <TableHead className=\"text-center whitespace-nowrap\">\n              {t(\"table.header.full_name\")}\n            </TableHead>\n            <TableHead className=\"text-center whitespace-nowrap\">\n              {t(\"table.header.email\")}\n            </TableHead>\n            <TableHead className=\"text-center w-[100px] whitespace-nowrap\">\n              {t(\"table.header.major\")}\n            </TableHead>\n            <TableHead className=\"text-center w-[120px] whitespace-nowrap\">\n              {t(\"table.header.enrolled_at\")}\n            </TableHead>\n            <TableHead className=\"text-center w-[90px] whitespace-nowrap\">\n              {t(\"table.header.status\")}\n            </TableHead>\n            <TableHead className=\"text-center w-[80px] whitespace-nowrap\">\n              {t(\"table.header.action\")}\n            </TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {data.length > 0 ? (\n            <>\n              {data.map((enrollment, index) => {\n                const stt = (currentPage - 1) * pageSize + index + 1;\n                return (\n                  <TableRow key={enrollment.studentUserId}>\n                    <TableCell className=\"text-center font-medium h-[52px] whitespace-nowrap\">\n                      {stt}\n                    </TableCell>\n                    <TableCell className=\"text-center h-[52px] whitespace-nowrap\">\n                      <code className=\"text-sm bg-muted px-2 py-1 rounded\">\n                        {enrollment.rollNumber}\n                      </code>\n                    </TableCell>\n                    <TableCell className=\"text-center h-[52px] whitespace-nowrap\">\n                      {enrollment.fullName}\n                    </TableCell>\n                    <TableCell className=\"text-center text-muted-foreground h-[52px] whitespace-nowrap\">\n                      {enrollment.email}\n                    </TableCell>\n                    <TableCell className=\"text-center h-[52px] whitespace-nowrap\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {enrollment.major.code}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-center text-muted-foreground text-sm h-[52px] whitespace-nowrap\">\n                      {formatDate(enrollment.enrolledAt)}\n                    </TableCell>\n                    <TableCell className=\"text-center h-[52px] whitespace-nowrap\">\n                      <Badge\n                        variant={\n                          enrollment.isEnrolled ? \"default\" : \"destructive\"\n                        }\n                        className=\"w-[74px] justify-center\"\n                      >\n                        {enrollment.isEnrolled ? t(\"table.status.active\") : t(\"table.status.withdrawn\")}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-center h-[52px] whitespace-nowrap\">\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0\"\n                          >\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuLabel>\n                            {enrollment.rollNumber}\n                          </DropdownMenuLabel>\n                          <DropdownMenuSeparator />\n                          <DropdownMenuItem onClick={() => onEdit(enrollment)}>\n                            <Pencil className=\"mr-2 h-4 w-4\" />\n                            {t(\"table.menu.view_details\")}\n                          </DropdownMenuItem>\n                          {enrollment.isEnrolled ? (\n                            <>\n                              <DropdownMenuItem\n                                onClick={() => onWithdraw(enrollment)}\n                                disabled={isWithdrawing || !canModifyEnrollments}\n                                className=\"text-destructive focus:text-destructive\"\n                              >\n                                <UserX className=\"mr-2 h-4 w-4\" />\n                                {t(\"table.menu.withdraw\")}\n                              </DropdownMenuItem>\n                              {canDelete && onDelete && (\n                                <>\n                                  <DropdownMenuSeparator />\n                                  <DropdownMenuItem\n                                    onClick={() => onDelete(enrollment)}\n                                    className=\"text-destructive focus:text-destructive\"\n                                  >\n                                    <Trash2 className=\"mr-2 h-4 w-4\" />\n                                    {t(\"table.menu.delete\")}\n                                  </DropdownMenuItem>\n                                </>\n                              )}\n                            </>\n                          ) : (\n                            <DropdownMenuItem\n                              onClick={() => onReEnroll(enrollment)}\n                              disabled={isReEnrolling || !canModifyEnrollments}\n                              className=\"text-green-600 focus:text-green-600\"\n                            >\n                              <UserPlus className=\"mr-2 h-4 w-4\" />\n                              {t(\"table.menu.re_enroll\")}\n                            </DropdownMenuItem>\n                          )}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                );\n              })}\n              {/* Fill empty rows for fixed height */}\n              {Array.from({\n                length: Math.max(0, fixedRowCount - data.length),\n              }).map((_, index) => (\n                <TableRow key={`empty-${index}`}>\n                  <TableCell colSpan={columnCount} className=\"h-[52px]\" />\n                </TableRow>\n              ))}\n            </>\n          ) : (\n            <>\n              <TableRow>\n                <TableCell\n                  colSpan={columnCount}\n                  className=\"h-[52px] text-center\"\n                >\n                  {t(\"table.empty.no_students\")}\n                </TableCell>\n              </TableRow>\n              {/* Fill remaining empty rows when no data */}\n              {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                <TableRow key={`empty-${index}`}>\n                  <TableCell colSpan={columnCount} className=\"h-[52px]\" />\n                </TableRow>\n              ))}\n            </>\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\class-table.tsx",
      "relative_path": "components/admin/classes/class-table.tsx",
      "filename": "class-table.tsx",
      "size_bytes": 4706,
      "lines": 155,
      "last_modified": "2025-11-11T10:48:14.521492",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from 'next-intl';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Class } from \"@/types\";\nimport { ClassPagination } from \"./class-pagination\";\n\ninterface ClassTableProps {\n  columns: ColumnDef<Class>[];\n  data: Class[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function ClassTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: ClassTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const t = useTranslations('class');\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[900px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t('no_classes')}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t('pagination_showing', {\n              start: (currentPage - 1) * pageSize + 1,\n              end: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t('pagination_no_items')\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <ClassPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\delete-class-dialog.tsx",
      "relative_path": "components/admin/classes/delete-class-dialog.tsx",
      "filename": "delete-class-dialog.tsx",
      "size_bytes": 2271,
      "lines": 75,
      "last_modified": "2025-11-11T10:48:14.522487",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from 'next-intl';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Class } from \"@/types\";\n\ninterface DeleteClassDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  classItem: Class | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteClassDialog({\n  open,\n  onOpenChange,\n  classItem,\n  onConfirm,\n  isDeleting = false,\n}: DeleteClassDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!classItem) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {t('class_name', { code: classItem.code })}\n            </span>{\" \"}\n            for{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {classItem.subject.name}\n            </span>{\" \"}\n            in{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {classItem.semester.name}\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>{t('button_cancel')}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\delete-student-dialog.tsx",
      "relative_path": "components/admin/classes/delete-student-dialog.tsx",
      "filename": "delete-student-dialog.tsx",
      "size_bytes": 2061,
      "lines": 69,
      "last_modified": "2025-11-24T16:47:01.007953",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { ClassEnrollment } from \"@/types\";\n\ninterface DeleteStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  enrollment: ClassEnrollment | null;\n  onConfirm: () => void;\n  isDeleting: boolean;\n}\n\nexport function DeleteStudentDialog({\n  open,\n  onOpenChange,\n  enrollment,\n  onConfirm,\n  isDeleting,\n}: DeleteStudentDialogProps) {\n  const t = useTranslations(\"admin.classes.students\");\n\n  if (!enrollment) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t(\"dialog.delete.title\")}</AlertDialogTitle>\n          <AlertDialogDescription asChild>\n            <div className=\"space-y-2\">\n              <div>\n                {t.rich(\"dialog.delete.confirm_message\", {\n                  name: enrollment.fullName,\n                  rollNumber: enrollment.rollNumber,\n                })}\n              </div>\n              <div className=\"text-destructive\">\n                {t(\"dialog.delete.warning\")}\n              </div>\n            </div>\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>\n            {t(\"dialog.delete.button_cancel\")}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isDeleting ? t(\"dialog.delete.button_deleting\") : t(\"dialog.delete.button_confirm\")}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\re-enroll-student-dialog.tsx",
      "relative_path": "components/admin/classes/re-enroll-student-dialog.tsx",
      "filename": "re-enroll-student-dialog.tsx",
      "size_bytes": 2094,
      "lines": 69,
      "last_modified": "2025-11-24T16:46:48.656667",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { ClassEnrollment } from \"@/types\";\n\ninterface ReEnrollStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  enrollment: ClassEnrollment | null;\n  onConfirm: () => void;\n  isReEnrolling: boolean;\n}\n\nexport function ReEnrollStudentDialog({\n  open,\n  onOpenChange,\n  enrollment,\n  onConfirm,\n  isReEnrolling,\n}: ReEnrollStudentDialogProps) {\n  const t = useTranslations(\"admin.classes.students\");\n\n  if (!enrollment) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t(\"dialog.re_enroll.title\")}</AlertDialogTitle>\n          <AlertDialogDescription asChild>\n            <div className=\"space-y-2\">\n              <div>\n                {t.rich(\"dialog.re_enroll.confirm_message\", {\n                  name: enrollment.fullName,\n                  rollNumber: enrollment.rollNumber,\n                })}\n              </div>\n              <div className=\"text-green-600 dark:text-green-500\">\n                {t(\"dialog.re_enroll.note\")}\n              </div>\n            </div>\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isReEnrolling}>\n            {t(\"dialog.re_enroll.button_cancel\")}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isReEnrolling}\n            className=\"bg-green-600 text-white hover:bg-green-700\"\n          >\n            {isReEnrolling ? t(\"dialog.re_enroll.button_reenrolling\") : t(\"dialog.re_enroll.button_confirm\")}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\view-student-dialog.tsx",
      "relative_path": "components/admin/classes/view-student-dialog.tsx",
      "filename": "view-student-dialog.tsx",
      "size_bytes": 6402,
      "lines": 174,
      "last_modified": "2025-11-24T16:49:00.186202",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ClassEnrollment } from \"@/types\";\nimport { Mail, Hash, GraduationCap, Calendar, UserCheck } from \"lucide-react\";\n\ninterface ViewStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  enrollment: ClassEnrollment | null;\n}\n\nfunction getInitials(name: string) {\n  const parts = name.trim().split(/\\s+/);\n  const first = parts[0]?.[0] || \"\";\n  const last = parts.length > 1 ? parts[parts.length - 1][0] : \"\";\n  return (first + last).toUpperCase();\n}\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString(\"en-US\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n};\n\nexport function ViewStudentDialog({\n  open,\n  onOpenChange,\n  enrollment,\n}: ViewStudentDialogProps) {\n  const t = useTranslations(\"admin.classes.students\");\n\n  if (!enrollment) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>{t(\"dialog.view.title\")}</DialogTitle>\n          <DialogDescription>\n            {t(\"dialog.view.description\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* Avatar and Basic Info */}\n          <div className=\"flex items-center gap-4\">\n            <Avatar className=\"h-16 w-16\">\n              <AvatarFallback className=\"text-lg font-semibold\">\n                {getInitials(enrollment.fullName)}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-lg\">{enrollment.fullName}</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                {enrollment.rollNumber}\n              </p>\n            </div>\n            <Badge\n              variant={enrollment.isEnrolled ? \"default\" : \"destructive\"}\n              className=\"h-fit\"\n            >\n              {enrollment.isEnrolled ? t(\"table.status.active\") : t(\"table.status.withdrawn\")}\n            </Badge>\n          </div>\n\n          {/* Details Grid */}\n          <div className=\"space-y-4\">\n            {/* Email */}\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n                <Mail className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"dialog.view.label.email\")}\n                </p>\n                <p className=\"text-sm\">{enrollment.email}</p>\n              </div>\n            </div>\n\n            {/* Roll Number */}\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n                <Hash className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"dialog.view.label.roll_number\")}\n                </p>\n                <p className=\"text-sm font-mono\">{enrollment.rollNumber}</p>\n              </div>\n            </div>\n\n            {/* Major */}\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n                <GraduationCap className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"dialog.view.label.major\")}\n                </p>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {enrollment.major.code}\n                  </Badge>\n                  <span className=\"text-sm\">\n                    {enrollment.major.name}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Enrolled Date */}\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n                <Calendar className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"dialog.view.label.enrolled_at\")}\n                </p>\n                <p className=\"text-sm\">{formatDate(enrollment.enrolledAt)}</p>\n              </div>\n            </div>\n\n            {/* Status */}\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n                <UserCheck className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"dialog.view.label.status\")}\n                </p>\n                <div className=\"mt-1\">\n                  <Badge\n                    variant={enrollment.isEnrolled ? \"default\" : \"destructive\"}\n                  >\n                    {enrollment.isEnrolled ? t(\"table.status.active\") : t(\"table.status.withdrawn\")}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n\n            {/* Last Updated */}\n            {enrollment.updatedAt && (\n              <div className=\"pt-2 border-t\">\n                <p className=\"text-xs text-muted-foreground\">\n                  {t(\"dialog.view.label.last_updated\")}: {formatDate(enrollment.updatedAt)}\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\classes\\withdraw-student-dialog.tsx",
      "relative_path": "components/admin/classes/withdraw-student-dialog.tsx",
      "filename": "withdraw-student-dialog.tsx",
      "size_bytes": 2112,
      "lines": 69,
      "last_modified": "2025-11-24T16:46:36.028802",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { ClassEnrollment } from \"@/types\";\n\ninterface WithdrawStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  enrollment: ClassEnrollment | null;\n  onConfirm: () => void;\n  isWithdrawing: boolean;\n}\n\nexport function WithdrawStudentDialog({\n  open,\n  onOpenChange,\n  enrollment,\n  onConfirm,\n  isWithdrawing,\n}: WithdrawStudentDialogProps) {\n  const t = useTranslations(\"admin.classes.students\");\n\n  if (!enrollment) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t(\"dialog.withdraw.title\")}</AlertDialogTitle>\n          <AlertDialogDescription asChild>\n            <div className=\"space-y-2\">\n              <div>\n                {t.rich(\"dialog.withdraw.confirm_message\", {\n                  name: enrollment.fullName,\n                  rollNumber: enrollment.rollNumber,\n                })}\n              </div>\n              <div className=\"text-amber-600 dark:text-amber-500\">\n                {t(\"dialog.withdraw.note\")}\n              </div>\n            </div>\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isWithdrawing}>\n            {t(\"dialog.withdraw.button_cancel\")}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isWithdrawing}\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isWithdrawing ? t(\"dialog.withdraw.button_withdrawing\") : t(\"dialog.withdraw.button_confirm\")}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\bulk-add-participants-dialog.tsx",
      "relative_path": "components/admin/exams/bulk-add-participants-dialog.tsx",
      "filename": "bulk-add-participants-dialog.tsx",
      "size_bytes": 12121,
      "lines": 336,
      "last_modified": "2025-11-24T14:36:53.576771",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Search, UserPlus, Users } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ExamSlotSubject, SemesterStudent, ExamParticipant } from \"@/types\";\nimport { cn } from \"@/lib/utils\";\n\ninterface BulkAddParticipantsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  assignedSubjects: ExamSlotSubject[];\n  semesterStudents: SemesterStudent[];\n  existingParticipants: ExamParticipant[];\n  isLoadingStudents: boolean;\n  onSubjectChange: (subjectId: string) => void;\n  onConfirm: (studentUserIds: number[]) => void;\n  isPending?: boolean;\n}\n\nexport function BulkAddParticipantsDialog({\n  open,\n  onOpenChange,\n  assignedSubjects,\n  semesterStudents,\n  existingParticipants,\n  isLoadingStudents,\n  onSubjectChange,\n  onConfirm,\n  isPending = false,\n}: BulkAddParticipantsDialogProps) {\n  const t = useTranslations(\"admin.exams.participants.bulk_add\");\n  const [selectedSubjectId, setSelectedSubjectId] = useState<string>(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedStudentIds, setSelectedStudentIds] = useState<Set<number>>(\n    new Set()\n  );\n\n  // Get existing participant IDs for filtering\n  const existingParticipantIds = useMemo(() => {\n    if (!selectedSubjectId) return new Set<number>();\n\n    const selectedSubjectIdNum = parseInt(selectedSubjectId);\n\n    return new Set(\n      existingParticipants\n        .filter((p) => p.subjectId === selectedSubjectIdNum)\n        .map((p) => p.studentUserId)\n    );\n  }, [existingParticipants, selectedSubjectId]);\n\n  // Filter students based on search query and exclude existing participants\n  const filteredStudents = useMemo(() => {\n    return semesterStudents.filter((student) => {\n      // Exclude already added participants\n      if (existingParticipantIds.has(student.userId)) {\n        return false;\n      }\n\n      // Search filter - by name, roll number, and email\n      if (searchQuery) {\n        const query = searchQuery.toLowerCase();\n        return (\n          student.rollNumber.toLowerCase().includes(query) ||\n          student.fullName.toLowerCase().includes(query) ||\n          student.email.toLowerCase().includes(query)\n        );\n      }\n\n      return true;\n    });\n  }, [semesterStudents, searchQuery, existingParticipantIds]);\n\n  // Stats\n  const availableCount = filteredStudents.length;\n  const selectedCount = selectedStudentIds.size;\n\n  // Handlers\n  const handleSubjectChange = (value: string) => {\n    setSelectedSubjectId(value);\n    setSelectedStudentIds(new Set());\n    setSearchQuery(\"\");\n    onSubjectChange(value);\n  };\n\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      const allIds = new Set(filteredStudents.map((s) => s.userId));\n      setSelectedStudentIds(allIds);\n    } else {\n      setSelectedStudentIds(new Set());\n    }\n  };\n\n  const handleToggleStudent = (\n    userId: number,\n    checked: boolean | \"indeterminate\"\n  ) => {\n    const newSelected = new Set(selectedStudentIds);\n    if (checked === true) {\n      newSelected.add(userId);\n    } else {\n      newSelected.delete(userId);\n    }\n    setSelectedStudentIds(newSelected);\n  };\n\n  const handleConfirm = () => {\n    if (selectedStudentIds.size === 0) return;\n    onConfirm(Array.from(selectedStudentIds));\n    handleClose();\n  };\n\n  const handleClose = () => {\n    setSelectedSubjectId(\"\");\n    setSearchQuery(\"\");\n    setSelectedStudentIds(new Set());\n    onOpenChange(false);\n  };\n\n  const isAllSelected =\n    filteredStudents.length > 0 &&\n    selectedStudentIds.size === filteredStudents.length;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[700px] min-h-[90vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            {t(\"title\")}\n          </DialogTitle>\n          <DialogDescription>\n            {t(\"description\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex-1 space-y-4\">\n          {/* Subject Selector */}\n          <div className=\"space-y-2\">\n            <Label>{t(\"subject_label\")}</Label>\n            <div>\n              <Select\n                value={selectedSubjectId}\n                onValueChange={handleSubjectChange}\n              >\n                <SelectTrigger className=\"w-[320px]\">\n                  <SelectValue placeholder={t(\"select_subject\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  {assignedSubjects.map((item) => (\n                    <SelectItem\n                      key={item.subject.id}\n                      value={item.subject.id.toString()}\n                    >\n                      {item.subject.code} - {item.subject.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            {assignedSubjects.length === 0 && (\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"no_subjects\")}\n              </p>\n            )}\n          </div>\n\n          {!selectedSubjectId ? (\n            /* Empty state when no subject selected */\n            <div className=\"flex flex-col items-center justify-center py-16 text-center text-muted-foreground\">\n              <Users className=\"h-16 w-16 mb-4 opacity-20\" />\n              <p className=\"text-lg font-medium mb-2\">{t(\"no_subject_selected\")}</p>\n              <p className=\"text-sm max-w-sm\">\n                {t(\"no_subject_hint\")}\n              </p>\n            </div>\n          ) : (\n            <>\n              {/* Search */}\n              <div className=\"space-y-2\">\n                <Label>{t(\"search_label\")}</Label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder={t(\"search_placeholder\")}\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-9\"\n                    autoComplete=\"off\"\n                  />\n                </div>\n              </div>\n\n              {/* Stats & Select All */}\n              <div className=\"flex items-center justify-between gap-4 py-2 border-y\">\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox\n                    id=\"select-all\"\n                    checked={isAllSelected}\n                    onCheckedChange={handleSelectAll}\n                    disabled={availableCount === 0 || isLoadingStudents}\n                  />\n                  <Label\n                    htmlFor=\"select-all\"\n                    className=\"text-sm font-medium cursor-pointer\"\n                  >\n                    {t(\"select_all\")}\n                  </Label>\n                </div>\n                {selectedCount > 0 && (\n                  <Badge variant=\"default\" className=\"ml-auto\">\n                    {t(\"selected_count\", { count: selectedCount })}\n                  </Badge>\n                )}\n              </div>\n\n              {/* Students List */}\n              <ScrollArea className=\"h-[400px]\">\n                <div className=\"min-h-[300px]\">\n                  {isLoadingStudents ? (\n                    <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : filteredStudents.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-8 text-center text-muted-foreground\">\n                      <Users className=\"h-12 w-12 mb-3 opacity-20\" />\n                      <p className=\"text-sm\">\n                        {searchQuery\n                          ? t(\"no_match\")\n                          : semesterStudents.length === 0\n                          ? t(\"no_students_enrolled\")\n                          : t(\"all_added\")}\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-1 pb-2\">\n                      {filteredStudents.map((student) => {\n                        const isSelected = selectedStudentIds.has(\n                          student.userId\n                        );\n                        return (\n                          <div\n                            key={student.userId}\n                            className={cn(\n                              \"flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors hover:bg-accent\",\n                              isSelected && \"bg-accent border-primary\"\n                            )}\n                            onClick={() =>\n                              handleToggleStudent(student.userId, !isSelected)\n                            }\n                          >\n                            <Checkbox\n                              checked={isSelected}\n                              onCheckedChange={(checked) =>\n                                handleToggleStudent(student.userId, checked)\n                              }\n                              onClick={(e: React.MouseEvent) =>\n                                e.stopPropagation()\n                              }\n                            />\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"font-medium\">\n                                  {student.rollNumber}\n                                </span>\n                                <span className=\"text-sm text-muted-foreground\">\n                                  {student.fullName}\n                                </span>\n                              </div>\n                              <p className=\"text-xs text-muted-foreground truncate\">\n                                {student.email}\n                              </p>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              </ScrollArea>\n            </>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleClose} disabled={isPending}>\n            {t(\"cancel\")}\n          </Button>\n          <Button\n            onClick={handleConfirm}\n            disabled={\n              !selectedSubjectId ||\n              selectedStudentIds.size === 0 ||\n              isPending ||\n              isLoadingStudents\n            }\n          >\n            {isPending ? (\n              <>\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                {t(\"adding\")}\n              </>\n            ) : (\n              <>\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                {t(\"add_button\", { count: selectedCount })}\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\exam-columns.tsx",
      "relative_path": "components/admin/exams/exam-columns.tsx",
      "filename": "exam-columns.tsx",
      "size_bytes": 9532,
      "lines": 278,
      "last_modified": "2025-11-24T17:07:31.877416",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Eye, MoreHorizontal, Pencil, Trash2, Users } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Slot } from \"@/types\";\nimport { format } from \"date-fns\";\nimport { canDeleteSlot } from \"@/lib/utils\";\n\nconst formatExamTime = (startTime: string, endTime: string) => {\n  const start = new Date(startTime);\n  const end = new Date(endTime);\n  return `${format(start, \"MMM d, h:mm a\")} - ${format(end, \"h:mm a\")}`;\n};\n\ntype TranslationFunction = (key: string, values?: Record<string, string | number | Date>) => string;\n\nexport const createExamColumns = (\n  onEdit: (exam: Slot) => void,\n  onManageParticipants: (exam: Slot) => void,\n  onViewRoster: (exam: Slot) => void,\n  onDelete: (exam: Slot) => void,\n  onSubjectClick: (subjectCode: string) => void,\n  t: TranslationFunction\n): ColumnDef<Slot>[] => [\n  {\n    id: \"semester\",\n    header: () => <div className=\"text-center\">{t(\"table.header.semester\")}</div>,\n    cell: ({ row }) => {\n      const semester =\n        row.original.semester ?? row.original.class?.semester ?? null;\n      return (\n        <div className=\"flex justify-center\">\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {semester?.code ?? t(\"table.cell.na\")}\n          </Badge>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"subjects\",\n    header: () => <div className=\"text-center\">{t(\"table.header.subjects\")}</div>,\n    cell: ({ row }) => {\n      const subjects = row.original.subjects || [];\n      const subjectCount = subjects.length;\n\n      if (subjectCount === 0) {\n        return (\n          <div className=\"flex justify-center\">\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {t(\"table.cell.subjects_none\")}\n            </Badge>\n          </div>\n        );\n      }\n\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"secondary\"\n                  className=\"text-xs cursor-help w-[80px] justify-center\"\n                >\n                  {t(\"table.cell.subjects_count\", { count: subjectCount })}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\" className=\"max-w-xs\">\n                <div className=\"space-y-1\">\n                  {subjects.map((subject, index) => (\n                    <div\n                      key={`${subject.id}-${index}`}\n                      className=\"text-sm flex items-center gap-2 cursor-pointer hover:bg-white/10 rounded px-2 py-1 -mx-2 transition-colors\"\n                      onClick={() => onSubjectClick(subject.code)}\n                    >\n                      <Badge variant=\"default\" className=\"text-xs\">\n                        {subject.code}\n                      </Badge>\n                      <span>{subject.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"room\",\n    header: () => <div className=\"text-center\">{t(\"table.header.room\")}</div>,\n    cell: ({ row }) => {\n      const room = row.original.room;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div className=\"text-center cursor-help\">{room.name}</div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"font-semibold\">{room.name}</p>\n                {room.location && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    {room.location}\n                  </p>\n                )}\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"staff\",\n    header: () => <div className=\"text-center\">{t(\"table.header.staff\")}</div>,\n    cell: ({ row }) => {\n      const staff = row.original.staffUser;\n\n      if (!staff) {\n        return (\n          <div className=\"flex justify-center\">\n            <div className=\"text-center text-muted-foreground\">{t(\"table.cell.na\")}</div>\n          </div>\n        );\n      }\n\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div className=\"text-center cursor-help max-w-[150px] truncate\">\n                  {staff.fullName}\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"font-semibold\">{staff.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  @{staff.username}\n                </p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"time\",\n    header: () => <div className=\"text-center\">{t(\"table.header.exam_time\")}</div>,\n    cell: ({ row }) => {\n      const { startTime, endTime } = row.original;\n      return (\n        <div className=\"text-center text-sm text-muted-foreground whitespace-nowrap\">\n          {formatExamTime(startTime, endTime)}\n        </div>\n      );\n    },\n  },\n  {\n    id: \"participants\",\n    header: () => <div className=\"text-center\">{t(\"table.header.participants\")}</div>,\n    cell: ({ row }) => {\n      const { totalStudent } = row.original;\n      return (\n        <div className=\"text-center\">\n          <span className=\"font-medium\">{totalStudent}</span>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"isActive\",\n    header: () => <div className=\"text-center\">{t(\"table.header.status\")}</div>,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return (\n        <div className=\"flex justify-center\">\n          <Badge\n            variant={isActive ? \"default\" : \"destructive\"}\n            className=\"w-[70px] justify-center text-xs\"\n          >\n            {isActive ? t(\"table.status.active\") : t(\"table.status.inactive\")}\n          </Badge>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"action\",\n    header: () => <div className=\"text-center\">{t(\"table.header.action\")}</div>,\n    cell: ({ row }) => {\n      const exam = row.original;\n      const canDelete = canDeleteSlot(exam);\n\n      return (\n        <div className=\"flex justify-center\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuLabel>\n                {t(\"table.menu.label\")}\n              </DropdownMenuLabel>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => onEdit(exam)}>\n                <Pencil className=\"mr-2 h-4 w-4\" />\n                {t(\"table.menu.edit\")}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onManageParticipants(exam)}>\n                <Users className=\"mr-2 h-4 w-4\" />\n                {t(\"table.menu.manage_participants\")}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onViewRoster(exam)}>\n                <Eye className=\"mr-2 h-4 w-4\" />\n                {t(\"table.menu.view_roster\")}\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              {canDelete ? (\n                <DropdownMenuItem\n                  onClick={() => onDelete(exam)}\n                  className=\"text-destructive focus:text-destructive\"\n                >\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\n                  {t(\"table.menu.delete\")}\n                </DropdownMenuItem>\n              ) : (\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <div className=\"w-full\">\n                        <DropdownMenuItem\n                          disabled\n                          className=\"text-destructive focus:text-destructive opacity-50 pointer-events-none\"\n                        >\n                          <Trash2 className=\"mr-2 h-4 w-4\" />\n                          {t(\"table.menu.delete\")}\n                        </DropdownMenuItem>\n                      </div>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"left\">\n                      <p className=\"text-xs\">\n                        {t(\"table.menu.delete_disabled_tooltip\")}\n                      </p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      );\n    },\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\exam-form-dialog.tsx",
      "relative_path": "components/admin/exams/exam-form-dialog.tsx",
      "filename": "exam-form-dialog.tsx",
      "size_bytes": 40056,
      "lines": 960,
      "last_modified": "2025-11-24T17:00:24.179716",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\nimport { useTranslations } from \"next-intl\";\nimport { CalendarIcon, Check, ChevronsUpDown, AlertCircle } from \"lucide-react\";\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport { formatAsVietnamTime } from \"@/lib/timezone-utils\";\nimport { useCheckSlotHasAttendance } from \"@/hooks/api/useSlots\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\nimport { Slot } from \"@/types\";\nimport { FILTER_PAGE_SIZE } from \"@/lib/constants\";\nimport { useGetSemesters } from \"@/hooks/api/useSemesters\";\nimport { useGetRooms } from \"@/hooks/api/useRooms\";\nimport { useGetSubjects } from \"@/hooks/api/useSubjects\";\n\nconst baseExamFormSchema = z.object({\n  title: z.string().max(255, \"Title must not exceed 255 characters\").optional(),\n  description: z\n    .string()\n    .max(1000, \"Description must not exceed 1000 characters\")\n    .optional(),\n  startDate: z.date({ message: \"Start date is required\" }),\n  startTime: z.string().min(1, \"Start time is required\"),\n  endDate: z.date({ message: \"End date is required\" }),\n  endTime: z.string().min(1, \"End time is required\"),\n  semesterId: z.number({ message: \"Semester is required\" }),\n  roomId: z.number({ message: \"Room is required\" }),\n  staffUserId: z.number({ message: \"Staff is required\" }),\n  isActive: z.boolean().optional(),\n  subjectIds: z\n    .array(z.number())\n    .min(1, \"At least one subject is required\"), // Required for FINAL_EXAM slots\n});\n\ntype ExamFormValues = z.infer<typeof baseExamFormSchema>;\n\ninterface ExamFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  exam?: Slot;\n  onSubmit: (data: ExamFormData) => Promise<void>;\n  isSubmitting?: boolean;\n  semesters?: Array<{ id: number; name: string; code: string }>;\n  rooms?: Array<{ id: number; name: string; location: string | null }>;\n  staff?: Array<{ id: number; fullName: string; username: string }>;\n}\n\nexport interface ExamFormData {\n  title: string | null;\n  description: string | null;\n  startTime: string;\n  endTime: string;\n  semesterId: number;\n  roomId: number;\n  staffUserId: number;\n  isActive?: boolean;\n  subjectIds: number[]; // Required for FINAL_EXAM slots (both create and edit modes)\n}\n\nexport function ExamFormDialog({\n  open,\n  onOpenChange,\n  exam,\n  onSubmit,\n  isSubmitting = false,\n  semesters = [],\n  rooms = [],\n  staff = [],\n}: ExamFormDialogProps) {\n  const t = useTranslations(\"admin.exams.dialog\");\n  const isEditMode = !!exam;\n  const [semesterOpen, setSemesterOpen] = useState(false);\n  const [roomOpen, setRoomOpen] = useState(false);\n  const [staffOpen, setStaffOpen] = useState(false);\n  const [subjectOpen, setSubjectOpen] = useState(false);\n  const [semesterQuery, setSemesterQuery] = useState(\"\");\n  const [roomQuery, setRoomQuery] = useState(\"\");\n  const [subjectQuery, setSubjectQuery] = useState(\"\");\n\n  // Check if exam slot has attendance records (PRESENT or ABSENT only, ignores NOT_YET)\n  const { data: hasAttendanceRecords = false } = useCheckSlotHasAttendance(\n    exam?.id || 0,\n    { enabled: isEditMode && !!exam?.id }\n  );\n\n  // View-only mode when exam slot has attendance records\n  const isViewOnly = isEditMode && hasAttendanceRecords;\n\n  const form = useForm<ExamFormValues>({\n    resolver: zodResolver(baseExamFormSchema),\n    defaultValues: {\n      title: exam?.title || \"\",\n      description: exam?.description || \"\",\n      startDate: exam?.startTime ? new Date(exam.startTime) : undefined,\n      startTime: exam?.startTime\n        ? format(new Date(exam.startTime), \"HH:mm\")\n        : \"\",\n      endDate: exam?.endTime ? new Date(exam.endTime) : undefined,\n      endTime: exam?.endTime ? format(new Date(exam.endTime), \"HH:mm\") : \"\",\n      semesterId: exam?.semester?.id ?? exam?.class?.semester?.id,\n      roomId: exam?.room.id,\n      staffUserId: exam?.staffUser?.id,\n      isActive: exam?.isActive ?? true,\n      subjectIds: exam?.subjects?.map((s) => s.id) || [],\n    },\n  });\n\n  // Remote search for semesters and rooms (only active items)\n  const { data: remoteSemesters } = useGetSemesters({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    search: semesterQuery || undefined,\n    isActive: true,\n  });\n  const { data: remoteRooms } = useGetRooms({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    search: roomQuery || undefined,\n    isActive: true,\n  });\n\n  // Remote search for subjects (filter active subjects only)\n  const { data: remoteSubjects } = useGetSubjects({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    search: subjectQuery || undefined,\n    isActive: true,\n  });\n\n  useEffect(() => {\n    if (!semesterOpen) setSemesterQuery(\"\");\n  }, [semesterOpen]);\n  useEffect(() => {\n    if (!roomOpen) setRoomQuery(\"\");\n  }, [roomOpen]);\n  useEffect(() => {\n    if (!subjectOpen) setSubjectQuery(\"\");\n  }, [subjectOpen]);\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        title: exam?.title || \"\",\n        description: exam?.description || \"\",\n        startDate: exam?.startTime ? new Date(exam.startTime) : undefined,\n        startTime: exam?.startTime\n          ? format(new Date(exam.startTime), \"HH:mm\")\n          : \"\",\n        endDate: exam?.endTime ? new Date(exam.endTime) : undefined,\n        endTime: exam?.endTime ? format(new Date(exam.endTime), \"HH:mm\") : \"\",\n        semesterId: exam?.semester?.id ?? exam?.class?.semester?.id,\n        roomId: exam?.room.id,\n        staffUserId: exam?.staffUser?.id,\n        isActive: exam?.isActive ?? true,\n        subjectIds: exam?.subjects?.map((s) => s.id) || [],\n      });\n    }\n  }, [exam, open, form]);\n\n  // Re-validate exam dates when semester changes\n  const selectedSemesterId = form.watch(\"semesterId\");\n\n  // Merge current item in EDIT mode (in case it's inactive and not in active list)\n  // Note: Slot type doesn't include isActive on nested semester/room, so we include current item if missing\n  const semesterOptions = useMemo(() => {\n    const activeItems = (remoteSemesters?.items || semesters) as Array<{\n      id: number;\n      name: string;\n      code: string;\n      isActive?: boolean;\n    }>;\n    if (isEditMode && exam?.semester) {\n      const currentExists = activeItems.some(s => s.id === exam.semester!.id);\n      if (!currentExists) {\n        // Current semester not in active list - include it (might be inactive)\n        return [{ ...exam.semester, isActive: false }, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteSemesters?.items, semesters, isEditMode, exam]);\n\n  const roomOptions = useMemo(() => {\n    const activeItems = (remoteRooms?.items || rooms) as Array<{\n      id: number;\n      name: string;\n      location: string | null;\n      isActive?: boolean;\n    }>;\n    if (isEditMode && exam?.room) {\n      const currentExists = activeItems.some(r => r.id === exam.room.id);\n      if (!currentExists) {\n        // Current room not in active list - include it (might be inactive)\n        return [{ ...exam.room, isActive: false }, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteRooms?.items, rooms, isEditMode, exam]);\n\n  useEffect(() => {\n    if (open && selectedSemesterId) {\n      const selectedSemester = semesterOptions.find(\n        (s) => s.id === selectedSemesterId\n      );\n\n      if (selectedSemester && (form.formState.isDirty || isEditMode)) {\n        // Trigger validation on date fields\n        form.trigger([\"startDate\", \"endDate\"]);\n      }\n    }\n  }, [selectedSemesterId, form, semesterOptions, open, isEditMode]);\n\n  const handleSubmit = async (values: ExamFormValues) => {\n    form.clearErrors();\n    try {\n      // Combine date and time\n      const startDateTime = new Date(values.startDate);\n      const [startHour, startMinute] = values.startTime.split(\":\");\n      startDateTime.setHours(parseInt(startHour), parseInt(startMinute), 0, 0);\n\n      const endDateTime = new Date(values.endDate);\n      const [endHour, endMinute] = values.endTime.split(\":\");\n      endDateTime.setHours(parseInt(endHour), parseInt(endMinute), 0, 0);\n\n      // CRITICAL: Backend expects timestamps in Vietnam timezone (Asia/Ho_Chi_Minh) without 'Z' suffix\n      // Convert browser's date to Vietnam timezone before formatting\n      // This ensures correct time regardless of user's browser timezone\n      // Example: User anywhere selects 15:20 â†’ converts to Vietnam 15:20 â†’ \"2025-11-03T15:20:00\"\n      const startLocal = formatAsVietnamTime(startDateTime);\n      const endLocal = formatAsVietnamTime(endDateTime);\n\n      await onSubmit({\n        title: values.title || null,\n        description: values.description || null,\n        startTime: startLocal,\n        endTime: endLocal,\n        semesterId: values.semesterId,\n        roomId: values.roomId,\n        staffUserId: values.staffUserId,\n        ...(isEditMode && { isActive: values.isActive }),\n        subjectIds: values.subjectIds, // Send subjects for both create and edit modes\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes\n      switch (errorCode) {\n        case ERROR_CODES.INVALID_TIME_RANGE:\n          form.setError(\"endTime\", {\n            type: \"manual\",\n            message: apiMessage || \"End time must be after start time\",\n          });\n          break;\n        case ERROR_CODES.INVALID_SLOT_DURATION:\n          form.setError(\"endTime\", {\n            type: \"manual\",\n            message:\n              apiMessage ||\n              \"Exam duration must be between 30 minutes and 4 hours\",\n          });\n          break;\n        case ERROR_CODES.ROOM_TIME_CONFLICT:\n          form.setError(\"roomId\", {\n            type: \"manual\",\n            message: apiMessage || \"Room is already booked for this time\",\n          });\n          break;\n        case ERROR_CODES.STAFF_TIME_CONFLICT:\n          form.setError(\"staffUserId\", {\n            type: \"manual\",\n            message: apiMessage || \"Staff is already assigned at this time\",\n          });\n          break;\n        case ERROR_CODES.EXAM_SLOT_SUBJECT_HAS_PARTICIPANTS:\n          form.setError(\"subjectIds\", {\n            type: \"manual\",\n            message:\n              apiMessage ||\n              \"Cannot remove subject. This subject has existing participants. Please remove the participants first before removing the subject.\",\n          });\n          break;\n        case ERROR_CODES.SLOT_HAS_DEPENDENCIES:\n          form.setError(\"isActive\", {\n            type: \"manual\",\n            message:\n              apiMessage ||\n              \"Cannot deactivate slot. It has participants or attendance records. Please remove these dependencies first.\",\n          });\n          break;\n        case ERROR_CODES.SLOT_OUTSIDE_SEMESTER_RANGE:\n          form.setError(\"startDate\", {\n            type: \"manual\",\n            message:\n              apiMessage || \"Exam time must be within semester date range\",\n          });\n          break;\n        default:\n          break;\n      }\n    }\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col gap-0 p-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full max-h-[90vh] overflow-hidden min-h-0\"\n          >\n            <DialogHeader className=\"px-6 pt-6 pb-2 shrink-0\">\n              <DialogTitle>\n                {isViewOnly ? t(\"view_title\") : isEditMode ? t(\"edit_title\") : t(\"create_title\")}\n              </DialogTitle>\n              <DialogDescription>\n                {isViewOnly\n                  ? t(\"view_description\")\n                  : isEditMode\n                  ? t(\"edit_description\")\n                  : t(\"create_description\")}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"grid gap-4 py-4 px-6 overflow-y-auto flex-1 min-h-0\">\n              {/* Warning Alert for View-Only Mode */}\n              {isViewOnly && (\n                <Alert variant=\"destructive\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertTitle>{t(\"view_only_alert.title\")}</AlertTitle>\n                  <AlertDescription>\n                    {t(\"view_only_alert.description\")}\n                  </AlertDescription>\n                </Alert>\n              )}\n              {/* Title */}\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"form.title\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t(\"form.title_placeholder\")}\n                        {...field}\n                        maxLength={255}\n                        autoComplete=\"off\"\n                        disabled={isViewOnly}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Description */}\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"form.description\")}</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder={t(\"form.description_placeholder\")}\n                        {...field}\n                        maxLength={1000}\n                        rows={3}\n                        disabled={isViewOnly}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Semester */}\n              <FormField\n                control={form.control}\n                name=\"semesterId\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col\">\n                    <FormLabel>\n                      {t(\"form.semester\")} <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <Popover open={semesterOpen} onOpenChange={setSemesterOpen}>\n                      <PopoverTrigger asChild>\n                        <FormControl>\n                          <Button\n                            variant=\"outline\"\n                              disabled={isViewOnly}\n                            role=\"combobox\"\n                            className={cn(\n                              \"justify-between w-full truncate\",\n                              !field.value && \"text-muted-foreground\"\n                            )}\n                          >\n                            {field.value\n                              ? semesterOptions.find((s) => s.id === field.value)\n                                  ?.name\n                              : t(\"form.select_semester\")}\n                            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </FormControl>\n                      </PopoverTrigger>\n                      <PopoverContent\n                        className=\"p-0 w-[min(400px,calc(100vw-2rem))] sm:w-[400px]\"\n                        align=\"start\"\n                      >\n                        <Command>\n                          <CommandInput\n                            placeholder={t(\"form.search_semester\")}\n                            value={semesterQuery}\n                            onValueChange={setSemesterQuery}\n                          />\n                          <CommandList className=\"max-h-60 overflow-y-auto\">\n                            <CommandEmpty>{t(\"form.no_semester\")}</CommandEmpty>\n                            <CommandGroup>\n                              {semesterOptions.map(\n                                (semester) => (\n                                  <CommandItem\n                                    key={semester.id}\n                                    value={semester.name}\n                                    onSelect={() => {\n                                      form.setValue(\"semesterId\", semester.id);\n                                      setSemesterOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        semester.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    <div className=\"flex-1\">\n                                      <div className=\"flex items-center gap-2\">\n                                        {semester.name}\n                                        {semester.isActive === false && (\n                                          <span className=\"text-xs text-muted-foreground\">\n                                            {t(\"form.inactive_label\")}\n                                          </span>\n                                        )}\n                                      </div>\n                                      <div className=\"text-xs text-muted-foreground\">\n                                        {semester.code}\n                                      </div>\n                                    </div>\n                                  </CommandItem>\n                                )\n                              )}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Room */}\n              <FormField\n                control={form.control}\n                name=\"roomId\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col\">\n                    <FormLabel>\n                      {t(\"form.room\")} <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <Popover open={roomOpen} onOpenChange={setRoomOpen}>\n                      <PopoverTrigger asChild>\n                        <FormControl>\n                          <Button\n                            variant=\"outline\"\n                              disabled={isViewOnly}\n                            role=\"combobox\"\n                            className={cn(\n                              \"justify-between w-full truncate\",\n                              !field.value && \"text-muted-foreground\"\n                            )}\n                          >\n                            {field.value\n                              ? roomOptions.find((r) => r.id === field.value)?.name\n                              : t(\"form.select_room\")}\n                            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </FormControl>\n                      </PopoverTrigger>\n                      <PopoverContent\n                        className=\"p-0 w-[min(400px,calc(100vw-2rem))] sm:w-[400px]\"\n                        align=\"start\"\n                      >\n                        <Command>\n                          <CommandInput\n                            placeholder={t(\"form.search_room\")}\n                            value={roomQuery}\n                            onValueChange={setRoomQuery}\n                          />\n                          <CommandList className=\"max-h-60 overflow-y-auto\">\n                            <CommandEmpty>{t(\"form.no_room\")}</CommandEmpty>\n                            <CommandGroup>\n                              {roomOptions.map((room) => (\n                                <CommandItem\n                                  key={room.id}\n                                  value={room.name}\n                                  onSelect={() => {\n                                    form.setValue(\"roomId\", room.id);\n                                    setRoomOpen(false);\n                                  }}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      room.id === field.value\n                                        ? \"opacity-100\"\n                                        : \"opacity-0\"\n                                    )}\n                                  />\n                                  <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2\">\n                                      {room.name}\n                                      {room.isActive === false && (\n                                        <span className=\"text-xs text-muted-foreground\">\n                                          {t(\"form.inactive_label\")}\n                                        </span>\n                                      )}\n                                    </div>\n                                    {room.location && (\n                                      <div className=\"text-xs text-muted-foreground\">\n                                        {room.location}\n                                      </div>\n                                    )}\n                                  </div>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Staff */}\n              <FormField\n                control={form.control}\n                name=\"staffUserId\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col\">\n                    <FormLabel>\n                      {t(\"form.staff\")} <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <Popover open={staffOpen} onOpenChange={setStaffOpen}>\n                      <PopoverTrigger asChild>\n                        <FormControl>\n                          <Button\n                            variant=\"outline\"\n                              disabled={isViewOnly}\n                            role=\"combobox\"\n                            className={cn(\n                              \"justify-between w-full truncate\",\n                              !field.value && \"text-muted-foreground\"\n                            )}\n                          >\n                            {field.value\n                              ? staff.find((s) => s.id === field.value)\n                                  ?.fullName\n                              : t(\"form.select_staff\")}\n                            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </FormControl>\n                      </PopoverTrigger>\n                      <PopoverContent\n                        className=\"p-0 w-[min(400px,calc(100vw-2rem))] sm:w-[400px]\"\n                        align=\"start\"\n                      >\n                        <Command>\n                          <CommandInput placeholder={t(\"form.search_staff\")} />\n                          <CommandList className=\"max-h-60 overflow-y-auto\">\n                            <CommandEmpty>{t(\"form.no_staff\")}</CommandEmpty>\n                            <CommandGroup>\n                              {staff.map((s) => (\n                                <CommandItem\n                                  key={s.id}\n                                  value={s.fullName}\n                                  onSelect={() => {\n                                    form.setValue(\"staffUserId\", s.id);\n                                    setStaffOpen(false);\n                                  }}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      s.id === field.value\n                                        ? \"opacity-100\"\n                                        : \"opacity-0\"\n                                    )}\n                                  />\n                                  <div>\n                                    <div>{s.fullName}</div>\n                                    <div className=\"text-xs text-muted-foreground\">\n                                      @{s.username}\n                                    </div>\n                                  </div>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Subjects (Both create and edit modes) */}\n              <FormField\n                control={form.control}\n                name=\"subjectIds\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col\">\n                    <FormLabel>\n                      {t(\"form.subjects\")} <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <Popover open={subjectOpen} onOpenChange={setSubjectOpen}>\n                      <PopoverTrigger asChild>\n                        <FormControl>\n                          <Button\n                            variant=\"outline\"\n                              disabled={isViewOnly}\n                            role=\"combobox\"\n                            className={cn(\n                              \"justify-between w-full\",\n                              (!field.value || field.value.length === 0) &&\n                                \"text-muted-foreground\"\n                            )}\n                          >\n                            {field.value && field.value.length > 0\n                              ? t(\"form.subjects_selected\", { count: field.value.length })\n                              : t(\"form.select_subjects\")}\n                            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </FormControl>\n                      </PopoverTrigger>\n                      <PopoverContent\n                        className=\"p-0 w-[min(400px,calc(100vw-2rem))] sm:w-[400px]\"\n                        align=\"start\"\n                      >\n                        <Command>\n                          <CommandInput\n                            placeholder={t(\"form.search_subjects\")}\n                            value={subjectQuery}\n                            onValueChange={setSubjectQuery}\n                          />\n                          <CommandList className=\"max-h-60 overflow-y-auto\">\n                            <CommandEmpty>{t(\"form.no_subjects\")}</CommandEmpty>\n                            <CommandGroup>\n                              {remoteSubjects?.items.map((subject) => (\n                                <CommandItem\n                                  key={subject.id}\n                                  value={subject.name}\n                                  onSelect={() => {\n                                    const currentValues = field.value || [];\n                                    const isSelected = currentValues.includes(\n                                      subject.id\n                                    );\n\n                                    if (isSelected) {\n                                      form.setValue(\n                                        \"subjectIds\",\n                                        currentValues.filter(\n                                          (id) => id !== subject.id\n                                        )\n                                      );\n                                    } else {\n                                      form.setValue(\"subjectIds\", [\n                                        ...currentValues,\n                                        subject.id,\n                                      ]);\n                                    }\n                                  }}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      field.value?.includes(subject.id)\n                                        ? \"opacity-100\"\n                                        : \"opacity-0\"\n                                    )}\n                                  />\n                                  <div>\n                                    <div>{subject.name}</div>\n                                    <div className=\"text-xs text-muted-foreground\">\n                                      {subject.code}\n                                    </div>\n                                  </div>\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    <FormDescription>\n                      {isEditMode\n                        ? t(\"form.subjects_description_edit\")\n                        : t(\"form.subjects_description_create\")}\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Row: Start Date + Start Time (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"startDate\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"form.start_date\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-start text-left font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                              {field.value ? (\n                                format(field.value, \"PPP\")\n                              ) : (\n                                <span>{t(\"form.pick_date\")}</span>\n                              )}\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={field.value}\n                            onSelect={field.onChange}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"startTime\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"form.start_time\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"time\"\n                          {...field}\n                          className=\"h-10\"\n                          autoComplete=\"off\"\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Row: End Date + End Time (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"endDate\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"form.end_date\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-start text-left font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                              {field.value ? (\n                                format(field.value, \"PPP\")\n                              ) : (\n                                <span>{t(\"form.pick_date\")}</span>\n                              )}\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={field.value}\n                            onSelect={field.onChange}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"endTime\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"form.end_time\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"time\"\n                          {...field}\n                          className=\"h-10\"\n                          autoComplete=\"off\"\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Active Status (edit only) */}\n              {isEditMode && (\n                <FormField\n                  control={form.control}\n                  name=\"isActive\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                      <div className=\"space-y-0.5 flex-1\">\n                        <FormLabel className=\"text-base\">\n                          {t(\"form.active_status\")}\n                        </FormLabel>\n                        <FormDescription className=\"text-sm\">\n                          {field.value\n                            ? t(\"form.active_description\")\n                            : t(\"form.inactive_description\")}\n                        </FormDescription>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              )}\n\n            </div>\n\n            <div className=\"flex gap-2 justify-end px-6 pb-6 pt-4 border-t mt-4 shrink-0 bg-background\">\n              {isViewOnly ? (\n                <Button\n                  type=\"button\"\n                  onClick={() => handleOpenChange(false)}\n                >\n                  {t(\"button.close\")}\n                </Button>\n              ) : (\n                <>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => handleOpenChange(false)}\n                    disabled={isSubmitting}\n                  >\n                    {t(\"button.cancel\")}\n                  </Button>\n                  <Button type=\"submit\" disabled={isSubmitting}>\n                    {isSubmitting ? t(\"button.saving\") : isEditMode ? t(\"button.update\") : t(\"button.create\")}\n                  </Button>\n                </>\n              )}\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\exam-pagination.tsx",
      "relative_path": "components/admin/exams/exam-pagination.tsx",
      "filename": "exam-pagination.tsx",
      "size_bytes": 2976,
      "lines": 111,
      "last_modified": "2025-11-01T15:38:43.294667",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface ExamPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function ExamPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: ExamPaginationProps) {\n  const getPageNumbers = () => {\n    const pages: (number | string)[] = [];\n    const maxVisible = 5;\n\n    if (totalPages <= maxVisible) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 3) {\n        for (let i = 1; i <= 4; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 2) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 3; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() => onPageChange(currentPage - 1)}\n            aria-disabled={disabled || currentPage === 1}\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {getPageNumbers().map((page, index) => (\n          <PaginationItem key={index}>\n            {page === \"ellipsis\" ? (\n              <PaginationEllipsis />\n            ) : (\n              <PaginationLink\n                onClick={() => onPageChange(page as number)}\n                isActive={currentPage === page}\n                aria-disabled={disabled}\n                className={\n                  disabled\n                    ? \"pointer-events-none opacity-50\"\n                    : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            )}\n          </PaginationItem>\n        ))}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() => onPageChange(currentPage + 1)}\n            aria-disabled={disabled || currentPage === totalPages}\n            className={\n              disabled || currentPage === totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\exam-participants-table.tsx",
      "relative_path": "components/admin/exams/exam-participants-table.tsx",
      "filename": "exam-participants-table.tsx",
      "size_bytes": 8131,
      "lines": 248,
      "last_modified": "2025-11-24T14:33:16.461296",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from \"next-intl\";\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { MoreHorizontal, UserMinus, UserPlus, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { ExamParticipant } from \"@/types\";\nimport { format } from \"date-fns\";\nimport {\n  flexRender,\n  getCoreRowModel,\n  useReactTable,\n} from \"@tanstack/react-table\";\n\ninterface ExamParticipantsTableProps {\n  participants: ExamParticipant[];\n  isLoading?: boolean;\n  onWithdraw: (participant: ExamParticipant) => void;\n  onReEnroll: (participant: ExamParticipant) => void;\n  onRemove: (participant: ExamParticipant) => void;\n  canModifyParticipants?: boolean;\n}\n\nexport function ExamParticipantsTable({\n  participants,\n  onWithdraw,\n  onReEnroll,\n  onRemove,\n  canModifyParticipants = true,\n}: ExamParticipantsTableProps) {\n  const t = useTranslations(\"admin.exams.participants.table\");\n  const columns: ColumnDef<ExamParticipant>[] = [\n    {\n      accessorKey: \"fullName\",\n      header: () => <div className=\"text-center\">{t(\"header.full_name\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center font-medium\">{row.getValue(\"fullName\")}</div>\n      ),\n    },\n    {\n      accessorKey: \"rollNumber\",\n      header: () => <div className=\"text-center\">{t(\"header.roll_number\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center text-sm\">\n          {row.getValue(\"rollNumber\") || \"N/A\"}\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"email\",\n      header: () => <div className=\"text-center\">{t(\"header.email\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center text-sm text-muted-foreground\">\n          {row.getValue(\"email\")}\n        </div>\n      ),\n    },\n    {\n      id: \"subject\",\n      header: () => <div className=\"text-center\">{t(\"header.subject\")}</div>,\n      cell: ({ row }) => {\n        const { subjectName, subjectCode } = row.original;\n        return (\n          <div className=\"flex justify-center\">\n            <Badge\n              variant=\"outline\"\n              className=\"cursor-help\"\n              title={subjectName}\n            >\n              {subjectCode}\n            </Badge>\n          </div>\n        );\n      },\n    },\n    {\n      accessorKey: \"isEnrolled\",\n      header: () => <div className=\"text-center\">{t(\"header.status\")}</div>,\n      cell: ({ row }) => {\n        const isEnrolled = row.getValue(\"isEnrolled\") as boolean;\n        return (\n          <div className=\"flex justify-center\">\n            <Badge\n              variant={isEnrolled ? \"default\" : \"secondary\"}\n              className=\"text-xs\"\n            >\n              {isEnrolled ? t(\"status.enrolled\") : t(\"status.withdrawn\")}\n            </Badge>\n          </div>\n        );\n      },\n    },\n    {\n      id: \"enrolledAt\",\n      header: () => <div className=\"text-center\">{t(\"header.enrolled_at\")}</div>,\n      cell: ({ row }) => {\n        const enrolledAt = row.original.enrolledAt;\n        return (\n          <div className=\"text-center text-sm text-muted-foreground\">\n            {format(new Date(enrolledAt), \"MMM d, yyyy\")}\n          </div>\n        );\n      },\n    },\n    {\n      id: \"action\",\n      header: () => <div className=\"text-center\">{t(\"header.action\")}</div>,\n      cell: ({ row }) => {\n        const participant = row.original;\n        return (\n          <div className=\"flex justify-center\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuLabel>\n                  {participant.rollNumber} {t(\"actions_label\")}\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                {participant.isEnrolled ? (\n                  <DropdownMenuItem\n                    onClick={() => onWithdraw(participant)}\n                    disabled={!canModifyParticipants}\n                  >\n                    <UserMinus className=\"mr-2 h-4 w-4\" />\n                    {t(\"action.withdraw\")}\n                  </DropdownMenuItem>\n                ) : (\n                  <DropdownMenuItem\n                    onClick={() => onReEnroll(participant)}\n                    disabled={!canModifyParticipants}\n                  >\n                    <UserPlus className=\"mr-2 h-4 w-4\" />\n                    {t(\"action.reenroll\")}\n                  </DropdownMenuItem>\n                )}\n                <DropdownMenuSeparator />\n                <DropdownMenuItem\n                  onClick={() => onRemove(participant)}\n                  disabled={!canModifyParticipants}\n                  className=\"text-destructive focus:text-destructive\"\n                >\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\n                  {t(\"action.remove\")}\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        );\n      },\n    },\n  ];\n\n  const table = useReactTable({\n    data: participants,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n  });\n\n  const fixedRowCount = 10;\n\n  return (\n    <div className=\"rounded-md border bg-background overflow-x-auto\">\n      <Table className=\"min-w-[900px]\">\n        <TableHeader>\n          {table.getHeaderGroups().map((headerGroup) => (\n            <TableRow key={headerGroup.id}>\n              {headerGroup.headers.map((header) => (\n                <TableHead key={header.id} className=\"whitespace-nowrap\">\n                  {header.isPlaceholder\n                    ? null\n                    : flexRender(\n                        header.column.columnDef.header,\n                        header.getContext()\n                      )}\n                </TableHead>\n              ))}\n            </TableRow>\n          ))}\n        </TableHeader>\n        <TableBody>\n          {participants.length > 0 ? (\n            <>\n              {table.getRowModel().rows.map((row) => (\n                <TableRow key={row.id}>\n                  {row.getVisibleCells().map((cell) => (\n                    <TableCell\n                      key={cell.id}\n                      className=\"h-[52px] whitespace-nowrap\"\n                    >\n                      {flexRender(\n                        cell.column.columnDef.cell,\n                        cell.getContext()\n                      )}\n                    </TableCell>\n                  ))}\n                </TableRow>\n              ))}\n              {Array.from({\n                length: Math.max(0, fixedRowCount - participants.length),\n              }).map((_, index) => (\n                <TableRow key={`empty-${index}`}>\n                  <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                </TableRow>\n              ))}\n            </>\n          ) : (\n            <>\n              <TableRow>\n                <TableCell\n                  colSpan={columns.length}\n                  className=\"h-[52px] text-center\"\n                >\n                  {t(\"empty\")}\n                </TableCell>\n              </TableRow>\n              {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                <TableRow key={`empty-${index}`}>\n                  <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                </TableRow>\n              ))}\n            </>\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\exams\\exam-table.tsx",
      "relative_path": "components/admin/exams/exam-table.tsx",
      "filename": "exam-table.tsx",
      "size_bytes": 4706,
      "lines": 155,
      "last_modified": "2025-11-24T16:55:26.375155",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Slot } from \"@/types\";\nimport { ExamPagination } from \"./exam-pagination\";\n\ninterface ExamTableProps {\n  columns: ColumnDef<Slot>[];\n  data: Slot[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function ExamTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: ExamTableProps) {\n  const t = useTranslations(\"admin.exams\");\n  const [sorting, setSorting] = useState<SortingState>([]);\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[1000px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t(\"table.empty.no_exams\")}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t(\"table.pagination.showing\", {\n              from: (currentPage - 1) * pageSize + 1,\n              to: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t(\"table.pagination.no_items\")\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <ExamPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\export\\admin-export-dialog.tsx",
      "relative_path": "components/admin/export/admin-export-dialog.tsx",
      "filename": "admin-export-dialog.tsx",
      "size_bytes": 16755,
      "lines": 434,
      "last_modified": "2025-11-24T11:18:27.763723",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, Download, Calendar, BookOpen } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format } from \"date-fns\";\nimport { parseVietnamTime, getVietnamNow } from \"@/lib/timezone-utils\";\nimport { useGetSlots } from \"@/hooks/api/useSlots\";\nimport { useGetSemesters } from \"@/hooks/api/useSemesters\";\nimport { useGetClasses } from \"@/hooks/api/useClasses\";\nimport { useExport, ExportFormat } from \"@/hooks/api/useExport\";\n\ninterface AdminExportDialogProps {\n  type: \"exam-slots\" | \"class-slots\" | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function AdminExportDialog({\n  type,\n  open,\n  onOpenChange,\n}: AdminExportDialogProps) {\n  const t = useTranslations(\"export\");\n  const [selectedSemester, setSelectedSemester] = useState<number | undefined>();\n  const [selectedItems, setSelectedItems] = useState<number[]>([]);\n  const [exportFormat, setExportFormat] = useState<ExportFormat>(\"excel\");\n  const [exportAll, setExportAll] = useState(false);\n\n  const { isExporting, exportClasses, exportSlots } = useExport();\n\n  // Fetch semesters\n  const { data: semestersData, isLoading: semestersLoading } = useGetSemesters({\n    pageSize: 100,\n  });\n  const semesters = useMemo(\n    () => semestersData?.items || [],\n    [semestersData]\n  );\n\n  // Auto-select current semester\n  useEffect(() => {\n    if (open && semesters.length > 0 && !selectedSemester) {\n      const now = getVietnamNow();\n      const current = semesters.find((s) => {\n        if (!s.startDate || !s.endDate) return false;\n        const start = parseVietnamTime(s.startDate + \"T00:00:00\");\n        const end = parseVietnamTime(s.endDate + \"T23:59:59\");\n        return now >= start && now <= end;\n      });\n      if (current) setSelectedSemester(current.id);\n    }\n  }, [open, semesters, selectedSemester]);\n\n  // Reset when semester changes or dialog closes\n  useEffect(() => {\n    setSelectedItems([]);\n    setExportAll(false);\n  }, [selectedSemester]);\n\n  useEffect(() => {\n    if (!open) {\n      setSelectedItems([]);\n      setExportAll(false);\n    }\n  }, [open]);\n\n  // Fetch data based on type\n  const isExamSlots = type === \"exam-slots\";\n\n  // Fetch slots for exam-slots type\n  const { data: slotsResponse, isLoading: slotsLoading } = useGetSlots({\n    slotCategories: [\"FINAL_EXAM\"],\n    semesterId: selectedSemester,\n    isActive: true,\n    page: 1,\n    pageSize: 200,\n  });\n  const slots = slotsResponse?.items || [];\n\n  // Fetch classes for class-slots type\n  const { data: classesResponse, isLoading: classesLoading } = useGetClasses({\n    semesterId: selectedSemester,\n    page: 1,\n    pageSize: 200,\n  });\n  const classes = classesResponse?.items || [];\n\n  // Choose items based on type\n  const items = isExamSlots ? slots : classes;\n  const itemsLoading = isExamSlots ? slotsLoading : classesLoading;\n\n  // Handle checkbox toggle\n  const handleToggleItem = (itemId: number) => {\n    if (exportAll) return;\n    setSelectedItems((prev) =>\n      prev.includes(itemId)\n        ? prev.filter((id) => id !== itemId)\n        : [...prev, itemId]\n    );\n  };\n\n  // Handle select all\n  const handleSelectAll = () => {\n    if (exportAll) return;\n    if (selectedItems.length === items.length) {\n      setSelectedItems([]);\n    } else {\n      setSelectedItems(items.map((item) => item.id));\n    }\n  };\n\n  // Handle export\n  const handleExport = async () => {\n    if (!selectedSemester) {\n      toast.error(t(\"error_no_semester\"));\n      return;\n    }\n\n    if (!exportAll && selectedItems.length === 0) {\n      toast.error(t(\"error_no_selection\"));\n      return;\n    }\n\n    try {\n      if (isExamSlots) {\n        await exportSlots(exportFormat, {\n          semesterId: selectedSemester,\n          ids: exportAll ? undefined : selectedItems,\n          exportAll,\n        });\n      } else {\n        await exportClasses(exportFormat, {\n          semesterId: selectedSemester,\n          ids: exportAll ? undefined : selectedItems,\n          exportAll,\n        });\n      }\n\n      toast.success(t(\"success_export\", { count: exportAll ? items.length : selectedItems.length }));\n      onOpenChange(false);\n      setSelectedItems([]);\n      setExportAll(false);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Export failed\";\n      toast.error(t(\"error_export_failed\", { message: errorMessage }));\n    }\n  };\n\n  const title = isExamSlots ? t(\"dialog_title_exam\") : t(\"dialog_title_class\");\n  const Icon = isExamSlots ? Calendar : BookOpen;\n  const canExport = selectedSemester && (exportAll || selectedItems.length > 0);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"p-6 pb-4\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Icon className=\"h-5 w-5\" />\n            {title}\n          </DialogTitle>\n          <DialogDescription>{t(\"dialog_description\")}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-y-auto px-6 space-y-4\">\n          {/* Semester & Format Select - Same Row */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>{t(\"semester\")}</Label>\n              <Select\n                value={selectedSemester?.toString()}\n                onValueChange={(value) => setSelectedSemester(parseInt(value))}\n                disabled={semestersLoading}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"select_semester\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  {semesters.map((semester) => (\n                    <SelectItem\n                      key={semester.id}\n                      value={semester.id.toString()}\n                    >\n                      {semester.name} ({semester.code})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>{t(\"format\")}</Label>\n              <Select\n                value={exportFormat}\n                onValueChange={(v) => setExportFormat(v as ExportFormat)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"excel\">Excel (.xlsx)</SelectItem>\n                  <SelectItem value=\"csv\">CSV (.zip)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Export All Checkbox */}\n          {selectedSemester && (\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox\n                id=\"exportAll\"\n                checked={exportAll}\n                onCheckedChange={(checked) => {\n                  setExportAll(checked === true);\n                  if (checked) setSelectedItems([]);\n                }}\n              />\n              <Label htmlFor=\"exportAll\" className=\"cursor-pointer\">\n                {t(\"export_all_semester\")} ({items.length} {isExamSlots ? t(\"slots\") : t(\"classes\")})\n              </Label>\n            </div>\n          )}\n\n          {/* Items List */}\n          {selectedSemester && !exportAll && (\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <Label>\n                  {isExamSlots\n                    ? t(\"slots_available\", { count: items.length })\n                    : t(\"classes_available\", { count: items.length })}\n                </Label>\n                <div className=\"flex items-center gap-4\">\n                  <span className=\"text-sm text-muted-foreground\">\n                    {t(\"selected_count\", { count: selectedItems.length })}\n                  </span>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleSelectAll}\n                    disabled={items.length === 0}\n                  >\n                    {selectedItems.length === items.length\n                      ? t(\"deselect_all\")\n                      : t(\"select_all\")}\n                  </Button>\n                </div>\n              </div>\n\n              {itemsLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\n                </div>\n              ) : items.length === 0 ? (\n                <Card>\n                  <CardHeader className=\"py-8 text-center text-muted-foreground\">\n                    {isExamSlots ? t(\"no_slots_found\") : t(\"no_classes_found\")}\n                  </CardHeader>\n                </Card>\n              ) : (\n                <div className=\"grid grid-cols-1 gap-2 overflow-y-auto p-1 max-h-[calc(90vh-350px)]\">\n                  {isExamSlots\n                    ? slots.map((slot) => (\n                        <Card\n                          key={slot.id}\n                          className={`cursor-pointer transition-colors ${\n                            selectedItems.includes(slot.id)\n                              ? \"border-primary bg-primary/5\"\n                              : \"hover:border-primary/50\"\n                          }`}\n                          onClick={() => handleToggleItem(slot.id)}\n                        >\n                          <CardHeader className=\"p-3\">\n                            <div className=\"flex items-center space-x-3\">\n                              <Checkbox\n                                checked={selectedItems.includes(slot.id)}\n                                onCheckedChange={() => handleToggleItem(slot.id)}\n                                onClick={(e) => e.stopPropagation()}\n                              />\n                              <div className=\"flex-1 min-w-0\">\n                                <CardTitle className=\"text-sm font-semibold truncate\">\n                                  {slot.title || \"Exam Slot\"}\n                                </CardTitle>\n                                <div className=\"text-xs text-muted-foreground mt-1 space-y-0.5\">\n                                  <div>\n                                    {format(\n                                      parseVietnamTime(slot.startTime),\n                                      \"dd/MM/yyyy HH:mm\"\n                                    )}\n                                    {slot.totalStudent !== undefined && (\n                                      <span className=\"ml-2\">\n                                        - {slot.totalStudent} {t(\"students\")}\n                                      </span>\n                                    )}\n                                  </div>\n                                  {slot.subjects && slot.subjects.length > 0 && (\n                                    <div className=\"flex flex-wrap gap-1\">\n                                      {slot.subjects.map((subject) => (\n                                        <Badge\n                                          key={subject.id}\n                                          variant=\"secondary\"\n                                          className=\"text-xs px-1.5 py-0\"\n                                        >\n                                          {subject.code}\n                                        </Badge>\n                                      ))}\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                              <Badge variant=\"outline\">{slot.slotCategory}</Badge>\n                            </div>\n                          </CardHeader>\n                        </Card>\n                      ))\n                    : classes.map((cls) => (\n                        <Card\n                          key={cls.id}\n                          className={`cursor-pointer transition-colors ${\n                            selectedItems.includes(cls.id)\n                              ? \"border-primary bg-primary/5\"\n                              : \"hover:border-primary/50\"\n                          }`}\n                          onClick={() => handleToggleItem(cls.id)}\n                        >\n                          <CardHeader className=\"p-3\">\n                            <div className=\"flex items-center space-x-3\">\n                              <Checkbox\n                                checked={selectedItems.includes(cls.id)}\n                                onCheckedChange={() => handleToggleItem(cls.id)}\n                                onClick={(e) => e.stopPropagation()}\n                              />\n                              <div className=\"flex-1 min-w-0\">\n                                <CardTitle className=\"text-sm font-semibold truncate\">\n                                  {cls.code}\n                                </CardTitle>\n                                <div className=\"text-xs text-muted-foreground mt-1\">\n                                  {cls.subject?.name || cls.subject?.code || \"N/A\"}\n                                </div>\n                              </div>\n                              <Badge variant=\"outline\">\n                                {cls.totalStudent || 0} {t(\"students\")}\n                              </Badge>\n                            </div>\n                          </CardHeader>\n                        </Card>\n                      ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Export Info for Export All */}\n          {selectedSemester && exportAll && (\n            <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-md dark:bg-blue-950 dark:border-blue-800\">\n              <span className=\"text-sm text-blue-800 dark:text-blue-200\">\n                {t(\"export_all_info\", {\n                  count: items.length,\n                  type: isExamSlots ? t(\"exam_slots\") : t(\"classes\"),\n                })}\n              </span>\n            </div>\n          )}\n\n          {/* Exporting Progress */}\n          {isExporting && (\n            <div className=\"p-3 bg-green-50 border border-green-200 rounded-md dark:bg-green-950 dark:border-green-800\">\n              <div className=\"flex items-center space-x-2\">\n                <Loader2 className=\"h-4 w-4 animate-spin text-green-600 dark:text-green-400\" />\n                <span className=\"text-sm text-green-800 dark:text-green-200\">\n                  {t(\"generating_file\")}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"p-6 pt-4 border-t\">\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isExporting}\n          >\n            {t(\"cancel\")}\n          </Button>\n          <Button\n            onClick={handleExport}\n            disabled={!canExport || isExporting}\n            className=\"bg-green-600 hover:bg-green-700 text-white\"\n          >\n            {isExporting ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                {t(\"exporting\")}\n              </>\n            ) : (\n              <>\n                <Download className=\"mr-2 h-4 w-4\" />\n                {t(\"export_button\")}{\" \"}\n                {exportAll\n                  ? `(${t(\"all\")})`\n                  : selectedItems.length > 0\n                  ? `(${selectedItems.length})`\n                  : \"\"}\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\majors\\delete-major-dialog.tsx",
      "relative_path": "components/admin/majors/delete-major-dialog.tsx",
      "filename": "delete-major-dialog.tsx",
      "size_bytes": 1975,
      "lines": 68,
      "last_modified": "2025-11-11T10:48:14.522487",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from 'next-intl';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Major } from \"@/types\";\n\ninterface DeleteMajorDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  major: Major | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteMajorDialog({\n  open,\n  onOpenChange,\n  major,\n  onConfirm,\n  isDeleting = false,\n}: DeleteMajorDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!major) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {t('major_name', { name: major.name, code: major.code })}\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>{t('button_cancel')}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\majors\\major-columns.tsx",
      "relative_path": "components/admin/majors/major-columns.tsx",
      "filename": "major-columns.tsx",
      "size_bytes": 3736,
      "lines": 138,
      "last_modified": "2025-11-21T19:17:03.188881",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { List, Pencil, MoreHorizontal } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Major } from \"@/types\";\n\n// Header components\nfunction CodeHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_code')}</div>;\n}\n\nfunction NameHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_name')}</div>;\n}\n\nfunction SubjectsHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_subjects')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nfunction ActionCell({\n  major,\n  onEdit,\n  onViewSubjects,\n}: {\n  major: Major;\n  onEdit: (major: Major) => void;\n  onViewSubjects: (major: Major) => void;\n}) {\n  const t = useTranslations('major');\n  return (\n    <div className=\"flex justify-center\">\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\">\n          <DropdownMenuLabel>\n            {t('menu_label', { code: major.code })}\n          </DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem onClick={() => onEdit(major)}>\n            <Pencil className=\"mr-2 h-4 w-4\" />\n            {t('edit_menu')}\n          </DropdownMenuItem>\n          <DropdownMenuItem onClick={() => onViewSubjects(major)}>\n            <List className=\"mr-2 h-4 w-4\" />\n            {t('view_subjects_menu')}\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n\nexport const createMajorColumns = (\n  onEdit: (major: Major) => void,\n  onViewSubjects: (major: Major) => void\n): ColumnDef<Major>[] => {\n  return [\n  {\n    accessorKey: \"code\",\n    header: CodeHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"code\")}</div>\n    ),\n  },\n  {\n    accessorKey: \"name\",\n    header: NameHeader,\n    cell: ({ row }) => <div className=\"text-center\">{row.getValue(\"name\")}</div>,\n  },\n  {\n    accessorKey: \"totalSubject\",\n    header: SubjectsHeader,\n    cell: ({ row }) => (\n      <div className=\"text-center text-muted-foreground\">\n        {row.getValue(\"totalSubject\")}\n      </div>\n    ),\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => <StatusCell isActive={row.getValue(\"isActive\")} />,\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        major={row.original}\n        onEdit={onEdit}\n        onViewSubjects={onViewSubjects}\n      />\n    ),\n  },\n];\n};\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\majors\\major-form-dialog.tsx",
      "relative_path": "components/admin/majors/major-form-dialog.tsx",
      "filename": "major-form-dialog.tsx",
      "size_bytes": 12389,
      "lines": 377,
      "last_modified": "2025-11-21T19:17:03.189890",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Major } from \"@/types\";\n\ntype MajorFormValues = {\n  name: string;\n  code: string;\n  isActive?: boolean;\n};\n\ninterface MajorFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  major?: Major;\n  isLoadingMajor?: boolean;\n  onSubmit: (data: MajorFormData) => Promise<void>;\n  onDelete?: (major: Major) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n}\n\nexport interface MajorFormData {\n  name: string;\n  code: string;\n  isActive?: boolean;\n}\n\nexport function MajorFormDialog({\n  open,\n  onOpenChange,\n  major,\n  isLoadingMajor = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n}: MajorFormDialogProps) {\n  const isEditMode = !!major;\n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n  const tConfirm = useTranslations('code_change_confirmation');\n\n  // Confirmation dialog state for code change\n  const [showCodeChangeConfirm, setShowCodeChangeConfirm] = useState(false);\n  const [pendingFormData, setPendingFormData] = useState<MajorFormValues | null>(null);\n\n  // Create schema with translated messages\n  const baseMajorFormSchema = useMemo(() => z.object({\n    name: z\n      .string()\n      .min(1, tValidation('name_required'))\n      .max(150, tValidation('name_max_length'))\n      .regex(\n        /^[A-Za-z0-9&-]+( [A-Za-z0-9&-]+)*$/,\n        tValidation('name_format')\n      ),\n    code: z\n      .string()\n      .min(1, tValidation('code_required'))\n      .max(20, tValidation('code_max_length'))\n      .regex(\n        /^[A-Za-z0-9]+$/,\n        tValidation('code_format')\n      ),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  const form = useForm<MajorFormValues>({\n    resolver: zodResolver(baseMajorFormSchema),\n    defaultValues: {\n      name: major?.name || \"\",\n      code: major?.code || \"\",\n      isActive: major?.isActive ?? true,\n    },\n  });\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        name: major?.name || \"\",\n        code: major?.code || \"\",\n        isActive: major?.isActive ?? true,\n      });\n    }\n  }, [major, open, form]);\n\n  const handleSubmit = async (values: MajorFormValues) => {\n    // Check if code changed in edit mode\n    if (isEditMode && major && values.code !== major.code) {\n      setPendingFormData(values);\n      setShowCodeChangeConfirm(true);\n      return;\n    }\n\n    // Proceed with submission\n    await submitForm(values);\n  };\n\n  const submitForm = async (values: MajorFormValues) => {\n    form.clearErrors();\n    try {\n      await onSubmit({\n        name: values.name,\n        code: values.code,\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes from backend\n      switch (errorCode) {\n        case ERROR_CODES.MAJOR_NAME_EXISTS:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('name_exists'),\n          });\n          break;\n        case ERROR_CODES.MAJOR_CODE_EXISTS:\n          form.setError(\"code\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('code_exists'),\n          });\n          break;\n        case ERROR_CODES.MAJOR_HAS_ACTIVE_DEPENDENCIES:\n          form.setError(\"isActive\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('cannot_deactivate'),\n          });\n          break;\n        default:\n          // Fallback: Parse error message if no error code\n          if (\n            apiMessage.includes(\"name already exists\") ||\n            apiMessage.toLowerCase().includes(\"name\")\n          ) {\n            form.setError(\"name\", { type: \"manual\", message: apiMessage });\n          } else if (\n            apiMessage.includes(\"code already exists\") ||\n            apiMessage.toLowerCase().includes(\"code\")\n          ) {\n            form.setError(\"code\", { type: \"manual\", message: apiMessage });\n          }\n          break;\n      }\n    }\n  };\n\n  const handleConfirmCodeChange = async () => {\n    if (pendingFormData) {\n      setShowCodeChangeConfirm(false);\n      await submitForm(pendingFormData);\n      setPendingFormData(null);\n    }\n  };\n\n  const handleCancelCodeChange = () => {\n    setShowCodeChangeConfirm(false);\n    setPendingFormData(null);\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] flex flex-col gap-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full\"\n          >\n            <DialogHeader>\n              <DialogTitle>\n                {isEditMode ? tForm('title_edit') : tForm('title_create')}\n              </DialogTitle>\n              <DialogDescription>\n                {isEditMode\n                  ? tForm('description_edit')\n                  : tForm('description_create')}\n              </DialogDescription>\n            </DialogHeader>\n\n            {/* Loading State */}\n            {isLoadingMajor && isEditMode && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                {tForm('loading')}\n              </div>\n            )}\n\n            {/* Form Fields - Hidden while loading in edit mode */}\n            {(!isLoadingMajor || !isEditMode) && (\n              <>\n                <div className=\"grid gap-4 py-4 px-1 overflow-y-auto flex-1\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      {tForm('label_name')}{\" \"}\n                      <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={tForm('placeholder_name')}\n                        aria-invalid={!!form.formState.errors.name}\n                        {...field}\n                        maxLength={150}\n                        autoComplete=\"off\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"code\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      {tForm('label_code')}{\" \"}\n                      <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={tForm('placeholder_code')}\n                        aria-invalid={!!form.formState.errors.code}\n                        {...field}\n                        maxLength={20}\n                        autoComplete=\"off\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {isEditMode && (\n                <FormField\n                  control={form.control}\n                  name=\"isActive\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                      <div className=\"space-y-0.5 flex-1\">\n                        <FormLabel className=\"text-base\">\n                          {tForm('label_active')}\n                        </FormLabel>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {field.value\n                            ? tForm('description_active')\n                            : tForm('description_inactive')}\n                        </div>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              )}\n                </div>\n\n                <div className=\"flex flex-row justify-between items-center pt-4\">\n                  {isEditMode && onDelete && major && (\n                    <Button\n                      type=\"button\"\n                      variant=\"destructive\"\n                      onClick={() => onDelete(major)}\n                      disabled={isSubmitting || isDeleting}\n                      className=\"min-w-[100px]\"\n                    >\n                      {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                    </Button>\n                  )}\n\n                  <div className=\"flex gap-2 ml-auto\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => handleOpenChange(false)}\n                      disabled={isSubmitting || isDeleting}\n                      className=\"min-w-[80px]\"\n                    >\n                      {tForm('button_cancel')}\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={isSubmitting || isDeleting || (isLoadingMajor && isEditMode)}\n                      className=\"min-w-[100px]\"\n                    >\n                      {isSubmitting\n                        ? tForm('button_saving')\n                        : isEditMode\n                        ? tForm('button_update')\n                        : tForm('button_create')}\n                    </Button>\n                  </div>\n                </div>\n              </>\n            )}\n          </form>\n        </Form>\n      </DialogContent>\n\n      {/* Confirmation dialog for code change */}\n      <AlertDialog open={showCodeChangeConfirm} onOpenChange={setShowCodeChangeConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tConfirm('title_major')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tConfirm('description_major', {\n                oldCode: major?.code || '',\n                newCode: pendingFormData?.code || ''\n              })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={handleCancelCodeChange}>\n              {tConfirm('button_cancel')}\n            </AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmCodeChange}>\n              {tConfirm('button_confirm')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\majors\\major-pagination.tsx",
      "relative_path": "components/admin/majors/major-pagination.tsx",
      "filename": "major-pagination.tsx",
      "size_bytes": 3009,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.296668",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface MajorPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function MajorPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: MajorPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\majors\\major-table.tsx",
      "relative_path": "components/admin/majors/major-table.tsx",
      "filename": "major-table.tsx",
      "size_bytes": 4705,
      "lines": 155,
      "last_modified": "2025-11-11T10:48:14.525494",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from 'next-intl';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Major } from \"@/types\";\nimport { MajorPagination } from \"./major-pagination\";\n\ninterface MajorTableProps {\n  columns: ColumnDef<Major>[];\n  data: Major[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function MajorTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: MajorTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const t = useTranslations('major');\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[800px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t('no_majors')}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t('pagination_showing', {\n              start: (currentPage - 1) * pageSize + 1,\n              end: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t('pagination_no_items')\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <MajorPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\rooms\\delete-room-dialog.tsx",
      "relative_path": "components/admin/rooms/delete-room-dialog.tsx",
      "filename": "delete-room-dialog.tsx",
      "size_bytes": 1945,
      "lines": 67,
      "last_modified": "2025-11-11T10:48:14.525494",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from 'next-intl';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Room } from \"@/types\";\n\ninterface DeleteRoomDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  room: Room | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteRoomDialog({\n  open,\n  onOpenChange,\n  room,\n  onConfirm,\n  isDeleting = false,\n}: DeleteRoomDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!room) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {t('room_name', { name: room.name })}\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>{t('button_cancel')}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\rooms\\room-columns.tsx",
      "relative_path": "components/admin/rooms/room-columns.tsx",
      "filename": "room-columns.tsx",
      "size_bytes": 4441,
      "lines": 160,
      "last_modified": "2025-11-11T11:57:15.351906",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Pencil, MoreHorizontal, Camera } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Room } from \"@/types\";\n\n// Header components\nfunction NameHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_name')}</div>;\n}\n\nfunction LocationHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_location')}</div>;\n}\n\nfunction CamerasHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_cameras')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction LocationCell({ location }: { location: string | null }) {\n  const t = useTranslations('room');\n  \n  return (\n    <div className=\"text-muted-foreground text-center\">\n      {location || <span className=\"italic text-muted-foreground/60\">{t('no_location')}</span>}\n    </div>\n  );\n}\n\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nfunction ActionCell({ \n  room, \n  onEdit, \n  onViewCameras \n}: { \n  room: Room; \n  onEdit: (room: Room) => void;\n  onViewCameras: (room: Room) => void;\n}) {\n  const t = useTranslations('room');\n  \n  return (\n    <div className=\"flex justify-center\">\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\">\n          <DropdownMenuLabel>{t('menu_label', { name: room.name })}</DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem onClick={() => onEdit(room)}>\n            <Pencil className=\"mr-2 h-4 w-4\" />\n            {t('edit_menu')}\n          </DropdownMenuItem>\n          <DropdownMenuItem onClick={() => onViewCameras(room)}>\n            <Camera className=\"mr-2 h-4 w-4\" />\n            {t('view_cameras_menu')}\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n\nexport const createRoomColumns = (\n  onEdit: (room: Room) => void,\n  onViewCameras: (room: Room) => void\n): ColumnDef<Room>[] => [\n  {\n    accessorKey: \"name\",\n    header: NameHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"name\")}</div>\n    ),\n  },\n  {\n    accessorKey: \"location\",\n    header: LocationHeader,\n    cell: ({ row }) => {\n      const location = row.getValue(\"location\") as string | null;\n      return <LocationCell location={location} />;\n    },\n  },\n  {\n    id: \"cameras\",\n    header: CamerasHeader,\n    cell: ({ row }) => {\n      const activeCameras = row.original.activeCameras;\n      const totalCameras = row.original.totalCameras;\n      return (\n        <div className=\"text-center\">\n          <button\n            onClick={() => onViewCameras(row.original)}\n            className=\"text-muted-foreground hover:text-foreground transition-colors\"\n          >\n            {activeCameras} / {totalCameras}\n          </button>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return <StatusCell isActive={isActive} />;\n    },\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        room={row.original}\n        onEdit={onEdit}\n        onViewCameras={onViewCameras}\n      />\n    ),\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\rooms\\room-form-dialog.tsx",
      "relative_path": "components/admin/rooms/room-form-dialog.tsx",
      "filename": "room-form-dialog.tsx",
      "size_bytes": 10002,
      "lines": 305,
      "last_modified": "2025-11-14T17:14:01.258552",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Room } from \"@/types\";\n\ninterface RoomFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  room?: Room;\n  isLoadingRoom?: boolean;\n  onSubmit: (data: RoomFormData) => Promise<void>;\n  onDelete?: (room: Room) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n}\n\nexport interface RoomFormData {\n  name: string;\n  location?: string;\n  isActive?: boolean;\n}\n\nexport function RoomFormDialog({\n  open,\n  onOpenChange,\n  room,\n  isLoadingRoom = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n}: RoomFormDialogProps) {\n  const isEditMode = !!room;\n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n\n  // Create schema with translated messages\n  const roomFormSchema = useMemo(() => z.object({\n    name: z\n      .string()\n      .min(1, tValidation('name_required'))\n      .max(150, tValidation('name_max_length'))\n      .regex(\n        /^[A-Za-z0-9-]+( [A-Za-z0-9-]+)*$/,\n        tValidation('name_format')\n      ),\n    location: z.union([\n      z.string().max(255, tValidation('location_max_length')),\n      z.literal(\"\")\n    ]).optional(),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  type RoomFormValues = z.infer<typeof roomFormSchema>;\n\n  const form = useForm<RoomFormValues>({\n    resolver: zodResolver(roomFormSchema),\n    defaultValues: {\n      name: room?.name || \"\",\n      location: room?.location || \"\",\n      isActive: room?.isActive ?? true,\n    },\n  });\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        name: room?.name || \"\",\n        location: room?.location || \"\",\n        isActive: room?.isActive ?? true,\n      });\n    }\n  }, [room, open, form]);\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen && !isSubmitting && !isDeleting) {\n      form.reset();\n      onOpenChange(newOpen);\n    }\n  };\n\n  const handleDelete = () => {\n    if (room && onDelete) {\n      onDelete(room);\n    }\n  };\n\n  const handleSubmit = async (values: RoomFormValues) => {\n    form.clearErrors();\n    try {\n      await onSubmit({\n        name: values.name,\n        location: values.location || \"\",\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes from backend\n      switch (errorCode) {\n        case ERROR_CODES.ROOM_NAME_EXISTS:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('name_exists'),\n          });\n          break;\n        case ERROR_CODES.ROOM_HAS_ACTIVE_CAMERAS:\n        case ERROR_CODES.ROOM_HAS_ACTIVE_SLOTS:\n          form.setError(\"isActive\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('cannot_deactivate'),\n          });\n          break;\n        default:\n          // Fallback: try to parse error message for field-specific errors\n          if (apiMessage.toLowerCase().includes(\"name\")) {\n            form.setError(\"name\", {\n              type: \"manual\",\n              message: apiMessage,\n            });\n          } else if (apiMessage.toLowerCase().includes(\"location\")) {\n            form.setError(\"location\", {\n              type: \"manual\",\n              message: apiMessage,\n            });\n          }\n          break;\n      }\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] flex flex-col gap-0\">\n        <DialogHeader>\n          <DialogTitle>\n            {isEditMode ? tForm('title_edit') : tForm('title_create')}\n          </DialogTitle>\n          <DialogDescription>\n            {isEditMode\n              ? tForm('description_edit')\n              : tForm('description_create')}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full\"\n          >\n            <div className=\"grid gap-4 py-4 px-1 overflow-y-auto flex-1\">\n              {/* Loading State */}\n              {isLoadingRoom && isEditMode && (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  {tForm('loading')}\n                </div>\n              )}\n\n              {/* Form Fields - Hidden while loading in edit mode */}\n              {(!isLoadingRoom || !isEditMode) && (\n                <>\n                  {/* Name Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_room_name')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_room_name')}\n                            {...field}\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Location Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"location\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{tForm('label_location')}</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder={tForm('placeholder_location')}\n                            rows={3}\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Active Status (Edit mode only) */}\n                  {isEditMode && (\n                    <FormField\n                      control={form.control}\n                      name=\"isActive\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                          <div className=\"space-y-0.5 flex-1\">\n                            <FormLabel className=\"text-base\">\n                              {tForm('label_active')}\n                            </FormLabel>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {field.value\n                                ? tForm('description_active')\n                                : tForm('description_inactive')}\n                            </div>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  )}\n                </>\n              )}\n            </div>\n\n            {/* Button Layout */}\n            <div className=\"flex flex-row justify-between items-center pt-4\">\n              {isEditMode && onDelete && room && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={handleDelete}\n                  disabled={isDeleting || isSubmitting}\n                  className=\"min-w-[100px]\"\n                >\n                  {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                </Button>\n              )}\n\n              <div className=\"flex gap-2 ml-auto\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleOpenChange(false)}\n                  disabled={isSubmitting || isDeleting}\n                  className=\"min-w-[80px]\"\n                >\n                  {tForm('button_cancel')}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={isSubmitting || isDeleting || isLoadingRoom}\n                  className=\"min-w-[100px]\"\n                >\n                  {isSubmitting\n                    ? tForm('button_saving')\n                    : isEditMode\n                    ? tForm('button_update')\n                    : tForm('button_create')}\n                </Button>\n              </div>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\rooms\\room-pagination.tsx",
      "relative_path": "components/admin/rooms/room-pagination.tsx",
      "filename": "room-pagination.tsx",
      "size_bytes": 3006,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.298669",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface RoomPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function RoomPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: RoomPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\rooms\\room-table.tsx",
      "relative_path": "components/admin/rooms/room-table.tsx",
      "filename": "room-table.tsx",
      "size_bytes": 4587,
      "lines": 153,
      "last_modified": "2025-11-01T15:38:43.299668",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Room } from \"@/types\";\nimport { RoomPagination } from \"./room-pagination\";\n\ninterface RoomTableProps {\n  columns: ColumnDef<Room>[];\n  data: Room[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function RoomTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: RoomTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[900px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    No rooms found.\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            <>\n              Showing {(currentPage - 1) * pageSize + 1} -{\" \"}\n              {Math.min(currentPage * pageSize, totalItems)} of {totalItems}{\" \"}\n              items\n            </>\n          ) : (\n            \"No items\"\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <RoomPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\semesters\\delete-semester-dialog.tsx",
      "relative_path": "components/admin/semesters/delete-semester-dialog.tsx",
      "filename": "delete-semester-dialog.tsx",
      "size_bytes": 2034,
      "lines": 70,
      "last_modified": "2025-11-09T20:23:57.383509",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Semester } from \"@/types\";\nimport { useTranslations } from 'next-intl';\n\ninterface DeleteSemesterDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  semester: Semester | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteSemesterDialog({\n  open,\n  onOpenChange,\n  semester,\n  onConfirm,\n  isDeleting = false,\n}: DeleteSemesterDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!semester) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              {t('semester_name', { name: semester.name, code: semester.code })}\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>\n            {t('button_cancel')}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\semesters\\semester-columns.tsx",
      "relative_path": "components/admin/semesters/semester-columns.tsx",
      "filename": "semester-columns.tsx",
      "size_bytes": 5031,
      "lines": 180,
      "last_modified": "2025-11-21T19:17:03.189890",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { List, Pencil, MoreHorizontal } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Semester } from \"@/types\";\nimport { format } from 'date-fns';\nimport { enUS, vi } from 'date-fns/locale';\nimport { useLocale, useTranslations } from 'next-intl';\n\nconst formatDate = (dateString: string, locale: string) => {\n  try {\n    const date = new Date(dateString);\n    const dateLocale = locale === 'vi' ? vi : enUS;\n    return format(date, 'PP', { locale: dateLocale });\n  } catch {\n    // Fallback to simple date string if formatting fails\n    return new Date(dateString).toLocaleDateString();\n  }\n};\n\n// Header components\nfunction CodeHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_code')}</div>;\n}\n\nfunction NameHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_name')}</div>;\n}\n\nfunction StartDateHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_start_date')}</div>;\n}\n\nfunction EndDateHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_end_date')}</div>;\n}\n\nfunction ClassesHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_classes')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction DateCell({ dateString }: { dateString: string }) {\n  const locale = useLocale();\n  return (\n    <div className=\"text-muted-foreground text-center\">\n      {formatDate(dateString, locale)}\n    </div>\n  );\n}\n\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nfunction ActionCell({\n  semester,\n  onEdit,\n  onViewClasses,\n}: {\n  semester: Semester;\n  onEdit: (semester: Semester) => void;\n  onViewClasses: (semester: Semester) => void;\n}) {\n  const t = useTranslations('semester');\n  return (\n    <div className=\"flex justify-center\">\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\">\n          <DropdownMenuLabel>\n            {t('menu_label', { code: semester.code })}\n          </DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem onClick={() => onEdit(semester)}>\n            <Pencil className=\"mr-2 h-4 w-4\" />\n            {t('edit_menu')}\n          </DropdownMenuItem>\n          <DropdownMenuItem onClick={() => onViewClasses(semester)}>\n            <List className=\"mr-2 h-4 w-4\" />\n            {t('view_classes_menu')}\n          </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n\nexport const createSemesterColumns = (\n  onEdit: (semester: Semester) => void,\n  onViewClasses: (semester: Semester) => void\n): ColumnDef<Semester>[] => {\n  return [\n  {\n    accessorKey: \"code\",\n    header: CodeHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"code\")}</div>\n    ),\n  },\n  {\n    accessorKey: \"name\",\n    header: NameHeader,\n    cell: ({ row }) => <div className=\"text-center\">{row.getValue(\"name\")}</div>,\n  },\n  {\n    accessorKey: \"startDate\",\n    header: StartDateHeader,\n    cell: ({ row }) => <DateCell dateString={row.getValue(\"startDate\")} />,\n  },\n  {\n    accessorKey: \"endDate\",\n    header: EndDateHeader,\n    cell: ({ row }) => <DateCell dateString={row.getValue(\"endDate\")} />,\n  },\n  {\n    accessorKey: \"totalClass\",\n    header: ClassesHeader,\n    cell: ({ row }) => (\n      <div className=\"text-center text-muted-foreground\">\n        {row.getValue(\"totalClass\")}\n      </div>\n    ),\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => <StatusCell isActive={row.getValue(\"isActive\")} />,\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        semester={row.original}\n        onEdit={onEdit}\n        onViewClasses={onViewClasses}\n      />\n    ),\n  },\n];\n};\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\semesters\\semester-form-dialog.tsx",
      "relative_path": "components/admin/semesters/semester-form-dialog.tsx",
      "filename": "semester-form-dialog.tsx",
      "size_bytes": 20936,
      "lines": 568,
      "last_modified": "2025-11-21T19:17:03.190888",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\nimport { Semester } from \"@/types\";\n\ninterface SemesterFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  semester?: Semester;\n  isLoadingSemester?: boolean;\n  onSubmit: (data: SemesterFormData) => Promise<void>;\n  onDelete?: (semester: Semester) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n}\n\nexport interface SemesterFormData {\n  name: string;\n  code: string;\n  startDate: string;\n  endDate: string;\n  isActive?: boolean;\n}\n\nexport function SemesterFormDialog({\n  open,\n  onOpenChange,\n  semester,\n  isLoadingSemester = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n}: SemesterFormDialogProps) {\n  const isEditMode = !!semester;\n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n  const tConfirm = useTranslations('code_change_confirmation');\n\n  // Confirmation dialog state for code change\n  const [showCodeChangeConfirm, setShowCodeChangeConfirm] = useState(false);\n  const [pendingFormData, setPendingFormData] = useState<SemesterFormValues | null>(null);\n\n  // Create schemas with translated messages\n  const baseSemesterFormSchema = useMemo(() => z.object({\n    name: z\n      .string()\n      .min(1, tValidation('name_required'))\n      .max(20, tValidation('name_max_length'))\n      .regex(\n        /^[A-Za-z0-9]+( [A-Za-z0-9]+)*$/,\n        tValidation('name_format')\n      ),\n    code: z\n      .string()\n      .min(1, tValidation('code_required'))\n      .max(10, tValidation('code_max_length'))\n      .regex(\n        /^[A-Za-z0-9]+$/,\n        tValidation('code_format')\n      ),\n    startDate: z.date({ message: tValidation('start_date_required') }),\n    endDate: z.date({ message: tValidation('end_date_required') }),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  const createSemesterFormSchema = useMemo(() => baseSemesterFormSchema\n    .refine(\n      (data) => data.startDate >= new Date(new Date().setHours(0, 0, 0, 0)),\n      {\n        message: tValidation('start_date_future'),\n        path: [\"startDate\"],\n      }\n    )\n    .refine((data) => data.endDate > new Date(new Date().setHours(0, 0, 0, 0)), {\n      message: tValidation('end_date_future'),\n      path: [\"endDate\"],\n    })\n    .refine(\n      (data) => {\n        const start = new Date(data.startDate.setHours(0, 0, 0, 0));\n        const end = new Date(data.endDate.setHours(0, 0, 0, 0));\n        return end > start;\n      },\n      {\n        message: tValidation('end_date_after_start'),\n        path: [\"endDate\"],\n      }\n    ), [baseSemesterFormSchema, tValidation]);\n\n  const editSemesterFormSchema = useMemo(() => baseSemesterFormSchema.refine(\n    (data) => {\n      const start = new Date(data.startDate.setHours(0, 0, 0, 0));\n      const end = new Date(data.endDate.setHours(0, 0, 0, 0));\n      return end > start;\n    },\n    {\n      message: tValidation('end_date_after_start'),\n      path: [\"endDate\"],\n    }\n  ), [baseSemesterFormSchema, tValidation]);\n\n  type SemesterFormValues = z.infer<typeof baseSemesterFormSchema>;\n\n  const form = useForm<SemesterFormValues>({\n    resolver: zodResolver(\n      isEditMode ? editSemesterFormSchema : createSemesterFormSchema\n    ),\n    defaultValues: {\n      name: semester?.name || \"\",\n      code: semester?.code || \"\",\n      startDate: semester?.startDate ? new Date(semester.startDate) : undefined,\n      endDate: semester?.endDate ? new Date(semester.endDate) : undefined,\n      isActive: semester?.isActive ?? true,\n    },\n  });\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        name: semester?.name || \"\",\n        code: semester?.code || \"\",\n        startDate: semester?.startDate\n          ? new Date(semester.startDate)\n          : undefined,\n        endDate: semester?.endDate ? new Date(semester.endDate) : undefined,\n        isActive: semester?.isActive ?? true,\n      });\n    }\n  }, [semester, open, form]);\n\n  const handleSubmit = async (values: SemesterFormValues) => {\n    // Check if code changed in edit mode\n    if (isEditMode && semester && values.code !== semester.code) {\n      setPendingFormData(values);\n      setShowCodeChangeConfirm(true);\n      return;\n    }\n\n    // Proceed with submission\n    await submitForm(values);\n  };\n\n  const submitForm = async (values: SemesterFormValues) => {\n    form.clearErrors();\n    try {\n      await onSubmit({\n        name: values.name,\n        code: values.code,\n        startDate: format(values.startDate, \"yyyy-MM-dd\"),\n        endDate: format(values.endDate, \"yyyy-MM-dd\"),\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes from backend\n      switch (errorCode) {\n        case ERROR_CODES.SEMESTER_NAME_EXISTS:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('name_exists'),\n          });\n          break;\n        case ERROR_CODES.SEMESTER_CODE_EXISTS:\n          form.setError(\"code\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('code_exists'),\n          });\n          break;\n        case ERROR_CODES.SEMESTER_DATE_RANGE_EXISTS:\n          form.setError(\"startDate\", {\n            type: \"manual\",\n            message: \"\",\n          });\n          form.setError(\"endDate\", {\n            type: \"manual\",\n            message: \"\",\n          });\n          break;\n        case ERROR_CODES.SEMESTER_INVALID_DATE_RANGE:\n          form.setError(\"endDate\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('end_before_start'),\n          });\n          break;\n        case ERROR_CODES.INVALID_START_DATE_FORMAT:\n          form.setError(\"startDate\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('invalid_start_date'),\n          });\n          break;\n        case ERROR_CODES.INVALID_END_DATE_FORMAT:\n          form.setError(\"endDate\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('invalid_end_date'),\n          });\n          break;\n        case ERROR_CODES.SEMESTER_HAS_ACTIVE_CLASSES:\n          form.setError(\"isActive\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('cannot_deactivate'),\n          });\n          break;\n        default:\n          // Fallback: Parse error message if no error code\n          if (apiMessage.includes(\"At field endDate\")) {\n            form.setError(\"endDate\", { type: \"manual\" });\n          } else if (apiMessage.includes(\"At field startDate\")) {\n            form.setError(\"startDate\", { type: \"manual\" });\n          } else if (\n            apiMessage.includes(\"name already exists\") ||\n            apiMessage.toLowerCase().includes(\"name\")\n          ) {\n            form.setError(\"name\", { type: \"manual\" });\n          } else if (\n            apiMessage.includes(\"code already exists\") ||\n            apiMessage.toLowerCase().includes(\"code\")\n          ) {\n            form.setError(\"code\", { type: \"manual\" });\n          }\n          break;\n      }\n    }\n  };\n\n  const handleConfirmCodeChange = async () => {\n    if (pendingFormData) {\n      setShowCodeChangeConfirm(false);\n      await submitForm(pendingFormData);\n      setPendingFormData(null);\n    }\n  };\n\n  const handleCancelCodeChange = () => {\n    setShowCodeChangeConfirm(false);\n    setPendingFormData(null);\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] flex flex-col gap-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full\"\n          >\n            <DialogHeader>\n              <DialogTitle>\n                {isEditMode ? tForm('title_edit') : tForm('title_create')}\n              </DialogTitle>\n              <DialogDescription>\n                {isEditMode\n                  ? tForm('description_edit')\n                  : tForm('description_create')}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"grid gap-4 py-4 px-1 overflow-y-auto flex-1\">\n              {/* Loading State */}\n              {isLoadingSemester && isEditMode && (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  {tForm('loading')}\n                </div>\n              )}\n\n              {/* Form Fields - Hidden while loading in edit mode */}\n              {(!isLoadingSemester || !isEditMode) && (\n                <>\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_name')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_name')}\n                            aria-invalid={!!form.formState.errors.name}\n                            {...field}\n                            maxLength={20}\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"code\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_code')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_code')}\n                            aria-invalid={!!form.formState.errors.code}\n                            {...field}\n                            maxLength={10}\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"startDate\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-col\">\n                          <FormLabel>\n                            {tForm('label_start_date')}{\" \"}\n                            <span className=\"text-destructive\">*</span>\n                          </FormLabel>\n                          <Popover>\n                            <PopoverTrigger asChild>\n                              <FormControl>\n                                <Button\n                                  variant=\"outline\"\n                                  className={cn(\n                                    \"w-full justify-start text-left font-normal\",\n                                    !field.value && \"text-muted-foreground\",\n                                    form.formState.errors.startDate &&\n                                      \"border-destructive\"\n                                  )}\n                                >\n                                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                                  {field.value ? (\n                                    format(field.value, \"PPP\")\n                                  ) : (\n                                    <span>{tForm('placeholder_date')}</span>\n                                  )}\n                                </Button>\n                              </FormControl>\n                            </PopoverTrigger>\n                            <PopoverContent\n                              className=\"w-auto p-0\"\n                              align=\"start\"\n                            >\n                              <Calendar\n                                mode=\"single\"\n                                selected={field.value}\n                                onSelect={field.onChange}\n                                disabled={(date) =>\n                                  !isEditMode &&\n                                  date <\n                                    new Date(new Date().setHours(0, 0, 0, 0))\n                                }\n                              />\n                            </PopoverContent>\n                          </Popover>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"endDate\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-col\">\n                          <FormLabel>\n                            {tForm('label_end_date')} <span className=\"text-destructive\">*</span>\n                          </FormLabel>\n                          <Popover>\n                            <PopoverTrigger asChild>\n                              <FormControl>\n                                <Button\n                                  variant=\"outline\"\n                                  className={cn(\n                                    \"w-full justify-start text-left font-normal\",\n                                    !field.value && \"text-muted-foreground\",\n                                    form.formState.errors.endDate &&\n                                      \"border-destructive\"\n                                  )}\n                                >\n                                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                                  {field.value ? (\n                                    format(field.value, \"PPP\")\n                                  ) : (\n                                    <span>{tForm('placeholder_date')}</span>\n                                  )}\n                                </Button>\n                              </FormControl>\n                            </PopoverTrigger>\n                            <PopoverContent\n                              className=\"w-auto p-0\"\n                              align=\"start\"\n                            >\n                              <Calendar\n                                mode=\"single\"\n                                selected={field.value}\n                                onSelect={field.onChange}\n                                disabled={(date) =>\n                                  !isEditMode &&\n                                  date <\n                                    new Date(new Date().setHours(0, 0, 0, 0))\n                                }\n                              />\n                            </PopoverContent>\n                          </Popover>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {isEditMode && (\n                    <FormField\n                      control={form.control}\n                      name=\"isActive\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                          <div className=\"space-y-0.5 flex-1\">\n                            <FormLabel className=\"text-base\">\n                              {tForm('label_active')}\n                            </FormLabel>\n                            <FormDescription className=\"text-sm\">\n                              {field.value\n                                ? tForm('description_active')\n                                : tForm('description_inactive')}\n                            </FormDescription>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  )}\n                </>\n              )}\n            </div>\n\n            <div className=\"flex flex-row justify-between items-center pt-4\">\n              {isEditMode && onDelete && semester && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => onDelete(semester)}\n                  disabled={isSubmitting || isDeleting}\n                  className=\"min-w-[100px]\"\n                >\n                  {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                </Button>\n              )}\n\n              <div className=\"flex gap-2 ml-auto\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleOpenChange(false)}\n                  disabled={isSubmitting || isDeleting}\n                  className=\"min-w-[80px]\"\n                >\n                  {tForm('button_cancel')}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={isSubmitting || isDeleting || isLoadingSemester}\n                  className=\"min-w-[100px]\"\n                >\n                  {isSubmitting\n                    ? tForm('button_saving')\n                    : isEditMode\n                    ? tForm('button_update')\n                    : tForm('button_create')}\n                </Button>\n              </div>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n\n      {/* Confirmation dialog for code change */}\n      <AlertDialog open={showCodeChangeConfirm} onOpenChange={setShowCodeChangeConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tConfirm('title_semester')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tConfirm('description_semester', {\n                oldCode: semester?.code || '',\n                newCode: pendingFormData?.code || ''\n              })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={handleCancelCodeChange}>\n              {tConfirm('button_cancel')}\n            </AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmCodeChange}>\n              {tConfirm('button_confirm')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\semesters\\semester-pagination.tsx",
      "relative_path": "components/admin/semesters/semester-pagination.tsx",
      "filename": "semester-pagination.tsx",
      "size_bytes": 3018,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.301340",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface SemesterPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function SemesterPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: SemesterPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\semesters\\semester-table.tsx",
      "relative_path": "components/admin/semesters/semester-table.tsx",
      "filename": "semester-table.tsx",
      "size_bytes": 4738,
      "lines": 155,
      "last_modified": "2025-11-09T20:23:57.384512",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from 'next-intl';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Semester } from \"@/types\";\nimport { SemesterPagination } from \"./semester-pagination\";\n\ninterface SemesterTableProps {\n  columns: ColumnDef<Semester>[];\n  data: Semester[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function SemesterTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: SemesterTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const t = useTranslations('semester');\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[800px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t('no_semesters')}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t('pagination_showing', {\n              start: (currentPage - 1) * pageSize + 1,\n              end: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t('pagination_no_items')\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <SemesterPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\shared\\generic-import-dialog.tsx",
      "relative_path": "components/admin/shared/generic-import-dialog.tsx",
      "filename": "generic-import-dialog.tsx",
      "size_bytes": 15152,
      "lines": 419,
      "last_modified": "2025-11-14T17:01:44.464479",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport type { UseMutationResult } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { AlertCircle, CheckCircle2, Upload, FileUp, X } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ImportError {\n  rowNumber: number;\n  message: string;\n  errorCode?: string;\n}\n\ninterface ImportResponse {\n  errors: ImportError[];\n}\n\ninterface GenericImportDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title: string;\n  description?: string;\n  csvColumns: string[];\n  importMutation: UseMutationResult<\n    ImportResponse,\n    Error,\n    { file: File; mode: \"AddOnly\" | \"AddAndUpdate\" }\n  >;\n  successMessage?: string;\n  entityName?: string; // e.g., \"semesters\", \"majors\" for error messages\n}\n\nexport default function GenericImportDialog({\n  open,\n  onOpenChange,\n  title,\n  description,\n  csvColumns,\n  importMutation,\n  successMessage = \"All records imported successfully!\",\n  entityName = \"records\",\n}: GenericImportDialogProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [importMode, setImportMode] = useState<\"AddOnly\" | \"AddAndUpdate\">(\n    \"AddOnly\"\n  );\n  const [importResult, setImportResult] = useState<{\n    success: boolean;\n    message: string;\n    errors?: ImportError[];\n  } | null>(null);\n\n  const { mutateAsync: performImport, isPending } = importMutation;\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Validate file type\n      if (!file.name.endsWith(\".csv\")) {\n        toast.error(\"Please select a valid CSV file\");\n        return;\n      }\n      setSelectedFile(file);\n      setImportResult(null);\n    }\n  };\n\n  const handleDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      if (!file.name.endsWith(\".csv\")) {\n        toast.error(\"Please select a valid CSV file\");\n        return;\n      }\n      setSelectedFile(file);\n      setImportResult(null);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n  }, []);\n\n  const clearFile = () => {\n    setSelectedFile(null);\n    setImportResult(null);\n  };\n\n  const handleImport = async () => {\n    if (!selectedFile) {\n      toast.error(\"Please select a CSV file\");\n      return;\n    }\n\n    try {\n      const result = await performImport({\n        file: selectedFile,\n        mode: importMode,\n      });\n\n      // Check if there are any errors\n      if (result.errors && result.errors.length > 0) {\n        setImportResult({\n          success: false,\n          message: `Import completed with ${result.errors.length} error(s)`,\n          errors: result.errors,\n        });\n        // Toast already shown by hook's onSuccess callback\n      } else {\n        setImportResult({\n          success: true,\n          message: successMessage,\n        });\n        // Toast already shown by hook's onSuccess callback\n\n        // Auto close after success\n        setTimeout(() => {\n          handleClose();\n        }, 2000);\n      }\n    } catch (error) {\n      const err = error as { response?: { data?: { message?: string } } };\n      const errorMessage =\n        err.response?.data?.message || `Failed to import ${entityName}`;\n\n      setImportResult({\n        success: false,\n        message: errorMessage,\n      });\n      // Toast already shown by hook's onError callback\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedFile(null);\n    setImportMode(\"AddOnly\");\n    setImportResult(null);\n    onOpenChange(false);\n  };\n\n  // Reset state when dialog opens\n  useEffect(() => {\n    if (open) {\n      setSelectedFile(null);\n      setImportMode(\"AddOnly\");\n      setImportResult(null);\n    }\n  }, [open]);\n\n  // Generate description with CSV columns if not provided\n  const dialogDescription =\n    description ||\n    `Upload a CSV file with columns: ${csvColumns\n      .map((col) => `\"${col}\"`)\n      .join(\", \")}`;\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[560px] max-h-[95vh] flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"px-6 pt-6 pb-4 border-b\">\n          <DialogTitle className=\"text-xl\">{title}</DialogTitle>\n          <DialogDescription className=\"text-sm\">\n            {csvColumns.length > 0 ? (\n              <>\n                Upload a CSV file with columns:{\" \"}\n                {csvColumns.map((col, idx) => (\n                  <span key={col}>\n                    <code className=\"text-xs bg-muted px-1.5 py-0.5 rounded\">\n                      {col}\n                    </code>\n                    {idx < csvColumns.length - 1 ? \", \" : \"\"}\n                  </span>\n                ))}\n              </>\n            ) : (\n              dialogDescription\n            )}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex-1\">\n          <div className=\"px-6 py-6 space-y-6 max-h-[calc(95vh-220px)] overflow-y-auto\">\n            {/* Import Mode - Select Dropdown */}\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"import-mode\" className=\"text-sm font-medium\">\n                Import Mode\n              </Label>\n              <Select\n                value={importMode}\n                onValueChange={(value) =>\n                  setImportMode(value as \"AddOnly\" | \"AddAndUpdate\")\n                }\n                disabled={isPending}\n              >\n                <SelectTrigger id=\"import-mode\" className=\"w-full\">\n                  <SelectValue placeholder=\"Select import mode\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"AddOnly\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium\">Add Only</span>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        Safer\n                      </Badge>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Skip records that already exist\n                    </p>\n                  </SelectItem>\n                  <SelectItem value=\"AddAndUpdate\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium\">Add and Update</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Advanced\n                      </Badge>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Add new and update existing records\n                    </p>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Drag & Drop Upload Zone - Compact */}\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">CSV File</Label>\n              {!selectedFile ? (\n                <div\n                  onDrop={handleDrop}\n                  onDragOver={handleDragOver}\n                  className={cn(\n                    \"relative w-full border-2 border-dashed rounded-lg transition-all\",\n                    \"hover:border-primary/50 hover:bg-accent/5\",\n                    isPending\n                      ? \"opacity-50 cursor-not-allowed\"\n                      : \"cursor-pointer\"\n                  )}\n                >\n                  <input\n                    id=\"csv-file\"\n                    type=\"file\"\n                    accept=\".csv\"\n                    onChange={handleFileChange}\n                    disabled={isPending}\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed\"\n                  />\n                  <div className=\"flex items-center gap-3 px-4 py-3\">\n                    <div className=\"rounded-md bg-primary/10 p-2\">\n                      <Upload className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium\">\n                        Choose CSV file or drag and drop\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        .csv file only\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"pointer-events-none h-8 text-xs shrink-0\"\n                      type=\"button\"\n                    >\n                      Browse\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"w-full flex items-center gap-3 p-3 bg-muted/50 rounded-lg border-2 border-muted\">\n                  <div className=\"rounded-md bg-green-100 dark:bg-green-900/30 p-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm truncate\">\n                      {selectedFile.name}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {(selectedFile.size / 1024).toFixed(2)} KB\n                    </p>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={clearFile}\n                    disabled={isPending}\n                    className=\"shrink-0 h-8 w-8\"\n                    type=\"button\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* Import Result - Fixed Height to Prevent Layout Shift */}\n            {importResult && (\n              <div className=\"animate-in fade-in-50 duration-300\">\n                {importResult.success ? (\n                  <div className=\"rounded-lg border-2 border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950/30 p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"rounded-full bg-green-100 dark:bg-green-900/50 p-2\">\n                        <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-sm text-green-900 dark:text-green-100\">\n                          {importResult.message}\n                        </h4>\n                        <p className=\"text-xs text-green-700 dark:text-green-300 mt-1\">\n                          All records have been processed successfully\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"rounded-lg border-2 border-destructive/30 bg-destructive/5\">\n                    <div className=\"p-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <div className=\"rounded-full bg-destructive/10 p-2 shrink-0\">\n                          <AlertCircle className=\"h-5 w-5 text-destructive\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <h4 className=\"font-semibold text-sm text-destructive\">\n                            {importResult.message}\n                          </h4>\n                          {importResult.errors &&\n                            importResult.errors.length > 0 && (\n                              <p className=\"text-xs text-muted-foreground mt-1\">\n                                {importResult.errors.length} error(s) found\n                              </p>\n                            )}\n                        </div>\n                      </div>\n                    </div>\n                    {importResult.errors && importResult.errors.length > 0 && (\n                      <div className=\"border-t border-destructive/20\">\n                        <div className=\"max-h-[300px] overflow-y-auto\">\n                          <div className=\"p-4 space-y-2\">\n                            {importResult.errors.map((error, index) => (\n                              <div\n                                key={index}\n                                className=\"flex items-start gap-3 p-3 bg-background rounded-md border-l-2 border-destructive\"\n                              >\n                                <Badge\n                                  variant=\"destructive\"\n                                  className=\"shrink-0 mt-0.5 text-[10px] px-2 py-0.5\"\n                                >\n                                  Row {error.rowNumber}\n                                </Badge>\n                                <p className=\"text-xs text-muted-foreground flex-1 break-words\">\n                                  {error.message}\n                                </p>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 justify-end px-6 py-4 border-t shrink-0 bg-muted/30\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={isPending}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            onClick={handleImport}\n            disabled={!selectedFile || isPending}\n          >\n            {isPending ? (\n              <>\n                <Upload className=\"mr-2 h-4 w-4 animate-pulse\" />\n                Importing...\n              </>\n            ) : (\n              <>\n                <FileUp className=\"mr-2 h-4 w-4\" />\n                Import\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\delete-slot-dialog.tsx",
      "relative_path": "components/admin/slots/delete-slot-dialog.tsx",
      "filename": "delete-slot-dialog.tsx",
      "size_bytes": 3310,
      "lines": 101,
      "last_modified": "2025-11-23T10:21:14.459040",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Slot } from \"@/types\";\nimport { format } from \"date-fns\";\nimport { canDeleteSlot } from \"@/lib/utils\";\nimport { TruncatedText } from \"@/components/ui/truncated-text\";\n\ninterface DeleteSlotDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  slot: Slot | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteSlotDialog({\n  open,\n  onOpenChange,\n  slot,\n  onConfirm,\n  isDeleting = false,\n}: DeleteSlotDialogProps) {\n  if (!slot) return null;\n\n  const canDelete = canDeleteSlot(slot);\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Delete Slot</AlertDialogTitle>\n          <AlertDialogDescription asChild>\n            <div className=\"space-y-3\">\n              <p>Are you sure you want to delete this slot?</p>\n\n              <div className=\"rounded-lg border p-3 space-y-2 bg-muted/50\">\n                <div className=\"flex items-start gap-1\">\n                  <span className=\"font-semibold shrink-0\">Title:</span>{\" \"}\n                  {slot.title ? (\n                    <TruncatedText text={slot.title} maxWidth=\"250px\" />\n                  ) : (\n                    <span className=\"text-muted-foreground italic\">\n                      Untitled\n                    </span>\n                  )}\n                </div>\n                {slot.class && (\n                  <div>\n                    <span className=\"font-semibold\">Class:</span>{\" \"}\n                    {slot.class.code}\n                  </div>\n                )}\n                <div>\n                  <span className=\"font-semibold\">Time:</span>{\" \"}\n                  {format(new Date(slot.startTime), \"PPp\")}\n                </div>\n                <div>\n                  <span className=\"font-semibold\">Room:</span> {slot.room.name}\n                </div>\n              </div>\n\n              {!canDelete && (\n                <div className=\"rounded-lg border border-destructive bg-destructive/10 p-3\">\n                  <p className=\"text-sm text-destructive\">\n                    Cannot delete this slot: Slot has already started.\n                  </p>\n                </div>\n              )}\n\n              {canDelete && (\n                <p className=\"text-sm text-muted-foreground\">\n                  This action cannot be undone.\n                </p>\n              )}\n            </div>\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting || !canDelete}\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isDeleting ? \"Deleting...\" : \"Delete\"}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\evidence-viewer-dialog.tsx",
      "relative_path": "components/admin/slots/evidence-viewer-dialog.tsx",
      "filename": "evidence-viewer-dialog.tsx",
      "size_bytes": 6036,
      "lines": 168,
      "last_modified": "2025-11-20T23:08:32.743681",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useMemo, useEffect } from \"react\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { ImageOff } from \"lucide-react\";\nimport { QUERY_KEYS } from \"@/lib/constants\";\nimport { getEvidenceImageUrl, getProfilePhotoUrl, getPlaceholderImageUrl } from \"@/lib/image-utils\";\nimport type { SlotRosterResponse } from \"@/types\";\n\ninterface EvidenceViewerDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  slotId: number;\n  studentUserId: number;\n  attendanceType: \"REGULAR\" | \"EXAM\";\n}\n\nexport function EvidenceViewerDialog({\n  open,\n  onOpenChange,\n  slotId,\n  studentUserId,\n  attendanceType,\n}: EvidenceViewerDialogProps) {\n  const [avatarError, setAvatarError] = useState(false);\n  const [evidenceError, setEvidenceError] = useState(false);\n  const [rosterData, setRosterData] = useState<SlotRosterResponse | undefined>();\n\n  const queryClient = useQueryClient();\n\n  // Get roster data from cache and subscribe to updates\n  useEffect(() => {\n    if (!open) return;\n\n    // Get initial data from cache\n    const data = queryClient.getQueryData<SlotRosterResponse>(\n      QUERY_KEYS.slots.roster(slotId)\n    );\n    setRosterData(data);\n\n    // Subscribe to cache updates (for SSE real-time updates)\n    const unsubscribe = queryClient.getQueryCache().subscribe((event) => {\n      if (\n        event?.query.queryKey[0] === \"slots\" &&\n        event?.query.queryKey[1] === slotId &&\n        event?.query.queryKey[2] === \"roster\"\n      ) {\n        const updatedData = queryClient.getQueryData<SlotRosterResponse>(\n          QUERY_KEYS.slots.roster(slotId)\n        );\n        setRosterData(updatedData);\n      }\n    });\n\n    return () => unsubscribe();\n  }, [open, slotId, queryClient]);\n\n  // Reset error states when dialog opens/closes or student changes\n  useEffect(() => {\n    if (open) {\n      setAvatarError(false);\n      setEvidenceError(false);\n    }\n  }, [open, studentUserId, attendanceType]);\n\n  // Find student item from roster\n  const studentItem = useMemo(\n    () => rosterData?.find((item) => item.student.userId === studentUserId),\n    [rosterData, studentUserId]\n  );\n\n  // Extract student info\n  const studentName = studentItem?.student.fullName || \"\";\n  const avatarUrl = useMemo(() => {\n    if (!studentItem?.student.photoUrl) return getPlaceholderImageUrl();\n\n    const baseUrl = getProfilePhotoUrl(studentItem.student.photoUrl);\n    if (!baseUrl) return getPlaceholderImageUrl();\n\n    // Skip cache-busting for placeholder\n    if (baseUrl.includes('placehold.co')) return baseUrl;\n\n    // Use student userId as cache key (stable per student)\n    return `${baseUrl}?v=${studentItem.student.userId}`;\n  }, [studentItem]);\n\n  // Extract evidence URL (reactive to SSE updates!)\n  const evidenceUrl = useMemo(() => {\n    if (!studentItem) return null;\n\n    const attendance =\n      attendanceType === \"REGULAR\"\n        ? studentItem.regularAttendance\n        : studentItem.examAttendance;\n\n    if (!attendance?.evidenceImageUrl) return null;\n\n    const baseUrl = getEvidenceImageUrl(attendance.evidenceImageUrl);\n    if (!baseUrl) return null;\n\n    // CRITICAL: Use recordId and timestamp as cache keys to bust browser cache after rescan\n    // When rescan updates evidence, recordId stays same but image content changes\n    // Adding timestamp ensures browser fetches new image every time dialog opens\n    return `${baseUrl}?v=${attendance.recordId}&t=${Date.now()}`;\n  }, [studentItem, attendanceType]);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl\">\n        <DialogHeader>\n          <DialogTitle>Image Comparison - {studentName}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-2 gap-6\">\n          {/* Avatar Column */}\n          <div className=\"flex flex-col items-center gap-3\">\n            <h3 className=\"text-sm font-semibold text-foreground\">Avatar</h3>\n            <div className=\"flex items-center justify-center min-h-[300px] bg-muted rounded-lg w-full\">\n              {avatarUrl && !avatarError ? (\n                // eslint-disable-next-line @next/next/no-img-element\n                <img\n                  src={avatarUrl}\n                  alt=\"Avatar\"\n                  className=\"max-w-full max-h-[400px] object-contain rounded\"\n                  onError={() => setAvatarError(true)}\n                />\n              ) : (\n                <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\n                  <ImageOff className=\"h-12 w-12\" />\n                  <p className=\"text-sm\">Avatar not available</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Evidence Column */}\n          <div className=\"flex flex-col items-center gap-3\">\n            <h3 className=\"text-sm font-semibold text-foreground\">Evidence</h3>\n            <div className=\"flex items-center justify-center min-h-[300px] bg-muted rounded-lg w-full\">\n              {evidenceUrl && !evidenceError ? (\n                // eslint-disable-next-line @next/next/no-img-element\n                <img\n                  src={evidenceUrl}\n                  alt=\"Evidence\"\n                  className=\"max-w-full max-h-[400px] object-contain rounded\"\n                  onError={() => setEvidenceError(true)}\n                />\n              ) : (\n                <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\n                  <ImageOff className=\"h-12 w-12\" />\n                  <p className=\"text-sm\">\n                    {evidenceUrl ? \"Evidence not available\" : \"No evidence\"}\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\exam-session-controls.tsx",
      "relative_path": "components/admin/slots/exam-session-controls.tsx",
      "filename": "exam-session-controls.tsx",
      "size_bytes": 24864,
      "lines": 668,
      "last_modified": "2025-11-24T15:42:41.191971",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, cloneElement, isValidElement } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Play, Square, RotateCcw, Lock, AlertTriangle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  useStartExamSession,\n  useStopExamSession,\n  useRescanExam,\n} from \"@/hooks/api/useExamSession\";\nimport { useSubmitAttendance } from \"@/hooks/api/useSubmitAttendance\";\nimport { getSlotTimeRangeStatus } from \"@/lib/utils\";\nimport type { Slot, SlotRosterItem } from \"@/types\";\nimport type { PendingChange } from \"./slot-roster-table\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { RosterFilters, type StatusFilter } from \"./roster-filters\";\n\ninterface ExamSessionControlsProps {\n  slot: Slot;\n  roster: SlotRosterItem[];\n  pendingChanges: Map<string, PendingChange>;\n  onSubmitSuccess: () => void;\n  userRole?: string;\n  children?: React.ReactNode;\n  statusFilter?: StatusFilter;\n  onStatusFilterChange?: (filter: StatusFilter) => void;\n  searchQuery?: string;\n  onSearchQueryChange?: (query: string) => void;\n}\n\n/**\n * Exam Session Controls for LECTURE_WITH_PT and FINAL_EXAM slots.\n *\n * KEY DIFFERENCES from Regular Attendance:\n * - Uses examSessionStatus, examScanCount, lastExamSessionStoppedAt\n * - NO DOWNGRADE LOGIC: On rescan, PRESENT stays PRESENT\n * - Mutual exclusion with regular session\n *\n * SAME as Regular Attendance:\n * - Submit logic (pending changes + NOT_YET resolution)\n * - SSE connection status\n * - Role-based hiding (DATA_OPERATOR)\n * - Time-based warnings\n */\nexport function ExamSessionControls({\n  slot,\n  roster,\n  pendingChanges,\n  onSubmitSuccess,\n  userRole,\n  children,\n  statusFilter,\n  onStatusFilterChange,\n  searchQuery,\n  onSearchQueryChange,\n}: ExamSessionControlsProps) {\n  const t = useTranslations(\"roster.exam_session\");\n  const [showRescanConfirm, setShowRescanConfirm] = useState(false);\n  const [showStopConfirm, setShowStopConfirm] = useState(false);\n  const [showSubmitDialog, setShowSubmitDialog] = useState(false);\n  const [showSubmitConfirm, setShowSubmitConfirm] = useState(false);\n  const [showReviewWarning, setShowReviewWarning] = useState(false);\n  const [recordsNeedingReview, setRecordsNeedingReview] = useState<\n    SlotRosterItem[]\n  >([]);\n  const [notYetResolution, setNotYetResolution] = useState<\n    \"MARK_AS_ABSENT\" | \"MARK_AS_PRESENT\" | \"KEEP_NOT_YET\"\n  >(\"MARK_AS_ABSENT\");\n\n  // Exam session hooks (different from regular)\n  const startExamSessionMutation = useStartExamSession();\n  const stopExamSessionMutation = useStopExamSession();\n  const rescanExamMutation = useRescanExam();\n  const submitAttendance = useSubmitAttendance(slot.id);\n\n  // Exam session state (different from regular)\n  const examSessionStatus = slot.examSessionStatus || \"NOT_STARTED\";\n  const isExamRunning = examSessionStatus === \"RUNNING\";\n\n  // Check if regular session is running (mutual exclusion)\n  const isRegularRunning = slot.sessionStatus === \"RUNNING\";\n\n  // Determine mutation state\n  const isMutating =\n    startExamSessionMutation.isPending ||\n    stopExamSessionMutation.isPending ||\n    rescanExamMutation.isPending ||\n    submitAttendance.isPending;\n\n  // Compute session running state including pending connections\n  // Disable editing when session is RUNNING OR when starting/rescanning (connecting to cameras)\n  const isSessionRunningOrConnecting =\n    isExamRunning ||\n    startExamSessionMutation.isPending ||\n    rescanExamMutation.isPending;\n\n  const timeRangeStatus = getSlotTimeRangeStatus(slot);\n\n  // Can start if NOT_STARTED and not during regular session\n  // STRICT: Only allow during active time (startTime â†’ endTime)\n  const canStart =\n    examSessionStatus === \"NOT_STARTED\" &&\n    !isRegularRunning &&\n    timeRangeStatus === \"active\"; // Only during slot active time\n\n  // Can stop if RUNNING\n  const canStop = isExamRunning;\n\n  // Can rescan if STOPPED\n  // STRICT: Only allow during active time (startTime â†’ endTime)\n  const canRescan =\n    examSessionStatus === \"STOPPED\" &&\n    !isRegularRunning &&\n    timeRangeStatus === \"active\"; // Only during slot active time\n\n  const handleStart = async () => {\n    try {\n      await startExamSessionMutation.mutateAsync(slot.id);\n    } catch {\n      // Error already handled in mutation's onError callback\n    }\n  };\n\n  const handleStop = async () => {\n    setShowStopConfirm(false);\n    try {\n      await stopExamSessionMutation.mutateAsync(slot.id);\n    } catch {\n      // Error already handled in mutation's onError callback\n    }\n  };\n\n  const handleRescan = async () => {\n    setShowRescanConfirm(false);\n    try {\n      await rescanExamMutation.mutateAsync(slot.id);\n    } catch {\n      // Error already handled in mutation's onError callback\n    }\n  };\n\n  // Check if there are any NOT_YET students in EXAM attendance\n  const hasNotYetStudents = roster.some((item) => {\n    const attendance = item.examAttendance;\n    return !attendance || attendance.status === \"not_yet\";\n  });\n\n  const handleSubmitClick = () => {\n    // Check for records needing review\n    const recordsNeedReview = roster.filter((item) => {\n      const attendance = item.examAttendance;\n      return attendance?.needsReview === true;\n    });\n\n    if (recordsNeedReview.length > 0) {\n      // Show review warning dialog instead of window.confirm\n      setRecordsNeedingReview(recordsNeedReview);\n      setShowReviewWarning(true);\n      return;\n    }\n\n    // No records need review, proceed to next step\n    proceedToSubmit();\n  };\n\n  const proceedToSubmit = () => {\n    if (hasNotYetStudents) {\n      // Show dialog with RadioGroup for batch resolution\n      setShowSubmitDialog(true);\n    } else {\n      // Show simple confirmation dialog\n      setShowSubmitConfirm(true);\n    }\n  };\n\n  const handleSubmitWithResolution = async () => {\n    setShowSubmitDialog(false);\n\n    // Build submissions:\n    // 1) From pending changes (map recordId -> studentUserId)\n    const recordIdToStudentUserId = new Map<number, number>();\n    roster.forEach((item) => {\n      if (item.examAttendance) {\n        recordIdToStudentUserId.set(\n          item.examAttendance.recordId,\n          item.student.userId\n        );\n      }\n    });\n\n    const submissionsFromChanges = Array.from(pendingChanges.entries())\n      .filter(([key]) => key.startsWith(\"EXAM-\")) // Only process EXAM attendance\n      .map(([key, change]) => {\n        const recordId = parseInt(key.split(\"-\")[1]); // Extract recordId from \"EXAM-456\"\n        const studentUserId = recordIdToStudentUserId.get(recordId);\n        if (!studentUserId) return null;\n        return {\n          studentUserId,\n          status: change.status,\n          remark: change.remark,\n        } as const;\n      })\n      .filter(Boolean) as {\n      studentUserId: number;\n      status: \"present\" | \"absent\" | \"not_yet\";\n      remark?: string;\n    }[];\n\n    // Create Set of studentUserIds with pending changes to avoid duplicates\n    const studentUserIdsWithChanges = new Set(\n      submissionsFromChanges.map((s) => s.studentUserId)\n    );\n\n    // 2) Add NOT_YET students per resolution (exclude those with pending changes)\n    // If KEEP_NOT_YET, skip adding NOT_YET students to submission (keep them as NOT_YET)\n    const submissionsFromNotYet =\n      notYetResolution === \"KEEP_NOT_YET\"\n        ? []\n        : roster\n            .filter((item) => {\n              // Exclude students who already have pending changes\n              if (studentUserIdsWithChanges.has(item.student.userId)) {\n                return false;\n              }\n\n              const att = item.examAttendance;\n              return !att || att.status === \"not_yet\";\n            })\n            .map((item) => ({\n              studentUserId: item.student.userId,\n              status: (notYetResolution === \"MARK_AS_ABSENT\"\n                ? \"absent\"\n                : \"present\") as \"absent\" | \"present\",\n            }));\n\n    const submissions = [...submissionsFromChanges, ...submissionsFromNotYet];\n\n    try {\n      // IMPORTANT: Send attendanceType: \"EXAM\" to route to exam_attendance table\n      await submitAttendance.mutateAsync({\n        attendanceType: \"EXAM\",\n        submissions,\n      });\n      onSubmitSuccess();\n    } catch {\n      // Error handling done in mutation hook\n    }\n  };\n\n  const handleSubmitConfirmed = async () => {\n    setShowSubmitConfirm(false);\n\n    // Build submissions from pending changes (no NOT_YET resolution needed)\n    const recordIdToStudentUserId = new Map<number, number>();\n    roster.forEach((item) => {\n      if (item.examAttendance) {\n        recordIdToStudentUserId.set(\n          item.examAttendance.recordId,\n          item.student.userId\n        );\n      }\n    });\n\n    const submissions = Array.from(pendingChanges.entries())\n      .filter(([key]) => key.startsWith(\"EXAM-\")) // Only process EXAM attendance\n      .map(([key, change]) => {\n        const recordId = parseInt(key.split(\"-\")[1]); // Extract recordId from \"EXAM-456\"\n        const studentUserId = recordIdToStudentUserId.get(recordId);\n        if (!studentUserId) return null;\n        return {\n          studentUserId,\n          status: change.status,\n          remark: change.remark,\n        } as const;\n      })\n      .filter(Boolean) as {\n      studentUserId: number;\n      status: \"present\" | \"absent\" | \"not_yet\";\n      remark?: string;\n    }[];\n\n    try {\n      // IMPORTANT: Send attendanceType: \"EXAM\" to route to exam_attendance table\n      await submitAttendance.mutateAsync({\n        attendanceType: \"EXAM\",\n        submissions,\n      });\n      onSubmitSuccess();\n    } catch {\n      // Error handling done in mutation hook\n    }\n  };\n\n  return (\n    <>\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n            {/* Right: Action Buttons */}\n            <div\n              className={`flex items-center gap-2 ${\n                userRole === \"DATA_OPERATOR\" ? \"ml-auto\" : \"\"\n              }`}\n            >\n              {/* Hide Start/Stop/Rescan buttons for DATA_OPERATOR */}\n              {userRole !== \"DATA_OPERATOR\" && (\n                <TooltipProvider>\n                  {/* Start Exam Button */}\n                  {examSessionStatus === \"NOT_STARTED\" && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <span>\n                          <Button\n                            onClick={handleStart}\n                            disabled={isMutating || !canStart}\n                            size=\"sm\"\n                            className=\"gap-2\"\n                          >\n                            <Play className=\"h-4 w-4\" />\n                            {t(\"button.start\")}\n                          </Button>\n                        </span>\n                      </TooltipTrigger>\n                      {!canStart && (\n                        <TooltipContent>\n                          <p>\n                            {isRegularRunning\n                              ? t(\"tooltip.regular_running\")\n                              : timeRangeStatus === \"before_start\"\n                              ? t(\"tooltip.before_start\")\n                              : timeRangeStatus === \"expired\"\n                              ? t(\"tooltip.expired\")\n                              : timeRangeStatus === \"edit_window\"\n                              ? t(\"tooltip.edit_window\")\n                              : t(\"tooltip.ended\")}\n                          </p>\n                        </TooltipContent>\n                      )}\n                    </Tooltip>\n                  )}\n\n                  {/* Stop Exam Button */}\n                  {canStop && (\n                    <Button\n                      onClick={() => setShowStopConfirm(true)}\n                      disabled={isMutating}\n                      variant=\"destructive\"\n                      size=\"sm\"\n                      className=\"gap-2\"\n                    >\n                      <Square className=\"h-4 w-4\" />\n                      {t(\"button.stop\")}\n                    </Button>\n                  )}\n\n                  {/* Rescan Exam Button */}\n                  {examSessionStatus === \"STOPPED\" && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <span>\n                          <Button\n                            onClick={() => setShowRescanConfirm(true)}\n                            disabled={isMutating || !canRescan}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-2\"\n                          >\n                            <RotateCcw className=\"h-4 w-4\" />\n                            {t(\"button.rescan\")}\n                          </Button>\n                        </span>\n                      </TooltipTrigger>\n                      {!canRescan && (\n                        <TooltipContent>\n                          <p>\n                            {isRegularRunning\n                              ? t(\"tooltip.regular_running_rescan\")\n                              : timeRangeStatus === \"before_start\"\n                              ? t(\"tooltip.rescan_before_start\")\n                              : timeRangeStatus === \"expired\"\n                              ? t(\"tooltip.expired\")\n                              : timeRangeStatus === \"edit_window\"\n                              ? t(\"tooltip.rescan_edit_window\")\n                              : t(\"tooltip.rescan_ended\")}\n                          </p>\n                        </TooltipContent>\n                      )}\n                    </Tooltip>\n                  )}\n                </TooltipProvider>\n              )}\n\n              {!isExamRunning && (\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <span>\n                        <Button\n                          onClick={handleSubmitClick}\n                          disabled={\n                            isMutating ||\n                            (pendingChanges.size === 0 && !hasNotYetStudents) ||\n                            (userRole !== \"DATA_OPERATOR\" &&\n                              timeRangeStatus === \"expired\") ||\n                            (userRole !== \"DATA_OPERATOR\" &&\n                              timeRangeStatus === \"before_start\") ||\n                            (userRole === \"DATA_OPERATOR\" &&\n                              timeRangeStatus !== \"expired\")\n                          }\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"gap-2\"\n                        >\n                          <Lock className=\"h-4 w-4\" />\n                          {t(\"button.submit\")} ({pendingChanges.size})\n                        </Button>\n                      </span>\n                    </TooltipTrigger>\n                    {userRole === \"DATA_OPERATOR\" &&\n                      timeRangeStatus !== \"expired\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.data_operator_not_yet\")}</p>\n                        </TooltipContent>\n                      )}\n                    {userRole !== \"DATA_OPERATOR\" &&\n                      timeRangeStatus === \"before_start\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.submit_before_start\")}</p>\n                        </TooltipContent>\n                      )}\n                    {userRole !== \"DATA_OPERATOR\" &&\n                      timeRangeStatus === \"expired\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.submit_expired\")}</p>\n                        </TooltipContent>\n                      )}\n                  </Tooltip>\n                </TooltipProvider>\n              )}\n            </div>\n          </div>\n\n          {/* Mutual Exclusion Warning */}\n          {isRegularRunning && (\n            <Alert variant=\"destructive\" className=\"mt-3\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertDescription>\n                {t(\"warning.regular_running\")}\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Roster Filters */}\n          {statusFilter !== undefined &&\n            onStatusFilterChange &&\n            onSearchQueryChange && (\n              <>\n                <Separator className=\"my-4\" />\n                <RosterFilters\n                  statusFilter={statusFilter}\n                  onStatusFilterChange={onStatusFilterChange}\n                  searchQuery={searchQuery || \"\"}\n                  onSearchQueryChange={onSearchQueryChange}\n                  attendanceType=\"EXAM\"\n                  data={roster}\n                />\n              </>\n            )}\n\n          {/* Roster Table */}\n          {children && (\n            <div className=\"mt-6\">\n              {isValidElement(children)\n                ? cloneElement(children as React.ReactElement<any>, {\n                    isSessionRunning: isSessionRunningOrConnecting,\n                    statusFilter,\n                    searchQuery,\n                  })\n                : children}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Stop Confirmation Dialog */}\n      <AlertDialog open={showStopConfirm} onOpenChange={setShowStopConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.stop_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.stop_desc\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleStop}>\n              {t(\"dialog.stop_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Rescan Confirmation Dialog - NO DOWNGRADE LOGIC */}\n      <AlertDialog open={showRescanConfirm} onOpenChange={setShowRescanConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.rescan_title\")}</AlertDialogTitle>\n          </AlertDialogHeader>\n          <div className=\"space-y-3 text-sm text-muted-foreground px-6 pb-4\">\n            <p>\n              <strong>{t(\"dialog.rescan_note\")}:</strong> {t(\"dialog.rescan_logic\")}\n            </p>\n            <ul className=\"list-disc pl-5 space-y-1\">\n              <li>\n                <strong>{t(\"dialog.rescan_case1_label\")}:</strong> {t(\"dialog.rescan_case1\")}\n              </li>\n              <li>\n                <strong>{t(\"dialog.rescan_case2_label\")}:</strong> {t(\"dialog.rescan_case2\")}\n              </li>\n              <li>\n                <strong>{t(\"dialog.rescan_case3_label\")}:</strong> {t(\"dialog.rescan_case3\")}\n              </li>\n              <li>\n                <strong>{t(\"dialog.rescan_case4_label\")}:</strong> {t(\"dialog.rescan_case4\")}\n              </li>\n            </ul>\n            <p className=\"text-sm\">\n              {t(\"dialog.rescan_hint\")}\n            </p>\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleRescan}\n              className=\"bg-amber-600 hover:bg-amber-700\"\n            >\n              {t(\"dialog.rescan_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Submit Dialog with NOT_YET Resolution (when there are NOT_YET students) */}\n      <Dialog open={showSubmitDialog} onOpenChange={setShowSubmitDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"dialog.submit_title\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"dialog.submit_desc\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <RadioGroup\n              value={notYetResolution}\n              onValueChange={(value) =>\n                setNotYetResolution(\n                  value as \"MARK_AS_ABSENT\" | \"MARK_AS_PRESENT\" | \"KEEP_NOT_YET\"\n                )\n              }\n            >\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"MARK_AS_ABSENT\" id=\"absent\" />\n                <Label htmlFor=\"absent\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_absent\")}\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2 mt-3\">\n                <RadioGroupItem value=\"MARK_AS_PRESENT\" id=\"present\" />\n                <Label htmlFor=\"present\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_present\")}\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2 mt-3\">\n                <RadioGroupItem value=\"KEEP_NOT_YET\" id=\"keep\" />\n                <Label htmlFor=\"keep\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_keep\")}\n                </Label>\n              </div>\n            </RadioGroup>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowSubmitDialog(false)}\n            >\n              {t(\"dialog.cancel\")}\n            </Button>\n            <Button onClick={handleSubmitWithResolution} disabled={isMutating}>\n              {isMutating ? t(\"dialog.submitting\") : t(\"dialog.submit_action\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Submit Confirmation Dialog (when all students have been marked) */}\n      <AlertDialog open={showSubmitConfirm} onOpenChange={setShowSubmitConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.confirm_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.confirm_desc\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleSubmitConfirmed}>\n              {t(\"dialog.submit_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Review Warning Dialog (when there are records needing review) */}\n      <AlertDialog open={showReviewWarning} onOpenChange={setShowReviewWarning}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.review_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.review_desc\", { count: recordsNeedingReview.length })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setShowReviewWarning(false)}>\n              {t(\"dialog.review_again\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                setShowReviewWarning(false);\n                proceedToSubmit();\n              }}\n            >\n              {t(\"dialog.continue_submit\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\finalize-slot-dialog.tsx",
      "relative_path": "components/admin/slots/finalize-slot-dialog.tsx",
      "filename": "finalize-slot-dialog.tsx",
      "size_bytes": 5160,
      "lines": 156,
      "last_modified": "2025-11-01T15:38:43.302864",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { AlertTriangle, Loader2 } from \"lucide-react\";\nimport type { Slot } from \"@/types\";\n\ninterface FinalizeSlotDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  slot: Slot | null;\n  notYetCount: number;\n  onSubmit: (data: {\n    notYetStatusResolution: \"MARK_AS_PRESENT\" | \"MARK_AS_ABSENT\";\n  }) => Promise<void>;\n}\n\nexport function FinalizeSlotDialog({\n  open,\n  onOpenChange,\n  slot,\n  notYetCount,\n  onSubmit,\n}: FinalizeSlotDialogProps) {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [notYetStatusResolution, setNotYetStatusResolution] = useState<\n    \"MARK_AS_PRESENT\" | \"MARK_AS_ABSENT\"\n  >(\"MARK_AS_ABSENT\");\n\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    try {\n      await onSubmit({ notYetStatusResolution });\n      onOpenChange(false);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!slot) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Finalize Slot</DialogTitle>\n          <DialogDescription>\n            Finalize attendance for this slot. This action cannot be undone.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Warning */}\n          <div className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-4 flex items-start gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-destructive mt-0.5\" />\n            <div className=\"space-y-1\">\n              <p className=\"text-sm font-medium\">Warning</p>\n              <p className=\"text-sm text-muted-foreground\">\n                This action cannot be undone. All attendance records will be\n                locked.\n              </p>\n            </div>\n          </div>\n\n          {/* Not Yet Count */}\n          {notYetCount > 0 && (\n            <div className=\"rounded-lg border p-4 space-y-2\">\n              <p className=\"text-sm font-medium\">\n                Students with &quot;Not Yet&quot; status:{\" \"}\n                <span className=\"text-lg font-bold\">{notYetCount}</span>\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                Choose how to handle these students:\n              </p>\n            </div>\n          )}\n\n          {/* Note for LECTURE_WITH_PT */}\n          {slot.slotCategory === \"LECTURE_WITH_PT\" && (\n            <div className=\"rounded-lg border p-4\">\n              <p className=\"text-sm\">\n                <strong>Note:</strong> For LECTURE_WITH_PT slots, this will\n                apply to both regular and exam attendance.\n              </p>\n            </div>\n          )}\n\n          {/* Resolution Options */}\n          <div className=\"space-y-3\">\n            <Label>Resolution for &quot;Not Yet&quot; students</Label>\n            <div className=\"space-y-2\">\n              <label className=\"flex items-center space-x-2 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"notYetStatusResolution\"\n                  value=\"MARK_AS_PRESENT\"\n                  checked={notYetStatusResolution === \"MARK_AS_PRESENT\"}\n                  onChange={(e) =>\n                    setNotYetStatusResolution(\n                      e.target.value as \"MARK_AS_PRESENT\"\n                    )\n                  }\n                  className=\"h-4 w-4\"\n                />\n                <span className=\"text-sm\">Mark as Present</span>\n              </label>\n              <label className=\"flex items-center space-x-2 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"notYetStatusResolution\"\n                  value=\"MARK_AS_ABSENT\"\n                  checked={notYetStatusResolution === \"MARK_AS_ABSENT\"}\n                  onChange={(e) =>\n                    setNotYetStatusResolution(\n                      e.target.value as \"MARK_AS_ABSENT\"\n                    )\n                  }\n                  className=\"h-4 w-4\"\n                />\n                <span className=\"text-sm\">Mark as Absent</span>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isSubmitting}\n          >\n            Cancel\n          </Button>\n          <Button\n            variant=\"destructive\"\n            onClick={handleSubmit}\n            disabled={isSubmitting}\n          >\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Finalize Slot\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\roster-filters.tsx",
      "relative_path": "components/admin/slots/roster-filters.tsx",
      "filename": "roster-filters.tsx",
      "size_bytes": 4383,
      "lines": 129,
      "last_modified": "2025-11-24T14:22:41.054763",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Search } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { SlotRosterItem, AttendanceType } from \"@/types\";\n\nexport type StatusFilter = \"all\" | \"present\" | \"absent\" | \"not_yet\" | \"need_review\";\n\ninterface RosterFiltersProps {\n  statusFilter: StatusFilter;\n  onStatusFilterChange: (filter: StatusFilter) => void;\n  searchQuery: string;\n  onSearchQueryChange: (query: string) => void;\n  attendanceType: AttendanceType;\n  data: SlotRosterItem[]; // For calculating counts\n}\n\nexport function RosterFilters({\n  statusFilter,\n  onStatusFilterChange,\n  searchQuery,\n  onSearchQueryChange,\n  attendanceType,\n  data,\n}: RosterFiltersProps) {\n  const t = useTranslations(\"roster.filters\");\n  // Debounced search\n  const [localSearchQuery, setLocalSearchQuery] = useState(searchQuery);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      onSearchQueryChange(localSearchQuery);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [localSearchQuery, onSearchQueryChange]);\n\n  // Calculate counts for each status\n  const counts = {\n    all: data.length,\n    present: 0,\n    absent: 0,\n    not_yet: 0,\n    need_review: 0,\n  };\n\n  data.forEach((item) => {\n    const attendance =\n      attendanceType === \"EXAM\" ? item.examAttendance : item.regularAttendance;\n\n    if (!attendance) {\n      counts.not_yet++;\n      return;\n    }\n\n    if (attendance.needsReview) {\n      counts.need_review++;\n    }\n\n    if (attendance.status === \"present\") {\n      counts.present++;\n    } else if (attendance.status === \"absent\") {\n      counts.absent++;\n    } else {\n      counts.not_yet++;\n    }\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Status Filter Tabs */}\n      <div>\n        <label className=\"text-sm font-medium mb-2 block\">{t(\"status_label\")}</label>\n        <Tabs value={statusFilter} onValueChange={(v) => onStatusFilterChange(v as StatusFilter)}>\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"all\" className=\"text-xs text-blue-600\">\n              {t(\"all\")}\n              <Badge variant=\"secondary\" className=\"ml-1.5 text-xs bg-blue-100 text-blue-700 hover:bg-blue-100\">\n                {counts.all}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"present\" className=\"text-xs text-green-600\">\n              {t(\"present\")}\n              <Badge variant=\"secondary\" className=\"ml-1.5 text-xs bg-green-100 text-green-700 hover:bg-green-100\">\n                {counts.present}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"absent\" className=\"text-xs text-red-600\">\n              {t(\"absent\")}\n              <Badge variant=\"secondary\" className=\"ml-1.5 text-xs bg-red-100 text-red-700 hover:bg-red-100\">\n                {counts.absent}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"not_yet\" className=\"text-xs text-gray-600\">\n              {t(\"not_yet\")}\n              <Badge variant=\"secondary\" className=\"ml-1.5 text-xs bg-gray-200 text-gray-700 hover:bg-gray-200\">\n                {counts.not_yet}\n              </Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"need_review\" className=\"text-xs text-amber-600\">\n              {t(\"review\")}\n              <Badge variant=\"secondary\" className=\"ml-1.5 text-xs bg-amber-100 text-amber-700 hover:bg-amber-100\">\n                {counts.need_review}\n              </Badge>\n            </TabsTrigger>\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {/* Search Input */}\n      <div>\n        <label className=\"text-sm font-medium mb-2 block\">{t(\"search_label\")}</label>\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n          <Input\n            placeholder={t(\"search_placeholder\")}\n            value={localSearchQuery}\n            onChange={(e) => setLocalSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\session-controls.tsx",
      "relative_path": "components/admin/slots/session-controls.tsx",
      "filename": "session-controls.tsx",
      "size_bytes": 23873,
      "lines": 656,
      "last_modified": "2025-11-24T14:28:25.412111",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, cloneElement, isValidElement } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Play, Square, RotateCcw, Lock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { RosterFilters, type StatusFilter } from \"./roster-filters\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  useStartSession,\n  useStopSession,\n  useRescanSession,\n} from \"@/hooks/api/useSlotSession\";\nimport { useSubmitAttendance } from \"@/hooks/api/useSubmitAttendance\";\nimport { useSessionState } from \"@/hooks/useSessionState\";\nimport { getSlotTimeRangeStatus } from \"@/lib/utils\";\nimport type { Slot, SlotRosterItem } from \"@/types\";\nimport type { PendingChange } from \"./slot-roster-table\";\n\ninterface SessionControlsProps {\n  slot: Slot;\n  roster: SlotRosterItem[];\n  pendingChanges: Map<string, PendingChange>;\n  onSubmitSuccess: () => void;\n  userRole?: string;\n  children?: React.ReactNode;\n  statusFilter?: StatusFilter;\n  onStatusFilterChange?: (filter: StatusFilter) => void;\n  searchQuery?: string;\n  onSearchQueryChange?: (query: string) => void;\n}\n\n/**\n * Session control buttons for slot attendance.\n *\n * Features:\n * - Start/Stop/Rescan buttons with proper state management\n * - WebSocket connection status indicator\n * - Session info display (cameras, students, status)\n * - Confirmation dialogs for destructive actions\n * - Disabled states based on slot finalization and session status\n *\n * Usage:\n * ```tsx\n * <SessionControls\n *   slot={slot}\n *   isConnected={isWebSocketConnected}\n *   isConnecting={isWebSocketConnecting}\n * />\n * ```\n */\nexport function SessionControls({\n  slot,\n  roster,\n  pendingChanges,\n  onSubmitSuccess,\n  userRole,\n  children,\n  statusFilter,\n  onStatusFilterChange,\n  searchQuery,\n  onSearchQueryChange,\n}: SessionControlsProps) {\n  const t = useTranslations(\"roster.session\");\n  const [showRescanConfirm, setShowRescanConfirm] = useState(false);\n  const [showStopConfirm, setShowStopConfirm] = useState(false);\n  const [showSubmitDialog, setShowSubmitDialog] = useState(false);\n  const [showSubmitConfirm, setShowSubmitConfirm] = useState(false);\n  const [showReviewWarning, setShowReviewWarning] = useState(false);\n  const [recordsNeedingReview, setRecordsNeedingReview] = useState<\n    SlotRosterItem[]\n  >([]);\n  const [notYetResolution, setNotYetResolution] = useState<\n    \"MARK_AS_ABSENT\" | \"MARK_AS_PRESENT\" | \"KEEP_NOT_YET\"\n  >(\"MARK_AS_ABSENT\");\n\n  const startSessionMutation = useStartSession();\n  const stopSessionMutation = useStopSession();\n  const rescanSessionMutation = useRescanSession();\n  const submitAttendance = useSubmitAttendance(slot.id);\n\n  // Get session state from slot data (backend is source of truth)\n  const {\n    sessionStatus,\n    scanCount,\n    canStart: canStartFromHook,\n    canStop,\n    canRescan: canRescanFromHook,\n    isRunning,\n  } = useSessionState(slot);\n\n  // Determine mutation state\n  const isMutating =\n    startSessionMutation.isPending ||\n    stopSessionMutation.isPending ||\n    rescanSessionMutation.isPending ||\n    submitAttendance.isPending;\n\n  // Compute session running state including pending connections\n  // Disable editing when session is RUNNING OR when starting/rescanning (connecting to cameras)\n  const isSessionRunningOrConnecting =\n    isRunning ||\n    startSessionMutation.isPending ||\n    rescanSessionMutation.isPending;\n\n  const timeRangeStatus = getSlotTimeRangeStatus(slot);\n\n  const canStart = canStartFromHook;\n  const canRescan = canRescanFromHook;\n\n  const handleStart = async () => {\n    await startSessionMutation.mutateAsync(slot.id);\n    // Backend updates sessionStatus, React Query refetch will update UI\n  };\n\n  const handleStop = async () => {\n    setShowStopConfirm(false);\n    await stopSessionMutation.mutateAsync(slot.id);\n    // Backend updates sessionStatus, React Query refetch will update UI\n  };\n\n  const handleRescan = async () => {\n    setShowRescanConfirm(false);\n    await rescanSessionMutation.mutateAsync(slot.id);\n    // Backend updates sessionStatus, React Query refetch will update UI\n  };\n\n  // Check if there are any NOT_YET students\n  const hasNotYetStudents = roster.some((item) => {\n    const attendance =\n      (slot.slotCategory === \"LECTURE_WITH_PT\" ||\n        slot.slotCategory === \"FINAL_EXAM\") &&\n      item.examAttendance\n        ? item.examAttendance\n        : item.regularAttendance;\n    return !attendance || attendance.status === \"not_yet\";\n  });\n\n  const handleSubmitClick = () => {\n    // Check for records needing review\n    const recordsNeedReview = roster.filter((item) => {\n      const attendance =\n        (slot.slotCategory === \"LECTURE_WITH_PT\" ||\n          slot.slotCategory === \"FINAL_EXAM\") &&\n        item.examAttendance\n          ? item.examAttendance\n          : item.regularAttendance;\n      return attendance?.needsReview === true;\n    });\n\n    if (recordsNeedReview.length > 0) {\n      // Show review warning dialog instead of window.confirm\n      setRecordsNeedingReview(recordsNeedReview);\n      setShowReviewWarning(true);\n      return;\n    }\n\n    // No records need review, proceed to next step\n    proceedToSubmit();\n  };\n\n  const proceedToSubmit = () => {\n    if (hasNotYetStudents) {\n      // Show dialog with RadioGroup for batch resolution\n      setShowSubmitDialog(true);\n    } else {\n      // Show simple confirmation dialog\n      setShowSubmitConfirm(true);\n    }\n  };\n\n  const handleSubmitWithResolution = async () => {\n    setShowSubmitDialog(false);\n\n    // Build submissions:\n    // 1) From pending changes (map recordId -> studentUserId)\n    const recordIdToStudentUserId = new Map<number, number>();\n    roster.forEach((item) => {\n      if (item.regularAttendance) {\n        recordIdToStudentUserId.set(\n          item.regularAttendance.recordId,\n          item.student.userId\n        );\n      }\n      if (item.examAttendance) {\n        recordIdToStudentUserId.set(\n          item.examAttendance.recordId,\n          item.student.userId\n        );\n      }\n    });\n\n    const submissionsFromChanges = Array.from(pendingChanges.entries())\n      .filter(([key]) => key.startsWith(\"REGULAR-\")) // Only process REGULAR attendance\n      .map(([key, change]) => {\n        const recordId = parseInt(key.split(\"-\")[1]); // Extract recordId from \"REGULAR-123\"\n        const studentUserId = recordIdToStudentUserId.get(recordId);\n        if (!studentUserId) return null;\n        return {\n          studentUserId,\n          status: change.status,\n          remark: change.remark,\n        } as const;\n      })\n      .filter(Boolean) as {\n      studentUserId: number;\n      status: \"present\" | \"absent\" | \"not_yet\";\n      remark?: string;\n    }[];\n\n    // Create Set of studentUserIds with pending changes to avoid duplicates\n    const studentUserIdsWithChanges = new Set(\n      submissionsFromChanges.map((s) => s.studentUserId)\n    );\n\n    // 2) Add NOT_YET students per resolution (exclude those with pending changes)\n    // If KEEP_NOT_YET, skip adding NOT_YET students to submission (keep them as NOT_YET)\n    const submissionsFromNotYet =\n      notYetResolution === \"KEEP_NOT_YET\"\n        ? []\n        : roster\n            .filter((item) => {\n              // Exclude students who already have pending changes\n              if (studentUserIdsWithChanges.has(item.student.userId)) {\n                return false;\n              }\n\n              const att =\n                (slot.slotCategory === \"LECTURE_WITH_PT\" ||\n                  slot.slotCategory === \"FINAL_EXAM\") &&\n                item.examAttendance\n                  ? item.examAttendance\n                  : item.regularAttendance;\n              return !att || att.status === \"not_yet\";\n            })\n            .map((item) => ({\n              studentUserId: item.student.userId,\n              status: (notYetResolution === \"MARK_AS_ABSENT\"\n                ? \"absent\"\n                : \"present\") as \"absent\" | \"present\",\n            }));\n\n    const submissions = [...submissionsFromChanges, ...submissionsFromNotYet];\n\n    try {\n      await submitAttendance.mutateAsync({\n        attendanceType: \"REGULAR\",\n        submissions,\n      });\n      onSubmitSuccess();\n    } catch {\n      // Error handling done in mutation hook\n    }\n  };\n\n  const handleSubmitConfirmed = async () => {\n    setShowSubmitConfirm(false);\n\n    // Build submissions from pending changes (no NOT_YET resolution needed)\n    const recordIdToStudentUserId = new Map<number, number>();\n    roster.forEach((item) => {\n      if (item.regularAttendance) {\n        recordIdToStudentUserId.set(\n          item.regularAttendance.recordId,\n          item.student.userId\n        );\n      }\n      if (item.examAttendance) {\n        recordIdToStudentUserId.set(\n          item.examAttendance.recordId,\n          item.student.userId\n        );\n      }\n    });\n\n    const submissions = Array.from(pendingChanges.entries())\n      .filter(([key]) => key.startsWith(\"REGULAR-\")) // Only process REGULAR attendance\n      .map(([key, change]) => {\n        const recordId = parseInt(key.split(\"-\")[1]); // Extract recordId from \"REGULAR-123\"\n        const studentUserId = recordIdToStudentUserId.get(recordId);\n        if (!studentUserId) return null;\n        return {\n          studentUserId,\n          status: change.status,\n          remark: change.remark,\n        } as const;\n      })\n      .filter(Boolean) as {\n      studentUserId: number;\n      status: \"present\" | \"absent\" | \"not_yet\";\n      remark?: string;\n    }[];\n\n    try {\n      await submitAttendance.mutateAsync({\n        attendanceType: \"REGULAR\",\n        submissions,\n      });\n      onSubmitSuccess();\n    } catch {\n      // Error handling done in mutation hook\n    }\n  };\n\n  return (\n    <>\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n            {/* Action Buttons */}\n            <div\n              className={`flex items-center gap-2 ${\n                userRole === \"DATA_OPERATOR\" ? \"ml-auto\" : \"\"\n              }`}\n            >\n              {/* Hide Start/Stop/Rescan buttons for DATA_OPERATOR */}\n              {userRole !== \"DATA_OPERATOR\" && (\n                <TooltipProvider>\n                  {/* Start Button */}\n                  {sessionStatus === \"NOT_STARTED\" && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <span>\n                          <Button\n                            onClick={handleStart}\n                            disabled={isMutating || !canStart}\n                            size=\"sm\"\n                            className=\"gap-2\"\n                          >\n                            <Play className=\"h-4 w-4\" />\n                            {t(\"button.start\")}\n                          </Button>\n                        </span>\n                      </TooltipTrigger>\n                      {!canStart && (\n                        <TooltipContent>\n                          <p>\n                            {timeRangeStatus === \"before_start\"\n                              ? t(\"tooltip.before_start\")\n                              : timeRangeStatus === \"expired\"\n                              ? t(\"tooltip.expired\")\n                              : t(\"tooltip.ended\")}\n                          </p>\n                        </TooltipContent>\n                      )}\n                    </Tooltip>\n                  )}\n\n                  {/* Stop Button */}\n                  {canStop && (\n                    <Button\n                      onClick={() => setShowStopConfirm(true)}\n                      disabled={isMutating}\n                      variant=\"destructive\"\n                      size=\"sm\"\n                      className=\"gap-2\"\n                    >\n                      <Square className=\"h-4 w-4\" />\n                      {t(\"button.stop\")}\n                    </Button>\n                  )}\n\n                  {/* Rescan Button */}\n                  {sessionStatus === \"STOPPED\" && scanCount >= 1 && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <span>\n                          <Button\n                            onClick={() => setShowRescanConfirm(true)}\n                            disabled={isMutating || !canRescan}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-2\"\n                          >\n                            <RotateCcw className=\"h-4 w-4\" />\n                            {t(\"button.rescan\")}\n                          </Button>\n                        </span>\n                      </TooltipTrigger>\n                      {!canRescan && (\n                        <TooltipContent>\n                          <p>\n                            {timeRangeStatus === \"before_start\"\n                              ? t(\"tooltip.rescan_before_start\")\n                              : timeRangeStatus === \"expired\"\n                              ? t(\"tooltip.expired\")\n                              : t(\"tooltip.rescan_ended\")}\n                          </p>\n                        </TooltipContent>\n                      )}\n                    </Tooltip>\n                  )}\n                </TooltipProvider>\n              )}\n\n              {!isRunning && (\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <span>\n                        <Button\n                          onClick={handleSubmitClick}\n                          disabled={\n                            isMutating ||\n                            (pendingChanges.size === 0 && !hasNotYetStudents) ||\n                            (userRole !== \"DATA_OPERATOR\" &&\n                              timeRangeStatus === \"expired\") ||\n                            (userRole !== \"DATA_OPERATOR\" &&\n                              timeRangeStatus === \"before_start\") ||\n                            (userRole === \"DATA_OPERATOR\" &&\n                              timeRangeStatus !== \"expired\")\n                          }\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"gap-2\"\n                        >\n                          <Lock className=\"h-4 w-4\" />\n                          {t(\"button.submit\")} ({pendingChanges.size})\n                        </Button>\n                      </span>\n                    </TooltipTrigger>\n                    {userRole === \"DATA_OPERATOR\" &&\n                      timeRangeStatus !== \"expired\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.data_operator_not_yet\")}</p>\n                        </TooltipContent>\n                      )}\n                    {userRole !== \"DATA_OPERATOR\" &&\n                      timeRangeStatus === \"before_start\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.submit_before_start\")}</p>\n                        </TooltipContent>\n                      )}\n                    {userRole !== \"DATA_OPERATOR\" &&\n                      timeRangeStatus === \"expired\" && (\n                        <TooltipContent>\n                          <p>{t(\"tooltip.submit_expired\")}</p>\n                        </TooltipContent>\n                      )}\n                  </Tooltip>\n                </TooltipProvider>\n              )}\n            </div>\n          </div>\n\n          {/* Roster Filters */}\n          {statusFilter !== undefined &&\n            onStatusFilterChange &&\n            onSearchQueryChange && (\n              <>\n                <Separator className=\"my-4\" />\n                <RosterFilters\n                  statusFilter={statusFilter}\n                  onStatusFilterChange={onStatusFilterChange}\n                  searchQuery={searchQuery || \"\"}\n                  onSearchQueryChange={onSearchQueryChange}\n                  attendanceType=\"REGULAR\"\n                  data={roster}\n                />\n              </>\n            )}\n\n          {/* Roster Table */}\n          {children && (\n            <div className=\"mt-6\">\n              {isValidElement(children)\n                ? cloneElement(children as React.ReactElement<any>, {\n                    isSessionRunning: isSessionRunningOrConnecting,\n                    statusFilter,\n                    searchQuery,\n                  })\n                : children}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Stop Confirmation Dialog */}\n      <AlertDialog open={showStopConfirm} onOpenChange={setShowStopConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.stop_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.stop_desc\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleStop}>\n              {t(\"dialog.stop_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Rescan Confirmation Dialog */}\n      <AlertDialog open={showRescanConfirm} onOpenChange={setShowRescanConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.rescan_title\")}</AlertDialogTitle>\n          </AlertDialogHeader>\n          <div className=\"space-y-3 text-sm text-muted-foreground px-6 pb-4\">\n            <p>\n              <strong>{t(\"dialog.rescan_note\")}:</strong> {t(\"dialog.rescan_logic\")}\n            </p>\n            <ul className=\"list-disc pl-5 space-y-1\">\n              <li>\n                <strong>{t(\"dialog.rescan_case1_label\")}:</strong> {t(\"dialog.rescan_case1\")}\n              </li>\n              <li>\n                <strong>{t(\"dialog.rescan_case2_label\")}:</strong> {t(\"dialog.rescan_case2\")}\n              </li>\n              <li>\n                <strong>{t(\"dialog.rescan_case3_label\")}:</strong> {t(\"dialog.rescan_case3\")}\n              </li>\n            </ul>\n            <p className=\"text-sm\">\n              {t(\"dialog.rescan_hint\")}\n            </p>\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleRescan}\n              className=\"bg-amber-600 hover:bg-amber-700\"\n            >\n              {t(\"dialog.rescan_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Submit Dialog with NOT_YET Resolution (when there are NOT_YET students) */}\n      <Dialog open={showSubmitDialog} onOpenChange={setShowSubmitDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"dialog.submit_title\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"dialog.submit_desc\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <RadioGroup\n              value={notYetResolution}\n              onValueChange={(value) =>\n                setNotYetResolution(\n                  value as \"MARK_AS_ABSENT\" | \"MARK_AS_PRESENT\" | \"KEEP_NOT_YET\"\n                )\n              }\n            >\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"MARK_AS_ABSENT\" id=\"absent\" />\n                <Label htmlFor=\"absent\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_absent\")}\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2 mt-3\">\n                <RadioGroupItem value=\"MARK_AS_PRESENT\" id=\"present\" />\n                <Label htmlFor=\"present\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_present\")}\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2 mt-3\">\n                <RadioGroupItem value=\"KEEP_NOT_YET\" id=\"keep\" />\n                <Label htmlFor=\"keep\" className=\"cursor-pointer\">\n                  {t(\"dialog.resolution_keep\")}\n                </Label>\n              </div>\n            </RadioGroup>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowSubmitDialog(false)}\n            >\n              {t(\"dialog.cancel\")}\n            </Button>\n            <Button onClick={handleSubmitWithResolution} disabled={isMutating}>\n              {isMutating ? t(\"dialog.submitting\") : t(\"dialog.submit_action\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Submit Confirmation Dialog (when all students have been marked) */}\n      <AlertDialog open={showSubmitConfirm} onOpenChange={setShowSubmitConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.confirm_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.confirm_desc\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"dialog.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleSubmitConfirmed}>\n              {t(\"dialog.submit_action\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Review Warning Dialog (when there are records needing review) */}\n      <AlertDialog open={showReviewWarning} onOpenChange={setShowReviewWarning}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"dialog.review_title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"dialog.review_desc\", { count: recordsNeedingReview.length })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setShowReviewWarning(false)}>\n              {t(\"dialog.review_again\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                setShowReviewWarning(false);\n                proceedToSubmit();\n              }}\n            >\n              {t(\"dialog.continue_submit\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\slot-columns.tsx",
      "relative_path": "components/admin/slots/slot-columns.tsx",
      "filename": "slot-columns.tsx",
      "size_bytes": 12210,
      "lines": 355,
      "last_modified": "2025-11-24T16:01:14.187887",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Calendar, Eye, MoreHorizontal, Pencil, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Slot } from \"@/types\";\nimport { canDeleteSlot, formatSlotTime } from \"@/lib/utils\";\n\nexport const createSlotColumns = (\n  onEdit: (slot: Slot) => void,\n  onViewRoster: (slot: Slot) => void,\n  onViewClass: (classCode: string) => void,\n  onDelete: (slot: Slot) => void,\n  onRoomClick: (roomName: string) => void,\n  onSubjectClick: (subjectCode: string) => void,\n  t: (key: string) => string,\n  tCommon: (key: string) => string\n): ColumnDef<Slot>[] => [\n  {\n    id: \"class\",\n    header: () => <div className=\"text-center\">{t(\"table.header.class\")}</div>,\n    cell: ({ row }) => {\n      const classData = row.original.class;\n      if (!classData) {\n        return (\n          <div className=\"flex justify-center\">\n            <Badge variant=\"outline\" className=\"text-xs\">\n              Independent Exam\n            </Badge>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80\"\n                  onClick={() => onViewClass(classData.code)}\n                >\n                  {classData.code}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"font-semibold\">{classData.subject.name}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {classData.subject.code} - {classData.semester.name}\n                </p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"subject\",\n    header: () => <div className=\"text-center\">{t(\"table.header.subject\")}</div>,\n    cell: ({ row }) => {\n      const classData = row.original.class;\n\n      // For slots without class (e.g., FINAL_EXAM), show \"N/A\"\n      if (!classData) {\n        return (\n          <div className=\"flex justify-center\">\n            <Badge variant=\"outline\" className=\"text-xs\">\n              N/A\n            </Badge>\n          </div>\n        );\n      }\n\n      const subject = classData.subject;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80\"\n                  onClick={() => onSubjectClick(subject.code)}\n                >\n                  {subject.code}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <p>{subject.name}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"slotCategory\",\n    header: () => <div className=\"text-center\">{t(\"sort.category\")}</div>,\n    cell: ({ row }) => {\n      const category = row.getValue(\"slotCategory\") as string;\n      const displayText = category.replace(/_/g, \" \");\n      return (\n        <div className=\"flex justify-center\">\n          <Badge variant=\"outline\" className=\"text-xs whitespace-nowrap\">\n            {displayText}\n          </Badge>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"room\",\n    header: () => <div className=\"text-center\">{t(\"table.header.room\")}</div>,\n    cell: ({ row }) => {\n      const room = row.original.room;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs cursor-pointer hover:opacity-80 min-w-[100px] justify-center\"\n                  onClick={() => onRoomClick(room.name)}\n                >\n                  <span className=\"truncate\">{room.name}</span>\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">\n                <div className=\"space-y-1\">\n                  <p className=\"font-medium\">{room.name}</p>\n                  {room.location && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      {room.location}\n                    </p>\n                  )}\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"staff\",\n    header: () => <div className=\"text-center\">{t(\"table.header.staff\")}</div>,\n    cell: ({ row }) => {\n      const staff = row.original.staffUser;\n\n      if (!staff) {\n        return (\n          <div className=\"flex justify-center\">\n            <div className=\"text-center text-muted-foreground\">N/A</div>\n          </div>\n        );\n      }\n\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div className=\"text-center cursor-help max-w-[150px] truncate\">\n                  {staff.fullName}\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"font-semibold\">{staff.fullName}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  @{staff.username}\n                </p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"time\",\n    header: () => <div className=\"text-center\">{t(\"table.header.time\")}</div>,\n    cell: ({ row }) => {\n      const { startTime, endTime } = row.original;\n      return (\n        <div className=\"text-center text-sm text-muted-foreground whitespace-nowrap\">\n          {formatSlotTime(startTime, endTime)}\n        </div>\n      );\n    },\n  },\n  {\n    id: \"stats\",\n    header: () => <div className=\"text-center\">{t(\"table.header.students\")}</div>,\n    cell: ({ row }) => {\n      const original = row.original as any;\n      const {\n        totalStudent,\n        totalEnrolledStudent,\n        totalPresentStudent,\n        totalAbsentStudent,\n        totalNotYetStudent,\n      } = original;\n      // Use totalEnrolledStudent (excludes withdrawn) with fallback to totalStudent\n      const displayTotal = totalEnrolledStudent ?? totalStudent;\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div className=\"text-center text-sm cursor-help\">\n                  <span className=\"text-green-600 font-medium\">\n                    {totalPresentStudent}\n                  </span>\n                  <span className=\"text-muted-foreground mx-1\">/</span>\n                  <span className=\"text-red-600 font-medium\">\n                    {totalAbsentStudent}\n                  </span>\n                  <span className=\"text-muted-foreground mx-1\">/</span>\n                  <span className=\"text-yellow-600 font-medium\">\n                    {totalNotYetStudent}\n                  </span>\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs\">\n                    <span className=\"text-green-600\">â—</span> {tCommon(\"present\")}:{\" \"}\n                    {totalPresentStudent}\n                  </p>\n                  <p className=\"text-xs\">\n                    <span className=\"text-red-600\">â—</span> {tCommon(\"absent\")}:{\" \"}\n                    {totalAbsentStudent}\n                  </p>\n                  <p className=\"text-xs\">\n                    <span className=\"text-yellow-600\">â—</span> {tCommon(\"not_yet\")}:{\" \"}\n                    {totalNotYetStudent}\n                  </p>\n                  <p className=\"text-xs font-semibold border-t pt-1\">\n                    Total: {displayTotal}\n                  </p>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"isActive\",\n    header: () => <div className=\"text-center\">{t(\"table.header.status\")}</div>,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return (\n        <div className=\"flex justify-center\">\n          <Badge\n            variant={isActive ? \"default\" : \"destructive\"}\n            className=\"w-[70px] justify-center text-xs\"\n          >\n            {isActive ? \"Active\" : \"Inactive\"}\n          </Badge>\n        </div>\n      );\n    },\n  },\n  {\n    id: \"action\",\n    header: () => <div className=\"text-center\">{t(\"table.header.action\")}</div>,\n    cell: ({ row }) => {\n      const slot = row.original;\n      const canDelete = canDeleteSlot(slot);\n\n      return (\n        <div className=\"flex justify-center\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuLabel>\n                {tCommon(\"actions\")}\n              </DropdownMenuLabel>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => onEdit(slot)}>\n                <Pencil className=\"mr-2 h-4 w-4\" />\n                {tCommon(\"edit\")}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onViewRoster(slot)}>\n                <Eye className=\"mr-2 h-4 w-4\" />\n                {tCommon(\"view_roster\")}\n              </DropdownMenuItem>\n              {slot.class && (\n                <DropdownMenuItem onClick={() => onViewClass(slot.class!.code)}>\n                  <Calendar className=\"mr-2 h-4 w-4\" />\n                  {tCommon(\"view_class\")}\n                </DropdownMenuItem>\n              )}\n              <DropdownMenuSeparator />\n              {canDelete ? (\n                <DropdownMenuItem\n                  onClick={() => onDelete(slot)}\n                  className=\"text-destructive focus:text-destructive\"\n                >\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\n                  {tCommon(\"delete\")}\n                </DropdownMenuItem>\n              ) : (\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <div className=\"w-full\">\n                        <DropdownMenuItem\n                          disabled\n                          className=\"text-destructive focus:text-destructive opacity-50 pointer-events-none\"\n                        >\n                          <Trash2 className=\"mr-2 h-4 w-4\" />\n                          {tCommon(\"delete\")}\n                        </DropdownMenuItem>\n                      </div>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"left\">\n                      <p className=\"text-xs\">\n                        Cannot delete: slot has already started\n                      </p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      );\n    },\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\slot-form-dialog.tsx",
      "relative_path": "components/admin/slots/slot-form-dialog.tsx",
      "filename": "slot-form-dialog.tsx",
      "size_bytes": 41840,
      "lines": 1015,
      "last_modified": "2025-11-24T15:58:48.626893",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useState, useMemo } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon, Check, ChevronsUpDown, AlertCircle } from \"lucide-react\";\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport { formatAsVietnamTime } from \"@/lib/timezone-utils\";\nimport { useCheckSlotHasAttendance } from \"@/hooks/api/useSlots\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\nimport { Slot } from \"@/types\";\nimport { FILTER_PAGE_SIZE } from \"@/lib/constants\";\nimport { useGetClasses } from \"@/hooks/api/useClasses\";\nimport { useGetRooms } from \"@/hooks/api/useRooms\";\nimport { useGetSemesters } from \"@/hooks/api/useSemesters\";\n\n// Form schema with semester field\nconst baseSlotFormSchema = z.object({\n  title: z.string().max(255, \"Title must not exceed 255 characters\").optional(),\n  description: z\n    .string()\n    .max(1000, \"Description must not exceed 1000 characters\")\n    .optional(),\n  startDate: z.date({ message: \"Start date is required\" }),\n  startTime: z.string().min(1, \"Start time is required\"),\n  endDate: z.date({ message: \"End date is required\" }),\n  endTime: z.string().min(1, \"End time is required\"),\n  slotCategory: z.enum([\"LECTURE\", \"LECTURE_WITH_PT\"], {\n    message: \"Slot category is required\",\n  }),\n  semesterId: z.number({ message: \"Semester is required\" }),\n  classId: z.number().nullable(),\n  roomId: z.number({ message: \"Room is required\" }),\n  staffUserId: z.number({ message: \"Staff is required\" }),\n  isActive: z.boolean().optional(),\n});\n\ntype SlotFormValues = z.infer<typeof baseSlotFormSchema>;\n\ninterface SlotFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  slot?: Slot;\n  onSubmit: (data: SlotFormData) => Promise<void>;\n  isSubmitting?: boolean;\n  classes?: Array<{ id: number; code: string; name: string }>;\n  rooms?: Array<{ id: number; name: string; location: string | null }>;\n  staff?: Array<{ id: number; fullName: string; username: string }>;\n  semesterId?: number;\n}\n\nexport interface SlotFormData {\n  title: string | null;\n  description: string | null;\n  startTime: string;\n  endTime: string;\n  slotCategory: \"LECTURE\" | \"LECTURE_WITH_PT\";\n  semesterId: number;\n  classId: number | null;\n  roomId: number;\n  staffUserId: number;\n  isActive?: boolean;\n}\n\n// Helper to filter out FINAL_EXAM (legacy category)\nconst normalizeCategory = (\n  category: string | undefined\n): \"LECTURE\" | \"LECTURE_WITH_PT\" => {\n  if (category === \"LECTURE_WITH_PT\") return \"LECTURE_WITH_PT\";\n  return \"LECTURE\"; // Default to LECTURE for FINAL_EXAM or undefined\n};\n\nexport function SlotFormDialog({\n  open,\n  onOpenChange,\n  slot,\n  onSubmit,\n  isSubmitting = false,\n  classes = [],\n  rooms = [],\n  staff = [],\n  semesterId,\n}: SlotFormDialogProps) {\n  const t = useTranslations(\"admin.slots.form\");\n  const isEditMode = !!slot;\n  const [semesterOpen, setSemesterOpen] = useState(false);\n  const [classOpen, setClassOpen] = useState(false);\n  const [roomOpen, setRoomOpen] = useState(false);\n  const [staffOpen, setStaffOpen] = useState(false);\n  const [classQuery, setClassQuery] = useState(\"\");\n  const [roomQuery, setRoomQuery] = useState(\"\");\n\n  // Check if slot has attendance records (PRESENT or ABSENT only, ignores NOT_YET)\n  const { data: hasAttendanceRecords = false } = useCheckSlotHasAttendance(\n    slot?.id || 0,\n    { enabled: isEditMode && !!slot?.id }\n  );\n\n  // View-only mode when slot has attendance records\n  const isViewOnly = isEditMode && hasAttendanceRecords;\n\n  const form = useForm<SlotFormValues>({\n    resolver: zodResolver(baseSlotFormSchema),\n    defaultValues: {\n      title: slot?.title || \"\",\n      description: slot?.description || \"\",\n      startDate: slot?.startTime ? new Date(slot.startTime) : undefined,\n      startTime: slot?.startTime\n        ? format(new Date(slot.startTime), \"HH:mm\")\n        : \"\",\n      endDate: slot?.endTime ? new Date(slot.endTime) : undefined,\n      endTime: slot?.endTime ? format(new Date(slot.endTime), \"HH:mm\") : \"\",\n      slotCategory: normalizeCategory(slot?.slotCategory),\n      semesterId: slot?.class?.semester?.id || semesterId,\n      classId: slot?.class?.id || null,\n      roomId: slot?.room.id,\n      staffUserId: slot?.staffUser?.id,\n      isActive: slot?.isActive ?? true,\n    },\n  });\n\n  // Watch semesterId from form to refetch classes when it changes\n  const selectedSemesterId = form.watch(\"semesterId\");\n\n  // Remote search for semesters\n  const { data: remoteSemesters } = useGetSemesters({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    sort: \"desc\",\n    isActive: true,\n  });\n\n  // Remote search for classes (filtered by selected semester, only active)\n  const { data: remoteClasses } = useGetClasses({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"code\",\n    search: classQuery || undefined,\n    semesterId: selectedSemesterId || undefined,\n    isActive: true,\n  });\n\n  const { data: remoteRooms } = useGetRooms({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"name\",\n    search: roomQuery || undefined,\n    isActive: true,\n  });\n\n  useEffect(() => {\n    if (!classOpen) setClassQuery(\"\");\n  }, [classOpen]);\n  useEffect(() => {\n    if (!roomOpen) setRoomQuery(\"\");\n  }, [roomOpen]);\n\n  // Reset classId when semester changes\n  useEffect(() => {\n    if (open && selectedSemesterId) {\n      // Only reset if we're not in edit mode OR the semester has changed\n      const currentClassSemesterId = slot?.class?.semester?.id;\n      if (\n        !isEditMode ||\n        (currentClassSemesterId &&\n          currentClassSemesterId !== selectedSemesterId)\n      ) {\n        form.setValue(\"classId\", null);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedSemesterId]);\n\n  // Merge current item in EDIT mode (in case it's inactive and not in active list)\n  // Note: Slot type doesn't include isActive on nested semester/room, so we include current item if missing\n  const semesterOptions = useMemo(() => {\n    const activeItems = (remoteSemesters?.items || []) as Array<{\n      id: number;\n      name: string;\n      code: string;\n      isActive: boolean;\n    }>;\n    if (isEditMode && slot?.class?.semester) {\n      const currentExists = activeItems.some(s => s.id === slot.class!.semester.id);\n      if (!currentExists) {\n        // Current semester not in active list - include it (might be inactive)\n        return [{ ...slot.class.semester, isActive: false } as typeof activeItems[0], ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteSemesters?.items, isEditMode, slot]);\n\n  const classOptions = useMemo(() => {\n    const activeItems = (\n      remoteClasses?.items\n        ? remoteClasses.items.map((c) => ({\n            id: c.id,\n            code: c.code,\n            name: `${c.subject.name} (${c.semester.name})`,\n            isActive: c.isActive,\n          }))\n        : classes.map(c => ({ ...c, isActive: true }))\n    ) as Array<{ id: number; code: string; name: string; isActive: boolean }>;\n    if (isEditMode && slot?.class) {\n      const currentExists = activeItems.some(c => c.id === slot.class!.id);\n      if (!currentExists) {\n        // Current class not in active list - include it (might be inactive)\n        return [{\n          id: slot.class.id,\n          code: slot.class.code,\n          name: `${slot.class.subject.name} (${slot.class.semester.name})`,\n          isActive: false,\n        }, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteClasses?.items, classes, isEditMode, slot]);\n\n  const roomOptions = useMemo(() => {\n    const activeItems = (remoteRooms?.items || rooms) as Array<{\n      id: number;\n      name: string;\n      location: string | null;\n      isActive?: boolean;\n    }>;\n    if (isEditMode && slot?.room) {\n      const currentExists = activeItems.some(r => r.id === slot.room.id);\n      if (!currentExists) {\n        // Current room not in active list - include it (might be inactive)\n        return [{ ...slot.room, isActive: false }, ...activeItems];\n      }\n    }\n    return activeItems;\n  }, [remoteRooms?.items, rooms, isEditMode, slot]);\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        title: slot?.title || \"\",\n        description: slot?.description || \"\",\n        startDate: slot?.startTime ? new Date(slot.startTime) : undefined,\n        startTime: slot?.startTime\n          ? format(new Date(slot.startTime), \"HH:mm\")\n          : \"\",\n        endDate: slot?.endTime ? new Date(slot.endTime) : undefined,\n        endTime: slot?.endTime ? format(new Date(slot.endTime), \"HH:mm\") : \"\",\n        slotCategory: normalizeCategory(slot?.slotCategory),\n        semesterId: slot?.class?.semester?.id || semesterId,\n        classId: slot?.class?.id || null,\n        roomId: slot?.room.id,\n        staffUserId: slot?.staffUser?.id,\n        isActive: slot?.isActive ?? true,\n      });\n    }\n  }, [slot, open, form, semesterId]);\n\n  // Re-validate slot dates when semester changes\n  useEffect(() => {\n    if (open && selectedSemesterId) {\n      const selectedSemester = semesterOptions.find(\n        (s) => s.id === selectedSemesterId\n      );\n\n      if (selectedSemester && (form.formState.isDirty || isEditMode)) {\n        // Trigger validation on date fields\n        form.trigger([\"startDate\", \"endDate\"]);\n      }\n    }\n  }, [selectedSemesterId, form, semesterOptions, open, isEditMode]);\n\n  const handleSubmit = async (values: SlotFormValues) => {\n    form.clearErrors();\n    try {\n      // Combine date and time (in browser's local timezone)\n      const startDateTime = new Date(values.startDate);\n      const [startHour, startMinute] = values.startTime.split(\":\");\n      startDateTime.setHours(parseInt(startHour), parseInt(startMinute), 0, 0);\n\n      const endDateTime = new Date(values.endDate);\n      const [endHour, endMinute] = values.endTime.split(\":\");\n      endDateTime.setHours(parseInt(endHour), parseInt(endMinute), 0, 0);\n\n      // CRITICAL: Backend expects timestamps in Vietnam timezone (Asia/Ho_Chi_Minh) without 'Z' suffix\n      // Convert browser's date to Vietnam timezone before formatting\n      // This ensures correct time regardless of user's browser timezone\n      // Example: User anywhere selects 15:20 â†’ converts to Vietnam 15:20 â†’ \"2025-11-03T15:20:00\"\n      const startLocal = formatAsVietnamTime(startDateTime);\n      const endLocal = formatAsVietnamTime(endDateTime);\n\n      await onSubmit({\n        title: values.title || null,\n        description: values.description || null,\n        startTime: startLocal,\n        endTime: endLocal,\n        slotCategory: values.slotCategory,\n        semesterId: values.semesterId,\n        classId: values.classId,\n        roomId: values.roomId,\n        staffUserId: values.staffUserId,\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes\n      switch (errorCode) {\n        case ERROR_CODES.INVALID_TIME_RANGE:\n          form.setError(\"endTime\", {\n            type: \"manual\",\n            message: apiMessage || \"End time must be after start time\",\n          });\n          break;\n        case ERROR_CODES.INVALID_SLOT_DURATION:\n          form.setError(\"endTime\", {\n            type: \"manual\",\n            message:\n              apiMessage ||\n              \"Slot duration must be between 30 minutes and 4 hours\",\n          });\n          break;\n        case ERROR_CODES.ROOM_TIME_CONFLICT:\n          form.setError(\"roomId\", {\n            type: \"manual\",\n            message: apiMessage || \"Room is already booked for this time\",\n          });\n          break;\n        case ERROR_CODES.STAFF_TIME_CONFLICT:\n          form.setError(\"staffUserId\", {\n            type: \"manual\",\n            message: apiMessage || \"Staff is already assigned at this time\",\n          });\n          break;\n        case ERROR_CODES.SLOT_OUTSIDE_SEMESTER_RANGE:\n          form.setError(\"startDate\", {\n            type: \"manual\",\n            message:\n              apiMessage || \"Slot time must be within semester date range\",\n          });\n          break;\n        default:\n          break;\n      }\n    }\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col gap-0 p-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full max-h-[90vh] overflow-hidden\"\n          >\n            <DialogHeader className=\"px-6 pt-6 pb-2 shrink-0\">\n              <DialogTitle>\n                {isViewOnly ? t(\"title_view\") : isEditMode ? t(\"title_edit\") : t(\"title_create\")}\n              </DialogTitle>\n              <DialogDescription>\n                {isViewOnly\n                  ? t(\"desc_view\")\n                  : isEditMode\n                  ? t(\"desc_edit\")\n                  : t(\"desc_create\")}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"grid gap-4 py-4 px-6 overflow-y-auto flex-1\">\n              {/* Warning Alert for View-Only Mode */}\n              {isViewOnly && (\n                <Alert variant=\"destructive\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertTitle>{t(\"readonly_title\")}</AlertTitle>\n                  <AlertDescription>\n                    {t(\"readonly_desc\")}\n                  </AlertDescription>\n                </Alert>\n              )}\n              {/* Title */}\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"label.title\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t(\"placeholder.title\")}\n                        {...field}\n                        maxLength={255}\n                        autoComplete=\"off\"\n                        disabled={isViewOnly}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Description */}\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"label.description\")}</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder={t(\"placeholder.description\")}\n                        {...field}\n                        maxLength={1000}\n                        rows={3}\n                        disabled={isViewOnly}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Row 1: Category + Semester (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* Slot Category */}\n                <FormField\n                  control={form.control}\n                  name=\"slotCategory\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.category\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                        disabled={isViewOnly}\n                      >\n                        <FormControl>\n                          <SelectTrigger className=\"w-full\">\n                            <SelectValue placeholder={t(\"placeholder.category\")} />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent className=\"w-[300px]\">\n                          <SelectItem value=\"LECTURE\">LECTURE</SelectItem>\n                          <SelectItem value=\"LECTURE_WITH_PT\">\n                            LECTURE WITH PT\n                          </SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Semester */}\n                <FormField\n                  control={form.control}\n                  name=\"semesterId\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.semester\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover\n                        open={semesterOpen}\n                        onOpenChange={setSemesterOpen}\n                      >\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              {field.value\n                                ? semesterOptions.find(\n                                    (s) => s.id === field.value\n                                  )\n                                  ? `${\n                                      semesterOptions.find(\n                                        (s) => s.id === field.value\n                                      )?.code\n                                    } - ${\n                                      semesterOptions.find(\n                                        (s) => s.id === field.value\n                                      )?.name\n                                    }`\n                                  : t(\"placeholder.semester\")\n                                : t(\"placeholder.semester\")}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[350px] p-0\">\n                          <Command>\n                            <CommandInput placeholder={t(\"search.semester\")} />\n                            <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                              <CommandEmpty>{t(\"empty.semester\")}</CommandEmpty>\n                              <CommandGroup>\n                                {semesterOptions.map((semester) => (\n                                  <CommandItem\n                                    key={semester.id}\n                                    value={`${semester.code}-${semester.name}`}\n                                    onSelect={() => {\n                                      form.setValue(\"semesterId\", semester.id);\n                                      setSemesterOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        semester.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    {semester.code} - {semester.name}\n                                    {!semester.isActive && (\n                                      <span className=\"ml-2 text-xs text-muted-foreground\">\n                                        ({t(\"inactive\")})\n                                      </span>\n                                    )}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Row 2: Class (full width) */}\n              <FormField\n                control={form.control}\n                name=\"classId\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col\">\n                    <FormLabel>\n                      {t(\"label.class\")} <span className=\"text-destructive\">*</span>\n                    </FormLabel>\n                    <Popover open={classOpen} onOpenChange={setClassOpen}>\n                      <PopoverTrigger asChild>\n                        <FormControl>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            disabled={!selectedSemesterId || isViewOnly}\n                            className={cn(\n                              \"justify-between\",\n                              !field.value && \"text-muted-foreground\"\n                            )}\n                          >\n                            {field.value\n                              ? classOptions.find((c) => c.id === field.value)\n                                  ?.code\n                              : !selectedSemesterId\n                              ? t(\"placeholder.select_semester_first\")\n                              : t(\"placeholder.class\")}\n                            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                          </Button>\n                        </FormControl>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-[400px] p-0\">\n                        <Command>\n                          <CommandInput\n                            placeholder={t(\"search.class\")}\n                            value={classQuery}\n                            onValueChange={setClassQuery}\n                          />\n                          <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                            <CommandEmpty>{t(\"empty.class\")}</CommandEmpty>\n                            <CommandGroup>\n                              {classOptions.map((cls) => (\n                                <CommandItem\n                                  key={cls.id}\n                                  value={cls.code}\n                                  onSelect={() => {\n                                    form.setValue(\"classId\", cls.id);\n                                    setClassOpen(false);\n                                  }}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      cls.id === field.value\n                                        ? \"opacity-100\"\n                                        : \"opacity-0\"\n                                    )}\n                                  />\n                                  {cls.code} - {cls.name}\n                                  {!cls.isActive && (\n                                    <span className=\"ml-2 text-xs text-muted-foreground\">\n                                      ({t(\"inactive\")})\n                                    </span>\n                                  )}\n                                </CommandItem>\n                              ))}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Row 3: Room + Staff (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* Room */}\n                <FormField\n                  control={form.control}\n                  name=\"roomId\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.room\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover open={roomOpen} onOpenChange={setRoomOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              {field.value\n                                ? roomOptions.find((r) => r.id === field.value)\n                                    ?.name\n                                : t(\"placeholder.room\")}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[300px] p-0\">\n                          <Command>\n                            <CommandInput\n                              placeholder={t(\"search.room\")}\n                              value={roomQuery}\n                              onValueChange={setRoomQuery}\n                            />\n                            <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                              <CommandEmpty>{t(\"empty.room\")}</CommandEmpty>\n                              <CommandGroup>\n                                {roomOptions.map((room) => (\n                                  <CommandItem\n                                    key={room.id}\n                                    value={room.name}\n                                    onSelect={() => {\n                                      form.setValue(\"roomId\", room.id);\n                                      setRoomOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        room.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    <div className=\"flex-1\">\n                                      <div className=\"flex items-center gap-2\">\n                                        {room.name}\n                                        {room.isActive === false && (\n                                          <span className=\"text-xs text-muted-foreground\">\n                                            ({t(\"inactive\")})\n                                          </span>\n                                        )}\n                                      </div>\n                                      {room.location && (\n                                        <div className=\"text-xs text-muted-foreground\">\n                                          {room.location}\n                                        </div>\n                                      )}\n                                    </div>\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Staff */}\n                <FormField\n                  control={form.control}\n                  name=\"staffUserId\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.staff\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover open={staffOpen} onOpenChange={setStaffOpen}>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              {field.value\n                                ? staff.find((s) => s.id === field.value)\n                                    ?.fullName\n                                : t(\"placeholder.staff\")}\n                              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[300px] p-0\">\n                          <Command>\n                            <CommandInput placeholder={t(\"search.staff\")} />\n                            <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                              <CommandEmpty>{t(\"empty.staff\")}</CommandEmpty>\n                              <CommandGroup>\n                                {staff.map((s) => (\n                                  <CommandItem\n                                    key={s.id}\n                                    value={s.fullName}\n                                    onSelect={() => {\n                                      form.setValue(\"staffUserId\", s.id);\n                                      setStaffOpen(false);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        s.id === field.value\n                                          ? \"opacity-100\"\n                                          : \"opacity-0\"\n                                      )}\n                                    />\n                                    <div>\n                                      <div>{s.fullName}</div>\n                                      <div className=\"text-xs text-muted-foreground\">\n                                        @{s.username}\n                                      </div>\n                                    </div>\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Row 4: Start Date + Start Time (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"startDate\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.start_date\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-start text-left font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                              {field.value ? (\n                                format(field.value, \"PPP\")\n                              ) : (\n                                <span>{t(\"placeholder.pick_date\")}</span>\n                              )}\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={field.value}\n                            onSelect={field.onChange}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"startTime\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.start_time\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"time\"\n                          {...field}\n                          className=\"h-10\"\n                          autoComplete=\"off\"\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Row 5: End Date + End Time (2 cols) */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"endDate\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.end_date\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              disabled={isViewOnly}\n                              className={cn(\n                                \"justify-start text-left font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                            >\n                              <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                              {field.value ? (\n                                format(field.value, \"PPP\")\n                              ) : (\n                                <span>{t(\"placeholder.pick_date\")}</span>\n                              )}\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={field.value}\n                            onSelect={field.onChange}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"endTime\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>\n                        {t(\"label.end_time\")} <span className=\"text-destructive\">*</span>\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"time\"\n                          {...field}\n                          className=\"h-10\"\n                          autoComplete=\"off\"\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Active Status (edit only) */}\n              {isEditMode && (\n                <FormField\n                  control={form.control}\n                  name=\"isActive\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                      <div className=\"space-y-0.5 flex-1\">\n                        <FormLabel className=\"text-base\">\n                          {t(\"label.active_status\")}\n                        </FormLabel>\n                        <FormDescription className=\"text-sm\">\n                          {field.value\n                            ? t(\"status.active\")\n                            : t(\"status.inactive\")}\n                        </FormDescription>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          disabled={isViewOnly}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              )}\n            </div>\n\n            <div className=\"flex gap-2 justify-end pt-4 px-6 pb-6 border-t mt-4 shrink-0 bg-background\">\n              {isViewOnly ? (\n                <Button\n                  type=\"button\"\n                  onClick={() => handleOpenChange(false)}\n                >\n                  {t(\"button.close\")}\n                </Button>\n              ) : (\n                <>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => handleOpenChange(false)}\n                    disabled={isSubmitting}\n                  >\n                    {t(\"button.cancel\")}\n                  </Button>\n                  <Button type=\"submit\" disabled={isSubmitting}>\n                    {isSubmitting ? t(\"button.saving\") : isEditMode ? t(\"button.update\") : t(\"button.create\")}\n                  </Button>\n                </>\n              )}\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\slot-pagination.tsx",
      "relative_path": "components/admin/slots/slot-pagination.tsx",
      "filename": "slot-pagination.tsx",
      "size_bytes": 2976,
      "lines": 111,
      "last_modified": "2025-11-01T15:38:43.305871",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface SlotPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function SlotPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: SlotPaginationProps) {\n  const getPageNumbers = () => {\n    const pages: (number | string)[] = [];\n    const maxVisible = 5;\n\n    if (totalPages <= maxVisible) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 3) {\n        for (let i = 1; i <= 4; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 2) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 3; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() => onPageChange(currentPage - 1)}\n            aria-disabled={disabled || currentPage === 1}\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {getPageNumbers().map((page, index) => (\n          <PaginationItem key={index}>\n            {page === \"ellipsis\" ? (\n              <PaginationEllipsis />\n            ) : (\n              <PaginationLink\n                onClick={() => onPageChange(page as number)}\n                isActive={currentPage === page}\n                aria-disabled={disabled}\n                className={\n                  disabled\n                    ? \"pointer-events-none opacity-50\"\n                    : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            )}\n          </PaginationItem>\n        ))}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() => onPageChange(currentPage + 1)}\n            aria-disabled={disabled || currentPage === totalPages}\n            className={\n              disabled || currentPage === totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\slot-roster-table.tsx",
      "relative_path": "components/admin/slots/slot-roster-table.tsx",
      "filename": "slot-roster-table.tsx",
      "size_bytes": 17938,
      "lines": 424,
      "last_modified": "2025-11-24T14:20:38.265789",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { canEditAttendanceForRole } from \"@/lib/utils\";\nimport type { SlotRosterItem, Slot, AttendanceType } from \"@/types\";\nimport { cn } from \"@/lib/utils\";\nimport { getEvidenceImageUrl, getPlaceholderImageUrl, getProfilePhotoUrl } from \"@/lib/image-utils\";\n\nexport interface PendingChange {\n  status: \"present\" | \"absent\" | \"not_yet\";\n  remark?: string;\n}\n\ninterface SlotRosterTableProps {\n  data: SlotRosterItem[];\n  slot: Slot;\n  attendanceType: AttendanceType; // \"REGULAR\" or \"EXAM\"\n  pendingChanges: Map<string, PendingChange>; // Composite key: \"attendanceType-recordId\"\n  onPendingChange: (\n    recordId: number,\n    attendanceType: AttendanceType,\n    status: \"present\" | \"absent\" | \"not_yet\",\n    remark?: string\n  ) => void;\n  onViewEvidence: (\n    studentUserId: number,\n    attendanceType: AttendanceType\n  ) => void;\n  userRole?: string;\n  isSessionRunning?: boolean; // Disable editing when session is running\n  statusFilter?: \"all\" | \"present\" | \"absent\" | \"not_yet\" | \"need_review\";\n  searchQuery?: string;\n}\n\nexport function SlotRosterTable({\n  data,\n  slot,\n  attendanceType,\n  pendingChanges,\n  onPendingChange,\n  onViewEvidence,\n  userRole,\n  isSessionRunning = false,\n  statusFilter,\n  searchQuery,\n}: SlotRosterTableProps) {\n  const t = useTranslations(\"roster.table\");\n  // Track broken evidence images (images that failed to load)\n  const [brokenImages, setBrokenImages] = useState<Set<string>>(new Set());\n  // Track broken avatar images (images that failed to load)\n  const [brokenAvatars, setBrokenAvatars] = useState<Set<string>>(new Set());\n\n  // Filter data based on statusFilter and searchQuery\n  const filteredData = useMemo(() => {\n    let result = data;\n\n    // Status filter\n    if (statusFilter && statusFilter !== \"all\") {\n      result = result.filter((item) => {\n        const attendance =\n          attendanceType === \"EXAM\" ? item.examAttendance : item.regularAttendance;\n\n        if (!attendance) {\n          return statusFilter === \"not_yet\";\n        }\n\n        if (statusFilter === \"need_review\") {\n          return attendance.needsReview === true;\n        }\n\n        return attendance.status === statusFilter;\n      });\n    }\n\n    // Search filter\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase().trim();\n      result = result.filter((item) => {\n        const student = item.student;\n        return (\n          student.rollNumber?.toLowerCase().includes(query) ||\n          student.fullName?.toLowerCase().includes(query) ||\n          student.email?.toLowerCase().includes(query)\n        );\n      });\n    }\n\n    return result;\n  }, [data, statusFilter, searchQuery, attendanceType]);\n\n  // Disable editing when:\n  // 1. User doesn't have permission based on role/time (canEditAttendanceForRole)\n  // 2. Session is currently running (to prevent conflicts with auto-recognition)\n  const canEdit = canEditAttendanceForRole(slot, userRole) && !isSessionRunning;\n\n  // Handle image load error - mark as broken\n  const handleImageError = (imageUrl: string, rollNumber: string) => {\n    console.warn('Evidence image not found (file deleted?):', rollNumber, imageUrl);\n    setBrokenImages(prev => new Set(prev).add(imageUrl));\n  };\n\n  // Handle avatar load error - mark as broken (silent fallback)\n  const handleAvatarError = (photoUrl: string, rollNumber: string) => {\n    // Only log in development mode to avoid console spam\n    if (process.env.NODE_ENV === 'development') {\n      console.warn('Avatar image not found (file deleted?):', rollNumber, photoUrl);\n    }\n    setBrokenAvatars(prev => new Set(prev).add(photoUrl));\n  };\n\n  const handleStatusChange = (\n    recordId: number,\n    attendanceType: AttendanceType,\n    newStatus: \"present\" | \"absent\" | \"not_yet\",\n    currentStatus: string | undefined, // DB status (source of truth, not pending change)\n    currentRemark?: string\n  ) => {\n    const key = `${attendanceType}-${recordId}`;\n    const pendingChange = pendingChanges.get(key);\n    const remarkValue = pendingChange?.remark ?? currentRemark ?? \"\";\n\n    onPendingChange(recordId, attendanceType, newStatus, remarkValue);\n  };\n\n  const handleRemarkChange = (\n    recordId: number,\n    attendanceType: AttendanceType,\n    newRemark: string,\n    currentStatus: string | undefined, // DB status (source of truth)\n    pendingStatus?: \"present\" | \"absent\" | \"not_yet\"\n  ) => {\n    const status =\n      pendingStatus ??\n      (currentStatus as \"present\" | \"absent\" | \"not_yet\" | undefined) ??\n      \"not_yet\";\n\n    onPendingChange(recordId, attendanceType, status, newRemark);\n  };\n\n  return (\n    <div className=\"rounded-md border\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead className=\"text-center w-16\">{t(\"header.stt\")}</TableHead>\n            <TableHead className=\"text-center w-32\">{t(\"header.roll_number\")}</TableHead>\n            <TableHead className=\"text-center w-48\">{t(\"header.student_info\")}</TableHead>\n            <TableHead className=\"text-center w-56\">{t(\"header.status\")}</TableHead>\n            <TableHead className=\"text-center w-64\">{t(\"header.remark\")}</TableHead>\n            <TableHead className=\"text-center w-32\">{t(\"header.avatar\")}</TableHead>\n            <TableHead className=\"text-center w-32\">{t(\"header.evidence\")}</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {filteredData.length === 0 ? (\n            <TableRow>\n              <TableCell\n                colSpan={7}\n                className=\"text-center text-muted-foreground h-32\"\n              >\n                {statusFilter && statusFilter !== \"all\" || searchQuery ? (\n                  <div className=\"space-y-2\">\n                    <p>{t(\"empty.no_match\")}</p>\n                    <p className=\"text-sm\">\n                      {t(\"empty.try_adjusting\")}\n                    </p>\n                  </div>\n                ) : (\n                  t(\"empty.no_students\")\n                )}\n              </TableCell>\n            </TableRow>\n          ) : (\n            filteredData.map((item, index) => {\n              const student = item.student;\n              // Use attendance based on attendanceType prop\n              const attendance =\n                attendanceType === \"EXAM\"\n                  ? item.examAttendance\n                  : item.regularAttendance;\n\n              const recordId = attendance?.recordId;\n              const currentStatus = attendance?.status;\n              const currentRemark = attendance?.remark;\n              const currentMethod = attendance?.method;\n\n              // Get pending changes or use current values (with composite key)\n              const key = recordId ? `${attendanceType}-${recordId}` : undefined;\n              const pendingChange = key ? pendingChanges.get(key) : undefined;\n              const displayStatus =\n                pendingChange?.status ?? currentStatus ?? \"not_yet\";\n              const displayRemark =\n                pendingChange?.remark !== undefined\n                  ? pendingChange.remark\n                  : currentRemark ?? \"\";\n\n              // Check if this row has pending changes (with composite key)\n              const isDirty = key ? pendingChanges.has(key) : false;\n\n              // Check if this row needs review\n              const needsReview = !!attendance?.needsReview;\n\n              return (\n                <TableRow\n                  key={recordId ?? `${student.userId}-${item.subject?.id ?? 'no-subject'}`}\n                  className={cn(\n                    isDirty && \"bg-amber-50 border-l-4 border-l-amber-500\",\n                    needsReview && \"border-2 border-red-500 bg-red-50/30\"\n                  )}\n                >\n                  {/* STT */}\n                  <TableCell className=\"text-center font-medium\">\n                    {index + 1}\n                  </TableCell>\n\n                  {/* Roll Number */}\n                  <TableCell className=\"text-center font-medium\">\n                    {student.rollNumber}\n                  </TableCell>\n\n                  {/* Student Info */}\n                  <TableCell className=\"text-center\">\n                    <div>\n                      <div className=\"font-medium\">{student.fullName}</div>\n                      {student.email && (\n                        <div className=\"text-xs text-muted-foreground\">{student.email}</div>\n                      )}\n                    </div>\n                  </TableCell>\n\n                  {/* Status - Inline RadioGroup */}\n                  <TableCell className=\"text-center align-middle\">\n                    <div className=\"flex flex-col items-center justify-center gap-2\">\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <div>\n                              <RadioGroup\n                                value={displayStatus}\n                                onValueChange={(value) =>\n                                  recordId &&\n                                  handleStatusChange(\n                                    recordId,\n                                    attendanceType,\n                                    value as \"present\" | \"absent\" | \"not_yet\",\n                                    currentStatus,\n                                    currentRemark ?? undefined\n                                  )\n                                }\n                                disabled={!canEdit || !recordId}\n                                className=\"flex flex-col gap-2\"\n                              >\n                                <div className=\"flex items-center space-x-1\">\n                                  <RadioGroupItem\n                                    value=\"present\"\n                                    id={`present-${recordId}`}\n                                    className=\"h-4 w-4\"\n                                  />\n                                  <Label\n                                    htmlFor={`present-${recordId}`}\n                                    className=\"text-xs cursor-pointer text-green-700 font-medium\"\n                                  >\n                                    {t(\"status.present\")}\n                                  </Label>\n                                </div>\n                                <div className=\"flex items-center space-x-1\">\n                                  <RadioGroupItem\n                                    value=\"absent\"\n                                    id={`absent-${recordId}`}\n                                    className=\"h-4 w-4\"\n                                  />\n                                  <Label\n                                    htmlFor={`absent-${recordId}`}\n                                    className=\"text-xs cursor-pointer text-red-700 font-medium\"\n                                  >\n                                    {t(\"status.absent\")}\n                                  </Label>\n                                </div>\n                                <div className=\"flex items-center space-x-1\">\n                                  <RadioGroupItem\n                                    value=\"not_yet\"\n                                    id={`not_yet-${recordId}`}\n                                    className=\"h-4 w-4\"\n                                    disabled={true}\n                                  />\n                                  <Label\n                                    htmlFor={`not_yet-${recordId}`}\n                                    className=\"text-xs cursor-not-allowed text-gray-400\"\n                                  >\n                                    {t(\"status.not_yet\")}\n                                  </Label>\n                                </div>\n                              </RadioGroup>\n                            </div>\n                          </TooltipTrigger>\n                          {currentMethod && (\n                            <TooltipContent>\n                              <p>method: {currentMethod}</p>\n                            </TooltipContent>\n                          )}\n                        </Tooltip>\n                      </TooltipProvider>\n                    </div>\n                  </TableCell>\n\n                  {/* Remark - Inline Input */}\n                  <TableCell className=\"text-center\">\n                    <Input\n                      value={displayRemark}\n                      onChange={(e) =>\n                        recordId &&\n                        handleRemarkChange(\n                          recordId,\n                          attendanceType,\n                          e.target.value,\n                          currentStatus,\n                          pendingChange?.status\n                        )\n                      }\n                      disabled={!canEdit || !recordId}\n                      placeholder={canEdit ? t(\"remark.placeholder\") : t(\"remark.no_remark\")}\n                      className=\"text-sm h-8\"\n                      maxLength={1000}\n                    />\n                  </TableCell>\n\n                  {/* Avatar */}\n                  <TableCell className=\"text-center\">\n                    <div className=\"flex justify-center\">\n                      <button\n                        onClick={() => {\n                          onViewEvidence(student.userId, attendanceType);\n                        }}\n                        className=\"inline-block hover:opacity-80 transition-opacity\"\n                        title=\"Click to compare images\"\n                      >\n                        {/* eslint-disable-next-line @next/next/no-img-element */}\n                        <img\n                          key={`avatar-${student.userId}`}\n                          src={(() => {\n                            // If avatar is broken, use placeholder immediately\n                            if (student.photoUrl && brokenAvatars.has(student.photoUrl)) {\n                              return getPlaceholderImageUrl();\n                            }\n                            const baseUrl = student.photoUrl\n                              ? getProfilePhotoUrl(student.photoUrl) || getPlaceholderImageUrl()\n                              : getPlaceholderImageUrl();\n                            // Add cache-busting param to force reload (skip for placeholder)\n                            const url = baseUrl.includes('placehold.co') ? baseUrl : `${baseUrl}?t=${Date.now()}`;\n                            return url;\n                          })()}\n                          alt={student.fullName}\n                          className=\"rounded object-cover border cursor-pointer w-28 h-28\"\n                          onError={(e) => {\n                            // Mark as broken and fallback to placeholder\n                            if (student.photoUrl) {\n                              handleAvatarError(student.photoUrl, student.rollNumber || '');\n                            }\n                            e.currentTarget.src = getPlaceholderImageUrl();\n                          }}\n                        />\n                      </button>\n                    </div>\n                  </TableCell>\n\n                  {/* Evidence */}\n                  <TableCell className=\"text-center\">\n                    {attendance?.evidenceImageUrl &&\n                     attendance.evidenceImageUrl.trim() !== \"\" &&\n                     !brokenImages.has(attendance.evidenceImageUrl) ? (\n                      <button\n                        onClick={() => {\n                          onViewEvidence(student.userId, attendanceType);\n                        }}\n                        className=\"inline-block hover:opacity-80 transition-opacity\"\n                        title=\"Click to compare images\"\n                      >\n                        {/* eslint-disable-next-line @next/next/no-img-element */}\n                        <img\n                          key={`evidence-${student.userId}-${attendance.recordId}`}\n                          src={(() => {\n                            const baseUrl = getEvidenceImageUrl(attendance.evidenceImageUrl) || \"\";\n                            // Add cache-busting param to force reload\n                            const url = baseUrl ? `${baseUrl}?t=${Date.now()}` : \"\";\n                            return url;\n                          })()}\n                          alt=\"Evidence\"\n                          className=\"rounded object-cover border cursor-pointer w-28 h-28\"\n                          onError={() => {\n                            handleImageError(attendance.evidenceImageUrl!, student.rollNumber || '');\n                          }}\n                        />\n                      </button>\n                    ) : (\n                      <span className=\"text-muted-foreground text-sm\">-</span>\n                    )}\n                  </TableCell>\n                </TableRow>\n              );\n            })\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\slot-table.tsx",
      "relative_path": "components/admin/slots/slot-table.tsx",
      "filename": "slot-table.tsx",
      "size_bytes": 4753,
      "lines": 155,
      "last_modified": "2025-11-24T12:38:30.901111",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Slot } from \"@/types\";\nimport { SlotPagination } from \"./slot-pagination\";\n\ninterface SlotTableProps {\n  columns: ColumnDef<Slot>[];\n  data: Slot[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function SlotTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: SlotTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const t = useTranslations(\"admin.slots\");\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[1200px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                        header.column.columnDef.header,\n                        header.getContext()\n                      )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t(\"table.empty.no_slots\")}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            <>\n              {t(\"pagination.showing\")} {(currentPage - 1) * pageSize + 1} -{\" \"}\n              {Math.min(currentPage * pageSize, totalItems)} {t(\"pagination.of\")} {totalItems}{\" \"}\n              {t(\"pagination.items\")}\n            </>\n          ) : (\n            t(\"pagination.no_items\")\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <SlotPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\slots\\update-attendance-dialog.tsx",
      "relative_path": "components/admin/slots/update-attendance-dialog.tsx",
      "filename": "update-attendance-dialog.tsx",
      "size_bytes": 5688,
      "lines": 170,
      "last_modified": "2025-11-01T15:38:43.306875",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2 } from \"lucide-react\";\nimport type { SlotRosterItem } from \"@/types\";\nimport { getEvidenceImageUrl } from \"@/lib/image-utils\";\n\ninterface UpdateAttendanceDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  item: SlotRosterItem | null;\n  type: \"regular\" | \"exam\";\n  onSubmit: (data: { status: string; remark: string }) => Promise<void>;\n}\n\nexport function UpdateAttendanceDialog({\n  open,\n  onOpenChange,\n  item,\n  type,\n  onSubmit,\n}: UpdateAttendanceDialogProps) {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [status, setStatus] = useState<\"present\" | \"absent\">(\"present\");\n  const [remark, setRemark] = useState(\"\");\n  const [error, setError] = useState(\"\");\n\n  const attendance = type === \"regular\" ? item?.regularAttendance : item?.examAttendance;\n\n  const handleSubmit = async () => {\n    if (!remark.trim()) {\n      setError(\"Remark is required\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    setError(\"\");\n    try {\n      await onSubmit({ status, remark });\n      setRemark(\"\");\n      onOpenChange(false);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!item || !attendance) return null;\n\n  const getStatusBadge = (status: string) => {\n    const variants = {\n      present: { variant: \"default\" as const, label: \"Present\" },\n      absent: { variant: \"destructive\" as const, label: \"Absent\" },\n      not_yet: { variant: \"secondary\" as const, label: \"Not Yet\" },\n    };\n    const config = variants[status as keyof typeof variants] || variants.not_yet;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>Update {type === \"regular\" ? \"Regular\" : \"Exam\"} Attendance</DialogTitle>\n          <DialogDescription>\n            Update attendance status for {item.student.fullName} ({item.student.rollNumber})\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Current Status */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium\">Current Status:</span>\n            {getStatusBadge(attendance.status)}\n            {attendance.method && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {attendance.method}\n              </Badge>\n            )}\n          </div>\n\n          {/* Evidence Image */}\n          {attendance.evidenceImageUrl && (\n            <div className=\"space-y-2\">\n              <span className=\"text-sm font-medium\">Evidence:</span>\n              {/* eslint-disable-next-line @next/next/no-img-element */}\n              <img\n                src={getEvidenceImageUrl(attendance.evidenceImageUrl) || \"\"}\n                alt=\"Evidence\"\n                className=\"max-w-full max-h-[200px] object-contain rounded-lg border\"\n              />\n            </div>\n          )}\n\n          {/* New Status */}\n          <div className=\"space-y-3\">\n            <Label>New Status</Label>\n            <div className=\"space-y-2\">\n              <label className=\"flex items-center space-x-2 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"status\"\n                  value=\"present\"\n                  checked={status === \"present\"}\n                  onChange={(e) => setStatus(e.target.value as \"present\")}\n                  className=\"h-4 w-4\"\n                />\n                <span className=\"text-sm\">Present</span>\n              </label>\n              <label className=\"flex items-center space-x-2 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"status\"\n                  value=\"absent\"\n                  checked={status === \"absent\"}\n                  onChange={(e) => setStatus(e.target.value as \"absent\")}\n                  className=\"h-4 w-4\"\n                />\n                <span className=\"text-sm\">Absent</span>\n              </label>\n            </div>\n          </div>\n\n          {/* Remark */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"remark\">Remark (Required)</Label>\n            <Textarea\n              id=\"remark\"\n              placeholder=\"Enter reason for manual update...\"\n              className=\"resize-none\"\n              rows={4}\n              value={remark}\n              onChange={(e) => {\n                setRemark(e.target.value);\n                setError(\"\");\n              }}\n            />\n            {error && <p className=\"text-sm text-destructive\">{error}</p>}\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isSubmitting}\n          >\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} disabled={isSubmitting}>\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Update Attendance\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\delete-subject-dialog.tsx",
      "relative_path": "components/admin/subjects/delete-subject-dialog.tsx",
      "filename": "delete-subject-dialog.tsx",
      "size_bytes": 1977,
      "lines": 68,
      "last_modified": "2025-11-11T10:48:14.529010",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useTranslations } from 'next-intl';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Subject } from \"@/types\";\n\ninterface DeleteSubjectDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  subject: Subject | null;\n  onConfirm: () => void;\n  isDeleting?: boolean;\n}\n\nexport function DeleteSubjectDialog({\n  open,\n  onOpenChange,\n  subject,\n  onConfirm,\n  isDeleting = false,\n}: DeleteSubjectDialogProps) {\n  const t = useTranslations('delete');\n\n  if (!subject) return null;\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('title')}</AlertDialogTitle>\n          <AlertDialogDescription className=\"space-y-2\">\n            {t('confirm_message')}{\" \"}\n            <span className=\"font-semibold text-foreground\">\n              &quot;{subject.name}&quot; ({subject.code})\n            </span>\n            ?\n          </AlertDialogDescription>\n          <div className=\"space-y-2 text-sm\">\n            <p className=\"text-destructive font-medium\">{t('warning')}</p>\n            <p className=\"text-muted-foreground\">\n              {t('note')}\n            </p>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isDeleting}>{t('button_cancel')}</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isDeleting}\n            className=\"bg-destructive text-white hover:bg-destructive/90\"\n          >\n            {isDeleting ? t('button_deleting') : t('button_delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\multi-select-majors.tsx",
      "relative_path": "components/admin/subjects/multi-select-majors.tsx",
      "filename": "multi-select-majors.tsx",
      "size_bytes": 5763,
      "lines": 165,
      "last_modified": "2025-11-21T19:17:03.192893",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Check, ChevronsUpDown, X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Major } from \"@/types\";\nimport { useGetMajors } from \"@/hooks/api/useMajors\";\nimport { FILTER_PAGE_SIZE } from \"@/lib/constants\";\n\ninterface MultiSelectMajorsProps {\n  value: number[];\n  onChange: (value: number[]) => void;\n  majors: Major[];\n  disabled?: boolean;\n  error?: boolean;\n}\n\nexport function MultiSelectMajors({\n  value,\n  onChange,\n  majors,\n  disabled = false,\n  error = false,\n}: MultiSelectMajorsProps) {\n  const [open, setOpen] = React.useState(false);\n  const [query, setQuery] = React.useState(\"\");\n\n  const { data: remoteMajors } = useGetMajors({\n    pageSize: FILTER_PAGE_SIZE,\n    sortBy: \"code\",\n    search: query || undefined,\n    isActive: true,\n  });\n  React.useEffect(() => {\n    if (!open) setQuery(\"\");\n  }, [open]);\n\n  const selectedMajors = majors.filter((major) => value.includes(major.id));\n  const availableMajors = majors.filter((major) => major.isActive);\n\n  const handleSelect = (majorId: number) => {\n    const newValue = value.includes(majorId)\n      ? value.filter((id) => id !== majorId)\n      : [...value, majorId];\n    onChange(newValue);\n  };\n\n  const handleRemove = (majorId: number, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onChange(value.filter((id) => id !== majorId));\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            disabled={disabled}\n            className={cn(\n              \"w-full justify-between h-auto min-h-[40px] px-3 py-2\",\n              error && \"border-destructive\"\n            )}\n          >\n            <div className=\"flex flex-wrap gap-1 flex-1\">\n              {selectedMajors.length === 0 ? (\n                <span className=\"text-muted-foreground\">Select majors...</span>\n              ) : (\n                selectedMajors.map((major) => (\n                  <Badge\n                    key={major.id}\n                    variant={major.isActive ? \"default\" : \"destructive\"}\n                    className=\"text-xs flex items-center gap-1\"\n                  >\n                    {major.code}\n                    <span\n                      className=\"ml-1 hover:text-foreground cursor-pointer\"\n                      onClick={(e) => handleRemove(major.id, e)}\n                      role=\"button\"\n                      tabIndex={0}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" || e.key === \" \") {\n                          e.preventDefault();\n                          const syntheticEvent =\n                            e as unknown as React.MouseEvent;\n                          handleRemove(major.id, syntheticEvent);\n                        }\n                      }}\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </span>\n                  </Badge>\n                ))\n              )}\n            </div>\n            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n          <Command shouldFilter={false}>\n            <CommandInput\n              placeholder=\"Search majors...\"\n              className=\"h-9\"\n              value={query}\n              onValueChange={setQuery}\n            />\n            <CommandList className=\"max-h-[300px] overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-track]:bg-transparent\">\n              <CommandEmpty>No major found.</CommandEmpty>\n              <CommandGroup>\n                {(remoteMajors?.items || availableMajors).map((major) => {\n                  const isSelected = value.includes(major.id);\n                  return (\n                    <CommandItem\n                      key={major.id}\n                      value={`${major.code} ${major.name}`}\n                      onSelect={() => handleSelect(major.id)}\n                    >\n                      <div className=\"flex items-center flex-1\">\n                        <Check\n                          className={cn(\n                            \"mr-2 h-4 w-4\",\n                            isSelected ? \"opacity-100\" : \"opacity-0\"\n                          )}\n                        />\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">{major.code}</span>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {major.name}\n                          </span>\n                        </div>\n                      </div>\n                      {major.isActive && (\n                        <Badge variant=\"outline\" className=\"ml-auto text-xs\">\n                          Active\n                        </Badge>\n                      )}\n                    </CommandItem>\n                  );\n                })}\n              </CommandGroup>\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\multi-select-subjects.tsx",
      "relative_path": "components/admin/subjects/multi-select-subjects.tsx",
      "filename": "multi-select-subjects.tsx",
      "size_bytes": 5412,
      "lines": 158,
      "last_modified": "2025-11-21T19:17:03.192893",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Check, ChevronsUpDown, X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface SubjectBase {\n  id: number;\n  name: string;\n  code: string;\n  isActive: boolean;\n}\n\ninterface MultiSelectSubjectsProps {\n  value: number[];\n  onChange: (value: number[]) => void;\n  subjects: SubjectBase[];\n  disabled?: boolean;\n  error?: boolean;\n}\n\nexport function MultiSelectSubjects({\n  value,\n  onChange,\n  subjects,\n  disabled = false,\n  error = false,\n}: MultiSelectSubjectsProps) {\n  const [open, setOpen] = React.useState(false);\n\n  const selectedSubjects = subjects.filter((subject) =>\n    value.includes(subject.id)\n  );\n  const availableSubjects = subjects.filter((subject) => subject.isActive);\n\n  const handleSelect = (subjectId: number) => {\n    const newValue = value.includes(subjectId)\n      ? value.filter((id) => id !== subjectId)\n      : [...value, subjectId];\n    onChange(newValue);\n  };\n\n  const handleRemove = (subjectId: number, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onChange(value.filter((id) => id !== subjectId));\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            disabled={disabled}\n            className={cn(\n              \"w-full justify-between h-auto min-h-[40px] px-3 py-2\",\n              error && \"border-destructive\"\n            )}\n          >\n            <div className=\"flex flex-wrap gap-1 flex-1\">\n              {selectedSubjects.length === 0 ? (\n                <span className=\"text-muted-foreground\">\n                  Select subjects...\n                </span>\n              ) : (\n                selectedSubjects.map((subject) => (\n                  <Badge\n                    key={subject.id}\n                    variant={subject.isActive ? \"default\" : \"destructive\"}\n                    className=\"text-xs flex items-center gap-1\"\n                  >\n                    {subject.code}\n                    <span\n                      className=\"ml-1 hover:text-foreground cursor-pointer\"\n                      onClick={(e) => handleRemove(subject.id, e)}\n                      role=\"button\"\n                      tabIndex={0}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" || e.key === \" \") {\n                          e.preventDefault();\n                          const syntheticEvent =\n                            e as unknown as React.MouseEvent;\n                          handleRemove(subject.id, syntheticEvent);\n                        }\n                      }}\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </span>\n                  </Badge>\n                ))\n              )}\n            </div>\n            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-[500px] p-0\" align=\"start\">\n          <Command>\n            <CommandInput placeholder=\"Search subjects...\" className=\"h-9\" />\n            <CommandList className=\"max-h-[300px] overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-track]:bg-transparent\">\n              <CommandEmpty>No subject found.</CommandEmpty>\n              <CommandGroup>\n                {availableSubjects.map((subject) => {\n                  const isSelected = value.includes(subject.id);\n                  return (\n                    <CommandItem\n                      key={subject.id}\n                      value={`${subject.code} ${subject.name}`}\n                      onSelect={() => handleSelect(subject.id)}\n                    >\n                      <div className=\"flex items-center flex-1\">\n                        <Check\n                          className={cn(\n                            \"mr-2 h-4 w-4\",\n                            isSelected ? \"opacity-100\" : \"opacity-0\"\n                          )}\n                        />\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">{subject.code}</span>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {subject.name}\n                          </span>\n                        </div>\n                      </div>\n                      {subject.isActive && (\n                        <Badge variant=\"outline\" className=\"ml-auto text-xs\">\n                          Active\n                        </Badge>\n                      )}\n                    </CommandItem>\n                  );\n                })}\n              </CommandGroup>\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\subject-columns.tsx",
      "relative_path": "components/admin/subjects/subject-columns.tsx",
      "filename": "subject-columns.tsx",
      "size_bytes": 5070,
      "lines": 183,
      "last_modified": "2025-11-21T19:17:03.193887",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Pencil } from \"lucide-react\";\nimport { useTranslations } from 'next-intl';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Subject } from \"@/types\";\n\n// Header components\nfunction CodeHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_code')}</div>;\n}\n\nfunction NameHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_name')}</div>;\n}\n\nfunction MajorsHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_subjects')}</div>;\n}\n\nfunction ClassesHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_classes')}</div>;\n}\n\nfunction StatusHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_status')}</div>;\n}\n\nfunction ActionHeader() {\n  const t = useTranslations('table');\n  return <div className=\"text-center\">{t('column_action')}</div>;\n}\n\n// Cell components\nfunction StatusCell({ isActive }: { isActive: boolean }) {\n  return (\n    <div className=\"flex justify-center\">\n      <Badge\n        variant={isActive ? \"default\" : \"destructive\"}\n        className=\"w-[70px] justify-center\"\n      >\n        {isActive ? \"Active\" : \"Inactive\"}\n      </Badge>\n    </div>\n  );\n}\n\nfunction ActionCell({ \n  subject, \n  onEdit \n}: { \n  subject: Subject; \n  onEdit: (subject: Subject) => void;\n}) {\n  const t = useTranslations('subject');\n  \n  return (\n    <div className=\"flex justify-center\">\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => onEdit(subject)}\n              className=\"h-8\"\n            >\n              <Pencil className=\"h-4 w-4 mr-2\" />\n              {t('edit_menu')}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>\n              {t('menu_label', { code: subject.code })} - {subject.name}\n            </p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    </div>\n  );\n}\n\nexport const createSubjectColumns = (\n  onEdit: (subject: Subject) => void,\n  onMajorClick: (majorName: string) => void\n): ColumnDef<Subject>[] => [\n  {\n    accessorKey: \"code\",\n    header: CodeHeader,\n    cell: ({ row }) => (\n      <div className=\"font-medium text-center\">{row.getValue(\"code\")}</div>\n    ),\n  },\n  {\n    accessorKey: \"name\",\n    header: NameHeader,\n    cell: ({ row }) => <div className=\"text-center\">{row.getValue(\"name\")}</div>,\n  },\n  {\n    id: \"majors\",\n    header: MajorsHeader,\n    cell: ({ row }) => {\n      const majors = row.original.majors;\n      const majorCount = majors.length;\n\n      return (\n        <div className=\"flex justify-center\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Badge\n                  variant=\"secondary\"\n                  className=\"text-xs cursor-help w-[60px] justify-center\"\n                >\n                  {majorCount} {majorCount === 1 ? \"major\" : \"majors\"}\n                </Badge>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\" className=\"max-w-xs\">\n                <div className=\"space-y-1\">\n                  {majors.map((major) => (\n                    <div\n                      key={major.id}\n                      className=\"text-sm flex items-center gap-2 cursor-pointer hover:bg-white/10 rounded px-2 py-1 -mx-2 transition-colors\"\n                      onClick={() => onMajorClick(major.name)}\n                    >\n                      <Badge\n                        variant={major.isActive ? \"default\" : \"destructive\"}\n                        className=\"text-xs\"\n                      >\n                        {major.code}\n                      </Badge>\n                      <span>{major.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      );\n    },\n  },\n  {\n    accessorKey: \"totalClass\",\n    header: ClassesHeader,\n    cell: ({ row }) => (\n      <div className=\"text-center text-muted-foreground\">\n        {row.getValue(\"totalClass\")}\n      </div>\n    ),\n  },\n  {\n    accessorKey: \"isActive\",\n    header: StatusHeader,\n    cell: ({ row }) => {\n      const isActive = row.getValue(\"isActive\") as boolean;\n      return <StatusCell isActive={isActive} />;\n    },\n  },\n  {\n    id: \"action\",\n    header: ActionHeader,\n    cell: ({ row }) => (\n      <ActionCell\n        subject={row.original}\n        onEdit={onEdit}\n      />\n    ),\n  },\n];\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\subject-form-dialog.tsx",
      "relative_path": "components/admin/subjects/subject-form-dialog.tsx",
      "filename": "subject-form-dialog.tsx",
      "size_bytes": 15405,
      "lines": 436,
      "last_modified": "2025-11-21T19:17:03.194888",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useTranslations } from 'next-intl';\nimport { ERROR_CODES } from \"@/lib/constants\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Subject, Major } from \"@/types\";\nimport { MultiSelectMajors } from \"./multi-select-majors\";\n\ninterface SubjectFormDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  subject?: Subject;\n  isLoadingSubject?: boolean;\n  onSubmit: (data: SubjectFormData) => Promise<void>;\n  onDelete?: (subject: Subject) => void;\n  isSubmitting?: boolean;\n  isDeleting?: boolean;\n  availableMajors: Major[];\n}\n\nexport interface SubjectFormData {\n  name: string;\n  code: string;\n  majorIds: number[];\n  isActive?: boolean;\n}\n\nexport function SubjectFormDialog({\n  open,\n  onOpenChange,\n  subject,\n  isLoadingSubject = false,\n  onSubmit,\n  onDelete,\n  isSubmitting = false,\n  isDeleting = false,\n  availableMajors,\n}: SubjectFormDialogProps) {\n  const isEditMode = !!subject;\n  const tForm = useTranslations('form');\n  const tValidation = useTranslations('validation');\n  const tApiError = useTranslations('api_error');\n  const tConfirm = useTranslations('code_change_confirmation');\n\n  // Create schema with translated messages\n  const baseSubjectFormSchema = useMemo(() => z.object({\n    name: z\n      .string()\n      .min(1, tValidation('name_required'))\n      .max(150, tValidation('name_max_length'))\n      .regex(\n        /^[A-Za-z0-9 ]+$/,\n        tValidation('name_format')\n      ),\n    code: z\n      .string()\n      .min(1, tValidation('code_required'))\n      .max(20, tValidation('code_max_length'))\n      .regex(\n        /^[A-Z0-9]+$/,\n        tValidation('code_uppercase_format')\n      ),\n    majorIds: z.array(z.number()).min(1, tValidation('major_ids_required')),\n    isActive: z.boolean().optional(),\n  }), [tValidation]);\n\n  type SubjectFormValues = z.infer<typeof baseSubjectFormSchema>;\n\n  // Confirmation dialog state for code change\n  const [showCodeChangeConfirm, setShowCodeChangeConfirm] = useState(false);\n  const [pendingFormData, setPendingFormData] = useState<SubjectFormValues | null>(null);\n\n  const form = useForm<SubjectFormValues>({\n    resolver: zodResolver(baseSubjectFormSchema),\n    defaultValues: {\n      name: subject?.name || \"\",\n      code: subject?.code || \"\",\n      majorIds: subject?.majors.map((m) => m.id) || [],\n      isActive: subject?.isActive ?? true,\n    },\n  });\n\n  useEffect(() => {\n    if (open) {\n      form.reset({\n        name: subject?.name || \"\",\n        code: subject?.code || \"\",\n        majorIds: subject?.majors.map((m) => m.id) || [],\n        isActive: subject?.isActive ?? true,\n      });\n    }\n  }, [subject, open, form]);\n\n  const handleSubmit = async (values: SubjectFormValues) => {\n    // Check if code changed in edit mode (compare uppercase versions)\n    if (isEditMode && subject && values.code.toUpperCase() !== subject.code.toUpperCase()) {\n      setPendingFormData(values);\n      setShowCodeChangeConfirm(true);\n      return;\n    }\n\n    // Proceed with submission\n    await submitForm(values);\n  };\n\n  const submitForm = async (values: SubjectFormValues) => {\n    form.clearErrors();\n    try {\n      // Convert code to uppercase before submitting\n      await onSubmit({\n        name: values.name,\n        code: values.code.toUpperCase(),\n        majorIds: values.majorIds,\n        ...(isEditMode && { isActive: values.isActive }),\n      });\n    } catch (error) {\n      const err = error as {\n        response?: { data?: { message?: string; code?: string } };\n      };\n      const apiMessage = err.response?.data?.message || \"\";\n      const errorCode = err.response?.data?.code || \"\";\n\n      // Handle specific error codes from backend\n      switch (errorCode) {\n        case ERROR_CODES.SUBJECT_NAME_EXISTS:\n          form.setError(\"name\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('name_exists'),\n          });\n          break;\n        case ERROR_CODES.SUBJECT_CODE_EXISTS:\n          form.setError(\"code\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('code_exists'),\n          });\n          break;\n        case ERROR_CODES.SUBJECT_MAJOR_IDS_REQUIRED:\n        case ERROR_CODES.SUBJECT_MAJOR_IDS_EMPTY:\n          form.setError(\"majorIds\", {\n            type: \"manual\",\n            message: apiMessage || tValidation('major_ids_required'),\n          });\n          break;\n        case ERROR_CODES.MAJOR_NOT_FOUND:\n          form.setError(\"majorIds\", {\n            type: \"manual\",\n            message: apiMessage,\n          });\n          break;\n        case ERROR_CODES.INACTIVE_MAJOR_NOT_ALLOWED:\n          form.setError(\"majorIds\", {\n            type: \"manual\",\n            message: apiMessage,\n          });\n          break;\n        case ERROR_CODES.SUBJECT_HAS_ACTIVE_CLASSES:\n          form.setError(\"isActive\", {\n            type: \"manual\",\n            message: apiMessage || tApiError('cannot_deactivate'),\n          });\n          break;\n        default:\n          // Fallback: Parse error message if no error code\n          if (\n            apiMessage.includes(\"name already exists\") ||\n            apiMessage.toLowerCase().includes(\"name\")\n          ) {\n            form.setError(\"name\", { type: \"manual\", message: apiMessage });\n          } else if (\n            apiMessage.includes(\"code already exists\") ||\n            apiMessage.toLowerCase().includes(\"code\")\n          ) {\n            form.setError(\"code\", { type: \"manual\", message: apiMessage });\n          } else if (apiMessage.toLowerCase().includes(\"major\")) {\n            form.setError(\"majorIds\", { type: \"manual\", message: apiMessage });\n          }\n          break;\n      }\n    }\n  };\n\n  const handleConfirmCodeChange = async () => {\n    if (pendingFormData) {\n      setShowCodeChangeConfirm(false);\n      await submitForm(pendingFormData);\n      setPendingFormData(null);\n    }\n  };\n\n  const handleCancelCodeChange = () => {\n    setShowCodeChangeConfirm(false);\n    setPendingFormData(null);\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-[550px] max-h-[90vh] flex flex-col gap-0\">\n        <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit(handleSubmit)}\n            className=\"flex flex-col h-full\"\n          >\n            <DialogHeader>\n              <DialogTitle>\n                {isEditMode ? tForm('title_edit') : tForm('title_create')}\n              </DialogTitle>\n              <DialogDescription>\n                {isEditMode\n                  ? tForm('description_edit')\n                  : tForm('description_create')}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"grid gap-4 py-4 px-1 overflow-y-auto flex-1\">\n              {/* Loading State */}\n              {isLoadingSubject && isEditMode && (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  {tForm('loading')}\n                </div>\n              )}\n\n              {/* Form Fields - Hidden while loading in edit mode */}\n              {(!isLoadingSubject || !isEditMode) && (\n                <>\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_subject_name')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_subject_name')}\n                            aria-invalid={!!form.formState.errors.name}\n                            {...field}\n                            maxLength={150}\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"code\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_subject_code')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={tForm('placeholder_subject_code')}\n                            aria-invalid={!!form.formState.errors.code}\n                            {...field}\n                            maxLength={20}\n                            onChange={(e) =>\n                              field.onChange(e.target.value.toUpperCase())\n                            }\n                            autoComplete=\"off\"\n                          />\n                        </FormControl>\n                        <FormDescription className=\"text-xs\">\n                          {tForm('description_code_uppercase')}\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"majorIds\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {tForm('label_majors')}{\" \"}\n                          <span className=\"text-destructive\">*</span>\n                        </FormLabel>\n                        <FormControl>\n                          <MultiSelectMajors\n                            value={field.value}\n                            onChange={field.onChange}\n                            majors={availableMajors}\n                            disabled={isSubmitting || isDeleting}\n                            error={!!form.formState.errors.majorIds}\n                          />\n                        </FormControl>\n                        <FormDescription className=\"text-xs\">\n                          {tForm('description_majors')}\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {isEditMode && (\n                    <FormField\n                      control={form.control}\n                      name=\"isActive\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                          <div className=\"space-y-0.5 flex-1\">\n                            <FormLabel className=\"text-base\">\n                              {tForm('label_active')}\n                            </FormLabel>\n                            <FormDescription className=\"text-sm\">\n                              {field.value\n                                ? tForm('description_active')\n                                : tForm('description_inactive')}\n                            </FormDescription>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  )}\n                </>\n              )}\n            </div>\n\n            <div className=\"flex flex-row justify-between items-center pt-4\">\n              {isEditMode && onDelete && subject && (\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => onDelete(subject)}\n                  disabled={isSubmitting || isDeleting || isLoadingSubject}\n                  className=\"min-w-[100px]\"\n                >\n                  {isDeleting ? tForm('button_deleting') : tForm('button_delete')}\n                </Button>\n              )}\n\n              <div className=\"flex gap-2 ml-auto\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleOpenChange(false)}\n                  disabled={isSubmitting || isDeleting || isLoadingSubject}\n                  className=\"min-w-[80px]\"\n                >\n                  {tForm('button_cancel')}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={isSubmitting || isDeleting || isLoadingSubject}\n                  className=\"min-w-[100px]\"\n                >\n                  {isSubmitting\n                    ? tForm('button_saving')\n                    : isEditMode\n                    ? tForm('button_update')\n                    : tForm('button_create')}\n                </Button>\n              </div>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n\n      {/* Confirmation dialog for code change */}\n      <AlertDialog open={showCodeChangeConfirm} onOpenChange={setShowCodeChangeConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tConfirm('title_subject')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tConfirm('description_subject', {\n                oldCode: subject?.code || '',\n                newCode: pendingFormData?.code.toUpperCase() || ''\n              })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={handleCancelCodeChange}>\n              {tConfirm('button_cancel')}\n            </AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmCodeChange}>\n              {tConfirm('button_confirm')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\subject-pagination.tsx",
      "relative_path": "components/admin/subjects/subject-pagination.tsx",
      "filename": "subject-pagination.tsx",
      "size_bytes": 3015,
      "lines": 113,
      "last_modified": "2025-11-01T15:38:43.310380",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "import {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface SubjectPaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  disabled?: boolean;\n}\n\nexport function SubjectPagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  disabled = false,\n}: SubjectPaginationProps) {\n  const generatePageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 4) {\n        for (let i = 1; i <= 5; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 3) {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = totalPages - 4; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push(\"ellipsis\");\n        for (let i = currentPage - 1; i <= currentPage + 1; i++) {\n          pages.push(i);\n        }\n        pages.push(\"ellipsis\");\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  const pageNumbers = generatePageNumbers();\n\n  return (\n    <Pagination>\n      <PaginationContent>\n        <PaginationItem>\n          <PaginationPrevious\n            onClick={() =>\n              !disabled && currentPage > 1 && onPageChange(currentPage - 1)\n            }\n            className={\n              disabled || currentPage === 1\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n\n        {pageNumbers.map((page, index) =>\n          page === \"ellipsis\" ? (\n            <PaginationItem key={`ellipsis-${index}`}>\n              <PaginationEllipsis />\n            </PaginationItem>\n          ) : (\n            <PaginationItem key={page}>\n              <PaginationLink\n                onClick={() => !disabled && onPageChange(page)}\n                isActive={currentPage === page}\n                className={\n                  disabled ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"\n                }\n              >\n                {page}\n              </PaginationLink>\n            </PaginationItem>\n          )\n        )}\n\n        <PaginationItem>\n          <PaginationNext\n            onClick={() =>\n              !disabled &&\n              currentPage < totalPages &&\n              onPageChange(currentPage + 1)\n            }\n            className={\n              disabled || currentPage >= totalPages\n                ? \"pointer-events-none opacity-50\"\n                : \"cursor-pointer\"\n            }\n          />\n        </PaginationItem>\n      </PaginationContent>\n    </Pagination>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\subjects\\subject-table.tsx",
      "relative_path": "components/admin/subjects/subject-table.tsx",
      "filename": "subject-table.tsx",
      "size_bytes": 4727,
      "lines": 155,
      "last_modified": "2025-11-11T10:48:14.530514",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from 'next-intl';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Subject } from \"@/types\";\nimport { SubjectPagination } from \"./subject-pagination\";\n\ninterface SubjectTableProps {\n  columns: ColumnDef<Subject>[];\n  data: Subject[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function SubjectTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: SubjectTableProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const t = useTranslations('subject');\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[900px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t('no_subjects')}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t('pagination_showing', {\n              start: (currentPage - 1) * pageSize + 1,\n              end: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t('pagination_no_items')\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <SubjectPagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={onPageChange}\n              disabled={isLoading}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\import-photos-embeddings-dialog.tsx",
      "relative_path": "components/admin/users-roles/import-photos-embeddings-dialog.tsx",
      "filename": "import-photos-embeddings-dialog.tsx",
      "size_bytes": 18861,
      "lines": 506,
      "last_modified": "2025-11-14T17:01:59.632981",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { AlertCircle, CheckCircle2, Upload, FileUp, X, FileArchive } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { cn } from \"@/lib/utils\";\nimport { useImportPhotosEmbeddings } from \"@/hooks/api/useStudentProfiles\";\n\ninterface ImportError {\n  rowNumber: number;\n  message: string;\n  errorCode?: string;\n}\n\ninterface ImportPhotosEmbeddingsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport default function ImportPhotosEmbeddingsDialog({\n  open,\n  onOpenChange,\n}: ImportPhotosEmbeddingsDialogProps) {\n  const [csvFile, setCsvFile] = useState<File | null>(null);\n  const [zipFile, setZipFile] = useState<File | null>(null);\n  const [importMode, setImportMode] = useState<\"AddOnly\" | \"AddAndUpdate\">(\n    \"AddOnly\"\n  );\n  const [importResult, setImportResult] = useState<{\n    success: boolean;\n    message: string;\n    successCount?: number;\n    failureCount?: number;\n    errors?: ImportError[];\n  } | null>(null);\n\n  const { mutateAsync: performImport, isPending } = useImportPhotosEmbeddings();\n\n  // CSV file handlers\n  const handleCsvFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!file.name.endsWith(\".csv\")) {\n        toast.error(\"Please select a valid CSV file\");\n        return;\n      }\n      setCsvFile(file);\n      setImportResult(null);\n    }\n  };\n\n  const handleCsvDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      if (!file.name.endsWith(\".csv\")) {\n        toast.error(\"Please select a valid CSV file\");\n        return;\n      }\n      setCsvFile(file);\n      setImportResult(null);\n    }\n  }, []);\n\n  // ZIP file handlers\n  const handleZipFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!file.name.endsWith(\".zip\")) {\n        toast.error(\"Please select a valid ZIP file\");\n        return;\n      }\n      setZipFile(file);\n      setImportResult(null);\n    }\n  };\n\n  const handleZipDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      if (!file.name.endsWith(\".zip\")) {\n        toast.error(\"Please select a valid ZIP file\");\n        return;\n      }\n      setZipFile(file);\n      setImportResult(null);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n  }, []);\n\n  const clearCsvFile = () => {\n    setCsvFile(null);\n    setImportResult(null);\n  };\n\n  const clearZipFile = () => {\n    setZipFile(null);\n    setImportResult(null);\n  };\n\n  const handleImport = async () => {\n    if (!csvFile) {\n      toast.error(\"Please select a CSV file\");\n      return;\n    }\n    if (!zipFile) {\n      toast.error(\"Please select a ZIP file\");\n      return;\n    }\n\n    try {\n      const result = await performImport({\n        csvFile,\n        zipFile,\n        mode: importMode,\n      });\n\n      // Check if there are any errors\n      if (result.errors && result.errors.length > 0) {\n        setImportResult({\n          success: false,\n          message: `Import completed with ${result.failureCount} error(s)`,\n          successCount: result.successCount,\n          failureCount: result.failureCount,\n          errors: result.errors,\n        });\n        // Toast already shown by hook's onSuccess callback\n      } else {\n        setImportResult({\n          success: true,\n          message: `All ${result.successCount} photo(s) and embedding(s) imported successfully!`,\n          successCount: result.successCount,\n          failureCount: result.failureCount,\n        });\n        // Toast already shown by hook's onSuccess callback\n\n        // Auto close after success\n        setTimeout(() => {\n          handleClose();\n        }, 2000);\n      }\n    } catch (error) {\n      const err = error as { response?: { data?: { message?: string } } };\n      const errorMessage =\n        err.response?.data?.message || \"Failed to import photos and embeddings\";\n\n      setImportResult({\n        success: false,\n        message: errorMessage,\n      });\n      // Toast already shown by hook's onError callback\n    }\n  };\n\n  const handleClose = () => {\n    setCsvFile(null);\n    setZipFile(null);\n    setImportMode(\"AddOnly\");\n    setImportResult(null);\n    onOpenChange(false);\n  };\n\n  // Reset state when dialog opens\n  useEffect(() => {\n    if (open) {\n      setCsvFile(null);\n      setZipFile(null);\n      setImportMode(\"AddOnly\");\n      setImportResult(null);\n    }\n  }, [open]);\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[95vh] flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"px-6 pt-6 pb-4 border-b\">\n          <DialogTitle className=\"text-xl\">\n            Import Student Photos & Face Embeddings\n          </DialogTitle>\n          <DialogDescription className=\"text-sm\">\n            Upload a CSV file with columns:{\" \"}\n            <code className=\"text-xs bg-muted px-1.5 py-0.5 rounded\">\n              roll_number\n            </code>\n            ,{\" \"}\n            <code className=\"text-xs bg-muted px-1.5 py-0.5 rounded\">\n              image_filename\n            </code>\n            {\" \"}and a ZIP file containing the image files referenced in the CSV.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex-1\">\n          <div className=\"px-6 py-6 space-y-6 max-h-[calc(95vh-220px)] overflow-y-auto\">\n            {/* Import Mode - Select Dropdown */}\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"import-mode\" className=\"text-sm font-medium\">\n                Import Mode\n              </Label>\n              <Select\n                value={importMode}\n                onValueChange={(value) =>\n                  setImportMode(value as \"AddOnly\" | \"AddAndUpdate\")\n                }\n                disabled={isPending}\n              >\n                <SelectTrigger id=\"import-mode\" className=\"w-full\">\n                  <SelectValue placeholder=\"Select import mode\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"AddOnly\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium\">Add Only</span>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        Safer\n                      </Badge>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Skip students who already have photos\n                    </p>\n                  </SelectItem>\n                  <SelectItem value=\"AddAndUpdate\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium\">Add and Update</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Advanced\n                      </Badge>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Add new and replace existing photos\n                    </p>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* CSV File Upload Zone */}\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">CSV File</Label>\n              {!csvFile ? (\n                <div\n                  onDrop={handleCsvDrop}\n                  onDragOver={handleDragOver}\n                  className={cn(\n                    \"relative w-full border-2 border-dashed rounded-lg transition-all\",\n                    \"hover:border-primary/50 hover:bg-accent/5\",\n                    isPending\n                      ? \"opacity-50 cursor-not-allowed\"\n                      : \"cursor-pointer\"\n                  )}\n                >\n                  <input\n                    id=\"csv-file\"\n                    type=\"file\"\n                    accept=\".csv\"\n                    onChange={handleCsvFileChange}\n                    disabled={isPending}\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed\"\n                  />\n                  <div className=\"flex items-center gap-3 px-4 py-3\">\n                    <div className=\"rounded-md bg-primary/10 p-2\">\n                      <Upload className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium\">\n                        Choose CSV file or drag and drop\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        .csv file only\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"pointer-events-none h-8 text-xs shrink-0\"\n                      type=\"button\"\n                    >\n                      Browse\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"w-full flex items-center gap-3 p-3 bg-muted/50 rounded-lg border-2 border-muted\">\n                  <div className=\"rounded-md bg-green-100 dark:bg-green-900/30 p-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm truncate\">\n                      {csvFile.name}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {(csvFile.size / 1024).toFixed(2)} KB\n                    </p>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={clearCsvFile}\n                    disabled={isPending}\n                    className=\"shrink-0 h-8 w-8\"\n                    type=\"button\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* ZIP File Upload Zone */}\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ZIP File (Image Archive)</Label>\n              {!zipFile ? (\n                <div\n                  onDrop={handleZipDrop}\n                  onDragOver={handleDragOver}\n                  className={cn(\n                    \"relative w-full border-2 border-dashed rounded-lg transition-all\",\n                    \"hover:border-primary/50 hover:bg-accent/5\",\n                    isPending\n                      ? \"opacity-50 cursor-not-allowed\"\n                      : \"cursor-pointer\"\n                  )}\n                >\n                  <input\n                    id=\"zip-file\"\n                    type=\"file\"\n                    accept=\".zip\"\n                    onChange={handleZipFileChange}\n                    disabled={isPending}\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed\"\n                  />\n                  <div className=\"flex items-center gap-3 px-4 py-3\">\n                    <div className=\"rounded-md bg-blue-100 dark:bg-blue-900/30 p-2\">\n                      <FileArchive className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium\">\n                        Choose ZIP file or drag and drop\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        .zip file only (max 100MB)\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"pointer-events-none h-8 text-xs shrink-0\"\n                      type=\"button\"\n                    >\n                      Browse\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"w-full flex items-center gap-3 p-3 bg-muted/50 rounded-lg border-2 border-muted\">\n                  <div className=\"rounded-md bg-green-100 dark:bg-green-900/30 p-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm truncate\">\n                      {zipFile.name}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {(zipFile.size / 1024 / 1024).toFixed(2)} MB\n                    </p>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={clearZipFile}\n                    disabled={isPending}\n                    className=\"shrink-0 h-8 w-8\"\n                    type=\"button\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* Import Result */}\n            {importResult && (\n              <div className=\"animate-in fade-in-50 duration-300\">\n                {importResult.success ? (\n                  <div className=\"rounded-lg border-2 border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950/30 p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"rounded-full bg-green-100 dark:bg-green-900/50 p-2\">\n                        <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-sm text-green-900 dark:text-green-100\">\n                          {importResult.message}\n                        </h4>\n                        <p className=\"text-xs text-green-700 dark:text-green-300 mt-1\">\n                          {importResult.successCount} photo(s) and embedding(s) imported\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"rounded-lg border-2 border-destructive/30 bg-destructive/5\">\n                    <div className=\"p-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <div className=\"rounded-full bg-destructive/10 p-2 shrink-0\">\n                          <AlertCircle className=\"h-5 w-5 text-destructive\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <h4 className=\"font-semibold text-sm text-destructive\">\n                            {importResult.message}\n                          </h4>\n                          {importResult.successCount !== undefined && (\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              {importResult.successCount} successful, {importResult.failureCount} failed\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                    {importResult.errors && importResult.errors.length > 0 && (\n                      <div className=\"border-t border-destructive/20\">\n                        <div className=\"max-h-[300px] overflow-y-auto\">\n                          <div className=\"p-4 space-y-2\">\n                            {importResult.errors.map((error, index) => (\n                              <div\n                                key={index}\n                                className=\"flex items-start gap-3 p-3 bg-background rounded-md border-l-2 border-destructive\"\n                              >\n                                <Badge\n                                  variant=\"destructive\"\n                                  className=\"shrink-0 mt-0.5 text-[10px] px-2 py-0.5\"\n                                >\n                                  Row {error.rowNumber}\n                                </Badge>\n                                <p className=\"text-xs text-muted-foreground flex-1 break-words\">\n                                  {error.message}\n                                </p>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 justify-end px-6 py-4 border-t shrink-0 bg-muted/30\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={isPending}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            onClick={handleImport}\n            disabled={!csvFile || !zipFile || isPending}\n          >\n            {isPending ? (\n              <>\n                <Upload className=\"mr-2 h-4 w-4 animate-pulse\" />\n                Importing...\n              </>\n            ) : (\n              <>\n                <FileUp className=\"mr-2 h-4 w-4\" />\n                Import\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\multi-select-role-filter.tsx",
      "relative_path": "components/admin/users-roles/multi-select-role-filter.tsx",
      "filename": "multi-select-role-filter.tsx",
      "size_bytes": 4580,
      "lines": 136,
      "last_modified": "2025-11-01T15:38:43.311388",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Check, ChevronsUpDown, X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Role } from \"@/types\";\n\ninterface MultiSelectRoleFilterProps {\n  value: number[];\n  onChange: (value: number[]) => void;\n  disabled?: boolean;\n  roles: Role[];\n  isLoading?: boolean;\n}\n\nexport function MultiSelectRoleFilter({\n  value,\n  onChange,\n  disabled = false,\n  roles = [],\n  isLoading = false,\n}: MultiSelectRoleFilterProps) {\n  const [open, setOpen] = React.useState(false);\n\n  const selectedRoles = roles.filter((role) => value.includes(role.id));\n\n  const handleSelect = (roleId: number) => {\n    const newValue = value.includes(roleId)\n      ? value.filter((id) => id !== roleId)\n      : [...value, roleId];\n    onChange(newValue);\n    // Keep popover open for multi-select behavior\n    setOpen(true);\n  };\n\n  const handleRemove = (roleId: number, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onChange(value.filter((id) => id !== roleId));\n  };\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          disabled={disabled || isLoading}\n          className=\"w-full justify-between h-auto min-h-[40px] px-3 py-2\"\n        >\n          <div className=\"flex flex-wrap gap-1 flex-1\">\n            {isLoading ? (\n              <span className=\"text-muted-foreground\">Loading roles...</span>\n            ) : selectedRoles.length === 0 ? (\n              <span className=\"text-muted-foreground\">All Roles</span>\n            ) : (\n              selectedRoles.map((role) => (\n                <Badge\n                  key={role.id}\n                  variant=\"default\"\n                  className=\"text-xs flex items-center gap-1\"\n                >\n                  {role.name}\n                  <span\n                    className=\"ml-1 hover:text-foreground cursor-pointer\"\n                    onClick={(e) => handleRemove(role.id, e)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" || e.key === \" \") {\n                        e.preventDefault();\n                        const syntheticEvent = e as unknown as React.MouseEvent;\n                        handleRemove(role.id, syntheticEvent);\n                      }\n                    }}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </span>\n                </Badge>\n              ))\n            )}\n          </div>\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-[450px] p-0\" align=\"start\">\n        <Command shouldFilter={false}>\n          <CommandInput placeholder=\"Search roles...\" className=\"h-9\" />\n          <CommandList className=\"max-h-[300px] overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-track]:bg-transparent\">\n            <CommandEmpty>\n              {isLoading ? \"Loading...\" : \"No role found.\"}\n            </CommandEmpty>\n            <CommandGroup>\n              {roles.map((role) => {\n                const isSelected = value.includes(role.id);\n                return (\n                  <CommandItem\n                    key={role.id}\n                    value={role.name}\n                    onSelect={() => handleSelect(role.id)}\n                  >\n                    <div className=\"flex items-center flex-1\">\n                      <Check\n                        className={cn(\n                          \"mr-2 h-4 w-4\",\n                          isSelected ? \"opacity-100\" : \"opacity-0\"\n                        )}\n                      />\n                      <span className=\"font-medium\">{role.name}</span>\n                    </div>\n                  </CommandItem>\n                );\n              })}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\multi-select-roles.tsx",
      "relative_path": "components/admin/users-roles/multi-select-roles.tsx",
      "filename": "multi-select-roles.tsx",
      "size_bytes": 5305,
      "lines": 161,
      "last_modified": "2025-11-01T15:38:43.311388",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Check, ChevronsUpDown, X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Badge } from \"@/components/ui/badge\";\n\ntype StaffRole = \"LECTURER\" | \"SUPERVISOR\";\n\ninterface RoleOption {\n  value: StaffRole;\n  label: string;\n  description: string;\n}\n\nconst ROLE_OPTIONS: RoleOption[] = [\n  {\n    value: \"LECTURER\",\n    label: \"Lecturer\",\n    description: \"Teaching activities and lectures\",\n  },\n  {\n    value: \"SUPERVISOR\",\n    label: \"Supervisor\",\n    description: \"Exam invigilation and supervision\",\n  },\n];\n\ninterface MultiSelectRolesProps {\n  value: StaffRole[];\n  onChange: (value: StaffRole[]) => void;\n  disabled?: boolean;\n  error?: boolean;\n}\n\nexport function MultiSelectRoles({\n  value,\n  onChange,\n  disabled = false,\n  error = false,\n}: MultiSelectRolesProps) {\n  const [open, setOpen] = React.useState(false);\n\n  const selectedRoles = ROLE_OPTIONS.filter((role) =>\n    value.includes(role.value)\n  );\n\n  const handleSelect = (roleValue: StaffRole) => {\n    const newValue = value.includes(roleValue)\n      ? value.filter((r) => r !== roleValue)\n      : [...value, roleValue];\n    onChange(newValue);\n  };\n\n  const handleRemove = (roleValue: StaffRole, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onChange(value.filter((r) => r !== roleValue));\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            disabled={disabled}\n            className={cn(\n              \"w-full justify-between h-auto min-h-[40px] px-3 py-2\",\n              error && \"border-destructive\"\n            )}\n          >\n            <div className=\"flex flex-wrap gap-1 flex-1\">\n              {selectedRoles.length === 0 ? (\n                <span className=\"text-muted-foreground\">Select roles...</span>\n              ) : (\n                selectedRoles.map((role) => (\n                  <Badge\n                    key={role.value}\n                    variant=\"default\"\n                    className=\"text-xs flex items-center gap-1\"\n                  >\n                    {role.label}\n                    <span\n                      className=\"ml-1 hover:text-foreground cursor-pointer\"\n                      onClick={(e) => handleRemove(role.value, e)}\n                      role=\"button\"\n                      tabIndex={0}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" || e.key === \" \") {\n                          e.preventDefault();\n                          const syntheticEvent =\n                            e as unknown as React.MouseEvent;\n                          handleRemove(role.value, syntheticEvent);\n                        }\n                      }}\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </span>\n                  </Badge>\n                ))\n              )}\n            </div>\n            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-[450px] p-0\" align=\"start\">\n          <Command shouldFilter={false}>\n            <CommandInput placeholder=\"Search roles...\" className=\"h-9\" />\n            <CommandList className=\"max-h-[300px] overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-track]:bg-transparent\">\n              <CommandEmpty>No role found.</CommandEmpty>\n              <CommandGroup>\n                {ROLE_OPTIONS.map((role) => {\n                  const isSelected = value.includes(role.value);\n                  return (\n                    <CommandItem\n                      key={role.value}\n                      value={`${role.label} ${role.description}`}\n                      onSelect={() => handleSelect(role.value)}\n                    >\n                      <div className=\"flex items-center flex-1\">\n                        <Check\n                          className={cn(\n                            \"mr-2 h-4 w-4\",\n                            isSelected ? \"opacity-100\" : \"opacity-0\"\n                          )}\n                        />\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">{role.label}</span>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {role.description}\n                          </span>\n                        </div>\n                      </div>\n                    </CommandItem>\n                  );\n                })}\n              </CommandGroup>\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\staff-class-summary-view.tsx",
      "relative_path": "components/admin/users-roles/staff-class-summary-view.tsx",
      "filename": "staff-class-summary-view.tsx",
      "size_bytes": 13450,
      "lines": 374,
      "last_modified": "2025-11-24T17:31:22.876890",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect, useMemo, useRef } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { GraduationCap, Calendar, Users, Clock, CheckCircle, ExternalLink, Eye, BookOpen, ChevronLeft } from \"lucide-react\";\nimport { AttendanceMatrixTable } from \"@/components/lecturer/reports/attendance-matrix-table\";\nimport { StudentAttendanceTable } from \"@/components/lecturer/reports/student-attendance-table\";\nimport { useAdminLecturerSemestersClasses } from \"@/hooks/api/useAdminUserReports\";\nimport api from \"@/lib/api-axios\";\nimport { API_ENDPOINTS } from \"@/lib/constants\";\n\ninterface StaffClassSummaryViewProps {\n  userId: number;\n  userName: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\n// Types matching backend DTOs\ninterface SlotSummaryDTO {\n  slotId: number;\n  title: string;\n  description?: string;\n  startTime: string;\n  endTime: string;\n  slotCategory: \"LECTURE\" | \"LECTURE_WITH_PT\" | \"FINAL_EXAM\";\n}\n\ninterface ClassSummaryData {\n  classInfo: {\n    id: number;\n    code: string;\n    subject: {\n      id: number;\n      name: string;\n      code: string;\n    };\n    semester: {\n      id: number;\n      name: string;\n    };\n  };\n  enrollmentSummary: {\n    totalStudents: number;\n  };\n  attendanceStatistics: {\n    totalSlots: number;\n    completedSlots: number;\n    upcomingSlots: number;\n  };\n  slots: SlotSummaryDTO[];\n  students: Array<{\n    userId: number;\n    fullName: string;\n    rollNumber: string;\n    email: string;\n    major: {\n      name: string;\n      code: string;\n    };\n    attendanceSummary: {\n      totalSlots: number;\n      presentCount: number;\n      absentCount: number;\n      notYetCount: number;\n    };\n    attendanceRecords: Record<number, \"PRESENT\" | \"ABSENT\" | \"present\" | \"absent\" | null>;\n  }>;\n}\n\ninterface ClassInfo {\n  id: number;\n  code: string;\n  subject: {\n    id: number;\n    name: string;\n    code: string;\n  };\n}\n\nexport function StaffClassSummaryView({\n  userId,\n  userName,\n  open,\n  onOpenChange,\n}: StaffClassSummaryViewProps) {\n  const t = useTranslations(\"admin.users_roles.staffs.class_summary\");\n  const [selectedSemester, setSelectedSemester] = useState<string>(\"\");\n  const [selectedClass, setSelectedClass] = useState<ClassInfo | null>(null);\n  const [classSummary, setClassSummary] = useState<ClassSummaryData | null>(null);\n  const [loading, setLoading] = useState(false);\n  const hasAutoSelected = useRef(false);\n\n  // Fetch semesters with classes for this lecturer\n  const { data: semestersData, isLoading: isLoadingSemesters } = useAdminLecturerSemestersClasses(\n    userId,\n    true\n  );\n\n  // Get classes for selected semester\n  const availableClasses = selectedSemester\n    ? semestersData?.find((s) => s.id.toString() === selectedSemester)?.classes || []\n    : [];\n\n  // Calculate current semester\n  const currentSemester = useMemo(() => {\n    if (!semestersData || semestersData.length === 0) return null;\n    const now = new Date();\n    return semestersData.find((s) => {\n      const start = new Date(s.startDate);\n      const end = new Date(s.endDate);\n      return now >= start && now <= end;\n    });\n  }, [semestersData]);\n\n  // Auto-select current semester only once\n  useEffect(() => {\n    if (!selectedSemester && currentSemester && semestersData && semestersData.length > 0 && !hasAutoSelected.current) {\n      hasAutoSelected.current = true;\n      setSelectedSemester(currentSemester.id.toString());\n    }\n  }, [currentSemester, semestersData, selectedSemester]);\n\n  const fetchClassSummary = async (classId: number, semesterId: string) => {\n    setLoading(true);\n    try {\n      const response = await api.get(\n        `${API_ENDPOINTS.classes.byId(classId.toString())}/summary`,\n        { params: { semester: semesterId } }\n      );\n      if (response && typeof response === \"object\" && \"classInfo\" in response) {\n        setClassSummary(response as unknown as ClassSummaryData);\n      } else if (response && (response as any).data) {\n        setClassSummary((response as any).data as ClassSummaryData);\n      } else {\n        setClassSummary(null);\n      }\n    } catch {\n      setClassSummary(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleViewClass = (cls: ClassInfo) => {\n    setSelectedClass(cls);\n    fetchClassSummary(cls.id, selectedSemester);\n  };\n\n  const handleBackToList = () => {\n    setSelectedClass(null);\n    setClassSummary(null);\n  };\n\n  // Detail view - showing class attendance matrix\n  if (selectedClass) {\n    return (\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-0\">\n          <DialogHeader className=\"px-6 py-4 border-b\">\n            <DialogTitle className=\"flex items-center gap-2\">\n              <GraduationCap className=\"h-5 w-5\" />\n              {t(\"detail_title\", { classCode: selectedClass.code, subjectName: selectedClass.subject.name })}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <Button variant=\"ghost\" size=\"sm\" onClick={handleBackToList}>\n                <ChevronLeft className=\"h-4 w-4 mr-1\" />\n                {t(\"back_to_list\")}\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => window.open(`/admin/classes/${selectedClass.id}/roster`, '_blank')}\n              >\n                <ExternalLink className=\"h-4 w-4 mr-1\" />\n                {t(\"go_to_roster\")}\n              </Button>\n            </div>\n          {/* Loading State */}\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                <span>{t(\"loading\")}</span>\n              </div>\n            </div>\n          )}\n\n          {/* Class Summary Content */}\n          {classSummary && !loading && (\n            <div className=\"space-y-6\">\n              {/* Overview Cards */}\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.total_students\")}</p>\n                        <p className=\"text-2xl font-bold\">{classSummary.enrollmentSummary.totalStudents}</p>\n                      </div>\n                      <Users className=\"h-8 w-8 text-blue-500\" />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.total_slots\")}</p>\n                        <p className=\"text-2xl font-bold\">{classSummary.attendanceStatistics.totalSlots}</p>\n                      </div>\n                      <Clock className=\"h-8 w-8 text-orange-500\" />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.completed\")}</p>\n                        <p className=\"text-2xl font-bold text-green-600\">{classSummary.attendanceStatistics.completedSlots}</p>\n                      </div>\n                      <CheckCircle className=\"h-8 w-8 text-green-500\" />\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Attendance Matrix Table */}\n              <div className=\"overflow-x-auto\">\n                <AttendanceMatrixTable\n                  slots={classSummary.slots}\n                  students={classSummary.students}\n                />\n              </div>\n\n              {/* Student Attendance Table */}\n              <div className=\"overflow-x-auto\">\n                <StudentAttendanceTable students={classSummary.students as any} />\n              </div>\n            </div>\n          )}\n\n            {/* Empty State */}\n            {!loading && !classSummary && (\n              <div className=\"flex items-center justify-center py-12\">\n                <p className=\"text-muted-foreground\">{t(\"no_data\")}</p>\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  // List view - showing class list\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"px-6 py-4 border-b\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <GraduationCap className=\"h-5 w-5\" />\n            {t(\"title\", { userName })}\n          </DialogTitle>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            {t(\"description\")}\n          </p>\n        </DialogHeader>\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n          {/* Semester Filter */}\n        <div className=\"flex flex-wrap items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            <span className=\"font-medium\">{t(\"semester\")}</span>\n          </div>\n          <Select\n            value={selectedSemester}\n            onValueChange={setSelectedSemester}\n            disabled={isLoadingSemesters}\n          >\n            <SelectTrigger className=\"w-[280px]\">\n              <SelectValue placeholder={isLoadingSemesters ? t(\"loading_semesters\") : t(\"select_semester\")} />\n            </SelectTrigger>\n            <SelectContent>\n              {semestersData && semestersData.length > 0 ? (\n                semestersData.map((semester) => (\n                  <SelectItem key={semester.id} value={semester.id.toString()}>\n                    {semester.name} ({semester.code})\n                  </SelectItem>\n                ))\n              ) : (\n                <div className=\"px-2 py-1.5 text-sm text-muted-foreground\">\n                  {t(\"no_semesters\")}\n                </div>\n              )}\n            </SelectContent>\n          </Select>\n          {selectedSemester && (\n            <Badge variant=\"secondary\">\n              {t(\"class_count\", { count: availableClasses.length })}\n            </Badge>\n          )}\n        </div>\n\n        {/* Class List */}\n        {selectedSemester && availableClasses.length > 0 && (\n          <div className=\"space-y-2\">\n            {availableClasses.map((cls) => (\n              <div\n                key={cls.id}\n                className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors\"\n              >\n                <div className=\"flex-1 min-w-0 space-y-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <BookOpen className=\"h-4 w-4 text-primary shrink-0\" />\n                    <span className=\"font-semibold truncate\">{cls.code}</span>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground pl-6 truncate\">\n                    {cls.subject.code} - {cls.subject.name}\n                  </p>\n                </div>\n                <Button size=\"sm\" onClick={() => handleViewClass(cls)}>\n                  <Eye className=\"h-4 w-4 mr-1\" />\n                  {t(\"view\")}\n                </Button>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Empty State */}\n        {selectedSemester && availableClasses.length === 0 && (\n          <div className=\"flex flex-col items-center justify-center py-8\">\n            <GraduationCap className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">\n              {t(\"empty.no_classes\")}\n            </p>\n          </div>\n        )}\n\n          {/* Initial State */}\n          {!selectedSemester && !isLoadingSemesters && (\n            <div className=\"flex flex-col items-center justify-center py-8\">\n              <Calendar className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground text-center\">\n                {t(\"empty.select_semester\")}\n              </p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\staff-columns.tsx",
      "relative_path": "components/admin/users-roles/staff-columns.tsx",
      "filename": "staff-columns.tsx",
      "size_bytes": 7399,
      "lines": 216,
      "last_modified": "2025-11-24T17:15:13.742153",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Pencil, MoreHorizontal, GraduationCap, ShieldCheck } from \"lucide-react\";\n\nexport type StaffUserRow = {\n  id: number;\n  username: string;\n  staffCode: string;\n  fullName: string;\n  email: string;\n  isActive: boolean;\n  roles: string[]; // Array of role names: \"LECTURER\", \"SUPERVISOR\", \"DATA_OPERATOR\"\n  createdAt: string;\n  updatedAt: string;\n};\n\nexport function getInitials(name: string) {\n  const parts = name.trim().split(/\\s+/);\n  const first = parts[0]?.[0] || \"\";\n  const last = parts.length > 1 ? parts[parts.length - 1][0] : \"\";\n  return (first + last).toUpperCase();\n}\n\ntype TranslationFunction = (key: string, values?: Record<string, string | number | Date>) => string;\n\n// Helper to format role names for display using translations\nfunction formatRoleName(role: string, t: TranslationFunction): string {\n  const roleKeyMap: Record<string, string> = {\n    LECTURER: \"table.roles.lecturer\",\n    SUPERVISOR: \"table.roles.supervisor\",\n    DATA_OPERATOR: \"table.roles.data_operator\",\n  };\n  const key = roleKeyMap[role];\n  return key ? t(key) : role.replace(/_/g, \" \");\n}\n\nexport function createStaffColumns(\n  handlers: {\n    onEdit: (row: StaffUserRow) => void;\n    onToggleStatus: (row: StaffUserRow) => void;\n    onViewClassSummary?: (row: StaffUserRow) => void;\n    onViewSlotSummary?: (row: StaffUserRow) => void;\n  },\n  t: TranslationFunction\n): ColumnDef<StaffUserRow>[] {\n  return [\n    {\n      accessorKey: \"staffCode\",\n      header: () => <div className=\"text-center\">{t(\"table.header.staff_code\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center font-medium\">{row.original.staffCode}</div>\n      ),\n    },\n    {\n      accessorKey: \"fullName\",\n      header: () => <div className=\"text-left\">{t(\"table.header.full_name\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"flex items-center gap-2\">\n          <span className=\"font-medium\">{row.original.fullName}</span>\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"email\",\n      header: () => <div className=\"text-left\">{t(\"table.header.email\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-sm text-muted-foreground\">\n          {row.original.email}\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"roles\",\n      header: () => <div className=\"text-center\">{t(\"table.header.roles\")}</div>,\n      cell: ({ row }) => {\n        const roles = row.original.roles;\n        const roleCount = roles.length;\n\n        // If no roles\n        if (roleCount === 0) {\n          return (\n            <div className=\"flex justify-center\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {t(\"table.cell.no_roles\")}\n              </Badge>\n            </div>\n          );\n        }\n\n        // If single role, display directly\n        if (roleCount === 1) {\n          return (\n            <div className=\"flex justify-center\">\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {formatRoleName(roles[0], t)}\n              </Badge>\n            </div>\n          );\n        }\n\n        // If multiple roles, show count with tooltip (like subject majors)\n        return (\n          <div className=\"flex justify-center\">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Badge\n                    variant=\"secondary\"\n                    className=\"text-xs cursor-help w-[70px] justify-center\"\n                  >\n                    {t(\"table.cell.roles_count\", { count: roleCount })}\n                  </Badge>\n                </TooltipTrigger>\n                <TooltipContent side=\"right\" className=\"max-w-xs\">\n                  <div className=\"space-y-1\">\n                    {roles.map((role) => (\n                      <div\n                        key={role}\n                        className=\"text-sm flex items-center gap-2 px-2 py-1\"\n                      >\n                        <Badge variant=\"default\" className=\"text-xs\">\n                          {formatRoleName(role, t)}\n                        </Badge>\n                      </div>\n                    ))}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          </div>\n        );\n      },\n    },\n    {\n      accessorKey: \"isActive\",\n      header: () => <div className=\"text-center\">{t(\"table.header.status\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"flex justify-center\">\n          <Badge\n            variant={row.original.isActive ? \"default\" : \"destructive\"}\n            className=\"w-[74px] justify-center\"\n          >\n            {row.original.isActive ? t(\"table.status.active\") : t(\"table.status.inactive\")}\n          </Badge>\n        </div>\n      ),\n    },\n    {\n      id: \"actions\",\n      header: () => <div className=\"text-center\">{t(\"table.header.actions\")}</div>,\n      cell: ({ row }) => {\n        const roles = row.original.roles;\n        const hasLecturer = roles.includes(\"LECTURER\");\n        const hasSupervisor = roles.includes(\"SUPERVISOR\");\n        const hasReportActions = hasLecturer || hasSupervisor;\n\n        return (\n          <div className=\"flex justify-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handlers.onEdit(row.original)}\n            >\n              <Pencil className=\"mr-2 h-4 w-4\" /> {t(\"table.menu.edit\")}\n            </Button>\n\n            {hasReportActions && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\">\n                    <MoreHorizontal className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  {hasLecturer && handlers.onViewClassSummary && (\n                    <DropdownMenuItem\n                      onClick={() => handlers.onViewClassSummary!(row.original)}\n                    >\n                      <GraduationCap className=\"mr-2 h-4 w-4\" />\n                      {t(\"table.menu.class_summary\")}\n                    </DropdownMenuItem>\n                  )}\n                  {hasLecturer && hasSupervisor && <DropdownMenuSeparator />}\n                  {hasSupervisor && handlers.onViewSlotSummary && (\n                    <DropdownMenuItem\n                      onClick={() => handlers.onViewSlotSummary!(row.original)}\n                    >\n                      <ShieldCheck className=\"mr-2 h-4 w-4\" />\n                      {t(\"table.menu.slot_summary\")}\n                    </DropdownMenuItem>\n                  )}\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n          </div>\n        );\n      },\n    },\n  ];\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\staff-form-dialogs.tsx",
      "relative_path": "components/admin/users-roles/staff-form-dialogs.tsx",
      "filename": "staff-form-dialogs.tsx",
      "size_bytes": 12573,
      "lines": 377,
      "last_modified": "2025-11-24T17:20:21.432897",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { StaffUserRow, getInitials } from \"./staff-columns\";\nimport {\n  useUpdateStaffProfile,\n  useCreateStaffProfile,\n} from \"@/hooks/api/useStaffProfiles\";\nimport { MultiSelectRoles } from \"./multi-select-roles\";\n\ntype StaffRole = \"LECTURER\" | \"SUPERVISOR\";\n\n// ============================================================================\n// EDIT STAFF DIALOG\n// ============================================================================\n\ninterface EditStaffDialogProps {\n  open: boolean;\n  staff: StaffUserRow | null;\n  onOpenChange: (open: boolean) => void;\n  onSave: (data: Partial<StaffUserRow>) => void;\n}\n\nexport function EditStaffDialog({\n  open,\n  staff,\n  onOpenChange,\n  onSave,\n}: EditStaffDialogProps) {\n  const t = useTranslations(\"admin.users_roles.staffs.dialog\");\n  const [fullName, setFullName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [staffCode, setStaffCode] = useState(\"\");\n  const [isActive, setIsActive] = useState(true);\n  const [roles, setRoles] = useState<StaffRole[]>([]);\n\n  const updateMutation = useUpdateStaffProfile();\n\n  // Update form when staff changes\n  useEffect(() => {\n    if (staff) {\n      setFullName(staff.fullName);\n      setEmail(staff.email);\n      setUsername(staff.username);\n      setStaffCode(staff.staffCode);\n      setIsActive(staff.isActive);\n      // staff.roles is already an array of role strings\n      setRoles(staff.roles as StaffRole[]);\n    }\n  }, [staff]);\n\n  const handleSave = () => {\n    if (!staff) return;\n\n    // At least one role required\n    if (roles.length === 0) {\n      return; // Validation will be handled by Zod in the mutation\n    }\n\n    updateMutation.mutate(\n      {\n        id: staff.id, // staff.id is already userId from adapter\n        payload: {\n          fullName,\n          email,\n          username,\n          staffCode,\n          roles: roles,\n          isActive,\n        },\n      },\n      {\n        onSuccess: () => {\n          onSave({});\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{t(\"edit.title\")}</DialogTitle>\n          <DialogDescription>\n            {t(\"edit.description\")}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          {/* Avatar Section */}\n          <div className=\"flex items-center gap-4 pb-4 border-b\">\n            <Avatar className=\"h-16 w-16\">\n              <AvatarFallback className=\"text-lg\">\n                {staff ? getInitials(staff.fullName) : \"ST\"}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-lg\">\n                {staff?.fullName || \"Staff Name\"}\n              </h3>\n              <p className=\"text-sm text-muted-foreground\">\n                {staff?.email || \"email@example.com\"}\n              </p>\n            </div>\n          </div>\n\n          {/* Form Fields */}\n          <div className=\"space-y-3\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              <div>\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.staff_code\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input disabled value={staffCode} className=\"bg-muted\" />\n              </div>\n              <div>\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.username\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input\n                  disabled\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  placeholder={t(\"form.placeholder_username\")}\n                  autoComplete=\"off\"\n                  className=\"bg-muted\"\n                />\n              </div>\n              <div className=\"sm:col-span-2\">\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.full_name\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input\n                  value={fullName}\n                  onChange={(e) => setFullName(e.target.value)}\n                  placeholder={t(\"form.placeholder_full_name\")}\n                  autoComplete=\"off\"\n                />\n              </div>\n              <div className=\"sm:col-span-2\">\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.email\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder={t(\"form.placeholder_email\")}\n                  autoComplete=\"off\"\n                />\n              </div>\n            </div>\n\n            {/* Roles Section */}\n            <div className=\"space-y-2\">\n              <div className=\"text-sm font-medium\">\n                {t(\"form.roles\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <MultiSelectRoles\n                value={roles}\n                onChange={setRoles}\n                disabled={updateMutation.isPending}\n                error={roles.length === 0}\n              />\n              {roles.length === 0 && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {t(\"form.roles_hint\")}\n                </p>\n              )}\n            </div>\n\n            {/* Active Status Toggle */}\n            <div className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5 flex-1\">\n                <div className=\"text-base font-medium\">{t(\"form.active_status\")}</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {isActive\n                    ? t(\"form.active_description\")\n                    : t(\"form.inactive_description\")}\n                </div>\n              </div>\n              <Switch checked={isActive} onCheckedChange={setIsActive} />\n            </div>\n          </div>\n        </div>\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={updateMutation.isPending}\n          >\n            {t(\"button.cancel\")}\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={updateMutation.isPending || roles.length === 0}\n          >\n            {updateMutation.isPending ? t(\"button.saving\") : t(\"button.save\")}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// ============================================================================\n// CREATE STAFF DIALOG\n// ============================================================================\n\ninterface CreateStaffDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onCreate: (data: {\n    staffCode: string;\n    email: string;\n    fullName: string;\n    roles: Array<\"LECTURER\" | \"SUPERVISOR\">;\n  }) => void;\n}\n\nexport function CreateStaffDialog({\n  open,\n  onOpenChange,\n  onCreate,\n}: CreateStaffDialogProps) {\n  const t = useTranslations(\"admin.users_roles.staffs.dialog\");\n  const [staffCode, setStaffCode] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [fullName, setFullName] = useState(\"\");\n  const [roles, setRoles] = useState<StaffRole[]>([]);\n\n  const createMutation = useCreateStaffProfile();\n\n  const handleCreate = () => {\n    if (!staffCode || !username || !email || !fullName) return;\n\n    // At least one role required\n    if (roles.length === 0) {\n      return;\n    }\n\n    createMutation.mutate(\n      {\n        staffCode,\n        username,\n        email,\n        fullName,\n        roles: roles,\n      },\n      {\n        onSuccess: () => {\n          onCreate({ staffCode, email, fullName, roles: roles });\n          // Reset form\n          setStaffCode(\"\");\n          setUsername(\"\");\n          setEmail(\"\");\n          setFullName(\"\");\n          setRoles([]);\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{t(\"create.title\")}</DialogTitle>\n          <DialogDescription>\n            {t(\"create.description\")}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n            <div className=\"sm:col-span-2\">\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.full_name\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={fullName}\n                onChange={(e) => setFullName(e.target.value)}\n                placeholder={t(\"form.placeholder_full_name\")}\n                autoComplete=\"off\"\n              />\n            </div>\n            <div>\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.staff_code\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={staffCode}\n                onChange={(e) => setStaffCode(e.target.value)}\n                placeholder={t(\"form.placeholder_staff_code\")}\n                autoComplete=\"off\"\n              />\n            </div>\n            <div>\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.username\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder={t(\"form.placeholder_username\")}\n                autoComplete=\"off\"\n              />\n            </div>\n            <div className=\"sm:col-span-2\">\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.email\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder={t(\"form.placeholder_email\")}\n                autoComplete=\"off\"\n              />\n            </div>\n          </div>\n\n          {/* Roles Section */}\n          <div className=\"space-y-2\">\n            <div className=\"text-sm font-medium\">\n              {t(\"form.roles\")} <span className=\"text-destructive\">*</span>\n            </div>\n            <MultiSelectRoles\n              value={roles}\n              onChange={setRoles}\n              disabled={createMutation.isPending}\n              error={roles.length === 0}\n            />\n            {roles.length === 0 && (\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"form.roles_hint\")}\n              </p>\n            )}\n          </div>\n        </div>\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={createMutation.isPending}\n          >\n            {t(\"button.cancel\")}\n          </Button>\n          <Button\n            onClick={handleCreate}\n            disabled={\n              createMutation.isPending ||\n              !staffCode ||\n              !email ||\n              !fullName ||\n              roles.length === 0\n            }\n          >\n            {createMutation.isPending ? t(\"button.creating\") : t(\"button.create\")}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\staff-slot-summary-view.tsx",
      "relative_path": "components/admin/users-roles/staff-slot-summary-view.tsx",
      "filename": "staff-slot-summary-view.tsx",
      "size_bytes": 18678,
      "lines": 483,
      "last_modified": "2025-11-24T17:33:32.497825",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect, useMemo, useRef } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { ShieldCheck, Calendar, ExternalLink, Eye, Clock, Users, MapPin, CheckCircle, XCircle, HelpCircle, ChevronLeft } from \"lucide-react\";\nimport { useGetSemesters } from \"@/hooks/api/useSemesters\";\nimport { useGetSlots } from \"@/hooks/api/useSlots\";\nimport api from \"@/lib/api-axios\";\nimport { format } from \"date-fns\";\n\ninterface StaffSlotSummaryViewProps {\n  userId: number;\n  userName: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\ninterface SlotInfo {\n  id: number;\n  title?: string | null;\n  description?: string | null;\n  startTime: string;\n  endTime: string;\n  room?: {\n    id: number;\n    name: string;\n    location?: string | null;\n  } | null;\n  academicClass?: {\n    id: number;\n    code: string;\n  } | null;\n}\n\n// Matches backend StudentAttendanceInfoDTO\ninterface StudentAttendanceInfo {\n  studentId: number;\n  rollNumber: string;\n  fullName: string;\n  photoUrl?: string | null;\n  subjectCode?: string | null;\n  subjectName?: string | null;\n  attendanceId?: number | null;\n  status: \"PRESENT\" | \"ABSENT\" | \"NOT_YET\" | \"present\" | \"absent\" | \"not_yet\";\n  method?: string | null;\n  recordedAt?: string | null;\n  checkInTime?: string | null;\n  checkOutTime?: string | null;\n  remark?: string | null;\n}\n\n// Matches backend ExamAttendanceReportDTO\ninterface ExamAttendanceReportData {\n  slotId: number;\n  title?: string | null;\n  description?: string | null;\n  startTime: string;\n  endTime: string;\n  room?: {\n    id: number;\n    name: string;\n    location?: string | null;\n  } | null;\n  staff?: {\n    id: number;\n    fullName: string;\n    email: string;\n  } | null;\n  sessionStatus?: string;\n  subjects?: Array<{\n    id: number;\n    code: string;\n    name: string;\n  }>;\n  students?: StudentAttendanceInfo[];\n  statistics?: {\n    totalStudents: number;\n    presentCount: number;\n    absentCount: number;\n    notYetCount: number;\n  };\n}\n\nexport function StaffSlotSummaryView({\n  userId,\n  userName,\n  open,\n  onOpenChange,\n}: StaffSlotSummaryViewProps) {\n  const t = useTranslations(\"admin.users_roles.staffs.slot_summary\");\n  const [selectedSemester, setSelectedSemester] = useState<number | undefined>();\n  const [selectedSlot, setSelectedSlot] = useState<SlotInfo | null>(null);\n  const hasAutoSelected = useRef(false);\n\n  // Fetch all semesters\n  const { data: semestersData, isLoading: semestersLoading } = useGetSemesters(\n    { pageSize: 100 },\n  );\n\n  const semesters = useMemo(() => semestersData?.items || [], [semestersData?.items]);\n\n  // Calculate current semester\n  const currentSemester = useMemo(() => {\n    if (!semesters || semesters.length === 0) return null;\n    const now = new Date();\n    return semesters.find((s) => {\n      const start = new Date(s.startDate);\n      const end = new Date(s.endDate);\n      return now >= start && now <= end;\n    });\n  }, [semesters]);\n\n  // Auto-select current semester only once\n  useEffect(() => {\n    if (selectedSemester === undefined && currentSemester && semesters.length > 0 && !hasAutoSelected.current) {\n      hasAutoSelected.current = true;\n      setSelectedSemester(currentSemester.id);\n    }\n  }, [currentSemester, semesters, selectedSemester]);\n\n  // Fetch slots for this supervisor (filtered by FINAL_EXAM)\n  const { data: slotsResponse, isLoading: slotsLoading } = useGetSlots({\n    staffUserId: userId,\n    slotCategories: [\"FINAL_EXAM\"],\n    semesterId: selectedSemester,\n    sortBy: \"startTime\",\n    sort: \"desc\",\n    page: 1,\n    pageSize: 100,\n  }, { enabled: !!userId });\n\n  const slots = slotsResponse?.items || [];\n\n  // Fetch attendance for selected slot - use slot.id directly (not examSlot.id)\n  // The API /exam-slots/{slotId}/attendance-report uses the Slot entity ID directly\n  const slotId = selectedSlot?.id;\n  const { data: attendanceData, isLoading: attendanceLoading } = useQuery({\n    queryKey: [\"exam-slot-attendance\", slotId],\n    queryFn: async () => {\n      const raw = await api.get(`/exam-slots/${slotId}/attendance-report`);\n\n      // Handle both wrapped and unwrapped response (defensive)\n      let data: ExamAttendanceReportData;\n      if (raw && typeof raw === \"object\" && \"slotId\" in raw) {\n        // Already unwrapped by axios interceptor\n        data = raw as unknown as ExamAttendanceReportData;\n      } else if (raw && typeof raw === \"object\" && \"data\" in raw) {\n        // Still wrapped with { status, data }\n        data = (raw as { data: ExamAttendanceReportData }).data;\n      } else {\n        throw new Error(\"Unexpected response structure\");\n      }\n\n      return data;\n    },\n    enabled: !!slotId,\n    staleTime: 1000 * 60 * 5,\n  });\n\n  const handleViewSlot = (slot: SlotInfo) => {\n    setSelectedSlot(slot);\n  };\n\n  const handleBackToList = () => {\n    setSelectedSlot(null);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const normalizedStatus = status.toUpperCase();\n    switch (normalizedStatus) {\n      case \"PRESENT\":\n        return <Badge variant=\"default\" className=\"bg-green-500\">{t(\"status.present\")}</Badge>;\n      case \"ABSENT\":\n        return <Badge variant=\"destructive\">{t(\"status.absent\")}</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{t(\"status.not_yet\")}</Badge>;\n    }\n  };\n\n  const formatDateTime = (dateStr: string) => {\n    try {\n      return format(new Date(dateStr), \"dd/MM/yyyy HH:mm\");\n    } catch {\n      return dateStr;\n    }\n  };\n\n  const formatTime = (dateStr: string) => {\n    try {\n      return format(new Date(dateStr), \"HH:mm\");\n    } catch {\n      return dateStr;\n    }\n  };\n\n  // Detail view - showing slot attendance\n  if (selectedSlot) {\n    return (\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-0\">\n          <DialogHeader className=\"px-6 py-4 border-b\">\n            <DialogTitle className=\"flex items-center gap-2\">\n              <ShieldCheck className=\"h-5 w-5\" />\n              {selectedSlot.title || t(\"detail_title\", { slotId: selectedSlot.id })}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <Button variant=\"ghost\" size=\"sm\" onClick={handleBackToList}>\n                <ChevronLeft className=\"h-4 w-4 mr-1\" />\n                {t(\"back_to_list\")}\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => window.open(`/admin/slots/${selectedSlot.id}/roster`, '_blank')}\n              >\n                <ExternalLink className=\"h-4 w-4 mr-1\" />\n                {t(\"go_to_roster\")}\n              </Button>\n            </div>\n\n            {/* Loading State */}\n            {attendanceLoading && (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                  <span>{t(\"loading\")}</span>\n                </div>\n              </div>\n            )}\n\n            {/* Attendance Content */}\n            {!attendanceLoading && (\n              <div className=\"space-y-6\">\n                {/* Slot Info & Summary Cards */}\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.time\")}</p>\n                          <p className=\"text-sm font-semibold\">\n                            {formatDateTime(selectedSlot.startTime)}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {t(\"cards.to\")} {formatTime(selectedSlot.endTime)}\n                          </p>\n                        </div>\n                        <Clock className=\"h-8 w-8 text-blue-500\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.total\")}</p>\n                          <p className=\"text-2xl font-bold\">{attendanceData?.statistics?.totalStudents || 0}</p>\n                        </div>\n                        <Users className=\"h-8 w-8 text-blue-500\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.present\")}</p>\n                          <p className=\"text-2xl font-bold text-green-600\">{attendanceData?.statistics?.presentCount || 0}</p>\n                        </div>\n                        <CheckCircle className=\"h-8 w-8 text-green-500\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">{t(\"cards.absent\")}</p>\n                          <p className=\"text-2xl font-bold text-red-600\">{attendanceData?.statistics?.absentCount || 0}</p>\n                        </div>\n                        <XCircle className=\"h-8 w-8 text-red-500\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Attendance Table */}\n                {attendanceData?.students && attendanceData.students.length > 0 ? (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <Users className=\"h-5 w-5\" />\n                        {t(\"table.title\")}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"rounded-md border overflow-x-auto\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead className=\"w-[60px] text-center\">{t(\"table.index\")}</TableHead>\n                              <TableHead>{t(\"table.roll_number\")}</TableHead>\n                              <TableHead>{t(\"table.full_name\")}</TableHead>\n                              <TableHead className=\"text-center\">{t(\"table.status\")}</TableHead>\n                              <TableHead className=\"text-center\">{t(\"table.check_in_time\")}</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {attendanceData.students.map((record: StudentAttendanceInfo, index: number) => (\n                              <TableRow key={`${record.studentId}-${record.subjectCode || index}-${index}`}>\n                                <TableCell className=\"text-center font-medium\">{index + 1}</TableCell>\n                                <TableCell className=\"font-mono\">{record.rollNumber}</TableCell>\n                                <TableCell>{record.fullName}</TableCell>\n                                <TableCell className=\"text-center\">\n                                  {getStatusBadge(record.status)}\n                                </TableCell>\n                                <TableCell className=\"text-center text-sm text-muted-foreground\">\n                                  {record.checkInTime ? formatDateTime(record.checkInTime) : \"-\"}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ) : (\n                  <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                      <HelpCircle className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground text-center\">\n                        {t(\"no_data\")}\n                      </p>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  // List view - showing slot list\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-0\">\n        <DialogHeader className=\"px-6 py-4 border-b\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <ShieldCheck className=\"h-5 w-5\" />\n            {t(\"title\", { userName })}\n          </DialogTitle>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            {t(\"description\")}\n          </p>\n        </DialogHeader>\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n          {/* Semester Filter */}\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5\" />\n              <span className=\"font-medium\">{t(\"semester\")}</span>\n            </div>\n            <Select\n              value={selectedSemester?.toString() || \"all\"}\n              onValueChange={(value) =>\n                setSelectedSemester(value === \"all\" ? undefined : parseInt(value))\n              }\n              disabled={semestersLoading}\n            >\n              <SelectTrigger className=\"w-[280px]\">\n                <SelectValue placeholder={semestersLoading ? t(\"loading_semesters\") : t(\"all_semesters\")} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{t(\"all_semesters\")}</SelectItem>\n                {semesters.map((semester) => (\n                  <SelectItem key={semester.id} value={semester.id.toString()}>\n                    {semester.name} ({semester.code})\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Badge variant=\"secondary\">\n              {t(\"slot_count\", { count: slots.length })}\n            </Badge>\n          </div>\n\n          {/* Loading State */}\n          {slotsLoading && (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                <span>{t(\"loading_slots\")}</span>\n              </div>\n            </div>\n          )}\n\n          {/* Slot List */}\n          {!slotsLoading && slots.length > 0 && (\n            <div className=\"space-y-2\">\n              {slots.map((slot) => (\n                <div\n                  key={slot.id}\n                  className=\"flex flex-col sm:flex-row sm:items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors gap-2\"\n                >\n                  <div className=\"flex-1 min-w-0 space-y-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <ShieldCheck className=\"h-4 w-4 text-primary shrink-0\" />\n                      <span className=\"font-semibold truncate\">{slot.title || `Slot #${slot.id}`}</span>\n                    </div>\n                    {slot.description && (\n                      <p className=\"text-sm text-muted-foreground pl-6 truncate\">\n                        {slot.description}\n                      </p>\n                    )}\n                    <div className=\"flex flex-wrap gap-4 pl-6 text-sm text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        {formatDateTime(slot.startTime)} - {formatTime(slot.endTime)}\n                      </span>\n                      {slot.room && (\n                        <span className=\"flex items-center gap-1\">\n                          <MapPin className=\"h-3 w-3\" />\n                          {slot.room.name}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                  <Button size=\"sm\" onClick={() => handleViewSlot(slot)} className=\"shrink-0\">\n                    <Eye className=\"h-4 w-4 mr-1\" />\n                    {t(\"view\")}\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!slotsLoading && slots.length === 0 && (\n            <div className=\"flex flex-col items-center justify-center py-8\">\n              <ShieldCheck className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground text-center\">\n                {t(\"empty.no_slots\")}\n                {selectedSemester ? t(\"empty.in_semester\") : \"\"}.\n              </p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\staff-table.tsx",
      "relative_path": "components/admin/users-roles/staff-table.tsx",
      "filename": "staff-table.tsx",
      "size_bytes": 3662,
      "lines": 104,
      "last_modified": "2025-11-24T17:14:25.182500",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { useTranslations } from \"next-intl\";\nimport { GenericDataTable } from \"@/components/shared/generic-data-table\";\nimport { StaffUserRow } from \"./staff-columns\";\nimport { Pagination, PaginationContent, PaginationEllipsis, PaginationItem, PaginationLink, PaginationNext, PaginationPrevious } from \"@/components/ui/pagination\";\n\ninterface StaffTableProps {\n  columns: ColumnDef<StaffUserRow>[];\n  data: StaffUserRow[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function StaffTable({\n  columns,\n  data,\n  isLoading = false,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: StaffTableProps) {\n  const t = useTranslations(\"admin.users_roles.staffs\");\n\n  const getPageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) pages.push(i);\n    } else if (currentPage <= 4) {\n      for (let i = 1; i <= 5; i++) pages.push(i);\n      pages.push(\"ellipsis\", totalPages);\n    } else if (currentPage >= totalPages - 3) {\n      pages.push(1, \"ellipsis\");\n      for (let i = totalPages - 4; i <= totalPages; i++) pages.push(i);\n    } else {\n      pages.push(1, \"ellipsis\", currentPage - 1, currentPage, currentPage + 1, \"ellipsis\", totalPages);\n    }\n    return pages;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <GenericDataTable<StaffUserRow>\n        columns={columns}\n        data={data}\n        isLoading={isLoading}\n        minWidth=\"1100px\"\n        fixedRowCount={10}\n      />\n\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0\n            ? t(\"table.pagination.showing\", {\n                from: (currentPage - 1) * pageSize + 1,\n                to: Math.min(currentPage * pageSize, totalItems),\n                total: totalItems,\n              })\n            : t(\"table.pagination.no_items\")}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <Pagination>\n              <PaginationContent>\n                <PaginationItem>\n                  <PaginationPrevious\n                    onClick={() => currentPage > 1 && onPageChange(currentPage - 1)}\n                    className={currentPage === 1 ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                  />\n                </PaginationItem>\n                {getPageNumbers().map((p, idx) => (\n                  <PaginationItem key={idx}>\n                    {p === \"ellipsis\" ? (\n                      <PaginationEllipsis />\n                    ) : (\n                      <PaginationLink onClick={() => onPageChange(p as number)} isActive={currentPage === p}>\n                        {p}\n                      </PaginationLink>\n                    )}\n                  </PaginationItem>\n                ))}\n                <PaginationItem>\n                  <PaginationNext\n                    onClick={() => currentPage < totalPages && onPageChange(currentPage + 1)}\n                    className={currentPage >= totalPages ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                  />\n                </PaginationItem>\n              </PaginationContent>\n            </Pagination>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\student-attendance-history-view.tsx",
      "relative_path": "components/admin/users-roles/student-attendance-history-view.tsx",
      "filename": "student-attendance-history-view.tsx",
      "size_bytes": 16048,
      "lines": 405,
      "last_modified": "2025-11-24T09:50:12.913204",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { History, Check, ChevronsUpDown, ExternalLink } from \"lucide-react\";\nimport { useStudentSemesters } from \"@/hooks/api/useSemesters\";\nimport { useStudentSubjects } from \"@/hooks/api/useStudentSubjects\";\nimport { useGetStudentAttendanceHistory } from \"@/hooks/api/useStudentProfiles\";\nimport { format } from \"date-fns\";\nimport { AttendanceHistoryItem } from \"@/types\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StudentAttendanceHistoryViewProps {\n  studentId: number;\n  studentName: string;\n  studentRollNumber: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function StudentAttendanceHistoryView({\n  studentId,\n  studentName,\n  studentRollNumber,\n  open,\n  onOpenChange,\n}: StudentAttendanceHistoryViewProps) {\n  // Step 1: Semester selection\n  const [selectedSemester, setSelectedSemester] = useState<number | null>(null);\n  const [semesterSearchOpen, setSemesterSearchOpen] = useState(false);\n\n  // Step 2: Subject selection (from enrolled classes)\n  const [selectedSubject, setSelectedSubject] = useState<number | null>(null);\n\n  // Step 3: Status filter\n  const [selectedStatus, setSelectedStatus] = useState<\"all\" | \"present\" | \"absent\" | \"not_yet\">(\"all\");\n\n  // Fetch semesters where this student has enrolled classes (not all semesters)\n  const { data: semesters = [], isLoading: isLoadingSemesters } = useStudentSemesters(\n    studentId,\n    true // Always fetch when component is mounted\n  );\n\n  // Fetch subjects directly (when semester is selected)\n  const { data: subjects, isLoading: isLoadingSubjects } = useStudentSubjects(\n    studentId,\n    selectedSemester ?? undefined,\n    { enabled: !!studentId && !!selectedSemester }\n  );\n\n  // Fetch attendance history (when subject is selected)\n  const { data: attendanceData, isLoading: isLoadingAttendance } =\n    useGetStudentAttendanceHistory(\n      studentId,\n      selectedSemester && selectedSubject\n        ? {\n            semesterId: selectedSemester,\n            subjectId: selectedSubject,\n            page: 1,\n            pageSize: 1000, // Load all records for scrolling\n            sort: \"desc\" as const,\n            sortBy: \"slotDate\" as const,\n            attendanceType: \"all\", // Fetch all types (class + exam)\n            attendanceStatus: selectedStatus === \"all\" ? undefined : selectedStatus,\n          }\n        : undefined,\n      { enabled: !!studentId && !!selectedSemester && !!selectedSubject }\n    );\n\n  // Reset subject when semester changes\n  useEffect(() => {\n    setSelectedSubject(null);\n    setSelectedStatus(\"all\");\n  }, [selectedSemester]);\n\n  // Status badge helper\n  const getStatusBadge = (status: string) => {\n    const config: Record<\n      string,\n      { label: string; variant: \"default\" | \"destructive\" | \"secondary\" }\n    > = {\n      present: { label: \"Present\", variant: \"default\" },\n      absent: { label: \"Absent\", variant: \"destructive\" },\n      not_yet: { label: \"Not Yet\", variant: \"secondary\" },\n    };\n    const { label, variant } = config[status] || config.not_yet;\n    return <Badge variant={variant}>{label}</Badge>;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[85vw] h-[90vh] flex flex-col gap-0 p-4\">\n        <DialogHeader className=\"px-6 py-4 border-b -mx-4 -mt-4\">\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\n            <History className=\"h-5 w-5\" />\n            Attendance History - {studentName} ({studentRollNumber})\n          </DialogTitle>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            View detailed attendance history for class and exam sessions.\n          </p>\n        </DialogHeader>\n        <div className=\"flex-1 overflow-y-auto pt-4 space-y-4\">\n        {/* Filters Row */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n          {/* Semester Selection */}\n          <div className=\"space-y-2\">\n            <Label>\n              Semester <span className=\"text-destructive\">*</span>\n            </Label>\n            <Popover\n              open={semesterSearchOpen}\n              onOpenChange={setSemesterSearchOpen}\n            >\n              <PopoverTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  role=\"combobox\"\n                  aria-expanded={semesterSearchOpen}\n                  className=\"w-full justify-between\"\n                >\n                  {isLoadingSemesters\n                    ? \"Loading semesters...\"\n                    : selectedSemester\n                    ? semesters.find((s) => s.id === selectedSemester)?.name +\n                      \" (\" +\n                      semesters.find((s) => s.id === selectedSemester)?.code +\n                      \")\"\n                    : \"Select semester...\"}\n                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                </Button>\n              </PopoverTrigger>\n              <PopoverContent className=\"w-[400px] p-0\">\n                <Command>\n                  <CommandInput placeholder=\"Search semester...\" />\n                  <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                    <CommandEmpty>\n                      {isLoadingSemesters\n                        ? \"Loading...\"\n                        : semesters.length === 0\n                        ? \"No enrolled semesters found for this student.\"\n                        : \"No semester found.\"}\n                    </CommandEmpty>\n                    <CommandGroup>\n                      {semesters.map((semester) => (\n                        <CommandItem\n                          key={semester.id}\n                          value={`${semester.name} ${semester.code}`}\n                          onSelect={() => {\n                            setSelectedSemester(semester.id);\n                            setSemesterSearchOpen(false);\n                          }}\n                        >\n                          <Check\n                            className={cn(\n                              \"mr-2 h-4 w-4\",\n                              selectedSemester === semester.id\n                                ? \"opacity-100\"\n                                : \"opacity-0\"\n                            )}\n                          />\n                          {semester.name} ({semester.code})\n                        </CommandItem>\n                      ))}\n                    </CommandGroup>\n                  </CommandList>\n                </Command>\n              </PopoverContent>\n            </Popover>\n          </div>\n\n          {/* Subject Selection */}\n          <div className=\"space-y-2\">\n            <Label>\n              Subject <span className=\"text-destructive\">*</span>\n            </Label>\n            <Select\n              value={selectedSubject?.toString() || \"\"}\n              onValueChange={(value) => setSelectedSubject(parseInt(value))}\n              disabled={!selectedSemester || isLoadingSubjects}\n            >\n              <SelectTrigger className=\"w-full\">\n                <SelectValue\n                  placeholder={\n                    !selectedSemester\n                      ? \"Select semester first...\"\n                      : isLoadingSubjects\n                      ? \"Loading subjects...\"\n                      : \"Select subject...\"\n                  }\n                />\n              </SelectTrigger>\n              <SelectContent>\n                {subjects && subjects.length > 0 ? (\n                  subjects.map((subject) => (\n                    <SelectItem\n                      key={subject.subjectId}\n                      value={subject.subjectId.toString()}\n                    >\n                      {subject.subjectCode} - {subject.subjectName}\n                    </SelectItem>\n                  ))\n                ) : (\n                  <SelectItem value=\"no-subjects\" disabled>\n                    No subjects available\n                  </SelectItem>\n                )}\n              </SelectContent>\n            </Select>\n            {subjects && subjects.length === 0 && !isLoadingSubjects && selectedSemester && (\n              <p className=\"text-xs text-muted-foreground\">\n                No enrolled subjects found for this semester.\n              </p>\n            )}\n          </div>\n\n          {/* Status Filter */}\n          <div className=\"space-y-2\">\n            <Label>Status</Label>\n            <Select\n              value={selectedStatus}\n              onValueChange={(value) => setSelectedStatus(value as typeof selectedStatus)}\n              disabled={!selectedSemester || !selectedSubject}\n            >\n              <SelectTrigger className=\"w-full\">\n                <SelectValue placeholder=\"All Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"present\">Present</SelectItem>\n                <SelectItem value=\"absent\">Absent</SelectItem>\n                <SelectItem value=\"not_yet\">Not Yet</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {/* Data Display Section */}\n        {selectedSemester && selectedSubject && (\n          <>\n            <div className=\"border-t pt-4\" />\n\n            {/* Attendance Table */}\n            <div className=\"overflow-x-auto\">\n              <div className=\"rounded-md border\">\n                <Table className=\"min-w-[600px]\">\n                  <TableHeader className=\"sticky top-0 bg-background z-10\">\n                    <TableRow>\n                      <TableHead className=\"text-center w-[80px]\">\n                        Slot\n                      </TableHead>\n                      <TableHead className=\"text-center w-[140px]\">\n                        Date & Time\n                      </TableHead>\n                      <TableHead className=\"text-center w-[100px]\">\n                        Status\n                      </TableHead>\n                      <TableHead className=\"text-center w-[80px]\">\n                        Action\n                      </TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {isLoadingAttendance ? (\n                      <TableRow>\n                        <TableCell\n                          colSpan={4}\n                          className=\"h-[52px] text-center text-muted-foreground\"\n                        >\n                          Loading attendance records...\n                        </TableCell>\n                      </TableRow>\n                    ) : attendanceData?.items &&\n                      attendanceData.items.length > 0 ? (\n                      <>\n                        {attendanceData.items.map(\n                          (record: AttendanceHistoryItem, index: number) => (\n                            <TableRow key={record.recordId || index}>\n                              {/* Slot Number */}\n                              <TableCell className=\"text-center text-sm h-[60px]\">\n                                <div className=\"font-medium\">\n                                  {index + 1}\n                                </div>\n                              </TableCell>\n\n                              {/* Date & Time (2 lines) */}\n                              <TableCell className=\"text-center text-sm h-[60px]\">\n                                <div className=\"font-medium\">\n                                  {format(new Date(record.slotDate), \"dd/MM/yy\")}\n                                </div>\n                                <div className=\"text-xs text-muted-foreground\">\n                                  {record.slotTime}\n                                </div>\n                              </TableCell>\n\n                              {/* Status */}\n                              <TableCell className=\"text-center h-[60px]\">\n                                {getStatusBadge(record.attendanceStatus)}\n                              </TableCell>\n\n                              {/* Action */}\n                              <TableCell className=\"text-center h-[60px]\">\n                                {record.slotId ? (\n                                  <TooltipProvider>\n                                    <Tooltip>\n                                      <TooltipTrigger asChild>\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"sm\"\n                                          className=\"h-8 w-8 p-0\"\n                                          onClick={() => {\n                                            const url = `/admin/slots/${record.slotId}/roster?search=${encodeURIComponent(studentRollNumber)}`;\n                                            window.open(url, '_blank');\n                                          }}\n                                        >\n                                          <ExternalLink className=\"h-4 w-4\" />\n                                        </Button>\n                                      </TooltipTrigger>\n                                      <TooltipContent>\n                                        <p>View slot roster</p>\n                                      </TooltipContent>\n                                    </Tooltip>\n                                  </TooltipProvider>\n                                ) : (\n                                  <span className=\"text-xs text-muted-foreground\">N/A</span>\n                                )}\n                              </TableCell>\n                            </TableRow>\n                          )\n                        )}\n                      </>\n                    ) : (\n                      <TableRow>\n                        <TableCell\n                          colSpan={4}\n                          className=\"h-[52px] text-center text-muted-foreground\"\n                        >\n                          No attendance records found.\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n          </>\n        )}\n\n        {/* Initial State */}\n        {(!selectedSemester || !selectedSubject) && (\n          <div className=\"flex flex-col items-center justify-center py-8\">\n            <History className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">\n              {!selectedSemester\n                ? \"Select a semester to view attendance history.\"\n                : \"Select a subject to view attendance history.\"}\n            </p>\n          </div>\n        )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\student-columns.tsx",
      "relative_path": "components/admin/users-roles/student-columns.tsx",
      "filename": "student-columns.tsx",
      "size_bytes": 5490,
      "lines": 161,
      "last_modified": "2025-11-24T17:13:51.971589",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Pencil, MoreHorizontal, History } from \"lucide-react\";\n\nexport type StudentUserRow = {\n  id: number;\n  rollNumber: string;\n  username: string; // Username for login identification\n  fullName: string;\n  email: string;\n  major: string; // Major code for display\n  majorId?: number; // Major ID for API operations\n  isActive: boolean;\n  createdAt: string;\n  lastActiveAt?: string;\n};\n\nexport function getInitials(name: string) {\n  const parts = name.trim().split(/\\s+/);\n  const first = parts[0]?.[0] || \"\";\n  const last = parts.length > 1 ? parts[parts.length - 1][0] : \"\";\n  return (first + last).toUpperCase();\n}\n\ntype TranslationFunction = (key: string, values?: Record<string, string | number | Date>) => string;\n\nexport function createStudentColumns(\n  onEdit: (row: StudentUserRow) => void,\n  onViewAttendance: (row: StudentUserRow) => void,\n  onMajorClick: (majorCode: string) => void,\n  majorsList: Array<{ id: number; code: string; name: string }> | undefined,\n  t: TranslationFunction\n): ColumnDef<StudentUserRow>[] {\n  return [\n    {\n      accessorKey: \"rollNumber\",\n      header: () => <div className=\"text-center\">{t(\"table.header.roll_number\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center font-medium\">{row.original.rollNumber}</div>\n      ),\n    },\n    {\n      id: \"name\",\n      header: () => <div className=\"text-center\">{t(\"table.header.name\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center\">\n          <span className=\"font-medium\">{row.original.fullName}</span>\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"email\",\n      header: () => <div className=\"text-center\">{t(\"table.header.email\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"text-center text-muted-foreground text-sm\">\n          {row.original.email}\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"major\",\n      header: () => <div className=\"text-center\">{t(\"table.header.major\")}</div>,\n      cell: ({ row }) => {\n        const majorCode = row.original.major;\n        const majorName =\n          majorsList?.find((m) => m.code === majorCode)?.name ||\n          t(\"table.cell.unknown_major\");\n\n        return (\n          <div className=\"flex justify-center\">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Badge\n                    variant=\"outline\"\n                    className=\"text-xs cursor-pointer hover:opacity-80 min-w-[64px] justify-center\"\n                    onClick={() => onMajorClick(majorCode)}\n                  >\n                    <span className=\"truncate\">{majorCode}</span>\n                  </Badge>\n                </TooltipTrigger>\n                <TooltipContent side=\"top\">\n                  <p>{majorName}</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          </div>\n        );\n      },\n    },\n    {\n      id: \"role\",\n      header: () => <div className=\"text-center\">{t(\"table.header.role\")}</div>,\n      cell: () => (\n        <div className=\"flex justify-center\">\n          <Badge className=\"w-[78px] justify-center\">{t(\"table.cell.role_student\")}</Badge>\n        </div>\n      ),\n    },\n    {\n      accessorKey: \"isActive\",\n      header: () => <div className=\"text-center\">{t(\"table.header.status\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"flex justify-center\">\n          <Badge\n            variant={row.original.isActive ? \"default\" : \"destructive\"}\n            className=\"w-[74px] justify-center\"\n          >\n            {row.original.isActive ? t(\"table.status.active\") : t(\"table.status.inactive\")}\n          </Badge>\n        </div>\n      ),\n    },\n    {\n      id: \"action\",\n      header: () => <div className=\"text-center\">{t(\"table.header.action\")}</div>,\n      cell: ({ row }) => (\n        <div className=\"flex justify-center\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuLabel>\n                {t(\"table.menu.label\", { rollNumber: row.original.rollNumber })}\n              </DropdownMenuLabel>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => onEdit(row.original)}>\n                <Pencil className=\"mr-2 h-4 w-4\" />\n                {t(\"table.menu.edit_profile\")}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onViewAttendance(row.original)}>\n                <History className=\"mr-2 h-4 w-4\" />\n                {t(\"table.menu.attendance_history\")}\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      ),\n    },\n  ];\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\student-dialogs.tsx",
      "relative_path": "components/admin/users-roles/student-dialogs.tsx",
      "filename": "student-dialogs.tsx",
      "size_bytes": 18890,
      "lines": 523,
      "last_modified": "2025-11-24T17:19:00.185296",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { StudentUserRow, getInitials } from \"./student-columns\";\nimport {\n  useUpdateStudentProfile,\n  useCreateStudentProfile,\n} from \"@/hooks/api/useStudentProfiles\";\n\ninterface MajorItem {\n  id: number;\n  code: string;\n  name: string;\n  isActive: boolean;\n}\n\ninterface EditStudentDialogProps {\n  open: boolean;\n  student: StudentUserRow | null;\n  onOpenChange: (open: boolean) => void;\n  onSave: (data: Partial<StudentUserRow>) => void;\n  availableMajors?: MajorItem[];\n}\n\nexport function EditStudentDialog({\n  open,\n  student,\n  onOpenChange,\n  onSave,\n  availableMajors = [],\n}: EditStudentDialogProps) {\n  const t = useTranslations(\"admin.users_roles.students.dialog\");\n  const [fullName, setFullName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [majorId, setMajorId] = useState<number | undefined>(undefined);\n  const [isActive, setIsActive] = useState(true);\n  const [majorPopoverOpen, setMajorPopoverOpen] = useState(false);\n\n  const updateMutation = useUpdateStudentProfile();\n\n  // Update form when student changes\n  useEffect(() => {\n    if (student) {\n      setFullName(student.fullName);\n      setEmail(student.email);\n      setUsername(student.username); // Sync username from student object\n      setIsActive(student.isActive);\n      // Try to find majorId from major code\n      const foundMajor = availableMajors.find((m) => m.code === student.major);\n      setMajorId(foundMajor?.id);\n    }\n  }, [student, availableMajors]);\n\n  const selectedMajor = availableMajors.find((m) => m.id === majorId);\n\n  const handleSave = () => {\n    if (!student || !majorId) return;\n\n    updateMutation.mutate(\n      {\n        id: student.id, // student.id is already userId from adapter\n        payload: {\n          fullName,\n          email,\n          rollNumber: student.rollNumber, // Roll number cannot be changed\n          username: student.username, // Username cannot be changed\n          majorId,\n          isActive,\n        },\n      },\n      {\n        onSuccess: () => {\n          onSave({});\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        className=\"sm:max-w-[600px] max-h-[90vh] overflow-y-auto\"\n        onOpenAutoFocus={(e) => e.preventDefault()}\n      >\n        <DialogHeader>\n          <DialogTitle>{t(\"edit.title\")}</DialogTitle>\n          <DialogDescription>\n            {t(\"edit.description\")}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          {/* Avatar Section */}\n          <div className=\"flex items-center gap-4 pb-4 border-b\">\n            <Avatar className=\"h-16 w-16\">\n              <AvatarFallback className=\"text-lg\">\n                {student ? getInitials(student.fullName) : \"ST\"}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-lg\">\n                {student?.fullName || \"Student Name\"}\n              </h3>\n              <p className=\"text-sm text-muted-foreground\">\n                {student?.email || \"email@example.com\"}\n              </p>\n            </div>\n          </div>\n\n          {/* Form Fields */}\n          <div className=\"space-y-3\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              <div>\n                <div className=\"text-sm font-medium mb-1.5\">{t(\"form.roll_number\")}</div>\n                <Input disabled value={student?.rollNumber || \"\"} />\n              </div>\n              <div>\n                <div className=\"text-sm font-medium mb-1.5\">{t(\"form.username\")}</div>\n                <Input disabled value={username || \"\"} />\n              </div>\n              <div className=\"sm:col-span-2\">\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.email\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder={t(\"form.placeholder_email\")}\n                  autoComplete=\"off\"\n                />\n              </div>\n              <div className=\"sm:col-span-2\">\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.full_name\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Input\n                  value={fullName}\n                  onChange={(e) => setFullName(e.target.value)}\n                  placeholder={t(\"form.placeholder_full_name\")}\n                  autoComplete=\"off\"\n                />\n              </div>\n              <div className=\"sm:col-span-2\">\n                <div className=\"text-sm font-medium mb-1.5\">\n                  {t(\"form.major\")} <span className=\"text-destructive\">*</span>\n                </div>\n                <Popover\n                  open={majorPopoverOpen}\n                  onOpenChange={setMajorPopoverOpen}\n                >\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      className=\"w-full justify-between font-normal\"\n                    >\n                      {selectedMajor\n                        ? `${selectedMajor.code} - ${selectedMajor.name}`\n                        : t(\"form.select_major\")}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                    <Command>\n                      <CommandInput placeholder={t(\"form.search_major\")} />\n                      <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                        <CommandEmpty>{t(\"form.no_major\")}</CommandEmpty>\n                        <CommandGroup>\n                          {availableMajors.map((major) => (\n                            <CommandItem\n                              key={major.id}\n                              value={`${major.code} ${major.name}`}\n                              onSelect={() => {\n                                setMajorId(major.id);\n                                setMajorPopoverOpen(false);\n                              }}\n                            >\n                              <Check\n                                className={cn(\n                                  \"mr-2 h-4 w-4\",\n                                  majorId === major.id\n                                    ? \"opacity-100\"\n                                    : \"opacity-0\"\n                                )}\n                              />\n                              {major.code} - {major.name}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      </CommandList>\n                    </Command>\n                  </PopoverContent>\n                </Popover>\n              </div>\n            </div>\n\n            {/* Active Status Toggle */}\n            <div className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5 flex-1\">\n                <div className=\"text-base font-medium\">{t(\"form.active_status\")}</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {isActive\n                    ? t(\"form.active_description\")\n                    : t(\"form.inactive_description\")}\n                </div>\n              </div>\n              <Switch checked={isActive} onCheckedChange={setIsActive} />\n            </div>\n          </div>\n        </div>\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={updateMutation.isPending}\n          >\n            {t(\"button.cancel\")}\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={updateMutation.isPending || !majorId}\n          >\n            {updateMutation.isPending ? t(\"button.saving\") : t(\"button.save\")}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\ninterface CreateStudentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onCreate: (data: {\n    rollNumber: string;\n    username: string;\n    email: string;\n    fullName: string;\n    majorId: number;\n  }) => void;\n  availableMajors?: MajorItem[];\n}\n\nexport function CreateStudentDialog({\n  open,\n  onOpenChange,\n  onCreate,\n  availableMajors = [],\n}: CreateStudentDialogProps) {\n  const t = useTranslations(\"admin.users_roles.students.dialog\");\n  const [rollNumber, setRollNumber] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [fullName, setFullName] = useState(\"\");\n  const [majorId, setMajorId] = useState<number | undefined>(undefined);\n  const [majorPopoverOpen, setMajorPopoverOpen] = useState(false);\n  const [fieldErrors, setFieldErrors] = useState<{\n    rollNumber?: string;\n    username?: string;\n    email?: string;\n    fullName?: string;\n  }>({});\n\n  const createMutation = useCreateStudentProfile();\n\n  const selectedMajor = availableMajors.find((m) => m.id === majorId);\n\n  const handleCreate = () => {\n    if (!rollNumber || !username || !email || !fullName || !majorId) return;\n\n    // Clear previous errors\n    setFieldErrors({});\n\n    createMutation.mutate(\n      {\n        rollNumber,\n        username,\n        email,\n        fullName,\n        majorId,\n      },\n      {\n        onSuccess: () => {\n          onCreate({ rollNumber, username, email, fullName, majorId });\n          // Reset form\n          setRollNumber(\"\");\n          setUsername(\"\");\n          setEmail(\"\");\n          setFullName(\"\");\n          setMajorId(undefined);\n          setFieldErrors({});\n        },\n        onError: (error: Error & { response?: { data?: { code?: string; message?: string } } }) => {\n          // Map backend error codes to field-specific errors\n          const errorCode = error?.response?.data?.code;\n          const errorMessage = error?.response?.data?.message || error.message;\n\n          const newErrors: typeof fieldErrors = {};\n\n          switch (errorCode) {\n            case \"ROLL_NUMBER_EXISTS\":\n            case \"INVALID_ROLL_NUMBER_FORMAT\":\n            case \"ROLL_NUMBER_REQUIRED\":\n              newErrors.rollNumber = errorMessage;\n              break;\n            case \"USERNAME_EXISTS\":\n            case \"INVALID_USERNAME_FORMAT\":\n            case \"USERNAME_REQUIRED\":\n              newErrors.username = errorMessage;\n              break;\n            case \"EMAIL_EXISTS\":\n            case \"INVALID_EMAIL_FORMAT\":\n            case \"EMAIL_REQUIRED\":\n              newErrors.email = errorMessage;\n              break;\n            case \"FULL_NAME_REQUIRED\":\n              newErrors.fullName = errorMessage;\n              break;\n          }\n\n          setFieldErrors(newErrors);\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{t(\"create.title\")}</DialogTitle>\n          <DialogDescription>\n            {t(\"create.description\")}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n            <div className=\"sm:col-span-2\">\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.full_name\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={fullName}\n                onChange={(e) => {\n                  setFullName(e.target.value);\n                  setFieldErrors((prev) => ({ ...prev, fullName: undefined }));\n                }}\n                placeholder={t(\"form.placeholder_full_name\")}\n                autoComplete=\"off\"\n                className={fieldErrors.fullName ? \"border-destructive\" : \"\"}\n              />\n              {fieldErrors.fullName && (\n                <p className=\"text-sm text-destructive mt-1\">\n                  {fieldErrors.fullName}\n                </p>\n              )}\n            </div>\n            <div>\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.roll_number\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={rollNumber}\n                onChange={(e) => {\n                  setRollNumber(e.target.value.toUpperCase());\n                  setFieldErrors((prev) => ({ ...prev, rollNumber: undefined }));\n                }}\n                placeholder={t(\"form.placeholder_roll_number\")}\n                autoComplete=\"off\"\n                className={fieldErrors.rollNumber ? \"border-destructive\" : \"\"}\n              />\n              {fieldErrors.rollNumber && (\n                <p className=\"text-sm text-destructive mt-1\">\n                  {fieldErrors.rollNumber}\n                </p>\n              )}\n            </div>\n            <div>\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.username\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={username}\n                onChange={(e) => {\n                  setUsername(e.target.value);\n                  setFieldErrors((prev) => ({ ...prev, username: undefined }));\n                }}\n                placeholder={t(\"form.placeholder_username\")}\n                autoComplete=\"off\"\n                className={fieldErrors.username ? \"border-destructive\" : \"\"}\n              />\n              {fieldErrors.username && (\n                <p className=\"text-sm text-destructive mt-1\">\n                  {fieldErrors.username}\n                </p>\n              )}\n            </div>\n            <div className=\"sm:col-span-2\">\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.email\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Input\n                value={email}\n                onChange={(e) => {\n                  setEmail(e.target.value);\n                  setFieldErrors((prev) => ({ ...prev, email: undefined }));\n                }}\n                placeholder={t(\"form.placeholder_email\")}\n                autoComplete=\"off\"\n                className={fieldErrors.email ? \"border-destructive\" : \"\"}\n              />\n              {fieldErrors.email && (\n                <p className=\"text-sm text-destructive mt-1\">\n                  {fieldErrors.email}\n                </p>\n              )}\n            </div>\n            <div className=\"sm:col-span-2\">\n              <div className=\"text-sm font-medium mb-1.5\">\n                {t(\"form.major\")} <span className=\"text-destructive\">*</span>\n              </div>\n              <Popover\n                open={majorPopoverOpen}\n                onOpenChange={setMajorPopoverOpen}\n              >\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    className=\"w-full justify-between font-normal\"\n                  >\n                    {selectedMajor\n                      ? `${selectedMajor.code} - ${selectedMajor.name}`\n                      : t(\"form.select_major\")}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                  <Command>\n                    <CommandInput placeholder={t(\"form.search_major\")} />\n                    <CommandList className=\"max-h-[300px] overflow-y-auto\">\n                      <CommandEmpty>{t(\"form.no_major\")}</CommandEmpty>\n                      <CommandGroup>\n                        {availableMajors.map((major) => (\n                          <CommandItem\n                            key={major.id}\n                            value={`${major.code} ${major.name}`}\n                            onSelect={() => {\n                              setMajorId(major.id);\n                              setMajorPopoverOpen(false);\n                            }}\n                          >\n                            <Check\n                              className={cn(\n                                \"mr-2 h-4 w-4\",\n                                majorId === major.id\n                                  ? \"opacity-100\"\n                                  : \"opacity-0\"\n                              )}\n                            />\n                            {major.code} - {major.name}\n                          </CommandItem>\n                        ))}\n                      </CommandGroup>\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={createMutation.isPending}\n          >\n            {t(\"button.cancel\")}\n          </Button>\n          <Button\n            onClick={handleCreate}\n            disabled={\n              createMutation.isPending ||\n              !rollNumber ||\n              !username ||\n              !email ||\n              !fullName ||\n              !majorId\n            }\n          >\n            {createMutation.isPending ? t(\"button.creating\") : t(\"button.create\")}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"
    },
    {
      "path": "D:\\Work\\do_an_fall25\\fuacs\\frontend-web\\components\\admin\\users-roles\\student-table.tsx",
      "relative_path": "components/admin/users-roles/student-table.tsx",
      "filename": "student-table.tsx",
      "size_bytes": 6993,
      "lines": 222,
      "last_modified": "2025-11-24T17:13:10.331614",
      "encoding": "utf-8",
      "language": "typescript-react",
      "content": "\"use client\";\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  getSortedRowModel,\n  SortingState,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { useState } from \"react\";\nimport { useTranslations } from \"next-intl\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { StudentUserRow } from \"./student-columns\";\nimport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\n\ninterface StudentTableProps {\n  columns: ColumnDef<StudentUserRow>[];\n  data: StudentUserRow[];\n  isLoading?: boolean;\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function StudentTable({\n  columns,\n  data,\n  currentPage,\n  totalPages,\n  totalItems,\n  pageSize,\n  onPageChange,\n}: StudentTableProps) {\n  const t = useTranslations(\"admin.users_roles.students\");\n  const [sorting, setSorting] = useState<SortingState>([]);\n\n  const fixedRowCount = 10;\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n  });\n\n  const getPageNumbers = () => {\n    const pages: (number | \"ellipsis\")[] = [];\n    if (totalPages <= 7) {\n      for (let i = 1; i <= totalPages; i++) pages.push(i);\n    } else if (currentPage <= 4) {\n      for (let i = 1; i <= 5; i++) pages.push(i);\n      pages.push(\"ellipsis\", totalPages);\n    } else if (currentPage >= totalPages - 3) {\n      pages.push(1, \"ellipsis\");\n      for (let i = totalPages - 4; i <= totalPages; i++) pages.push(i);\n    } else {\n      pages.push(\n        1,\n        \"ellipsis\",\n        currentPage - 1,\n        currentPage,\n        currentPage + 1,\n        \"ellipsis\",\n        totalPages\n      );\n    }\n    return pages;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scrollable table container for mobile */}\n      <div className=\"rounded-md border bg-background overflow-x-auto\">\n        <Table className=\"min-w-[980px]\">\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <TableHead key={header.id} className=\"whitespace-nowrap\">\n                    {header.isPlaceholder\n                      ? null\n                      : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                  </TableHead>\n                ))}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {data.length > 0 ? (\n              <>\n                {table.getRowModel().rows.map((row) => (\n                  <TableRow key={row.id}>\n                    {row.getVisibleCells().map((cell) => (\n                      <TableCell\n                        key={cell.id}\n                        className=\"h-[52px] whitespace-nowrap\"\n                      >\n                        {flexRender(\n                          cell.column.columnDef.cell,\n                          cell.getContext()\n                        )}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n                {Array.from({\n                  length: Math.max(0, fixedRowCount - data.length),\n                }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            ) : (\n              <>\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length}\n                    className=\"h-[52px] text-center\"\n                  >\n                    {t(\"table.empty.no_students\")}\n                  </TableCell>\n                </TableRow>\n                {Array.from({ length: fixedRowCount - 1 }).map((_, index) => (\n                  <TableRow key={`empty-${index}`}>\n                    <TableCell colSpan={columns.length} className=\"h-[52px]\" />\n                  </TableRow>\n                ))}\n              </>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Pagination - Stack on mobile */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"text-sm text-muted-foreground text-center sm:text-left min-w-[200px]\">\n          {totalItems > 0 ? (\n            t(\"table.pagination.showing\", {\n              from: (currentPage - 1) * pageSize + 1,\n              to: Math.min(currentPage * pageSize, totalItems),\n              total: totalItems,\n            })\n          ) : (\n            t(\"table.pagination.no_items\")\n          )}\n        </div>\n        {totalItems > pageSize && (\n          <div className=\"flex justify-center sm:justify-end\">\n            <Pagination>\n              <PaginationContent>\n                <PaginationItem>\n                  <PaginationPrevious\n                    onClick={() =>\n                      currentPage > 1 && onPageChange(currentPage - 1)\n                    }\n                    className={\n                      currentPage === 1\n                        ? \"pointer-events-none opacity-50\"\n                        : \"cursor-pointer\"\n                    }\n                  />\n                </PaginationItem>\n                {getPageNumbers().map((p, idx) => (\n                  <PaginationItem key={idx}>\n                    {p === \"ellipsis\" ? (\n                      <PaginationEllipsis />\n                    ) : (\n                      <PaginationLink\n                        onClick={() => onPageChange(p as number)}\n                        isActive={currentPage === p}\n                      >\n                        {p}\n                      </PaginationLink>\n                    )}\n                  </PaginationItem>\n                ))}\n                <PaginationItem>\n                  <PaginationNext\n                    onClick={() =>\n                      currentPage < totalPages && onPageChange(currentPage + 1)\n                    }\n                    className={\n                      currentPage >= totalPages\n                        ? \"pointer-events-none opacity-50\"\n                        : \"cursor-pointer\"\n                    }\n                  />\n                </PaginationItem>\n              </PaginationContent>\n            </Pagination>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    }
  ]
}