codebase_inventory:
  feature_clusters:
    user_management:
      description: "User account management, authentication, and staff profiles"
      core_files:
        entity: "com/fuacs/backend/entity/User.java"
        repository: "com/fuacs/backend/repository/UserRepository.java"
        service: "com/fuacs/backend/service/StaffService.java"
        controller: "com/fuacs/backend/controller/StaffController.java"
        mapper: "com/fuacs/backend/dto/mapper/UserMapper.java"

      related_files:
        request_dtos:
          - "com/fuacs/backend/dto/request/UserRequest.java"
          - "com/fuacs/backend/dto/request/UserSearchRequest.java"
          - "com/fuacs/backend/dto/request/StaffCreateRequest.java"
          - "com/fuacs/backend/dto/request/StaffUpdateRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/UserDTO.java"
          - "com/fuacs/backend/dto/response/StaffDTO.java"

      dependencies:
        - "BaseEntity.java"
        - "RoleRepository.java"
        - "EmailService.java"
        - "PasswordEncoder (BCryptPasswordEncoder bean)"

      dependents:
        - "AuthenticationService.java"
        - "StudentProfileService.java"
        - "SlotService.java"

    authentication:
      description: "Authentication, password management, and token handling"
      core_files:
        entity: "com/fuacs/backend/entity/PasswordResetToken.java"
        repository: "com/fuacs/backend/repository/PasswordResetTokenRepository.java"
        service: "com/fuacs/backend/service/AuthenticationService.java"
        controller: "com/fuacs/backend/controller/AuthenticationController.java"
        utility: "com/fuacs/backend/util/TokenProviderUtil.java"

      related_files:
        request_dtos:
          - "com/fuacs/backend/dto/request/LoginRequest.java"
          - "com/fuacs/backend/dto/request/LoginGoogleRequest.java"
          - "com/fuacs/backend/dto/request/RefreshTokenRequest.java"
          - "com/fuacs/backend/dto/request/PasswordForgotRequest.java"
          - "com/fuacs/backend/dto/request/PasswordResetRequest.java"
          - "com/fuacs/backend/dto/request/PasswordUpdateRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/TokenResponse.java"

      dependencies:
        - "UserRepository.java"
        - "RoleRepository.java"
        - "PermissionRepository.java"
        - "EmailService.java"
        - "PasswordEncoder (BCryptPasswordEncoder)"

      dependents: []

      notes: "JWT-based authentication with Google OAuth support. Password reset tokens expire after 15 minutes with upsert strategy"

    role_permission:
      description: "Role-based access control and permission management"
      core_files:
        entities:
          - "com/fuacs/backend/entity/Role.java"
          - "com/fuacs/backend/entity/Permission.java"
        repositories:
          - "com/fuacs/backend/repository/RoleRepository.java"
          - "com/fuacs/backend/repository/PermissionRepository.java"
        services:
          - "com/fuacs/backend/service/RoleService.java"
          - "com/fuacs/backend/service/PermissionService.java"
        controllers:
          - "com/fuacs/backend/controller/RoleController.java"
          - "com/fuacs/backend/controller/PermissionController.java"
        mappers:
          - "com/fuacs/backend/dto/mapper/RoleMapper.java"
          - "com/fuacs/backend/dto/mapper/PermissionMapper.java"

      related_files:
        request_dtos:
          role:
            - "com/fuacs/backend/dto/request/RoleCreateRequest.java"
            - "com/fuacs/backend/dto/request/RoleUpdateRequest.java"
            - "com/fuacs/backend/dto/request/RoleSearchRequest.java"
          permission:
            - "com/fuacs/backend/dto/request/PermissionCreateRequest.java"
            - "com/fuacs/backend/dto/request/PermissionUpdateRequest.java"
            - "com/fuacs/backend/dto/request/PermissionSearchRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/RoleDTO.java"
          - "com/fuacs/backend/dto/response/PermissionDTO.java"

      dependencies:
        - "BaseEntity.java"

      dependents:
        - "UserRepository.java (Many-to-many with User via user_roles)"
        - "AuthenticationService.java (loads permissions for JWT)"
        - "StaffService.java (assigns roles to staff)"
        - "StudentProfileService.java (assigns STUDENT role)"
        - "PermissionEvaluatorImpl.java (evaluates permissions)"

      notes:
        - "Permission naming convention: DOMAIN_ACTION (e.g., USER_CREATE, SEMESTER_READ)"
        - "Role-permission mapping via role_permissions join table"
        - "User-role mapping via user_roles join table"
        - "Bidirectional relationships: Role ↔ Permission, Role ↔ User"
        - "Permissions are loaded into JWT access token for stateless authorization"

    academic_catalog:
      description: "Academic entities: semesters, majors, subjects, classes"
      core_files:
        entities:
          - "com/fuacs/backend/entity/Semester.java"
          - "com/fuacs/backend/entity/Major.java"
          - "com/fuacs/backend/entity/Subject.java"
          - "com/fuacs/backend/entity/StudyClass.java"
        repositories:
          - "com/fuacs/backend/repository/SemesterRepository.java"
          - "com/fuacs/backend/repository/MajorRepository.java"
          - "com/fuacs/backend/repository/SubjectRepository.java"
          - "com/fuacs/backend/repository/ClassRepository.java"
        services:
          - "com/fuacs/backend/service/SemesterService.java"
          - "com/fuacs/backend/service/MajorService.java"
          - "com/fuacs/backend/service/SubjectService.java"
          - "com/fuacs/backend/service/ClassService.java"
        controllers:
          - "com/fuacs/backend/controller/SemesterController.java"
          - "com/fuacs/backend/controller/MajorController.java"
          - "com/fuacs/backend/controller/SubjectController.java"
          - "com/fuacs/backend/controller/ClassController.java"
        mappers:
          - "com/fuacs/backend/dto/mapper/SemesterMapper.java"
          - "com/fuacs/backend/dto/mapper/MajorMapper.java"
          - "com/fuacs/backend/dto/mapper/SubjectMapper.java"
          - "com/fuacs/backend/dto/mapper/StudyClassMapper.java"

      related_files:
        request_dtos:
          semester:
            - "com/fuacs/backend/dto/request/SemesterCreateRequest.java"
            - "com/fuacs/backend/dto/request/SemesterUpdateRequest.java"
            - "com/fuacs/backend/dto/request/SemesterSearchRequest.java"
          major:
            - "com/fuacs/backend/dto/request/MajorCreateRequest.java"
            - "com/fuacs/backend/dto/request/MajorUpdateRequest.java"
            - "com/fuacs/backend/dto/request/MajorSearchRequest.java"
          subject:
            - "com/fuacs/backend/dto/request/SubjectCreateRequest.java"
            - "com/fuacs/backend/dto/request/SubjectUpdateRequest.java"
            - "com/fuacs/backend/dto/request/SubjectSearchRequest.java"
          class:
            - "com/fuacs/backend/dto/request/ClassCreateRequest.java"
            - "com/fuacs/backend/dto/request/ClassUpdateRequest.java"
            - "com/fuacs/backend/dto/request/ClassSearchRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/SemesterDTO.java"
          - "com/fuacs/backend/dto/response/MajorDTO.java"
          - "com/fuacs/backend/dto/response/SubjectDTO.java"
          - "com/fuacs/backend/dto/response/ClassDTO.java"

      dependencies:
        - "BaseEntity.java"

      dependents:
        - "StudentProfileService.java (Major → StudentProfile relationship)"
        - "SlotService.java (StudyClass → Slot relationship)"

      entity_relationships:
        - "Semester → StudyClass (one-to-many)"
        - "Major → Subject (one-to-many)"
        - "Major → StudentProfile (one-to-many)"
        - "Subject → StudyClass (one-to-many)"
        - "StudyClass → Slot (one-to-many)"
        - "StudyClass → Enrollment (one-to-many)"

      notes:
        - "StudyClass entity named to avoid Java 'class' keyword conflict"
        - "All entities extend BaseEntity for audit fields"
        - "Hierarchical structure: Semester/Major → Subject → StudyClass → Slot"
        - "StudyClass links Subject and Semester together"
        - "Enrollment management now via Enrollment entity (not simple join table)"

    infrastructure:
      description: "Physical infrastructure: rooms, cameras, slots"
      core_files:
        entities:
          - "com/fuacs/backend/entity/Room.java"
          - "com/fuacs/backend/entity/Camera.java"
          - "com/fuacs/backend/entity/Slot.java"
        repositories:
          - "com/fuacs/backend/repository/RoomRepository.java"
          - "com/fuacs/backend/repository/CameraRepository.java"
          - "com/fuacs/backend/repository/SlotRepository.java"
        services:
          - "com/fuacs/backend/service/RoomService.java"
          - "com/fuacs/backend/service/CameraService.java"
          - "com/fuacs/backend/service/SlotService.java"
        controllers:
          - "com/fuacs/backend/controller/RoomController.java"
          - "com/fuacs/backend/controller/CameraController.java"
          - "com/fuacs/backend/controller/SlotController.java"
        mappers:
          - "com/fuacs/backend/dto/mapper/RoomMapper.java"
          - "com/fuacs/backend/dto/mapper/CameraMapper.java"
          - "com/fuacs/backend/dto/mapper/SlotMapper.java"
        enums:
          - "com/fuacs/backend/constant/enums/SlotType.java"

      related_files:
        request_dtos:
          room:
            - "com/fuacs/backend/dto/request/RoomCreateRequest.java"
            - "com/fuacs/backend/dto/request/RoomUpdateRequest.java"
            - "com/fuacs/backend/dto/request/RoomSearchRequest.java"
          camera:
            - "com/fuacs/backend/dto/request/CameraCreateRequest.java"
            - "com/fuacs/backend/dto/request/CameraUpdateRequest.java"
            - "com/fuacs/backend/dto/request/CameraSearchRequest.java"
          slot:
            - "com/fuacs/backend/dto/request/SlotCreateRequest.java"
            - "com/fuacs/backend/dto/request/SlotUpdateRequest.java"
            - "com/fuacs/backend/dto/request/SlotSearchRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/RoomDTO.java"
          - "com/fuacs/backend/dto/response/CameraDTO.java"
          - "com/fuacs/backend/dto/response/SlotDTO.java"
          - "com/fuacs/backend/dto/response/SlotTypeDTO.java"

      dependencies:
        - "BaseEntity.java"
        - "ClassRepository.java (Slot → StudyClass relationship)"
        - "UserRepository.java (Slot → User staff relationship)"
        - "RoomRepository.java (Camera → Room relationship)"

      dependents: []

      notes:
        - "SlotType enum: LECTURE, EXAM"
        - "Slot has many-to-many relationship with Camera via slot_cameras join table"
        - "Camera has unidirectional many-to-one relationship with Room"
        - "Slot.finalizedAt tracks when attendance was finalized"
        - "Slot has one-to-many relationship with AttendanceRecord"

    identity_management:
      description: "Identity verification and submission management"
      core_files:
        entity: "com/fuacs/backend/entity/IdentitySubmission.java"
        repository: "com/fuacs/backend/repository/IdentitySubmissionRepository.java"
        service: "com/fuacs/backend/service/IdentitySubmissionService.java"
        controller: "com/fuacs/backend/controller/IdentitySubmissionController.java"
        mapper: "com/fuacs/backend/dto/mapper/IdentitySubmissionMapper.java"
        enums:
          - "com/fuacs/backend/constant/enums/IdentitySubmissionStatus.java"
          - "com/fuacs/backend/constant/enums/IdentitySubmissionType.java"

      related_files:
        request_dtos:
          - "com/fuacs/backend/dto/request/IdentitySubmissionCreationRequest.java"
          - "com/fuacs/backend/dto/request/IdentitySubmissionReviewRequest.java"
          - "com/fuacs/backend/dto/request/IdentitySubmissionSearchRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/IdentitySubmissionDTO.java"

      dependencies:
        - "UserRepository.java (student and reviewer relationships)"
        - "EmailService.java (rejection notifications)"

      dependents: []

      notes:
        - "IdentitySubmissionStatus: PENDING, APPROVED, REJECTED"
        - "IdentitySubmissionType: INITIAL_REGISTRATION, UPDATE_REQUEST"
        - "File storage for face video and ID card images NOT YET IMPLEMENTED"
        - "Rejection triggers automatic email notification to student"

    student_profiles:
      description: "Student profile management and academic assignment"
      core_files:
        entity: "com/fuacs/backend/entity/StudentProfile.java"
        repository: "com/fuacs/backend/repository/StudentProfileRepository.java"
        service: "com/fuacs/backend/service/StudentProfileService.java"
        controller: "com/fuacs/backend/controller/StudentProfileController.java"
        mapper: "com/fuacs/backend/dto/mapper/StudentProfileMapper.java"

      related_files:
        request_dtos:
          - "com/fuacs/backend/dto/request/StudentProfileCreateRequest.java"
          - "com/fuacs/backend/dto/request/StudentProfileUpdateRequest.java"
          - "com/fuacs/backend/dto/request/StudentProfileSearchRequest.java"
        response_dtos:
          - "com/fuacs/backend/dto/response/StudentProfileDTO.java"

      dependencies:
        - "UserRepository.java (one-to-one relationship via @MapsId)"
        - "MajorRepository.java (major assignment)"
        - "RoleRepository.java (assigns STUDENT role)"
        - "UserMapper.java (maps User fields to StudentProfileDTO)"
        - "EmailService.java (sends password to new students)"

      dependents: []

      notes:
        - "StudentProfile uses @MapsId for one-to-one relationship with User"
        - "Does NOT extend BaseEntity - lifecycle managed through User entity"
        - "Creating student profile automatically assigns STUDENT role"
        - "Random password generated and emailed to student on creation"

    attendance:
      description: "Attendance tracking and remark management"
      core_files:
        entities:
          - "com/fuacs/backend/entity/AttendanceRecord.java"
          - "com/fuacs/backend/entity/AttendanceRemark.java"
        enums:
          - "com/fuacs/backend/constant/enums/AttendanceStatus.java"
          - "com/fuacs/backend/constant/enums/AttendanceMethod.java"

      dependencies:
        - "BaseEntity.java"
        - "UserRepository.java (student and staff relationships)"
        - "SlotRepository.java (slot relationship)"

      dependents: []

      notes:
        - "AttendanceStatus: NOT_YET, PRESENT, ABSENT, ABSENT_AFTER_PRESENT"
        - "AttendanceMethod: AUTO, MANUAL, SYSTEM_FINALIZE"
        - "AttendanceRecord has unique constraint on (student_user_id, slot_id)"
        - "AttendanceRemark allows multiple staff remarks per attendance record"
        - "History field in AttendanceRecord stores JSON of status changes"
        - "Repositories, services, controllers NOT YET IMPLEMENTED"

    slot_interaction:
      description: "Slot announcements and pre-slot messaging"
      core_files:
        entities:
          - "com/fuacs/backend/entity/SlotAnnouncement.java"
          - "com/fuacs/backend/entity/PreSlotMessage.java"

      dependencies:
        - "SlotRepository.java (slot relationship)"
        - "UserRepository.java (creator and student relationships)"

      dependents: []

      notes:
        - "SlotAnnouncement created by lecturers/staff for slot-wide announcements"
        - "PreSlotMessage sent by students to lecturers before slot starts"
        - "PreSlotMessage.acknowledgedAt tracks when lecturer viewed the message"
        - "Both entities use @EntityListeners for audit fields instead of extending BaseEntity"
        - "Repositories, services, controllers NOT YET IMPLEMENTED"

    notifications:
      description: "System notification management and delivery tracking"
      core_files:
        entities:
          - "com/fuacs/backend/entity/SystemNotification.java"
          - "com/fuacs/backend/entity/NotificationDelivery.java"
        enums:
          - "com/fuacs/backend/constant/enums/NotificationType.java"
        services:
          - "com/fuacs/backend/service/EmailService.java"

      dependencies:
        - "UserRepository.java (recipient relationship)"

      dependents:
        - "AuthenticationService.java (password reset emails)"
        - "StudentProfileService.java (new student password emails)"
        - "IdentitySubmissionService.java (rejection notifications)"

      notes:
        - "NotificationType: IDENTITY_REJECTED, IDENTITY_APPROVED, SLOT_CANCELLED, ABSENCE_WARNING_10, ABSENCE_WARNING_20, ABSENCE_WARNING_MAX, EXAM_INELIGIBLE"
        - "SystemNotification stores notification templates/master records"
        - "NotificationDelivery tracks per-user delivery and read status"
        - "EmailService currently implemented for email notifications"
        - "In-app notification repositories, services, controllers NOT YET IMPLEMENTED"

    system_admin:
      description: "System configuration and audit logging"
      core_files:
        entities:
          - "com/fuacs/backend/entity/SystemConfiguration.java"
          - "com/fuacs/backend/entity/OperationalAuditLog.java"

      dependencies:
        - "UserRepository.java (actor relationship in audit log)"

      dependents: []

      notes:
        - "SystemConfiguration stores key-value pairs for system settings"
        - "OperationalAuditLog tracks business operations (slot finalization, identity approval, etc.)"
        - "Both entities use @EntityListeners for audit fields"
        - "Repositories, services, controllers NOT YET IMPLEMENTED"

    enrollment_management:
      description: "Student enrollment in classes with soft delete support"
      core_files:
        entities:
          - "com/fuacs/backend/entity/Enrollment.java"
          - "com/fuacs/backend/entity/EnrollmentId.java"

      dependencies:
        - "StudyClass entity"
        - "User entity"

      dependents:
        - "StudyClass (one-to-many relationship)"

      notes:
        - "Enrollment uses composite primary key (EnrollmentId)"
        - "Supports soft delete via is_active flag"
        - "Uses @MapsId for both relationships (StudyClass and User)"
        - "Does NOT extend BaseEntity, uses @EntityListeners for audit fields"
        - "Repositories, services, controllers NOT YET IMPLEMENTED"

    shared_infrastructure:
      description: "Base classes, utilities, and shared components"
      core_files:
        entities:
          - "com/fuacs/backend/entity/BaseEntity.java"
        services:
          - "com/fuacs/backend/service/EmailService.java"
        mappers:
          - "com/fuacs/backend/dto/mapper/DTOMapper.java"
        response_wrappers:
          - "com/fuacs/backend/dto/response/Response.java"
          - "com/fuacs/backend/dto/response/PagingResponse.java"
          - "com/fuacs/backend/dto/response/BaseDTO.java"
        exceptions:
          - "com/fuacs/backend/exception/GlobalExceptionHandler.java"
          - "com/fuacs/backend/exception/ResourceNotFoundException.java"
        configuration:
          - "com/fuacs/backend/config/CommonBeanConfig.java"
          - "com/fuacs/backend/config/HttpSecurityConfig.java"
          - "com/fuacs/backend/config/PermissionEvaluatorImpl.java"
          - "com/fuacs/backend/config/AuthenticationRequestFilter.java"
          - "com/fuacs/backend/config/CustomAuthenticationEntryPoint.java"

      dependencies: []

      dependents: "All other clusters"

      notes: "ResourceConflictException and InvalidDateRangeException not implemented. System uses IllegalArgumentException and DataIntegrityViolationException instead"

  cluster_summary:
    total_clusters: 13
    fully_implemented_clusters: 8
    partially_implemented_clusters: 5

    files_per_cluster:
      user_management:
        core_files: 5
        request_dtos: 4
        response_dtos: 2
        total: 11

      authentication:
        core_files: 5
        request_dtos: 6
        response_dtos: 1
        total: 12

      role_permission:
        core_files: 8
        request_dtos: 6
        response_dtos: 2
        total: 16

      academic_catalog:
        core_files: 16
        request_dtos: 12
        response_dtos: 4
        total: 32

      infrastructure:
        core_files: 13
        request_dtos: 9
        response_dtos: 4
        total: 26

      identity_management:
        core_files: 7
        request_dtos: 3
        response_dtos: 1
        total: 11

      student_profiles:
        core_files: 5
        request_dtos: 3
        response_dtos: 1
        total: 9

      attendance:
        core_files: 4
        request_dtos: 0
        response_dtos: 0
        total: 4
        status: "entities only"

      slot_interaction:
        core_files: 2
        request_dtos: 0
        response_dtos: 0
        total: 2
        status: "entities only"

      notifications:
        core_files: 4
        request_dtos: 0
        response_dtos: 0
        total: 4
        status: "entities only (EmailService exists)"

      system_admin:
        core_files: 2
        request_dtos: 0
        response_dtos: 0
        total: 2
        status: "entities only"

      enrollment_management:
        core_files: 2
        request_dtos: 0
        response_dtos: 0
        total: 2
        status: "entities only"

      shared_infrastructure:
        core_files: 15
        total: 15

    grand_total_files: 148

  cross_cluster_dependencies:
    most_depended_on:
      - cluster: "shared_infrastructure"
        reason: "Provides base classes, utilities, and configuration for all clusters"
        key_components:
          [
            "BaseEntity",
            "EmailService",
            "DTOMapper",
            "Response wrappers",
            "GlobalExceptionHandler",
            "Security configuration",
          ]

      - cluster: "user_management"
        reason: "User entity is referenced by many other entities"
        key_components: ["UserRepository", "UserMapper", "User entity"]
        dependents:
          [
            "authentication",
            "student_profiles",
            "identity_management",
            "infrastructure (Slot)",
            "attendance",
            "slot_interaction",
            "notifications",
            "system_admin",
            "enrollment_management",
          ]

      - cluster: "role_permission"
        reason: "RBAC system used throughout application"
        key_components:
          ["RoleRepository", "PermissionRepository", "PermissionEvaluatorImpl"]
        dependents: ["authentication", "user_management", "student_profiles"]

    dependency_chains:
      chain_1:
        path: "student_profiles → user_management → role_permission → shared_infrastructure"
        description: "Student profile creation requires user creation, role assignment, and base infrastructure"

      chain_2:
        path: "authentication → user_management → role_permission → shared_infrastructure"
        description: "Authentication loads user with roles and permissions for JWT token generation"

      chain_3:
        path: "infrastructure (Slot) → academic_catalog (StudyClass) → shared_infrastructure"
        description: "Slots reference classes which reference subjects/semesters"

      chain_4:
        path: "infrastructure (Slot) → user_management (staff) → shared_infrastructure"
        description: "Slots reference staff users (lecturers/supervisors)"

      chain_5:
        path: "identity_management → user_management → shared_infrastructure"
        description: "Identity submissions reference student and reviewer users"

      chain_6:
        path: "attendance → infrastructure (Slot) → academic_catalog (StudyClass) → shared_infrastructure"
        description: "Attendance records reference slots which reference classes"

      chain_7:
        path: "attendance → user_management (student) → shared_infrastructure"
        description: "Attendance records reference student users"

      chain_8:
        path: "slot_interaction → infrastructure (Slot) → user_management → shared_infrastructure"
        description: "Slot announcements and pre-slot messages reference slots and users"

      chain_9:
        path: "notifications → user_management (recipient) → shared_infrastructure"
        description: "Notification deliveries reference recipient users"

      chain_10:
        path: "enrollment_management → academic_catalog (StudyClass) → user_management (student) → shared_infrastructure"
        description: "Enrollments link students to classes"

    circular_dependencies: "None - clean dependency hierarchy maintained"

    integration_points:
      - "EmailService used by: authentication, user_management, student_profiles, identity_management"
      - "UserRepository used by: authentication, student_profiles, identity_management, infrastructure (Slot), attendance, slot_interaction, notifications, system_admin, enrollment_management"
      - "RoleRepository used by: authentication, user_management, student_profiles"
      - "SlotRepository used by: attendance, slot_interaction"
      - "BaseEntity extended by: User, Role, Permission, Semester, Major, Subject, StudyClass, Room, Camera, Slot, AttendanceRecord, AttendanceRemark"
      - "@EntityListeners used by: Enrollment, SlotAnnouncement, PreSlotMessage, SystemNotification, NotificationDelivery, SystemConfiguration, OperationalAuditLog"
      - "Entities NOT extending BaseEntity: PasswordResetToken, IdentitySubmission, StudentProfile, Enrollment, EnrollmentId, SlotAnnouncement, PreSlotMessage, SystemNotification, NotificationDelivery, SystemConfiguration, OperationalAuditLog"
