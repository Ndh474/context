# Communication Tables
# FUACS Database Schema - Version 1.0

tables:
  system_notifications:
    primary_key: id
    description: "System-generated notifications for users"
    columns:
      id:
        type: BIGINT
        constraints: [NOT NULL, PRIMARY KEY, AUTO_INCREMENT]
        description: "Unique notification identifier"
      created_at:
        type: timestamp
        constraints: [NOT NULL]
        default: now()
        description: "Notification creation timestamp"
      updated_at:
        type: timestamp
        constraints: [NOT NULL]
        description: "Notification last update timestamp"
      is_active:
        type: boolean
        constraints: [NOT NULL]
        default: true
        description: "Notification status"
      notification_type:
        type: varchar(50)
        constraints: [NOT NULL]
        description: "Type of notification (e.g., 'identity_rejected', 'slot_cancelled')"
      title:
        type: varchar(255)
        constraints: [NOT NULL]
        description: "Notification title"
      content:
        type: text
        constraints: [NOT NULL]
        description: "Notification content/message"
    indexes:
      - name: idx_system_notifications_type
        columns: [notification_type]
        description: "For filtering by notification type"
    notes:
      - "Template-based notifications generated by system events"
      - "Delivered to specific users via notification_deliveries table"

  notification_deliveries:
    primary_key: id
    description: "Delivery records for system notifications to specific users"
    columns:
      id:
        type: BIGINT
        constraints: [NOT NULL, PRIMARY KEY, AUTO_INCREMENT]
        description: "Unique delivery identifier"
      created_at:
        type: timestamp
        constraints: [NOT NULL]
        default: now()
        description: "Delivery creation timestamp"
      updated_at:
        type: timestamp
        constraints: [NOT NULL]
        description: "Delivery last update timestamp"
      read_at:
        type: timestamp
        constraints: [NULL]
        description: "When user read the notification (null if unread)"
      notification_id:
        type: bigint
        constraints: [NOT NULL]
        foreign_key:
          table: system_notifications
          column: id
        description: "Reference to system notification"
      recipient_user_id:
        type: int
        constraints: [NOT NULL]
        foreign_key:
          table: users
          column: id
        description: "User who should receive this notification"
      is_active:
        type: boolean
        constraints: [NOT NULL]
        default: true
        description: "Delivery status"
    indexes:
      - name: idx_notification_deliveries_recipient_unread
        columns: [recipient_user_id, read_at]
        description: "For unread notification queries (WHERE read_at IS NULL)"

      - name: idx_notification_deliveries_recipient_created
        columns: [recipient_user_id, created_at]
        description: "For notification inbox ordered by date"
    notes:
      - "One delivery record per notification per recipient"
      - "Tracks read status for each user individually"
      - "Used to show unread counts and notification history"

communication_flow:
  - "System generates system_notifications for various events (identity rejection, absence warnings, etc.)"
  - "notification_deliveries tracks which users receive which notifications"
  - "Students view system notifications in their Web notification inbox"
